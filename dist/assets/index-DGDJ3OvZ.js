var e=Object.defineProperty,t=(t,s,r)=>((t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r)(t,"symbol"!=typeof s?s+"":s,r);import{b as s,e as r,r as n,u as a,j as i,L as o,f as l,h as c,R as d,i as u,a as h,k as m,N as p,l as f,$ as g,Q as x,m as y,B as v,n as b,o as w}from"./vendor-ubRHmO-g.js";import{_ as j,t as N,a as _,S,L as k,T as C,C as T,R as E,O as I,P,b as O,c as A,d as D,D as M,e as q,f as R,g as $,I as L,h as Q,i as F,j as U,k as W,V,l as z,m as B,n as H,o as G,p as K,q as Y,r as J,s as Z,u as X,v as ee,w as te,x as se,y as re,z as ne,A as ae,B as ie,E as oe,F as le,G as ce,H as de,J as ue,K as he,M as me,N as pe,Q as fe,U as ge,W as xe,X as ye,Y as ve,Z as be,$ as we,a0 as je,a1 as Ne,a2 as _e,a3 as Se,a4 as ke,a5 as Ce,a6 as Te,a7 as Ee,a8 as Ie,a9 as Pe,aa as Oe,ab as Ae,ac as De,ad as Me,ae as qe,af as Re,ag as $e,ah as Le,ai as Qe,aj as Fe,ak as Ue,al as We,am as Ve,an as ze,ao as Be,ap as He,aq as Ge,ar as Ke,as as Ye,at as Je,au as Ze,av as Xe,aw as et,ax as tt,ay as st,az as rt,aA as nt,aB as at,aC as it,aD as ot}from"./ui-D8PhiAW8.js";import{c as lt,R as ct,T as dt,L as ut,C as ht,X as mt,Y as pt,a as ft,b as gt,B as xt,d as yt}from"./charts-CjcHNzPG.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var vt={},bt=s;vt.createRoot=bt.createRoot,vt.hydrateRoot=bt.hydrateRoot;const wt={},jt=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));r=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in wt)return;wt[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,s&&n.setAttribute("nonce",s),document.head.appendChild(n),t?new Promise((t,s)=>{n.addEventListener("load",t),n.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})};class Nt extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class _t extends Nt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class St extends Nt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class kt extends Nt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ct,Tt;(Tt=Ct||(Ct={})).Any="any",Tt.ApNortheast1="ap-northeast-1",Tt.ApNortheast2="ap-northeast-2",Tt.ApSouth1="ap-south-1",Tt.ApSoutheast1="ap-southeast-1",Tt.ApSoutheast2="ap-southeast-2",Tt.CaCentral1="ca-central-1",Tt.EuCentral1="eu-central-1",Tt.EuWest1="eu-west-1",Tt.EuWest2="eu-west-2",Tt.EuWest3="eu-west-3",Tt.SaEast1="sa-east-1",Tt.UsEast1="us-east-1",Tt.UsWest1="us-west-1",Tt.UsWest2="us-west-2";class Et{constructor(e,{headers:t={},customFetch:s,region:r=Ct.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>jt(async()=>{const{default:e}=await Promise.resolve().then(()=>Wt);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)})(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return j(this,arguments,void 0,function*(e,t={}){var s;try{const{headers:r,method:n,body:a,signal:i}=t;let o={},{region:l}=t;l||(l=this.region);const c=new URL(`${this.url}/${e}`);let d;l&&"any"!==l&&(o["x-region"]=l,c.searchParams.set("forceFunctionRegion",l)),a&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)?"undefined"!=typeof Blob&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",d=a):"string"==typeof a?(o["Content-Type"]="text/plain",d=a):"undefined"!=typeof FormData&&a instanceof FormData?d=a:(o["Content-Type"]="application/json",d=JSON.stringify(a)):d=a;const u=yield this.fetch(c.toString(),{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),r),body:d,signal:i}).catch(e=>{if("AbortError"===e.name)throw e;throw new _t(e)}),h=u.headers.get("x-relay-error");if(h&&"true"===h)throw new St(u);if(!u.ok)throw new kt(u);let m,p=(null!==(s=u.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return m="application/json"===p?yield u.json():"application/octet-stream"===p||"application/pdf"===p?yield u.blob():"text/event-stream"===p?u:"multipart/form-data"===p?yield u.formData():yield u.text(),{data:m,error:null,response:u}}catch(r){return r instanceof Error&&"AbortError"===r.name?{data:null,error:new _t(r)}:{data:null,error:r,response:r instanceof kt||r instanceof St?r.context:void 0}}})}}var It={};const Pt=r(N);var Ot={},At={},Dt={},Mt={},qt={},Rt=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const $t=Rt.fetch,Lt=Rt.fetch.bind(Rt),Qt=Rt.Headers,Ft=Rt.Request,Ut=Rt.Response,Wt=Object.freeze(Object.defineProperty({__proto__:null,Headers:Qt,Request:Ft,Response:Ut,default:Lt,fetch:$t},Symbol.toStringTag,{value:"Module"})),Vt=r(Wt);var zt,Bt,Ht,Gt,Kt,Yt,Jt={};function Zt(){if(zt)return Jt;zt=1,Object.defineProperty(Jt,"__esModule",{value:!0});class e extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}return Jt.default=e,Jt}function Xt(){if(Bt)return qt;Bt=1,Object.defineProperty(qt,"__esModule",{value:!0});const e=Pt,t=e.__importDefault(Vt),s=e.__importDefault(Zt());return qt.default=class{constructor(e){var s,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(s=e.shouldThrowOnError)&&void 0!==s&&s,this.signal=e.signal,this.isMaybeSingle=null!==(r=e.isMaybeSingle)&&void 0!==r&&r,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=t.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,r,n,a;let i=null,o=null,l=null,c=e.status,d=e.statusText;if(e.ok){if("HEAD"!==this.method){const s=await e.text();""===s||(o="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null===(t=this.headers.get("Accept"))||void 0===t?void 0:t.includes("application/vnd.pgrst.plan+text"))?s:JSON.parse(s))}const s=null===(r=this.headers.get("Prefer"))||void 0===r?void 0:r.match(/count=(exact|planned|estimated)/),a=null===(n=e.headers.get("content-range"))||void 0===n?void 0:n.split("/");s&&a&&a.length>1&&(l=parseInt(a[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(o)&&(o.length>1?(i={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,l=null,c=406,d="Not Acceptable"):o=1===o.length?o[0]:null)}else{const t=await e.text();try{i=JSON.parse(t),Array.isArray(i)&&404===e.status&&(o=[],i=null,c=200,d="OK")}catch(u){404===e.status&&""===t?(c=204,d="No Content"):i={message:t}}if(i&&this.isMaybeSingle&&(null===(a=null==i?void 0:i.details)||void 0===a?void 0:a.includes("0 rows"))&&(i=null,c=200,d="OK"),i&&this.shouldThrowOnError)throw new s.default(i)}return{error:i,data:o,count:l,status:c,statusText:d}});return this.shouldThrowOnError||(r=r.catch(e=>{var t,s,r;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:""}`,hint:"",code:`${null!==(r=null==e?void 0:e.code)&&void 0!==r?r:""}`},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}},qt}function es(){if(Ht)return Mt;Ht=1,Object.defineProperty(Mt,"__esModule",{value:!0});const e=Pt.__importDefault(Xt());class t extends e.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:n=r}={}){const a=n?`${n}.order`:"order",i=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${i?`${i},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){const n=void 0===r?"offset":`${r}.offset`,a=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(a,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:n=!1,format:a="text"}={}){var i;const o=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!==(i=this.headers.get("Accept"))&&void 0!==i?i:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${a}; for="${l}"; options=${o};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}}return Mt.default=t,Mt}function ts(){if(Gt)return Dt;Gt=1,Object.defineProperty(Dt,"__esModule",{value:!0});const e=Pt.__importDefault(es());class t extends e.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let n="";"plain"===r?n="pl":"phrase"===r?n="ph":"websearch"===r&&(n="w");const a=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${n}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}}return Dt.default=t,Dt}function ss(){if(Kt)return At;Kt=1,Object.defineProperty(At,"__esModule",{value:!0});const e=Pt.__importDefault(ts());return At.default=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=new Headers(t),this.schema=s,this.fetch=r}select(t,s){const{head:r=!1,count:n}=null!=s?s:{},a=r?"HEAD":"GET";let i=!1;const o=(null!=t?t:"*").split("").map(e=>/\s/.test(e)&&!i?"":('"'===e&&(i=!i),e)).join("");return this.url.searchParams.set("select",o),n&&this.headers.append("Prefer",`count=${n}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:s,defaultToNull:r=!0}={}){var n;if(s&&this.headers.append("Prefer",`count=${s}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const e=t.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(e.length>0){const t=[...new Set(e)].map(e=>`"${e}"`);this.url.searchParams.set("columns",t.join(","))}}return new e.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}upsert(t,{onConflict:s,ignoreDuplicates:r=!1,count:n,defaultToNull:a=!0}={}){var i;if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),void 0!==s&&this.url.searchParams.set("on_conflict",s),n&&this.headers.append("Prefer",`count=${n}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const e=t.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(e.length>0){const t=[...new Set(e)].map(e=>`"${e}"`);this.url.searchParams.set("columns",t.join(","))}}return new e.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}update(t,{count:s}={}){var r;return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}delete({count:t}={}){var s;return t&&this.headers.append("Prefer",`count=${t}`),new e.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}},At}Object.defineProperty(It,"__esModule",{value:!0}),It.PostgrestError=It.PostgrestBuilder=It.PostgrestTransformBuilder=It.PostgrestFilterBuilder=It.PostgrestQueryBuilder=It.PostgrestClient=void 0;const rs=Pt,ns=rs.__importDefault(function(){if(Yt)return Ot;Yt=1,Object.defineProperty(Ot,"__esModule",{value:!0});const e=Pt,t=e.__importDefault(ss()),s=e.__importDefault(ts());class r{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=new Headers(t),this.schemaName=s,this.fetch=r}from(e){const s=new URL(`${this.url}/${e}`);return new t.default(s,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new r(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:n=!1,count:a}={}){var i;let o;const l=new URL(`${this.url}/rpc/${e}`);let c;r||n?(o=r?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{l.searchParams.append(e,t)})):(o="POST",c=t);const d=new Headers(this.headers);return a&&d.set("Prefer",`count=${a}`),new s.default({method:o,url:l,headers:d,schema:this.schemaName,body:c,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}}return Ot.default=r,Ot}());It.PostgrestClient=ns.default;const as=rs.__importDefault(ss());It.PostgrestQueryBuilder=as.default;const is=rs.__importDefault(ts());It.PostgrestFilterBuilder=is.default;const os=rs.__importDefault(es());It.PostgrestTransformBuilder=os.default;const ls=rs.__importDefault(Xt());It.PostgrestBuilder=ls.default;const cs=rs.__importDefault(Zt());It.PostgrestError=cs.default;var ds=It.default={PostgrestClient:ns.default,PostgrestQueryBuilder:as.default,PostgrestFilterBuilder:is.default,PostgrestTransformBuilder:os.default,PostgrestBuilder:ls.default,PostgrestError:cs.default};const{PostgrestClient:us,PostgrestQueryBuilder:hs,PostgrestFilterBuilder:ms,PostgrestTransformBuilder:ps,PostgrestBuilder:fs,PostgrestError:gs}=ds;class xs{static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process){const e=process.versions;if(e&&e.node){const t=e.node,s=parseInt(t.replace(/^v/,"").split(".")[0]);return s>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`\n\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}}const ys=1e4;var vs,bs,ws,js,Ns,_s,Ss,ks,Cs,Ts,Es;(bs=vs||(vs={}))[bs.connecting=0]="connecting",bs[bs.open=1]="open",bs[bs.closing=2]="closing",bs[bs.closed=3]="closed",(js=ws||(ws={})).closed="closed",js.errored="errored",js.joined="joined",js.joining="joining",js.leaving="leaving",(_s=Ns||(Ns={})).close="phx_close",_s.error="phx_error",_s.join="phx_join",_s.reply="phx_reply",_s.leave="phx_leave",_s.access_token="access_token",(Ss||(Ss={})).websocket="websocket",(Cs=ks||(ks={})).Connecting="connecting",Cs.Open="open",Cs.Closing="closing",Cs.Closed="closed";class Is{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),n=t.getUint8(2);let a=this.HEADER_LENGTH+2;const i=s.decode(e.slice(a,a+r));a+=r;const o=s.decode(e.slice(a,a+n));a+=n;return{ref:null,topic:i,event:o,payload:JSON.parse(s.decode(e.slice(a,e.byteLength)))}}}class Ps{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(Es=Ts||(Ts={})).abstime="abstime",Es.bool="bool",Es.date="date",Es.daterange="daterange",Es.float4="float4",Es.float8="float8",Es.int2="int2",Es.int4="int4",Es.int4range="int4range",Es.int8="int8",Es.int8range="int8range",Es.json="json",Es.jsonb="jsonb",Es.money="money",Es.numeric="numeric",Es.oid="oid",Es.reltime="reltime",Es.text="text",Es.time="time",Es.timestamp="timestamp",Es.timestamptz="timestamptz",Es.timetz="timetz",Es.tsrange="tsrange",Es.tstzrange="tstzrange";const Os=(e,t,s={})=>{var r;const n=null!==(r=s.skipTypes)&&void 0!==r?r:[];return t?Object.keys(t).reduce((s,r)=>(s[r]=As(r,e,t,n),s),{}):{}},As=(e,t,s,r)=>{const n=t.find(t=>t.name===e),a=null==n?void 0:n.type,i=s[e];return a&&!r.includes(a)?Ds(a,i):Ms(i)},Ds=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return Ls(t,s)}switch(e){case Ts.bool:return qs(t);case Ts.float4:case Ts.float8:case Ts.int2:case Ts.int4:case Ts.int8:case Ts.numeric:case Ts.oid:return Rs(t);case Ts.json:case Ts.jsonb:return $s(t);case Ts.timestamp:return Qs(t);case Ts.abstime:case Ts.date:case Ts.daterange:case Ts.int4range:case Ts.int8range:case Ts.money:case Ts.reltime:case Ts.text:case Ts.time:case Ts.timestamptz:case Ts.timetz:case Ts.tsrange:case Ts.tstzrange:default:return Ms(t)}},Ms=e=>e,qs=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Rs=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},$s=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}return e},Ls=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,r=e[s];if("{"===e[0]&&"}"===r){let r;const a=e.slice(1,s);try{r=JSON.parse("["+a+"]")}catch(n){r=a?a.split(","):[]}return r.map(e=>Ds(t,e))}return e},Qs=e=>"string"==typeof e?e.replace(" ","T"):e,Fs=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class Us{constructor(e,t,s={},r=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ws,Vs,zs,Bs,Hs,Gs,Ks,Ys;(Vs=Ws||(Ws={})).SYNC="sync",Vs.JOIN="join",Vs.LEAVE="leave";class Js{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Js.syncState(this.state,e,t,s),this.pendingDiffs.forEach(e=>{this.state=Js.syncDiff(this.state,e,t,s)}),this.pendingDiffs=[],r()}),this.channel._on(s.diff,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Js.syncDiff(this.state,e,t,s),r())}),this.onJoin((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})}),this.onLeave((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){const n=this.cloneDeep(e),a=this.transformState(t),i={},o={};return this.map(n,(e,t)=>{a[e]||(o[e]=t)}),this.map(a,(e,t)=>{const s=n[e];if(s){const r=t.map(e=>e.presence_ref),n=s.map(e=>e.presence_ref),a=t.filter(e=>n.indexOf(e.presence_ref)<0),l=s.filter(e=>r.indexOf(e.presence_ref)<0);a.length>0&&(i[e]=a),l.length>0&&(o[e]=l)}else i[e]=t}),this.syncDiff(n,{joins:i,leaves:o},s,r)}static syncDiff(e,t,s,r){const{joins:n,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(n,(t,r)=>{var n;const a=null!==(n=e[t])&&void 0!==n?n:[];if(e[t]=this.cloneDeep(r),a.length>0){const s=e[t].map(e=>e.presence_ref),r=a.filter(e=>s.indexOf(e.presence_ref)<0);e[t].unshift(...r)}s(t,a,r)}),this.map(a,(t,s)=>{let n=e[t];if(!n)return;const a=s.map(e=>e.presence_ref);n=n.filter(e=>a.indexOf(e.presence_ref)<0),e[t]=n,r(t,n,s),0===n.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const r=e[s];return t[s]="metas"in r?r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(Bs=zs||(zs={})).ALL="*",Bs.INSERT="INSERT",Bs.UPDATE="UPDATE",Bs.DELETE="DELETE",(Gs=Hs||(Hs={})).BROADCAST="broadcast",Gs.PRESENCE="presence",Gs.POSTGRES_CHANGES="postgres_changes",Gs.SYSTEM="system",(Ys=Ks||(Ks={})).SUBSCRIBED="SUBSCRIBED",Ys.TIMED_OUT="TIMED_OUT",Ys.CLOSED="CLOSED",Ys.CHANNEL_ERROR="CHANNEL_ERROR";class Zs{constructor(e,t={config:{}},s){var r,n;if(this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=ws.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Us(this,Ns.join,this.params,this.timeout),this.rejoinTimer=new Ps(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ws.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ws.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=ws.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ws.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=ws.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ns.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new Js(this),this.broadcastEndpointURL=Fs(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(n=null===(r=this.params.config)||void 0===r?void 0:r.broadcast)||void 0===n?void 0:n.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,r,n;if(this.socket.isConnected()||this.socket.connect(),this.state==ws.closed){const{config:{broadcast:a,presence:i,private:o}}=this.params,l=null!==(r=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map(e=>e.filter))&&void 0!==r?r:[],c=!!this.bindings[Hs.PRESENCE]&&this.bindings[Hs.PRESENCE].length>0||!0===(null===(n=this.params.config.presence)||void 0===n?void 0:n.enabled),d={},u={broadcast:a,presence:Object.assign(Object.assign({},i),{enabled:c}),postgres_changes:l,private:o};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(Ks.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(Ks.CLOSED)),this.updateJoinPayload(Object.assign({config:u},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var s;if(this.socket.setAuth(),void 0!==t){const r=this.bindings.postgres_changes,n=null!==(s=null==r?void 0:r.length)&&void 0!==s?s:0,a=[];for(let s=0;s<n;s++){const n=r[s],{filter:{event:i,schema:o,table:l,filter:c}}=n,d=t&&t[s];if(!d||d.event!==i||d.schema!==o||d.table!==l||d.filter!==c)return this.unsubscribe(),this.state=ws.errored,void(null==e||e(Ks.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));a.push(Object.assign(Object.assign({},n),{id:d.id}))}return this.bindings.postgres_changes=a,void(e&&e(Ks.SUBSCRIBED))}null==e||e(Ks.SUBSCRIBED)}).receive("error",t=>{this.state=ws.errored,null==e||e(Ks.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(Ks.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===ws.joined&&e===Hs.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}async httpSend(e,t,s={}){var r;const n=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(null==t)return Promise.reject("Payload is required for httpSend()");const a={method:"POST",headers:{Authorization:n,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},i=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(r=s.timeout)&&void 0!==r?r:this.timeout);if(202===i.status)return{success:!0};let o=i.statusText;try{const e=await i.json();o=e.error||e.message||o}catch(l){}return Promise.reject(new Error(o))}async send(e,t={}){var s,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(s=>{var r,n,a;const i=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(a=null===(n=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===n?void 0:n.broadcast)||void 0===a?void 0:a.ack)||s("ok"),i.receive("ok",()=>s("ok")),i.receive("error",()=>s("error")),i.receive("timeout",()=>s("timed out"))});{const{event:a,payload:i}=e,o={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:i,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return await(null===(r=e.body)||void 0===r?void 0:r.cancel()),e.ok?"ok":"error"}catch(n){return"AbortError"===n.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=ws.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ns.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(r=>{s=new Us(this,Ns.leave,{},e),s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{null==s||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=ws.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){const r=new AbortController,n=setTimeout(()=>r.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(n),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new Us(this,e,t,s);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,n;const a=e.toLocaleLowerCase(),{close:i,error:o,leave:l,join:c}=Ns;if(s&&[i,o,l,c].indexOf(a)>=0&&s!==this._joinRef())return;let d=this._onMessage(a,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(e=>{var t,s,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===r?void 0:r.toLocaleLowerCase())===a}).map(e=>e.callback(d,s)):null===(n=this.bindings[a])||void 0===n||n.filter(e=>{var s,r,n,i,o,l;if(["broadcast","presence","postgres_changes"].includes(a)){if("id"in e){const a=e.id,i=null===(s=e.filter)||void 0===s?void 0:s.event;return a&&(null===(r=t.ids)||void 0===r?void 0:r.includes(a))&&("*"===i||(null==i?void 0:i.toLocaleLowerCase())===(null===(n=t.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const s=null===(o=null===(i=null==e?void 0:e.filter)||void 0===i?void 0:i.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===s||s===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===a}).map(e=>{if("object"==typeof d&&"ids"in d){const e=d.data,{schema:t,table:s,commit_timestamp:r,type:n,errors:a}=e,i={schema:t,table:s,commit_timestamp:r,eventType:n,new:{},old:{},errors:a};d=Object.assign(Object.assign({},i),this._getPayloadRecords(e))}e.callback(d,s)})}_isClosed(){return this.state===ws.closed}_isJoined(){return this.state===ws.joined}_isJoining(){return this.state===ws.joining}_isLeaving(){return this.state===ws.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),n={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(n):this.bindings[r]=[n],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===s&&Zs.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ns.close,{},e)}_onError(e){this._on(Ns.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ws.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=Os(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=Os(e.columns,e.old_record)),t}}const Xs=()=>{},er=25e3,tr=10,sr=100,rr=[1e3,2e3,5e3,1e4];class nr{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ys,this.transport=null,this.heartbeatIntervalMs=er,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Xs,this.ref=0,this.reconnectTimer=null,this.logger=Xs,this.conn=null,this.sendBuffer=[],this.serializer=new Is,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>jt(async()=>{const{default:e}=await Promise.resolve().then(()=>Wt);return{default:e}},void 0).then(({default:t})=>t(...e)).catch(e=>{throw new Error(`Failed to load @supabase/node-fetch: ${e.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):fetch),(...e)=>t(...e)},!(null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Ss.websocket}`,this.httpEndpoint=Fs(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=xs.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error(`${t}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case vs.connecting:return ks.Connecting;case vs.open:return ks.Open;case vs.closing:return ks.Closing;default:return ks.Closed}}isConnected(){return this.connectionState()===ks.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){const s=`realtime:${e}`,r=this.getChannels().find(e=>e.topic===s);if(r)return r;{const s=new Zs(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:s,payload:r,ref:n}=e,a=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${s} (${n})`,r),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},sr)}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event)try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error")}catch(o){this.log("error","error in heartbeat callback",o)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:s,payload:r,ref:n}=e,a=n?`(${n})`:"",i=r.status||"";this.log("receive",`${i} ${t} ${s} ${a}`.trim(),r),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(s,r,n)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ns.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;t=e||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const s={access_token:t,version:"realtime-js/2.76.1"};t&&e.updateJoinPayload(s),e.joinedOnce&&e._isJoined()&&e._push(Ns.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(r){this.log("error",`error in ${e} callback`,r)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new Ps(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},tr)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,r,n,a,i,o,l,c;if(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(s=null==e?void 0:e.timeout)&&void 0!==s?s:ys,this.heartbeatIntervalMs=null!==(r=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==r?r:er,this.worker=null!==(n=null==e?void 0:e.worker)&&void 0!==n&&n,this.accessToken=null!==(a=null==e?void 0:e.accessToken)&&void 0!==a?a:null,this.heartbeatCallback=null!==(i=null==e?void 0:e.heartbeatCallback)&&void 0!==i?i:Xs,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(o=null==e?void 0:e.reconnectAfterMs)&&void 0!==o?o:e=>rr[e-1]||1e4,this.encode=null!==(l=null==e?void 0:e.encode)&&void 0!==l?l:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(c=null==e?void 0:e.decode)&&void 0!==c?c:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}class ar extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ir(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class or extends ar{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class lr extends ar{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const cr=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>jt(async()=>{const{default:e}=await Promise.resolve().then(()=>Wt);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},dr=e=>{if(Array.isArray(e))return e.map(e=>dr(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,s])=>{const r=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[r]=dr(s)}),t},ur=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),hr=(e,t,s)=>j(void 0,void 0,void 0,function*(){const r=yield j(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield jt(()=>Promise.resolve().then(()=>Wt),void 0)).Response:Response});e instanceof r&&!(null==s?void 0:s.noResolveJson)?e.json().then(s=>{const r=e.status||500,n=(null==s?void 0:s.statusCode)||r+"";t(new or(ur(s),r,n))}).catch(e=>{t(new lr(ur(e),e))}):t(new lr(ur(e),e))}),mr=(e,t,s,r)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&r?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(r)?(n.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),n.body=JSON.stringify(r)):n.body=r,(null==t?void 0:t.duplex)&&(n.duplex=t.duplex),Object.assign(Object.assign({},n),s)):n};function pr(e,t,s,r,n,a){return j(this,void 0,void 0,function*(){return new Promise((i,o)=>{e(s,mr(t,r,n,a)).then(e=>{if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?e:e.json()}).then(e=>i(e)).catch(e=>hr(e,o,r))})})}function fr(e,t,s,r){return j(this,void 0,void 0,function*(){return pr(e,"GET",t,s,r)})}function gr(e,t,s,r,n){return j(this,void 0,void 0,function*(){return pr(e,"POST",t,r,n,s)})}function xr(e,t,s,r,n){return j(this,void 0,void 0,function*(){return pr(e,"PUT",t,r,n,s)})}function yr(e,t,s,r,n){return j(this,void 0,void 0,function*(){return pr(e,"DELETE",t,r,n,s)})}class vr{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return j(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ir(e))return{data:null,error:e};throw e}})}}var br;class wr{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[br]="BlobDownloadBuilder",this.promise=null}asStream(){return new vr(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return j(this,void 0,void 0,function*(){try{const e=yield this.downloadFn();return{data:yield e.blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ir(e))return{data:null,error:e};throw e}})}}br=Symbol.toStringTag;const jr={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Nr={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class _r{constructor(e,t={},s,r){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=s,this.fetch=cr(r)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,s,r){return j(this,void 0,void 0,function*(){try{let n;const a=Object.assign(Object.assign({},Nr),r);let i=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(a.upsert)});const o=a.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(n=new FormData,n.append("cacheControl",a.cacheControl),o&&n.append("metadata",this.encodeMetadata(o)),n.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(n=s,n.append("cacheControl",a.cacheControl),o&&n.append("metadata",this.encodeMetadata(o))):(n=s,i["cache-control"]=`max-age=${a.cacheControl}`,i["content-type"]=a.contentType,o&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(o)))),(null==r?void 0:r.headers)&&(i=Object.assign(Object.assign({},i),r.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),d=yield("PUT"==e?xr:gr)(this.fetch,`${this.url}/object/${c}`,n,Object.assign({headers:i},(null==a?void 0:a.duplex)?{duplex:a.duplex}:{}));return{data:{path:l,id:d.Id,fullPath:d.Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ir(n))return{data:null,error:n};throw n}})}upload(e,t,s){return j(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return j(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),a=this._getFinalPath(n),i=new URL(this.url+`/object/upload/sign/${a}`);i.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:Nr.upsert},r),a=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,a["cache-control"]=`max-age=${t.cacheControl}`,a["content-type"]=t.contentType);return{data:{path:n,fullPath:(yield xr(this.fetch,i.toString(),e,{headers:a})).Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(ir(o))return{data:null,error:o};throw o}})}createSignedUploadUrl(e,t){return j(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(r["x-upsert"]="true");const n=yield gr(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),a=new URL(this.url+n.url),i=a.searchParams.get("token");if(!i)throw new ar("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:i},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ir(s))return{data:null,error:s};throw s}})}update(e,t,s){return j(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return j(this,void 0,void 0,function*(){try{return{data:yield gr(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ir(r))return{data:null,error:r};throw r}})}copy(e,t,s){return j(this,void 0,void 0,function*(){try{return{data:{path:(yield gr(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ir(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,s){return j(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),n=yield gr(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const a=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${a}`)},{data:n,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ir(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,s){return j(this,void 0,void 0,function*(){try{const r=yield gr(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:r.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${n}`):null})),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ir(r))return{data:null,error:r};throw r}})}download(e,t){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=r?`?${r}`:"",a=this._getFinalPath(e);return new wr(()=>fr(this.fetch,`${this.url}/${s}/${a}${n}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}info(e){return j(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield fr(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:dr(e),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ir(s))return{data:null,error:s};throw s}})}exists(e){return j(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,r){return j(this,void 0,void 0,function*(){return pr(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ir(s)&&s instanceof lr){const e=s.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&r.push(n);const a=void 0!==(null==t?void 0:t.transform)?"render/image":"object",i=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==i&&r.push(i);let o=r.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${s}${o}`)}}}remove(e){return j(this,void 0,void 0,function*(){try{return{data:yield yr(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ir(t))return{data:null,error:t};throw t}})}list(e,t,s){return j(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},jr),t),{prefix:e||""});return{data:yield gr(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ir(r))return{data:null,error:r};throw r}})}listV2(e,t){return j(this,void 0,void 0,function*(){try{const s=Object.assign({},e);return{data:yield gr(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ir(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Sr="2.76.1",kr={"X-Client-Info":`storage-js/${Sr}`};class Cr{constructor(e,t={},s,r){this.shouldThrowOnError=!1;const n=new URL(e);if(null==r?void 0:r.useNewHostname){/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase."))}this.url=n.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},kr),t),this.fetch=cr(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return j(this,void 0,void 0,function*(){try{return{data:yield fr(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ir(e))return{data:null,error:e};throw e}})}getBucket(e){return j(this,void 0,void 0,function*(){try{return{data:yield fr(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ir(t))return{data:null,error:t};throw t}})}createBucket(e){return j(this,arguments,void 0,function*(e,t={public:!1}){try{return{data:yield gr(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ir(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return j(this,void 0,void 0,function*(){try{return{data:yield xr(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ir(s))return{data:null,error:s};throw s}})}emptyBucket(e){return j(this,void 0,void 0,function*(){try{return{data:yield gr(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ir(t))return{data:null,error:t};throw t}})}deleteBucket(e){return j(this,void 0,void 0,function*(){try{return{data:yield yr(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ir(t))return{data:null,error:t};throw t}})}}class Tr{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},kr),t),this.fetch=cr(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return j(this,void 0,void 0,function*(){try{return{data:yield gr(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ir(t))return{data:null,error:t};throw t}})}listBuckets(e){return j(this,void 0,void 0,function*(){try{const t=new URLSearchParams;void 0!==(null==e?void 0:e.limit)&&t.set("limit",e.limit.toString()),void 0!==(null==e?void 0:e.offset)&&t.set("offset",e.offset.toString()),(null==e?void 0:e.sortColumn)&&t.set("sortColumn",e.sortColumn),(null==e?void 0:e.sortOrder)&&t.set("sortOrder",e.sortOrder),(null==e?void 0:e.search)&&t.set("search",e.search);const s=t.toString(),r=s?`${this.url}/bucket?${s}`:`${this.url}/bucket`,n=yield fr(this.fetch,r,{headers:this.headers});return{data:Array.isArray(n)?n.filter(e=>"ANALYTICS"===e.type):[],error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ir(t))return{data:null,error:t};throw t}})}deleteBucket(e){return j(this,void 0,void 0,function*(){try{return{data:yield yr(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ir(t))return{data:null,error:t};throw t}})}}const Er={"X-Client-Info":`storage-js/${Sr}`,"Content-Type":"application/json"};class Ir extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function Pr(e){return"object"==typeof e&&null!==e&&"__isStorageVectorsError"in e}class Or extends Ir{constructor(e,t,s){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ar extends Ir{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}var Dr,Mr;(Mr=Dr||(Dr={})).InternalError="InternalError",Mr.S3VectorConflictException="S3VectorConflictException",Mr.S3VectorNotFoundException="S3VectorNotFoundException",Mr.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",Mr.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",Mr.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded";const qr=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>jt(async()=>{const{default:e}=await Promise.resolve().then(()=>Wt);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},Rr=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),$r=(e,t,s,r)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return r?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(r)?(n.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),n.body=JSON.stringify(r)):n.body=r,Object.assign(Object.assign({},n),s)):n};function Lr(e,t,s,r,n,a){return j(this,void 0,void 0,function*(){return new Promise((i,o)=>{e(s,$r(t,r,n,a)).then(e=>{if(!e.ok)throw e;if(null==r?void 0:r.noResolveJson)return e;const t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():{}}).then(e=>i(e)).catch(e=>((e,t,s)=>j(void 0,void 0,void 0,function*(){if(e&&"object"==typeof e&&"status"in e&&"ok"in e&&"number"==typeof e.status&&!(null==s?void 0:s.noResolveJson)){const s=e.status||500,r=e;if("function"==typeof r.json)r.json().then(e=>{const r=(null==e?void 0:e.statusCode)||(null==e?void 0:e.code)||s+"";t(new Or(Rr(e),s,r))}).catch(()=>{const e=s+"",n=r.statusText||`HTTP ${s} error`;t(new Or(n,s,e))});else{const e=s+"",n=r.statusText||`HTTP ${s} error`;t(new Or(n,s,e))}}else t(new Ar(Rr(e),e))}))(e,o,r))})})}function Qr(e,t,s,r,n){return j(this,void 0,void 0,function*(){return Lr(e,"POST",t,r,n,s)})}class Fr{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Er),t),this.fetch=qr(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return j(this,void 0,void 0,function*(){try{return{data:(yield Qr(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pr(t))return{data:null,error:t};throw t}})}getIndex(e,t){return j(this,void 0,void 0,function*(){try{return{data:yield Qr(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Pr(s))return{data:null,error:s};throw s}})}listIndexes(e){return j(this,void 0,void 0,function*(){try{return{data:yield Qr(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pr(t))return{data:null,error:t};throw t}})}deleteIndex(e,t){return j(this,void 0,void 0,function*(){try{return{data:(yield Qr(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Pr(s))return{data:null,error:s};throw s}})}}class Ur{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Er),t),this.fetch=qr(s)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return j(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield Qr(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pr(t))return{data:null,error:t};throw t}})}getVectors(e){return j(this,void 0,void 0,function*(){try{return{data:yield Qr(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pr(t))return{data:null,error:t};throw t}})}listVectors(e){return j(this,void 0,void 0,function*(){try{if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error("segmentIndex must be between 0 and "+(e.segmentCount-1))}return{data:yield Qr(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pr(t))return{data:null,error:t};throw t}})}queryVectors(e){return j(this,void 0,void 0,function*(){try{return{data:yield Qr(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pr(t))return{data:null,error:t};throw t}})}deleteVectors(e){return j(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield Qr(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pr(t))return{data:null,error:t};throw t}})}}class Wr{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Er),t),this.fetch=qr(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return j(this,void 0,void 0,function*(){try{return{data:(yield Qr(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pr(t))return{data:null,error:t};throw t}})}getBucket(e){return j(this,void 0,void 0,function*(){try{return{data:yield Qr(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pr(t))return{data:null,error:t};throw t}})}listBuckets(){return j(this,arguments,void 0,function*(e={}){try{return{data:yield Qr(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pr(t))return{data:null,error:t};throw t}})}deleteBucket(e){return j(this,void 0,void 0,function*(){try{return{data:(yield Qr(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Pr(t))return{data:null,error:t};throw t}})}}class Vr extends Wr{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new zr(this.url,this.headers,e,this.fetch)}}class zr extends Fr{constructor(e,t,s,r){super(e,t,r),this.vectorBucketName=s}createIndex(e){const t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return j(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return j(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return j(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return j(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new Br(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class Br extends Ur{constructor(e,t,s,r,n){super(e,t,n),this.vectorBucketName=s,this.indexName=r}putVectors(e){const t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return j(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return j(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return j(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return j(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return j(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class Hr extends Cr{constructor(e,t={},s,r){super(e,t,s,r)}from(e){return new _r(this.url,this.headers,e,this.fetch)}get vectors(){return new Vr(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Tr(this.url+"/iceberg",this.headers,this.fetch)}}let Gr="";Gr="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Kr={headers:{"X-Client-Info":`supabase-js-${Gr}/2.76.1`}},Yr={schema:"public"},Jr={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Zr={},Xr=(e,t,s)=>{const r=(e=>{let t;return t=e||("undefined"==typeof fetch?Lt:fetch),(...e)=>t(...e)})(s),n="undefined"==typeof Headers?Qt:Headers;return async(s,a)=>{var i;const o=null!==(i=await t())&&void 0!==i?i:e;let l=new n(null==a?void 0:a.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),r(s,Object.assign(Object.assign({},a),{headers:l}))}};const en="2.76.1",tn=3e4,sn=9e4,rn={"X-Client-Info":`gotrue-js/${en}`},nn="X-Supabase-Api-Version",an={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},on=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class ln extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function cn(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class dn extends ln{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class un extends ln{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class hn extends ln{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class mn extends hn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class pn extends hn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class fn extends hn{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class gn extends hn{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class xn extends hn{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class yn extends hn{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function vn(e){return cn(e)&&"AuthRetryableFetchError"===e.name}class bn extends hn{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class wn extends hn{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const jn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Nn=" \t\n\r=".split(""),_n=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Nn.length;t+=1)e[Nn[t].charCodeAt(0)]=-2;for(let t=0;t<jn.length;t+=1)e[jn[t].charCodeAt(0)]=t;return e})();function Sn(e,t,s){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(jn[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(jn[e]),t.queuedBits-=6}}function kn(e,t,s){const r=_n[e];if(!(r>-1)){if(-2===r)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function Cn(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},a=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,r,s)};for(let i=0;i<e.length;i+=1)kn(e.charCodeAt(i),n,a);return t.join("")}function Tn(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function En(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let n=0;n<e.length;n+=1)kn(e.charCodeAt(n),s,r);return new Uint8Array(t)}function In(e){const t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let r=e.charCodeAt(s);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}Tn(r,t)}}(e,e=>t.push(e)),new Uint8Array(t)}function Pn(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};return e.forEach(e=>Sn(e,s,r)),Sn(null,s,r),t.join("")}const On=()=>"undefined"!=typeof window&&"undefined"!=typeof document,An={tested:!1,writable:!1},Dn=()=>{if(!On())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(An.tested)return An.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),An.tested=!0,An.writable=!0}catch(t){An.tested=!0,An.writable=!1}return An.writable};const Mn=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>jt(async()=>{const{default:e}=await Promise.resolve().then(()=>Wt);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},qn=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},Rn=async(e,t)=>{const s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(r){return s}},$n=async(e,t)=>{await e.removeItem(t)};class Ln{constructor(){this.promise=new Ln.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function Qn(e){const t=e.split(".");if(3!==t.length)throw new wn("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!on.test(t[s]))throw new wn("JWT not in base64url format");return{header:JSON.parse(Cn(t[0])),payload:JSON.parse(Cn(t[1])),signature:En(t[2]),raw:{header:t[0],payload:t[1]}}}function Fn(e){return("0"+e.toString(16)).substr(-2)}async function Un(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return e;const t=await async function(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Wn(e,t,s=!1){const r=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let r=0;r<56;r++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,Fn).join("")}();let n=r;s&&(n+="/PASSWORD_RECOVERY"),await qn(e,`${t}-code-verifier`,n);const a=await Un(r);return[a,r===a?"plain":"s256"]}Ln.promiseConstructor=Promise;const Vn=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const zn=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Bn(e){if(!zn.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Hn(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Gn(e){return JSON.parse(JSON.stringify(e))}const Kn=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Yn=[502,503,504];async function Jn(e){var t,s;if(!("object"==typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new yn(Kn(e),0);if(Yn.includes(e.status))throw new yn(Kn(e),e.status);let r,n;try{r=await e.json()}catch(i){throw new un(Kn(i),i)}const a=function(e){const t=e.headers.get(nn);if(!t)return null;if(!t.match(Vn))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(i){return null}}(e);if(a&&a.getTime()>=an.timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?n=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(n=r.error_code),n){if("weak_password"===n)throw new bn(Kn(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===n)throw new mn}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new bn(Kn(r),e.status,r.weak_password.reasons);throw new dn(Kn(r),e.status||500,n)}async function Zn(e,t,s,r){var n;const a=Object.assign({},null==r?void 0:r.headers);a[nn]||(a[nn]=an.name),(null==r?void 0:r.jwt)&&(a.Authorization=`Bearer ${r.jwt}`);const i=null!==(n=null==r?void 0:r.query)&&void 0!==n?n:{};(null==r?void 0:r.redirectTo)&&(i.redirect_to=r.redirectTo);const o=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await async function(e,t,s,r,n,a){const i=((e,t,s,r)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),s))})(t,r,n,a);let o;try{o=await e(s,Object.assign({},i))}catch(l){throw new yn(Kn(l),0)}o.ok||await Jn(o);if(null==r?void 0:r.noResolveJson)return o;try{return await o.json()}catch(l){await Jn(l)}}(e,t,s+o,{headers:a,noResolveJson:null==r?void 0:r.noResolveJson},{},null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}function Xn(e){var t;let s=null;var r;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function ea(e){const t=Xn(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function ta(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function sa(e){return{data:e,error:null}}function ra(e){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:n,verification_type:a}=e,i=_(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:r,redirect_to:n,verification_type:a},user:Object.assign({},i)},error:null}}function na(e){return e}const aa=["global","local","others"];class ia{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Mn(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=aa[0]){if(aa.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${aa.join(", ")}`);try{return await Zn(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(cn(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await Zn(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ta})}catch(s){if(cn(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=_(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=null==s?void 0:s.newEmail,delete r.newEmail),await Zn(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:ra,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(cn(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Zn(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ta})}catch(t){if(cn(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,r,n,a,i,o;try{const l={nextPage:null,lastPage:0,total:0},c=await Zn(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(n=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==n?n:""},xform:na});if(c.error)throw c.error;const d=await c.json(),u=null!==(a=c.headers.get("x-total-count"))&&void 0!==a?a:0,h=null!==(o=null===(i=c.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(cn(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){Bn(e);try{return await Zn(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ta})}catch(t){if(cn(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Bn(e);try{return await Zn(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ta})}catch(s){if(cn(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){Bn(e);try{return await Zn(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ta})}catch(s){if(cn(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){Bn(e.userId);try{const{data:t,error:s}=await Zn(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(t){if(cn(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Bn(e.userId),Bn(e.id);try{return{data:await Zn(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(cn(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,s,r,n,a,i,o;try{const l={nextPage:null,lastPage:0,total:0},c=await Zn(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(n=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==n?n:""},xform:na});if(c.error)throw c.error;const d=await c.json(),u=null!==(a=c.headers.get("x-total-count"))&&void 0!==a?a:0,h=null!==(o=null===(i=c.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(cn(l))return{data:{clients:[]},error:l};throw l}}async _createOAuthClient(e){try{return await Zn(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(cn(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await Zn(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(cn(t))return{data:null,error:t};throw t}}async _deleteOAuthClient(e){try{return await Zn(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(cn(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await Zn(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(cn(t))return{data:null,error:t};throw t}}}function oa(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const la=!!(globalThis&&Dn()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class ca extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class da extends ca{}async function ua(e,t,s){const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort()},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async r=>{if(!r){if(0===t)throw new da(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(la)try{await globalThis.navigator.locks.query()}catch(n){}return await s()}try{return await s()}finally{}}))}function ha(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function ma(e){const t=(new TextEncoder).encode(e);return"0x"+Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}class pa extends Error{constructor({message:e,code:t,cause:s,name:r}){var n;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=null!==(n=null!=r?r:s instanceof Error?s.name:void 0)&&void 0!==n?n:"Unknown Error",this.code=t}}class fa extends pa{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function ga({error:e,options:t}){var s,r,n;const{publicKey:a}=t;if(!a)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new pa({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if(!0===(null===(s=a.authenticatorSelection)||void 0===s?void 0:s.requireResidentKey))return new pa({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if("conditional"===t.mediation&&"required"===(null===(r=a.authenticatorSelection)||void 0===r?void 0:r.userVerification))return new pa({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if("required"===(null===(n=a.authenticatorSelection)||void 0===n?void 0:n.userVerification))return new pa({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if("InvalidStateError"===e.name)return new pa({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if("NotAllowedError"===e.name)return new pa({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("NotSupportedError"===e.name){return 0===a.pubKeyCredParams.filter(e=>"public-key"===e.type).length?new pa({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new pa({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e})}if("SecurityError"===e.name){const t=window.location.hostname;if(!Na(t))return new pa({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(a.rp.id!==t)return new pa({message:`The RP ID "${a.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(a.user.id.byteLength<1||a.user.id.byteLength>64)return new pa({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new pa({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new pa({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function xa({error:e,options:t}){const{publicKey:s}=t;if(!s)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new pa({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if("NotAllowedError"===e.name)return new pa({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("SecurityError"===e.name){const t=window.location.hostname;if(!Na(t))return new pa({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(s.rpId!==t)return new pa({message:`The RP ID "${s.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new pa({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new pa({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}const ya=new class{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};function va(e){if(!e)throw new Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:s,excludeCredentials:r}=e,n=_(e,["challenge","user","excludeCredentials"]),a=En(t).buffer,i=Object.assign(Object.assign({},s),{id:En(s.id).buffer}),o=Object.assign(Object.assign({},n),{challenge:a,user:i});if(r&&r.length>0){o.excludeCredentials=new Array(r.length);for(let e=0;e<r.length;e++){const t=r[e];o.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:En(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return o}function ba(e){if(!e)throw new Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:s}=e,r=_(e,["challenge","allowCredentials"]),n=En(t).buffer,a=Object.assign(Object.assign({},r),{challenge:n});if(s&&s.length>0){a.allowCredentials=new Array(s.length);for(let e=0;e<s.length;e++){const t=s[e];a.allowCredentials[e]=Object.assign(Object.assign({},t),{id:En(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return a}function wa(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const s=e;return{id:e.id,rawId:e.id,response:{attestationObject:Pn(new Uint8Array(e.response.attestationObject)),clientDataJSON:Pn(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:null!==(t=s.authenticatorAttachment)&&void 0!==t?t:void 0}}function ja(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const s=e,r=e.getClientExtensionResults(),n=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Pn(new Uint8Array(n.authenticatorData)),clientDataJSON:Pn(new Uint8Array(n.clientDataJSON)),signature:Pn(new Uint8Array(n.signature)),userHandle:n.userHandle?Pn(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:null!==(t=s.authenticatorAttachment)&&void 0!==t?t:void 0}}function Na(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function _a(){var e,t;return!!(On()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&"function"==typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}const Sa={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},ka={userVerification:"preferred",hints:["security-key"]};function Ca(...e){const t=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),s=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),r={};for(const n of e)if(n)for(const e in n){const a=n[e];if(void 0!==a)if(Array.isArray(a))r[e]=a;else if(s(a))r[e]=a;else if(t(a)){const s=r[e];t(s)?r[e]=Ca(s,a):r[e]=Ca(a)}else r[e]=a}return r}class Ta{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:s,signal:r},n){try{const{data:a,error:i}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!a)return{data:null,error:i};const o=null!=r?r:ya.createNewAbortSignal();if("create"===a.webauthn.type){const{user:e}=a.webauthn.credential_options.publicKey;e.name||(e.name=`${e.id}:${s}`),e.displayName||(e.displayName=e.name)}switch(a.webauthn.type){case"create":{const t=function(e,t){return Ca(Sa,e,t||{})}(a.webauthn.credential_options.publicKey,null==n?void 0:n.create),{data:s,error:r}=await async function(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new fa("Browser returned unexpected credential type",t)}:{data:null,error:new fa("Empty credential response",t)}}catch(t){return{data:null,error:ga({error:t,options:e})}}}({publicKey:t,signal:o});return s?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:s}},error:null}:{data:null,error:r}}case"request":{const t=function(e,t){return Ca(ka,e,t||{})}(a.webauthn.credential_options.publicKey,null==n?void 0:n.request),{data:s,error:r}=await async function(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new fa("Browser returned unexpected credential type",t)}:{data:null,error:new fa("Empty credential response",t)}}catch(t){return{data:null,error:xa({error:t,options:e})}}}(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:t,signal:o}));return s?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:s}},error:null}:{data:null,error:r}}}}catch(a){return cn(a)?{data:null,error:a}:{data:null,error:new un("Unexpected error in challenge",a)}}}async _verify({challengeId:e,factorId:t,webauthn:s}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:s=("undefined"!=typeof window?[window.location.origin]:void 0),signal:r}},n){if(!t)return{data:null,error:new ln("rpId is required for WebAuthn authentication")};try{if(!_a())return{data:null,error:new un("Browser does not support WebAuthn",null)};const{data:a,error:i}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:s},signal:r},{request:n});if(!a)return{data:null,error:i};const{webauthn:o}=a;return this._verify({factorId:e,challengeId:a.challengeId,webauthn:{type:o.type,rpId:t,rpOrigins:s,credential_response:o.credential_response}})}catch(a){return cn(a)?{data:null,error:a}:{data:null,error:new un("Unexpected error in authenticate",a)}}}async _register({friendlyName:e,rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:s=("undefined"!=typeof window?[window.location.origin]:void 0),signal:r},n){if(!t)return{data:null,error:new ln("rpId is required for WebAuthn registration")};try{if(!_a())return{data:null,error:new un("Browser does not support WebAuthn",null)};const{data:a,error:i}=await this._enroll({friendlyName:e});if(!a)return await this.client.mfa.listFactors().then(t=>{var s;return null===(s=t.data)||void 0===s?void 0:s.all.find(t=>"webauthn"===t.factor_type&&t.friendly_name===e&&"unverified"!==t.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0),{data:null,error:i};const{data:o,error:l}=await this._challenge({factorId:a.id,friendlyName:a.friendly_name,webauthn:{rpId:t,rpOrigins:s},signal:r},{create:n});return o?this._verify({factorId:a.id,challengeId:o.challengeId,webauthn:{rpId:t,rpOrigins:s,type:o.webauthn.type,credential_response:o.webauthn.credential_response}}):{data:null,error:l}}catch(a){return cn(a)?{data:null,error:a}:{data:null,error:new un("Unexpected error in register",a)}}}}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const Ea={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:rn,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ia(e,t,s){return await s()}const Pa={};class Oa{get jwks(){var e,t;return null!==(t=null===(e=Pa[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){Pa[this.storageKey]=Object.assign(Object.assign({},Pa[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=Pa[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Pa[this.storageKey]=Object.assign(Object.assign({},Pa[this.storageKey]),{cachedAt:e})}constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Oa.nextInstanceID,Oa.nextInstanceID+=1,this.instanceID>0&&On();const r=Object.assign(Object.assign({},Ea),e);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new ia({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Mn(r.fetch),this.lock=r.lock||Ia,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:On()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=ua:this.lock=Ia,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Ta(this)},this.persistSession?(r.storage?this.storage=r.storage:Dn()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=oa(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=oa(this.memoryStorage)),On()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${en}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach((e,s)=>{t[s]=e})}catch(r){}return s.searchParams.forEach((e,s)=>{t[s]=e}),t}(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),On()&&this.detectSessionInUrl&&"none"!==s){const{data:r,error:n}=await this._getSessionFromURL(t,s);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),function(e){return cn(e)&&"AuthImplicitGrantRedirectError"===e.name}(n)){const t=null===(e=n.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:n}}return await this._removeSession(),{error:n}}const{session:a,redirectType:i}=r;return this._debug("#_initialize()","detected session in URL",a,"redirect type",i),await this._saveSession(a),setTimeout(async()=>{"recovery"===i?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return cn(t)?{error:t}:{error:new un("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,r;try{const n=await Zn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:Xn}),{data:a,error:i}=n;if(i||!a)return{data:{user:null,session:null},error:i};const o=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(n){if(cn(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,s,r;try{let n;if("email"in e){const{email:s,password:r,options:a}=e;let i=null,o=null;"pkce"===this.flowType&&([i,o]=await Wn(this.storage,this.storageKey)),n=await Zn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==a?void 0:a.emailRedirectTo,body:{email:s,password:r,data:null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken},code_challenge:i,code_challenge_method:o},xform:Xn})}else{if(!("phone"in e))throw new fn("You must provide either an email or phone number and a password");{const{phone:t,password:a,options:i}=e;n=await Zn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:a,data:null!==(s=null==i?void 0:i.data)&&void 0!==s?s:{},channel:null!==(r=null==i?void 0:i.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:Xn})}}const{data:a,error:i}=n;if(i||!a)return{data:{user:null,session:null},error:i};const o=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(n){if(cn(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:r,options:n}=e;t=await Zn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:ea})}else{if(!("phone"in e))throw new fn("You must provide either an email or phone number and a password");{const{phone:s,password:r,options:n}=e;t=await Zn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:ea})}}const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:s&&s.session&&s.user?(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r}):{data:{user:null,session:null},error:new pn}}catch(t){if(cn(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,r,n;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(n=e.options)||void 0===n?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,s,r,n,a,i,o,l,c,d,u;let h,m;if("message"in e)h=e.message,m=e.signature;else{const{chain:d,wallet:u,statement:p,options:f}=e;let g;if(On())if("object"==typeof u)g=u;else{const e=window;if(!("ethereum"in e)||"object"!=typeof e.ethereum||!("request"in e.ethereum)||"function"!=typeof e.ethereum.request)throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");g=e.ethereum}else{if("object"!=typeof u||!(null==f?void 0:f.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");g=u}const x=new URL(null!==(t=null==f?void 0:f.url)&&void 0!==t?t:window.location.href),y=await g.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!y||0===y.length)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const v=ha(y[0]);let b=null===(s=null==f?void 0:f.signInWithEthereum)||void 0===s?void 0:s.chainId;if(!b){const e=await g.request({method:"eth_chainId"});b=parseInt(e,16)}h=function(e){var t;const{chainId:s,domain:r,expirationTime:n,issuedAt:a=new Date,nonce:i,notBefore:o,requestId:l,resources:c,scheme:d,uri:u,version:h}=e;if(!Number.isInteger(s))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${s}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(i&&i.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${i}`);if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==h)throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(null===(t=e.statement)||void 0===t?void 0:t.includes("\n"))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`);const m=`${d?`${d}://${r}`:r} wants you to sign in with your Ethereum account:\n${ha(e.address)}\n\n${e.statement?`${e.statement}\n`:""}`;let p=`URI: ${u}\nVersion: ${h}\nChain ID: ${s}${i?`\nNonce: ${i}`:""}\nIssued At: ${a.toISOString()}`;if(n&&(p+=`\nExpiration Time: ${n.toISOString()}`),o&&(p+=`\nNot Before: ${o.toISOString()}`),l&&(p+=`\nRequest ID: ${l}`),c){let e="\nResources:";for(const t of c){if(!t||"string"!=typeof t)throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${t}`);e+=`\n- ${t}`}p+=e}return`${m}\n${p}`}({domain:x.host,address:v,statement:p,uri:x.href,version:"1",chainId:b,nonce:null===(r=null==f?void 0:f.signInWithEthereum)||void 0===r?void 0:r.nonce,issuedAt:null!==(a=null===(n=null==f?void 0:f.signInWithEthereum)||void 0===n?void 0:n.issuedAt)&&void 0!==a?a:new Date,expirationTime:null===(i=null==f?void 0:f.signInWithEthereum)||void 0===i?void 0:i.expirationTime,notBefore:null===(o=null==f?void 0:f.signInWithEthereum)||void 0===o?void 0:o.notBefore,requestId:null===(l=null==f?void 0:f.signInWithEthereum)||void 0===l?void 0:l.requestId,resources:null===(c=null==f?void 0:f.signInWithEthereum)||void 0===c?void 0:c.resources}),m=await g.request({method:"personal_sign",params:[ma(h),v]})}try{const{data:t,error:s}=await Zn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:h,signature:m},(null===(d=e.options)||void 0===d?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:null===(u=e.options)||void 0===u?void 0:u.captchaToken}}:null),xform:Xn});if(s)throw s;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:s}):{data:{user:null,session:null},error:new pn}}catch(p){if(cn(p))return{data:{user:null,session:null},error:p};throw p}}async signInWithSolana(e){var t,s,r,n,a,i,o,l,c,d,u,h;let m,p;if("message"in e)m=e.message,p=e.signature;else{const{chain:u,wallet:h,statement:f,options:g}=e;let x;if(On())if("object"==typeof h)x=h;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");x=e.solana}else{if("object"!=typeof h||!(null==g?void 0:g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=h}const y=new URL(null!==(t=null==g?void 0:g.url)&&void 0!==t?t:window.location.href);if("signIn"in x&&x.signIn){const e=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==g?void 0:g.signInWithSolana),{version:"1",domain:y.host,uri:y.href}),f?{statement:f}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");m="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in x&&"function"==typeof x.signMessage&&"publicKey"in x&&"object"==typeof x&&x.publicKey&&"toBase58"in x.publicKey&&"function"==typeof x.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${y.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),...f?["",f,""]:[""],"Version: 1",`URI: ${y.href}`,`Issued At: ${null!==(r=null===(s=null==g?void 0:g.signInWithSolana)||void 0===s?void 0:s.issuedAt)&&void 0!==r?r:(new Date).toISOString()}`,...(null===(n=null==g?void 0:g.signInWithSolana)||void 0===n?void 0:n.notBefore)?[`Not Before: ${g.signInWithSolana.notBefore}`]:[],...(null===(a=null==g?void 0:g.signInWithSolana)||void 0===a?void 0:a.expirationTime)?[`Expiration Time: ${g.signInWithSolana.expirationTime}`]:[],...(null===(i=null==g?void 0:g.signInWithSolana)||void 0===i?void 0:i.chainId)?[`Chain ID: ${g.signInWithSolana.chainId}`]:[],...(null===(o=null==g?void 0:g.signInWithSolana)||void 0===o?void 0:o.nonce)?[`Nonce: ${g.signInWithSolana.nonce}`]:[],...(null===(l=null==g?void 0:g.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${g.signInWithSolana.requestId}`]:[],...(null===(d=null===(c=null==g?void 0:g.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===d?void 0:d.length)?["Resources",...g.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=await x.signMessage((new TextEncoder).encode(m),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:s}=await Zn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:Pn(p)},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:Xn});if(s)throw s;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:s}):{data:{user:null,session:null},error:new pn}}catch(f){if(cn(f))return{data:{user:null,session:null},error:f};throw f}}async _exchangeCodeForSession(e){const t=await Rn(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(null!=t?t:"").split("/");try{const{data:t,error:n}=await Zn(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Xn});if(await $n(this.storage,`${this.storageKey}-code-verifier`),n)throw n;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=r?r:null}),error:n}):{data:{user:null,session:null,redirectType:null},error:new pn}}catch(n){if(cn(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:t,provider:s,token:r,access_token:n,nonce:a}=e,i=await Zn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:n,nonce:a,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:Xn}),{data:o,error:l}=i;return l?{data:{user:null,session:null},error:l}:o&&o.session&&o.user?(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:o,error:l}):{data:{user:null,session:null},error:new pn}}catch(t){if(cn(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,r,n,a;try{if("email"in e){const{email:r,options:n}=e;let a=null,i=null;"pkce"===this.flowType&&([a,i]=await Wn(this.storage,this.storageKey));const{error:o}=await Zn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},create_user:null===(s=null==n?void 0:n.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:a,code_challenge_method:i},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){const{phone:t,options:s}=e,{data:i,error:o}=await Zn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(r=null==s?void 0:s.data)&&void 0!==r?r:{},create_user:null===(n=null==s?void 0:s.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(a=null==s?void 0:s.channel)&&void 0!==a?a:"sms"}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o}}throw new fn("You must provide either an email or phone number.")}catch(i){if(cn(i))return{data:{user:null,session:null},error:i};throw i}}async verifyOtp(e){var t,s;try{let r,n;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,n=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:a,error:i}=await Zn(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:r,xform:Xn});if(i)throw i;if(!a)throw new Error("An error occurred on token verification.");const o=a.session,l=a.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(r){if(cn(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var t,s,r;try{let n=null,a=null;return"pkce"===this.flowType&&([n,a]=await Wn(this.storage,this.storageKey)),await Zn(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:a}),headers:this.headers,xform:sa})}catch(n){if(cn(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new mn;const{error:r}=await Zn(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(cn(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:n}=e,{error:a}=await Zn(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:s,type:r,options:n}=e,{data:a,error:i}=await Zn(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:i}}throw new fn("You must provide either an email or phone number and a type")}catch(t){if(cn(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch(e){}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(t){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await Rn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<sn;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const t=await Rn(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=Hn()}if(this.storage.isServer&&e.user){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,r)=>(t||"user"!==s||(t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,r))})}return{data:{session:e},error:null}}const{data:r,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,async()=>await this._getUser())}async _getUser(e){try{return e?await Zn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ta}):await this._useSession(async e=>{var t,s,r;const{data:n,error:a}=e;if(a)throw a;return(null===(t=n.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Zn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(s=n.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0,xform:ta}):{data:{user:null},error:new mn}})}catch(t){if(cn(t))return function(e){return cn(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await $n(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:r,error:n}=s;if(n)throw n;if(!r.session)throw new mn;const a=r.session;let i=null,o=null;"pkce"===this.flowType&&null!=e.email&&([i,o]=await Wn(this.storage,this.storageKey));const{data:l,error:c}=await Zn(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:i,code_challenge_method:o}),jwt:a.access_token,xform:ta});if(c)throw c;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(s){if(cn(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new mn;const t=Date.now()/1e3;let s=t,r=!0,n=null;const{payload:a}=Qn(e.access_token);if(a.exp&&(s=a.exp,r=s<=t),r){const{data:t,error:s}=await this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};n=t}else{const{data:r,error:a}=await this._getUser(e.access_token);if(a)throw a;n={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(cn(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:r,error:n}=t;if(n)throw n;e=null!==(s=r.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new mn;const{data:r,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(cn(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!On())throw new gn("No browser detected.");if(e.error||e.error_description||e.error_code)throw new gn(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new xn("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new gn("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new xn("No code detected.");const{data:t,error:s}=await this._exchangeCodeForSession(e.code);if(s)throw s;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:n,refresh_token:a,expires_in:i,expires_at:o,token_type:l}=e;if(!(n&&i&&a&&l))throw new gn("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(i);let u=c+d;o&&(u=parseInt(o));const{data:h,error:m}=await this._getUser(n);if(m)throw m;const p={provider_token:s,provider_refresh_token:r,access_token:n,expires_in:d,expires_at:u,refresh_token:a,token_type:l,user:h.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:p,redirectType:e.type},error:null}}catch(s){if(cn(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Rn(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:r,error:n}=t;if(n)return{error:n};const a=null===(s=r.session)||void 0===s?void 0:s.access_token;if(a){const{error:t}=await this.admin.signOut(a,e);if(t&&(!function(e){return cn(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await $n(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,r;try{const{data:{session:r},error:n}=t;if(n)throw n;await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(n){await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n)}})}async resetPasswordForEmail(e,t={}){let s=null,r=null;"pkce"===this.flowType&&([s,r]=await Wn(this.storage,this.storageKey,!0));try{return await Zn(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(cn(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(cn(t))return{data:null,error:t};throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:s,error:r}=await this._useSession(async t=>{var s,r,n,a,i;const{data:o,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:!0});return await Zn(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(i=null===(a=o.session)||void 0===a?void 0:a.access_token)&&void 0!==i?i:void 0})});if(r)throw r;return On()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(s){if(cn(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var s;try{const{error:r,data:{session:n}}=t;if(r)throw r;const{options:a,provider:i,token:o,access_token:l,nonce:c}=e,d=await Zn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!==(s=null==n?void 0:n.access_token)&&void 0!==s?s:void 0,body:{provider:i,id_token:o,access_token:l,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:Xn}),{data:u,error:h}=d;return h?{data:{user:null,session:null},error:h}:u&&u.session&&u.user?(u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("USER_UPDATED",u.session)),{data:u,error:h}):{data:{user:null,session:null},error:new pn}}catch(r){if(cn(r))return{data:{user:null,session:null},error:r};throw r}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,r;const{data:n,error:a}=t;if(a)throw a;return await Zn(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(s=n.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0})})}catch(t){if(cn(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await(s=async s=>(s>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await Zn(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Xn})),r=(e,t)=>{const s=200*Math.pow(2,e);return t&&vn(t)&&Date.now()+s-n<tn},new Promise((e,t)=>{(async()=>{for(let a=0;a<1/0;a++)try{const t=await s(a);if(!r(a,null,t))return void e(t)}catch(n){if(!r(a,n))return void t(n)}})()}))}catch(n){if(this._debug(t,"error",n),cn(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}var s,r}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),On()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const n=await Rn(this.storage,this.storageKey);if(n&&this.userStorage){let t=await Rn(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:n.user},await qn(this.userStorage,this.storageKey+"-user",t)),n.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:Hn()}else if(n&&!n.user&&!n.user){const e=await Rn(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(n.user=e.user,await $n(this.storage,this.storageKey+"-user"),await qn(this.storage,this.storageKey,n)):n.user=Hn()}if(this._debug(s,"session from storage",n),!this._isValidSession(n))return this._debug(s,"session is not valid"),void(null!==n&&await this._removeSession());const a=1e3*(null!==(t=n.expires_at)&&void 0!==t?t:1/0)-Date.now()<sn;if(this._debug(s,`session has${a?"":" not"} expired with margin of 90000s`),a){if(this.autoRefreshToken&&n.refresh_token){const{error:e}=await this._callRefreshToken(n.refresh_token);e&&(vn(e)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(n.user&&!0===n.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(n.access_token);!t&&(null==e?void 0:e.user)?(n.user=e.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(r){this._debug(s,"error getting user data, skipping SIGNED_IN notification",r)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){return void this._debug(s,"error",n)}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new mn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Ln;const{data:t,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new mn;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={data:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(n){if(this._debug(r,"error",n),cn(n)){const e={data:null,error:n};return vn(n)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(n),n}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],n=Array.from(this.stateChangeEmitters.values()).map(async s=>{try{await s.callback(e,t)}catch(n){r.push(n)}});if(await Promise.all(n),r.length>0){for(let e=0;e<r.length;e+=1);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!s&&t.user&&await qn(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const r=Gn(e);await qn(this.storage,this.storageKey,r)}else{const e=Gn(t);await qn(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),await $n(this.storage,this.storageKey),await $n(this.storage,this.storageKey+"-code-verifier"),await $n(this.storage,this.storageKey+"-user"),this.userStorage&&await $n(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&On()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),tn);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:s}}=e;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*s.expires_at-t)/tn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&await this._callRefreshToken(s.refresh_token)})}catch(e){}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(!(e.isAcquireTimeout||e instanceof ca))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!On()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const r=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){const[e,t]=await Wn(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});r.push(s.toString())}if(null==s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);r.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:r,error:n}=t;return n?{data:null,error:n}:await Zn(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})})}catch(t){if(cn(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,r;const{data:n,error:a}=t;if(a)return{data:null,error:a};const i=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:o,error:l}=await Zn(this.fetch,"POST",`${this.url}/factors`,{body:i,headers:this.headers,jwt:null===(s=null==n?void 0:n.session)||void 0===s?void 0:s.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&"totp"===o.type&&(null===(r=null==o?void 0:o.totp)||void 0===r?void 0:r.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})})}catch(t){if(cn(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:n}=t;if(n)return{data:null,error:n};const a=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?wa(e.webauthn.credential_response):ja(e.webauthn.credential_response)})}:{code:e.code}),{data:i,error:o}=await Zn(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:a,headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:o})})}catch(t){if(cn(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:n}=t;if(n)return{data:null,error:n};const a=await Zn(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});if(a.error)return a;const{data:i}=a;if("webauthn"!==i.type)return{data:i,error:null};switch(i.webauthn.type){case"create":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:va(i.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:ba(i.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(cn(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};const r={all:[],phone:[],totp:[],webauthn:[]};for(const n of null!==(e=null==t?void 0:t.factors)&&void 0!==e?e:[])r.all.push(n),"verified"===n.status&&r[n.factor_type].push(n);return{data:r,error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:r},error:n}=e;if(n)return{data:null,error:n};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=Qn(r.access_token);let i=null;a.aal&&(i=a.aal);let o=i;(null!==(s=null===(t=r.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==s?s:[]).length>0&&(o="aal2");return{data:{currentLevel:i,nextLevel:o,currentAuthenticationMethods:a.amr||[]},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(t=>t.kid===e);if(s)return s;const r=Date.now();if(s=this.jwks.keys.find(t=>t.kid===e),s&&this.jwks_cached_at+6e5>r)return s;const{data:n,error:a}=await Zn(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return n.keys&&0!==n.keys.length?(this.jwks=n,this.jwks_cached_at=r,s=n.keys.find(t=>t.kid===e),s||null):null}async getClaims(e,t={}){try{let s=e;if(!s){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};s=e.session.access_token}const{header:r,payload:n,signature:a,raw:{header:i,payload:o}}=Qn(s);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(n.exp);const l=r.alg&&!r.alg.startsWith("HS")&&r.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(r.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!l){const{error:e}=await this.getUser(s);if(e)throw e;return{data:{claims:n,header:r,signature:a},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),d=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!(await crypto.subtle.verify(c,d,a,In(`${i}.${o}`))))throw new wn("Invalid JWT signature");return{data:{claims:n,header:r,signature:a},error:null}}catch(s){if(cn(s))return{data:null,error:s};throw s}}}Oa.nextInstanceID=0;const Aa=Oa;class Da extends Aa{constructor(e){super(e)}}class Ma{constructor(e,t,s){var r,n,a;this.supabaseUrl=e,this.supabaseKey=t;const i=function(e){const t=null==e?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((s=t).endsWith("/")?s:s+"/")}catch(r){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var s}(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,l=function(e,t){var s,r;const{db:n,auth:a,realtime:i,global:o}=e,{db:l,auth:c,realtime:d,global:u}=t,h={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},c),a),realtime:Object.assign(Object.assign({},d),i),storage:{},global:Object.assign(Object.assign(Object.assign({},u),o),{headers:Object.assign(Object.assign({},null!==(s=null==u?void 0:u.headers)&&void 0!==s?s:{}),null!==(r=null==o?void 0:o.headers)&&void 0!==r?r:{})}),accessToken:async()=>""};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=s?s:{},{db:Yr,realtime:Zr,auth:Object.assign(Object.assign({},Jr),{storageKey:o}),global:Kr});this.storageKey=null!==(r=l.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(n=l.global.headers)&&void 0!==n?n:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(a=l.auth)&&void 0!==a?a:{},this.headers,l.global.fetch),this.fetch=Xr(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.rest=new us(new URL("rest/v1",i).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new Hr(this.storageUrl.href,this.headers,this.fetch,null==s?void 0:s.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new Et(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();const{data:s}=await this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,userStorage:n,storageKey:a,flowType:i,lock:o,debug:l},c,d){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Da({url:this.authUrl.href,headers:Object.assign(Object.assign({},u),c),storageKey:a,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,userStorage:n,flowType:i,lock:o,debug:l,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new nr(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=s,this.realtime.setAuth(s))}}!function(){if("undefined"!=typeof window)return!1;if("undefined"==typeof process)return!1;const e=process.version;if(null==e)return!1;const t=e.match(/^v(\d+)\./);!!t&&parseInt(t[1],10)}();const qa=new Ma("https://yiquudnrheitmcnwowlh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlpcXV1ZG5yaGVpdG1jbndvd2xoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNjI0NzMsImV4cCI6MjA3MDgzODQ3M30.8UzLhEbeaB6iV7EaCQmR0tW5WzLM11zIfRZ9_nFeNEQ",Ra);var Ra;const $a=Object.freeze(Object.defineProperty({__proto__:null,supabase:qa},Symbol.toStringTag,{value:"Module"})),La=[];function Qa(e){0===La.length||La.includes(e);return{error:(e,...t)=>{},warn:(e,...t)=>{},info:(e,...t)=>{},debug:(e,...t)=>{},verbose:(e,...t)=>{}}}const Fa=Qa("app"),Ua=Qa("useServicePoints"),Wa=()=>{const[e,t]=n.useState([]),[s,r]=n.useState(!0),[i,o]=n.useState(null),l=async()=>{try{r(!0),o(null);const{data:e,error:s}=await qa.from("service_points").select("*").order("code",{ascending:!0});if(s)throw s;t(e||[]),Ua.debug(`Fetched ${(null==e?void 0:e.length)||0} service points`)}catch(e){Ua.error("Error fetching service points:",e),o(e.message||"Failed to fetch service points"),a.error("")}finally{r(!1)}};return n.useEffect(()=>{l()},[]),{servicePoints:e,loading:s,error:i,fetchServicePoints:l,saveServicePoint:async e=>{try{if(!(e.id||e.code&&e.name))throw new Error("Service point code and name are required");const{data:t,error:s}=await qa.from("service_points").upsert({id:e.id||void 0,code:e.code||"",name:e.name||"",location:e.location,enabled:void 0===e.enabled||e.enabled}).select();if(s)throw s;if(!t||0===t.length)throw new Error("No data returned after saving service point");return await l(),t[0]}catch(t){throw Ua.error("Error saving service point:",t),a.error(""),t}},deleteServicePoint:async e=>{try{const{error:s}=await qa.from("service_points").delete().eq("id",e);if(s)throw s;return t(t=>t.filter(t=>t.id!==e)),a.success(""),!0}catch(s){return Ua.error("Error deleting service point:",s),a.error(""),!1}}}},Va=n.createContext(void 0),za=({children:e})=>{const[t,s]=n.useState(null),{servicePoints:r,loading:a,error:o,fetchServicePoints:l}=Wa();n.useEffect(()=>{if(!t&&r.length>0&&!a){const e=localStorage.getItem("selectedServicePointId");if(e){const t=r.find(t=>t.id===e);if(t)return void s(t)}const t=r.find(e=>e.enabled);t&&s(t)}},[r,a,t]);return i.jsx(Va.Provider,{value:{selectedServicePoint:t,setSelectedServicePoint:e=>{s(e),e?localStorage.setItem("selectedServicePointId",e.id):localStorage.removeItem("selectedServicePointId")},servicePoints:r,loading:a,error:o,fetchServicePoints:l},children:e})},Ba=()=>{const e=n.useContext(Va);if(void 0===e)throw new Error("useServicePointContext must be used within a ServicePointProvider");return e},Ha=()=>{try{const{patients:e=[],setPatients:t,loading:s=!1,error:r=null,fetchPatients:i=async()=>{}}=(()=>{const[e,t]=n.useState([]),[s,r]=n.useState(!0),[i,o]=n.useState(null),l=async()=>{try{r(!0),o(null);const{data:e,error:s}=await qa.from("patients").select("*").order("created_at",{ascending:!1});if(s)throw s;t(e)}catch(e){o(e.message||"Failed to fetch patients"),a.error("")}finally{r(!1)}};return n.useEffect(()=>{l()},[]),{patients:e,setPatients:t,loading:s,error:i,fetchPatients:l}})()||{},{actionError:o=null,addPatient:l=async()=>null,updatePatient:c=async()=>null,deletePatient:d=async()=>!1}=((e,t)=>({actionError:null,addPatient:async e=>{try{if(!e.name||!e.ID_card)throw new Error("Name and IDCard are required");if(!e.patient_id){const t=Math.floor(1e3+9e3*Math.random());e.patient_id=`P${t}`}const{data:s,error:r}=await qa.from("patients").insert({name:e.name,phone:e.phone,line_id:e.line_id||null,address:e.address||null,birth_date:e.birth_date||null,patient_id:e.patient_id,gender:e.gender||"",ID_card:e.ID_card||null}).select();if(r)throw r;const n=s[0];return t(e=>[...e,n]),a.success(""),n}catch(s){return a.error(""),null}},updatePatient:async(e,s)=>{try{if(!e)throw new Error("Patient ID is required");const{data:r,error:n}=await qa.from("patients").update({...s,updated_at:(new Date).toISOString()}).eq("id",e).select();if(n)throw n;const i=r[0];return t(t=>t.map(t=>t.id===e?i:t)),a.success(""),i}catch(r){return a.error(""),null}},deletePatient:async e=>{try{if(!e)throw new Error("Patient ID is required");const{error:s}=await qa.from("patients").delete().eq("id",e);if(s)throw s;return t(t=>t.filter(t=>t.id!==e)),a.success(""),!0}catch(s){return a.error(""),!1}}}))(0,t)||{},{searchLoading:u=!1,searchError:h=null,searchPatients:m=async()=>[],findPatientByPhone:p=async()=>null}=(()=>{const[e,t]=n.useState(!1),[s,r]=n.useState(null);return{searchLoading:e,searchError:s,searchPatients:async e=>{try{t(!0),r(null);const{data:s,error:n}=await qa.from("patients").select("*").or(`name.ilike.%${e}%,patient_id.ilike.%${e}%,phone.ilike.%${e}%,ID_card.ilike.%${e}%`).order("created_at",{ascending:!1});if(n)throw n;return s||[]}catch(s){return r(s.message||"Failed to search patients"),a.error(""),[]}finally{t(!1)}},findPatientByPhone:async e=>{try{t(!0),r(null);const{data:s,error:n}=await qa.from("patients").select("*").eq("phone",e).limit(1).maybeSingle();if(n){if("PGRST116"===n.code)return null;throw n}return s||null}catch(s){return r(s.message||"Failed to find patient"),null}finally{t(!1)}}}})()||{};return{patients:e,loading:s,error:r||o||h,fetchPatients:i,addPatient:l,updatePatient:c,deletePatient:d,searchPatients:m,findPatientByPhone:p,searchLoading:u}}catch(e){return{patients:[],loading:!1,error:String(e),fetchPatients:async()=>{},addPatient:async()=>null,updatePatient:async()=>null,deletePatient:async()=>!1,searchPatients:async()=>[],findPatientByPhone:async()=>null,searchLoading:!1}}},Ga=e=>{const t=Za(e),{conflictingClassGroups:s,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:e=>{const s=e.split("-");return""===s[0]&&1!==s.length&&s.shift(),Ka(s,t)||Ja(e)},getConflictingClassGroupIds:(e,t)=>{const n=s[e]||[];return t&&r[e]?[...n,...r[e]]:n}}},Ka=(e,t)=>{var s;if(0===e.length)return t.classGroupId;const r=e[0],n=t.nextPart.get(r),a=n?Ka(e.slice(1),n):void 0;if(a)return a;if(0===t.validators.length)return;const i=e.join("-");return null==(s=t.validators.find(({validator:e})=>e(i)))?void 0:s.classGroupId},Ya=/^\[(.+)\]$/,Ja=e=>{if(Ya.test(e)){const t=Ya.exec(e)[1],s=null==t?void 0:t.substring(0,t.indexOf(":"));if(s)return"arbitrary.."+s}},Za=e=>{const{theme:t,prefix:s}=e,r={nextPart:new Map,validators:[]};return si(Object.entries(e.classGroups),s).forEach(([e,s])=>{Xa(s,r,e,t)}),r},Xa=(e,t,s,r)=>{e.forEach(e=>{if("string"==typeof e){return void((""===e?t:ei(t,e)).classGroupId=s)}if("function"==typeof e)return ti(e)?void Xa(e(r),t,s,r):void t.validators.push({validator:e,classGroupId:s});Object.entries(e).forEach(([e,n])=>{Xa(n,ei(t,e),s,r)})})},ei=(e,t)=>{let s=e;return t.split("-").forEach(e=>{s.nextPart.has(e)||s.nextPart.set(e,{nextPart:new Map,validators:[]}),s=s.nextPart.get(e)}),s},ti=e=>e.isThemeGetter,si=(e,t)=>t?e.map(([e,s])=>[e,s.map(e=>"string"==typeof e?t+e:"object"==typeof e?Object.fromEntries(Object.entries(e).map(([e,s])=>[t+e,s])):e)]):e,ri=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,s=new Map,r=new Map;const n=(n,a)=>{s.set(n,a),t++,t>e&&(t=0,r=s,s=new Map)};return{get(e){let t=s.get(e);return void 0!==t?t:void 0!==(t=r.get(e))?(n(e,t),t):void 0},set(e,t){s.has(e)?s.set(e,t):n(e,t)}}},ni=e=>{const{separator:t,experimentalParseClassName:s}=e,r=1===t.length,n=t[0],a=t.length,i=e=>{const s=[];let i,o=0,l=0;for(let u=0;u<e.length;u++){let c=e[u];if(0===o){if(c===n&&(r||e.slice(u,u+a)===t)){s.push(e.slice(l,u)),l=u+a;continue}if("/"===c){i=u;continue}}"["===c?o++:"]"===c&&o--}const c=0===s.length?e:e.substring(l),d=c.startsWith("!");return{modifiers:s,hasImportantModifier:d,baseClassName:d?c.substring(1):c,maybePostfixModifierPosition:i&&i>l?i-l:void 0}};return s?e=>s({className:e,parseClassName:i}):i},ai=e=>{if(e.length<=1)return e;const t=[];let s=[];return e.forEach(e=>{"["===e[0]?(t.push(...s.sort(),e),s=[]):s.push(e)}),t.push(...s.sort()),t},ii=/\s+/;function oi(){let e,t,s=0,r="";for(;s<arguments.length;)(e=arguments[s++])&&(t=li(e))&&(r&&(r+=" "),r+=t);return r}const li=e=>{if("string"==typeof e)return e;let t,s="";for(let r=0;r<e.length;r++)e[r]&&(t=li(e[r]))&&(s&&(s+=" "),s+=t);return s};function ci(e,...t){let s,r,n,a=function(o){const l=t.reduce((e,t)=>t(e),e());return s=(e=>({cache:ri(e.cacheSize),parseClassName:ni(e),...Ga(e)}))(l),r=s.cache.get,n=s.cache.set,a=i,i(o)};function i(e){const t=r(e);if(t)return t;const a=((e,t)=>{const{parseClassName:s,getClassGroupId:r,getConflictingClassGroupIds:n}=t,a=[],i=e.trim().split(ii);let o="";for(let l=i.length-1;l>=0;l-=1){const e=i[l],{modifiers:t,hasImportantModifier:c,baseClassName:d,maybePostfixModifierPosition:u}=s(e);let h=Boolean(u),m=r(h?d.substring(0,u):d);if(!m){if(!h){o=e+(o.length>0?" "+o:o);continue}if(m=r(d),!m){o=e+(o.length>0?" "+o:o);continue}h=!1}const p=ai(t).join(":"),f=c?p+"!":p,g=f+m;if(a.includes(g))continue;a.push(g);const x=n(m,h);for(let s=0;s<x.length;++s){const e=x[s];a.push(f+e)}o=e+(o.length>0?" "+o:o)}return o})(e,s);return n(e,a),a}return function(){return a(oi.apply(null,arguments))}}const di=e=>{const t=t=>t[e]||[];return t.isThemeGetter=!0,t},ui=/^\[(?:([a-z-]+):)?(.+)\]$/i,hi=/^\d+\/\d+$/,mi=new Set(["px","full","screen"]),pi=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,fi=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,gi=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,xi=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,yi=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,vi=e=>wi(e)||mi.has(e)||hi.test(e),bi=e=>Di(e,"length",Mi),wi=e=>Boolean(e)&&!Number.isNaN(Number(e)),ji=e=>Di(e,"number",wi),Ni=e=>Boolean(e)&&Number.isInteger(Number(e)),_i=e=>e.endsWith("%")&&wi(e.slice(0,-1)),Si=e=>ui.test(e),ki=e=>pi.test(e),Ci=new Set(["length","size","percentage"]),Ti=e=>Di(e,Ci,qi),Ei=e=>Di(e,"position",qi),Ii=new Set(["image","url"]),Pi=e=>Di(e,Ii,$i),Oi=e=>Di(e,"",Ri),Ai=()=>!0,Di=(e,t,s)=>{const r=ui.exec(e);return!!r&&(r[1]?"string"==typeof t?r[1]===t:t.has(r[1]):s(r[2]))},Mi=e=>fi.test(e)&&!gi.test(e),qi=()=>!1,Ri=e=>xi.test(e),$i=e=>yi.test(e),Li=ci(()=>{const e=di("colors"),t=di("spacing"),s=di("blur"),r=di("brightness"),n=di("borderColor"),a=di("borderRadius"),i=di("borderSpacing"),o=di("borderWidth"),l=di("contrast"),c=di("grayscale"),d=di("hueRotate"),u=di("invert"),h=di("gap"),m=di("gradientColorStops"),p=di("gradientColorStopPositions"),f=di("inset"),g=di("margin"),x=di("opacity"),y=di("padding"),v=di("saturate"),b=di("scale"),w=di("sepia"),j=di("skew"),N=di("space"),_=di("translate"),S=()=>["auto",Si,t],k=()=>[Si,t],C=()=>["",vi,bi],T=()=>["auto",wi,Si],E=()=>["","0",Si],I=()=>[wi,Si];return{cacheSize:500,separator:":",theme:{colors:[Ai],spacing:[vi,bi],blur:["none","",ki,Si],brightness:I(),borderColor:[e],borderRadius:["none","","full",ki,Si],borderSpacing:k(),borderWidth:C(),contrast:I(),grayscale:E(),hueRotate:I(),invert:E(),gap:k(),gradientColorStops:[e],gradientColorStopPositions:[_i,bi],inset:S(),margin:S(),opacity:I(),padding:k(),saturate:I(),scale:I(),sepia:E(),skew:I(),space:k(),translate:k()},classGroups:{aspect:[{aspect:["auto","square","video",Si]}],container:["container"],columns:[{columns:[ki]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",Si]}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[f]}],"inset-x":[{"inset-x":[f]}],"inset-y":[{"inset-y":[f]}],start:[{start:[f]}],end:[{end:[f]}],top:[{top:[f]}],right:[{right:[f]}],bottom:[{bottom:[f]}],left:[{left:[f]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ni,Si]}],basis:[{basis:S()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Si]}],grow:[{grow:E()}],shrink:[{shrink:E()}],order:[{order:["first","last","none",Ni,Si]}],"grid-cols":[{"grid-cols":[Ai]}],"col-start-end":[{col:["auto",{span:["full",Ni,Si]},Si]}],"col-start":[{"col-start":T()}],"col-end":[{"col-end":T()}],"grid-rows":[{"grid-rows":[Ai]}],"row-start-end":[{row:["auto",{span:[Ni,Si]},Si]}],"row-start":[{"row-start":T()}],"row-end":[{"row-end":T()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Si]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Si]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal","start","end","center","between","around","evenly","stretch"]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[y]}],px:[{px:[y]}],py:[{py:[y]}],ps:[{ps:[y]}],pe:[{pe:[y]}],pt:[{pt:[y]}],pr:[{pr:[y]}],pb:[{pb:[y]}],pl:[{pl:[y]}],m:[{m:[g]}],mx:[{mx:[g]}],my:[{my:[g]}],ms:[{ms:[g]}],me:[{me:[g]}],mt:[{mt:[g]}],mr:[{mr:[g]}],mb:[{mb:[g]}],ml:[{ml:[g]}],"space-x":[{"space-x":[N]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[N]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Si,t]}],"min-w":[{"min-w":[Si,t,"min","max","fit"]}],"max-w":[{"max-w":[Si,t,"none","full","min","max","fit","prose",{screen:[ki]},ki]}],h:[{h:[Si,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Si,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Si,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Si,t,"auto","min","max","fit"]}],"font-size":[{text:["base",ki,bi]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ji]}],"font-family":[{font:[Ai]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Si]}],"line-clamp":[{"line-clamp":["none",wi,ji]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",vi,Si]}],"list-image":[{"list-image":["none",Si]}],"list-style-type":[{list:["none","disc","decimal",Si]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[x]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[x]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","none","wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",vi,bi]}],"underline-offset":[{"underline-offset":["auto",vi,Si]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:k()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Si]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Si]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[x]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",Ei]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Ti]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Pi]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[a]}],"rounded-s":[{"rounded-s":[a]}],"rounded-e":[{"rounded-e":[a]}],"rounded-t":[{"rounded-t":[a]}],"rounded-r":[{"rounded-r":[a]}],"rounded-b":[{"rounded-b":[a]}],"rounded-l":[{"rounded-l":[a]}],"rounded-ss":[{"rounded-ss":[a]}],"rounded-se":[{"rounded-se":[a]}],"rounded-ee":[{"rounded-ee":[a]}],"rounded-es":[{"rounded-es":[a]}],"rounded-tl":[{"rounded-tl":[a]}],"rounded-tr":[{"rounded-tr":[a]}],"rounded-br":[{"rounded-br":[a]}],"rounded-bl":[{"rounded-bl":[a]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[x]}],"border-style":[{border:["solid","dashed","dotted","double","none","hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[x]}],"divide-style":[{divide:["solid","dashed","dotted","double","none"]}],"border-color":[{border:[n]}],"border-color-x":[{"border-x":[n]}],"border-color-y":[{"border-y":[n]}],"border-color-s":[{"border-s":[n]}],"border-color-e":[{"border-e":[n]}],"border-color-t":[{"border-t":[n]}],"border-color-r":[{"border-r":[n]}],"border-color-b":[{"border-b":[n]}],"border-color-l":[{"border-l":[n]}],"divide-color":[{divide:[n]}],"outline-style":[{outline:["","solid","dashed","dotted","double","none"]}],"outline-offset":[{"outline-offset":[vi,Si]}],"outline-w":[{outline:[vi,bi]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:C()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[x]}],"ring-offset-w":[{"ring-offset":[vi,bi]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",ki,Oi]}],"shadow-color":[{shadow:[Ai]}],opacity:[{opacity:[x]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[r]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",ki,Si]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[u]}],saturate:[{saturate:[v]}],sepia:[{sepia:[w]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[u]}],"backdrop-opacity":[{"backdrop-opacity":[x]}],"backdrop-saturate":[{"backdrop-saturate":[v]}],"backdrop-sepia":[{"backdrop-sepia":[w]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Si]}],duration:[{duration:I()}],ease:[{ease:["linear","in","out","in-out",Si]}],delay:[{delay:I()}],animate:[{animate:["none","spin","ping","pulse","bounce",Si]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[b]}],"scale-x":[{"scale-x":[b]}],"scale-y":[{"scale-y":[b]}],rotate:[{rotate:[Ni,Si]}],"translate-x":[{"translate-x":[_]}],"translate-y":[{"translate-y":[_]}],"skew-x":[{"skew-x":[j]}],"skew-y":[{"skew-y":[j]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Si]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Si]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":k()}],"scroll-mx":[{"scroll-mx":k()}],"scroll-my":[{"scroll-my":k()}],"scroll-ms":[{"scroll-ms":k()}],"scroll-me":[{"scroll-me":k()}],"scroll-mt":[{"scroll-mt":k()}],"scroll-mr":[{"scroll-mr":k()}],"scroll-mb":[{"scroll-mb":k()}],"scroll-ml":[{"scroll-ml":k()}],"scroll-p":[{"scroll-p":k()}],"scroll-px":[{"scroll-px":k()}],"scroll-py":[{"scroll-py":k()}],"scroll-ps":[{"scroll-ps":k()}],"scroll-pe":[{"scroll-pe":k()}],"scroll-pt":[{"scroll-pt":k()}],"scroll-pr":[{"scroll-pr":k()}],"scroll-pb":[{"scroll-pb":k()}],"scroll-pl":[{"scroll-pl":k()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Si]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[vi,bi,ji]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}});function Qi(...e){return Li(lt(e))}const Fi=n.forwardRef(({className:e,...t},s)=>i.jsx("div",{ref:s,className:Qi("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));Fi.displayName="Card";const Ui=n.forwardRef(({className:e,...t},s)=>i.jsx("div",{ref:s,className:Qi("flex flex-col space-y-1.5 p-6",e),...t}));Ui.displayName="CardHeader";const Wi=n.forwardRef(({className:e,...t},s)=>i.jsx("h3",{ref:s,className:Qi("text-2xl font-semibold leading-none tracking-tight",e),...t}));Wi.displayName="CardTitle";const Vi=n.forwardRef(({className:e,...t},s)=>i.jsx("p",{ref:s,className:Qi("text-sm text-muted-foreground",e),...t}));Vi.displayName="CardDescription";const zi=n.forwardRef(({className:e,...t},s)=>i.jsx("div",{ref:s,className:Qi("p-6 pt-0",e),...t}));zi.displayName="CardContent";const Bi=n.forwardRef(({className:e,...t},s)=>i.jsx("div",{ref:s,className:Qi("flex items-center p-6 pt-0",e),...t}));Bi.displayName="CardFooter";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const Hi=(...e)=>e.filter((e,t,s)=>Boolean(e)&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim();
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var Gi={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ki=n.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:r,className:a="",children:i,iconNode:o,...l},c)=>n.createElement("svg",{ref:c,...Gi,width:t,height:t,stroke:e,strokeWidth:r?24*Number(s)/Number(t):s,className:Hi("lucide",a),...l},[...o.map(([e,t])=>n.createElement(e,t)),...Array.isArray(i)?i:[i]])),Yi=(e,t)=>{const s=n.forwardRef(({className:s,...r},a)=>{return n.createElement(Ki,{ref:a,iconNode:t,className:Hi(`lucide-${i=e,i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,s),...r});var i});return s.displayName=`${e}`,s},Ji=Yi("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]),Zi=Yi("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Xi=Yi("ArrowRightFromLine",[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M21 12H7",key:"13ipq5"}],["path",{d:"m15 18 6-6-6-6",key:"6tx3qv"}]]),eo=Yi("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),to=Yi("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),so=Yi("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),ro=Yi("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),no=Yi("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),ao=Yi("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),io=Yi("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),oo=Yi("ChartNoAxesColumnIncreasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]),lo=Yi("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),co=Yi("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),uo=Yi("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),ho=Yi("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),mo=Yi("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),po=Yi("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]),fo=Yi("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),go=Yi("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),xo=Yi("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]),yo=Yi("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),vo=Yi("CircleUserRound",[["path",{d:"M18 20a6 6 0 0 0-12 0",key:"1qehca"}],["circle",{cx:"12",cy:"10",r:"4",key:"1h16sb"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),bo=Yi("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),wo=Yi("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),jo=Yi("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),No=Yi("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),_o=Yi("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),So=Yi("Dot",[["circle",{cx:"12.1",cy:"12.1",r:"1",key:"18d7e5"}]]),ko=Yi("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Co=Yi("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),To=Yi("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),Eo=Yi("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),Io=Yi("Hospital",[["path",{d:"M12 6v4",key:"16clxf"}],["path",{d:"M14 14h-4",key:"esezmu"}],["path",{d:"M14 18h-4",key:"16mqa2"}],["path",{d:"M14 8h-4",key:"z8ypaz"}],["path",{d:"M18 12h2a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2h2",key:"b1k337"}],["path",{d:"M18 22V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v18",key:"16g51d"}]]),Po=Yi("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]),Oo=Yi("IdCard",[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]]),Ao=Yi("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Do=Yi("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Mo=Yi("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),qo=Yi("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),Ro=Yi("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]),$o=Yi("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),Lo=Yi("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Qo=Yi("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Fo=Yi("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),Uo=Yi("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),Wo=Yi("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),Vo=Yi("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),zo=Yi("MessagesSquare",[["path",{d:"M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z",key:"p1xzt8"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1",key:"1cx29u"}]]),Bo=Yi("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),Ho=Yi("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),Go=Yi("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),Ko=Yi("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]),Yo=Yi("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]),Jo=Yi("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Zo=Yi("PhoneCall",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}],["path",{d:"M14.05 2a9 9 0 0 1 8 7.94",key:"vmijpz"}],["path",{d:"M14.05 6A5 5 0 0 1 18 10",key:"13nbpp"}]]),Xo=Yi("PhoneForwarded",[["polyline",{points:"18 2 22 6 18 10",key:"6vjanh"}],["line",{x1:"14",x2:"22",y1:"6",y2:"6",key:"1jsywh"}],["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),el=Yi("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),tl=Yi("Pill",[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]]),sl=Yi("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),rl=Yi("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),nl=Yi("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]),al=Yi("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),il=Yi("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),ol=Yi("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),ll=Yi("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),cl=Yi("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),dl=Yi("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),ul=Yi("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),hl=Yi("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),ml=Yi("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]),pl=Yi("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]),fl=Yi("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),gl=Yi("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),xl=Yi("Stethoscope",[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]),yl=Yi("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]),vl=Yi("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]),bl=Yi("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),wl=Yi("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]),jl=Yi("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),Nl=Yi("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),_l=Yi("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Sl=Yi("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]),kl=Yi("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),Cl=Yi("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Tl=Yi("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),El=Yi("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),Il=Yi("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),Pl=Yi("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function Ol(e){const t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new e.constructor(+e):"number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?new Date(e):new Date(NaN)}function Al(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function Dl(e,t){const s=Ol(e);return isNaN(t)?Al(e,NaN):t?(s.setDate(s.getDate()+t),s):s}function Ml(e,t){const s=Ol(e);if(isNaN(t))return Al(e,NaN);if(!t)return s;const r=s.getDate(),n=Al(e,s.getTime());n.setMonth(s.getMonth()+t+1,0);return r>=n.getDate()?n:(s.setFullYear(n.getFullYear(),n.getMonth(),r),s)}const ql=6048e5,Rl=6e4,$l=36e5,Ll=43200;let Ql={};function Fl(){return Ql}function Ul(e,t){var s,r,n,a;const i=Fl(),o=(null==t?void 0:t.weekStartsOn)??(null==(r=null==(s=null==t?void 0:t.locale)?void 0:s.options)?void 0:r.weekStartsOn)??i.weekStartsOn??(null==(a=null==(n=i.locale)?void 0:n.options)?void 0:a.weekStartsOn)??0,l=Ol(e),c=l.getDay(),d=(c<o?7:0)+c-o;return l.setDate(l.getDate()-d),l.setHours(0,0,0,0),l}function Wl(e){return Ul(e,{weekStartsOn:1})}function Vl(e){const t=Ol(e),s=t.getFullYear(),r=Al(e,0);r.setFullYear(s+1,0,4),r.setHours(0,0,0,0);const n=Wl(r),a=Al(e,0);a.setFullYear(s,0,4),a.setHours(0,0,0,0);const i=Wl(a);return t.getTime()>=n.getTime()?s+1:t.getTime()>=i.getTime()?s:s-1}function zl(e){const t=Ol(e);return t.setHours(0,0,0,0),t}function Bl(e){const t=Ol(e),s=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return s.setUTCFullYear(t.getFullYear()),+e-+s}function Hl(e,t){const s=zl(e),r=zl(t),n=+s-Bl(s),a=+r-Bl(r);return Math.round((n-a)/864e5)}function Gl(e,t){return Dl(e,7*t)}function Kl(e,t){return Ml(e,12*t)}function Yl(e,t){const s=Ol(e),r=Ol(t),n=s.getTime()-r.getTime();return n<0?-1:n>0?1:n}function Jl(e,t){return+zl(e)===+zl(t)}function Zl(e){return e instanceof Date||"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e)}function Xl(e,t){const s=Ol(e),r=Ol(t);return 12*(s.getFullYear()-r.getFullYear())+(s.getMonth()-r.getMonth())}function ec(e){const t=Ol(e);return t.setHours(23,59,59,999),t}function tc(e){const t=Ol(e),s=t.getMonth();return t.setFullYear(t.getFullYear(),s+1,0),t.setHours(23,59,59,999),t}function sc(e,t){const s=Ol(e),r=Ol(t),n=Yl(s,r),a=Math.abs(Xl(s,r));let i;if(a<1)i=0;else{1===s.getMonth()&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-n*a);let t=Yl(s,r)===-n;(function(e){const t=Ol(e);return+ec(t)===+tc(t)})(Ol(e))&&1===a&&1===Yl(e,r)&&(t=!1),i=n*(a-Number(t))}return 0===i?0:i}function rc(e,t,s){const r=function(e,t){return+Ol(e)-+Ol(t)}(e,t)/1e3;return(n=null==s?void 0:s.roundingMethod,e=>{const t=(n?Math[n]:Math.trunc)(e);return 0===t?0:t})(r);var n}function nc(e){const t=Ol(e);return t.setDate(1),t.setHours(0,0,0,0),t}function ac(e){const t=Ol(e),s=Al(e,0);return s.setFullYear(t.getFullYear(),0,1),s.setHours(0,0,0,0),s}function ic(e,t){var s,r,n,a;const i=Fl(),o=(null==t?void 0:t.weekStartsOn)??(null==(r=null==(s=null==t?void 0:t.locale)?void 0:s.options)?void 0:r.weekStartsOn)??i.weekStartsOn??(null==(a=null==(n=i.locale)?void 0:n.options)?void 0:a.weekStartsOn)??0,l=Ol(e),c=l.getDay(),d=6+(c<o?-7:0)-(c-o);return l.setDate(l.getDate()+d),l.setHours(23,59,59,999),l}function oc(e){return ic(e,{weekStartsOn:1})}const lc={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function cc(e){return(t={})=>{const s=t.width?String(t.width):e.defaultWidth;return e.formats[s]||e.formats[e.defaultWidth]}}const dc={date:cc({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:cc({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:cc({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},uc={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function hc(e){return(t,s)=>{let r;if("formatting"===((null==s?void 0:s.context)?String(s.context):"standalone")&&e.formattingValues){const t=e.defaultFormattingWidth||e.defaultWidth,n=(null==s?void 0:s.width)?String(s.width):t;r=e.formattingValues[n]||e.formattingValues[t]}else{const t=e.defaultWidth,n=(null==s?void 0:s.width)?String(s.width):e.defaultWidth;r=e.values[n]||e.values[t]}return r[e.argumentCallback?e.argumentCallback(t):t]}}function mc(e){return(t,s={})=>{const r=s.width,n=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],a=t.match(n);if(!a)return null;const i=a[0],o=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(o)?function(e,t){for(let s=0;s<e.length;s++)if(t(e[s]))return s;return}(o,e=>e.test(i)):function(e,t){for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t(e[s]))return s;return}(o,e=>e.test(i));let c;c=e.valueCallback?e.valueCallback(l):l,c=s.valueCallback?s.valueCallback(c):c;return{value:c,rest:t.slice(i.length)}}}function pc(e){return(t,s={})=>{const r=t.match(e.matchPattern);if(!r)return null;const n=r[0],a=t.match(e.parsePattern);if(!a)return null;let i=e.valueCallback?e.valueCallback(a[0]):a[0];i=s.valueCallback?s.valueCallback(i):i;return{value:i,rest:t.slice(n.length)}}}const fc={code:"en-US",formatDistance:(e,t,s)=>{let r;const n=lc[e];return r="string"==typeof n?n:1===t?n.one:n.other.replace("{{count}}",t.toString()),(null==s?void 0:s.addSuffix)?s.comparison&&s.comparison>0?"in "+r:r+" ago":r},formatLong:dc,formatRelative:(e,t,s,r)=>uc[e],localize:{ordinalNumber:(e,t)=>{const s=Number(e),r=s%100;if(r>20||r<10)switch(r%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},era:hc({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:hc({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:hc({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:hc({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:hc({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:pc({matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)}),era:mc({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:mc({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:mc({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:mc({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:mc({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function gc(e){const t=Ol(e),s=+Wl(t)-+function(e){const t=Vl(e),s=Al(e,0);return s.setFullYear(t,0,4),s.setHours(0,0,0,0),Wl(s)}(t);return Math.round(s/ql)+1}function xc(e,t){var s,r,n,a;const i=Ol(e),o=i.getFullYear(),l=Fl(),c=(null==t?void 0:t.firstWeekContainsDate)??(null==(r=null==(s=null==t?void 0:t.locale)?void 0:s.options)?void 0:r.firstWeekContainsDate)??l.firstWeekContainsDate??(null==(a=null==(n=l.locale)?void 0:n.options)?void 0:a.firstWeekContainsDate)??1,d=Al(e,0);d.setFullYear(o+1,0,c),d.setHours(0,0,0,0);const u=Ul(d,t),h=Al(e,0);h.setFullYear(o,0,c),h.setHours(0,0,0,0);const m=Ul(h,t);return i.getTime()>=u.getTime()?o+1:i.getTime()>=m.getTime()?o:o-1}function yc(e,t){const s=Ol(e),r=+Ul(s,t)-+function(e,t){var s,r,n,a;const i=Fl(),o=(null==t?void 0:t.firstWeekContainsDate)??(null==(r=null==(s=null==t?void 0:t.locale)?void 0:s.options)?void 0:r.firstWeekContainsDate)??i.firstWeekContainsDate??(null==(a=null==(n=i.locale)?void 0:n.options)?void 0:a.firstWeekContainsDate)??1,l=xc(e,t),c=Al(e,0);return c.setFullYear(l,0,o),c.setHours(0,0,0,0),Ul(c,t)}(s,t);return Math.round(r/ql)+1}function vc(e,t){return(e<0?"-":"")+Math.abs(e).toString().padStart(t,"0")}const bc={y(e,t){const s=e.getFullYear(),r=s>0?s:1-s;return vc("yy"===t?r%100:r,t.length)},M(e,t){const s=e.getMonth();return"M"===t?String(s+1):vc(s+1,2)},d:(e,t)=>vc(e.getDate(),t.length),a(e,t){const s=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];default:return"am"===s?"a.m.":"p.m."}},h:(e,t)=>vc(e.getHours()%12||12,t.length),H:(e,t)=>vc(e.getHours(),t.length),m:(e,t)=>vc(e.getMinutes(),t.length),s:(e,t)=>vc(e.getSeconds(),t.length),S(e,t){const s=t.length,r=e.getMilliseconds();return vc(Math.trunc(r*Math.pow(10,s-3)),t.length)}},wc="midnight",jc="noon",Nc="morning",_c="afternoon",Sc="evening",kc="night",Cc={G:function(e,t,s){const r=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return s.era(r,{width:"abbreviated"});case"GGGGG":return s.era(r,{width:"narrow"});default:return s.era(r,{width:"wide"})}},y:function(e,t,s){if("yo"===t){const t=e.getFullYear(),r=t>0?t:1-t;return s.ordinalNumber(r,{unit:"year"})}return bc.y(e,t)},Y:function(e,t,s,r){const n=xc(e,r),a=n>0?n:1-n;if("YY"===t){return vc(a%100,2)}return"Yo"===t?s.ordinalNumber(a,{unit:"year"}):vc(a,t.length)},R:function(e,t){return vc(Vl(e),t.length)},u:function(e,t){return vc(e.getFullYear(),t.length)},Q:function(e,t,s){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return vc(r,2);case"Qo":return s.ordinalNumber(r,{unit:"quarter"});case"QQQ":return s.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(r,{width:"narrow",context:"formatting"});default:return s.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,s){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return vc(r,2);case"qo":return s.ordinalNumber(r,{unit:"quarter"});case"qqq":return s.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(r,{width:"narrow",context:"standalone"});default:return s.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,s){const r=e.getMonth();switch(t){case"M":case"MM":return bc.M(e,t);case"Mo":return s.ordinalNumber(r+1,{unit:"month"});case"MMM":return s.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(r,{width:"narrow",context:"formatting"});default:return s.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,s){const r=e.getMonth();switch(t){case"L":return String(r+1);case"LL":return vc(r+1,2);case"Lo":return s.ordinalNumber(r+1,{unit:"month"});case"LLL":return s.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(r,{width:"narrow",context:"standalone"});default:return s.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,s,r){const n=yc(e,r);return"wo"===t?s.ordinalNumber(n,{unit:"week"}):vc(n,t.length)},I:function(e,t,s){const r=gc(e);return"Io"===t?s.ordinalNumber(r,{unit:"week"}):vc(r,t.length)},d:function(e,t,s){return"do"===t?s.ordinalNumber(e.getDate(),{unit:"date"}):bc.d(e,t)},D:function(e,t,s){const r=function(e){const t=Ol(e);return Hl(t,ac(t))+1}(e);return"Do"===t?s.ordinalNumber(r,{unit:"dayOfYear"}):vc(r,t.length)},E:function(e,t,s){const r=e.getDay();switch(t){case"E":case"EE":case"EEE":return s.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(r,{width:"short",context:"formatting"});default:return s.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,s,r){const n=e.getDay(),a=(n-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(a);case"ee":return vc(a,2);case"eo":return s.ordinalNumber(a,{unit:"day"});case"eee":return s.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(n,{width:"short",context:"formatting"});default:return s.day(n,{width:"wide",context:"formatting"})}},c:function(e,t,s,r){const n=e.getDay(),a=(n-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(a);case"cc":return vc(a,t.length);case"co":return s.ordinalNumber(a,{unit:"day"});case"ccc":return s.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(n,{width:"narrow",context:"standalone"});case"cccccc":return s.day(n,{width:"short",context:"standalone"});default:return s.day(n,{width:"wide",context:"standalone"})}},i:function(e,t,s){const r=e.getDay(),n=0===r?7:r;switch(t){case"i":return String(n);case"ii":return vc(n,t.length);case"io":return s.ordinalNumber(n,{unit:"day"});case"iii":return s.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(r,{width:"short",context:"formatting"});default:return s.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,s){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(r,{width:"narrow",context:"formatting"});default:return s.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(e,t,s){const r=e.getHours();let n;switch(n=12===r?jc:0===r?wc:r/12>=1?"pm":"am",t){case"b":case"bb":return s.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(n,{width:"narrow",context:"formatting"});default:return s.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(e,t,s){const r=e.getHours();let n;switch(n=r>=17?Sc:r>=12?_c:r>=4?Nc:kc,t){case"B":case"BB":case"BBB":return s.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(n,{width:"narrow",context:"formatting"});default:return s.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(e,t,s){if("ho"===t){let t=e.getHours()%12;return 0===t&&(t=12),s.ordinalNumber(t,{unit:"hour"})}return bc.h(e,t)},H:function(e,t,s){return"Ho"===t?s.ordinalNumber(e.getHours(),{unit:"hour"}):bc.H(e,t)},K:function(e,t,s){const r=e.getHours()%12;return"Ko"===t?s.ordinalNumber(r,{unit:"hour"}):vc(r,t.length)},k:function(e,t,s){let r=e.getHours();return 0===r&&(r=24),"ko"===t?s.ordinalNumber(r,{unit:"hour"}):vc(r,t.length)},m:function(e,t,s){return"mo"===t?s.ordinalNumber(e.getMinutes(),{unit:"minute"}):bc.m(e,t)},s:function(e,t,s){return"so"===t?s.ordinalNumber(e.getSeconds(),{unit:"second"}):bc.s(e,t)},S:function(e,t){return bc.S(e,t)},X:function(e,t,s){const r=e.getTimezoneOffset();if(0===r)return"Z";switch(t){case"X":return Ec(r);case"XXXX":case"XX":return Ic(r);default:return Ic(r,":")}},x:function(e,t,s){const r=e.getTimezoneOffset();switch(t){case"x":return Ec(r);case"xxxx":case"xx":return Ic(r);default:return Ic(r,":")}},O:function(e,t,s){const r=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Tc(r,":");default:return"GMT"+Ic(r,":")}},z:function(e,t,s){const r=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Tc(r,":");default:return"GMT"+Ic(r,":")}},t:function(e,t,s){return vc(Math.trunc(e.getTime()/1e3),t.length)},T:function(e,t,s){return vc(e.getTime(),t.length)}};function Tc(e,t=""){const s=e>0?"-":"+",r=Math.abs(e),n=Math.trunc(r/60),a=r%60;return 0===a?s+String(n):s+String(n)+t+vc(a,2)}function Ec(e,t){if(e%60==0){return(e>0?"-":"+")+vc(Math.abs(e)/60,2)}return Ic(e,t)}function Ic(e,t=""){const s=e>0?"-":"+",r=Math.abs(e);return s+vc(Math.trunc(r/60),2)+t+vc(r%60,2)}const Pc=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},Oc=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},Ac={p:Oc,P:(e,t)=>{const s=e.match(/(P+)(p+)?/)||[],r=s[1],n=s[2];if(!n)return Pc(e,t);let a;switch(r){case"P":a=t.dateTime({width:"short"});break;case"PP":a=t.dateTime({width:"medium"});break;case"PPP":a=t.dateTime({width:"long"});break;default:a=t.dateTime({width:"full"})}return a.replace("{{date}}",Pc(r,t)).replace("{{time}}",Oc(n,t))}},Dc=/^D+$/,Mc=/^Y+$/,qc=["D","DD","YY","YYYY"];function Rc(e){return Dc.test(e)}function $c(e){return Mc.test(e)}function Lc(e,t,s){const r=function(e,t,s){const r="Y"===e[0]?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${r} to the input \`${s}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}(e,t,s);if(qc.includes(e))throw new RangeError(r)}const Qc=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Fc=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Uc=/^'([^]*?)'?$/,Wc=/''/g,Vc=/[a-zA-Z]/;function zc(e,t,s){var r,n,a,i,o,l,c,d;const u=Fl(),h=(null==s?void 0:s.locale)??u.locale??fc,m=(null==s?void 0:s.firstWeekContainsDate)??(null==(n=null==(r=null==s?void 0:s.locale)?void 0:r.options)?void 0:n.firstWeekContainsDate)??u.firstWeekContainsDate??(null==(i=null==(a=u.locale)?void 0:a.options)?void 0:i.firstWeekContainsDate)??1,p=(null==s?void 0:s.weekStartsOn)??(null==(l=null==(o=null==s?void 0:s.locale)?void 0:o.options)?void 0:l.weekStartsOn)??u.weekStartsOn??(null==(d=null==(c=u.locale)?void 0:c.options)?void 0:d.weekStartsOn)??0,f=Ol(e);if(!function(e){if(!Zl(e)&&"number"!=typeof e)return!1;const t=Ol(e);return!isNaN(Number(t))}(f))throw new RangeError("Invalid time value");let g=t.match(Fc).map(e=>{const t=e[0];if("p"===t||"P"===t){return(0,Ac[t])(e,h.formatLong)}return e}).join("").match(Qc).map(e=>{if("''"===e)return{isToken:!1,value:"'"};const t=e[0];if("'"===t)return{isToken:!1,value:Bc(e)};if(Cc[t])return{isToken:!0,value:e};if(t.match(Vc))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return{isToken:!1,value:e}});h.localize.preprocessor&&(g=h.localize.preprocessor(f,g));const x={firstWeekContainsDate:m,weekStartsOn:p,locale:h};return g.map(r=>{if(!r.isToken)return r.value;const n=r.value;(!(null==s?void 0:s.useAdditionalWeekYearTokens)&&$c(n)||!(null==s?void 0:s.useAdditionalDayOfYearTokens)&&Rc(n))&&Lc(n,t,String(e));return(0,Cc[n[0]])(f,n,h.localize,x)}).join("")}function Bc(e){const t=e.match(Uc);return t?t[1].replace(Wc,"'"):e}function Hc(e,t){return function(e,t,s){const r=Fl(),n=(null==s?void 0:s.locale)??r.locale??fc,a=Yl(e,t);if(isNaN(a))throw new RangeError("Invalid time value");const i=Object.assign({},s,{addSuffix:null==s?void 0:s.addSuffix,comparison:a});let o,l;a>0?(o=Ol(t),l=Ol(e)):(o=Ol(e),l=Ol(t));const c=rc(l,o),d=(Bl(l)-Bl(o))/1e3,u=Math.round((c-d)/60);let h;if(u<2)return(null==s?void 0:s.includeSeconds)?c<5?n.formatDistance("lessThanXSeconds",5,i):c<10?n.formatDistance("lessThanXSeconds",10,i):c<20?n.formatDistance("lessThanXSeconds",20,i):c<40?n.formatDistance("halfAMinute",0,i):c<60?n.formatDistance("lessThanXMinutes",1,i):n.formatDistance("xMinutes",1,i):0===u?n.formatDistance("lessThanXMinutes",1,i):n.formatDistance("xMinutes",u,i);if(u<45)return n.formatDistance("xMinutes",u,i);if(u<90)return n.formatDistance("aboutXHours",1,i);if(u<1440){const e=Math.round(u/60);return n.formatDistance("aboutXHours",e,i)}if(u<2520)return n.formatDistance("xDays",1,i);if(u<Ll){const e=Math.round(u/1440);return n.formatDistance("xDays",e,i)}if(u<86400)return h=Math.round(u/Ll),n.formatDistance("aboutXMonths",h,i);if(h=sc(l,o),h<12){const e=Math.round(u/Ll);return n.formatDistance("xMonths",e,i)}{const e=h%12,t=Math.trunc(h/12);return e<3?n.formatDistance("aboutXYears",t,i):e<9?n.formatDistance("overXYears",t,i):n.formatDistance("almostXYears",t+1,i)}}(e,function(e){return Al(e,Date.now())}(e),t)}function Gc(e,t){return function(e,t,s){const r=Ul(e,s),n=Ul(t,s),a=+r-Bl(r),i=+n-Bl(n);return Math.round((a-i)/ql)}(function(e){const t=Ol(e),s=t.getMonth();return t.setFullYear(t.getFullYear(),s+1,0),t.setHours(0,0,0,0),t}(e),nc(e),t)+1}function Kc(e,t){const s=Ol(e),r=Ol(t);return s.getTime()>r.getTime()}function Yc(e,t){return+Ol(e)<+Ol(t)}class Jc{constructor(){t(this,"subPriority",0)}validate(e,t){return!0}}class Zc extends Jc{constructor(e,t,s,r,n){super(),this.value=e,this.validateValue=t,this.setValue=s,this.priority=r,n&&(this.subPriority=n)}validate(e,t){return this.validateValue(e,this.value,t)}set(e,t,s){return this.setValue(e,t,this.value,s)}}class Xc extends Jc{constructor(){super(...arguments),t(this,"priority",10),t(this,"subPriority",-1)}set(e,t){return t.timestampIsSet?e:Al(e,function(e,t){const s=t instanceof Date?Al(t,0):new t(0);return s.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),s.setHours(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()),s}(e,Date))}}class ed{run(e,t,s,r){const n=this.parse(e,t,s,r);return n?{setter:new Zc(n.value,this.validate,this.set,this.priority,this.subPriority),rest:n.rest}:null}validate(e,t,s){return!0}}const td=/^(1[0-2]|0?\d)/,sd=/^(3[0-1]|[0-2]?\d)/,rd=/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,nd=/^(5[0-3]|[0-4]?\d)/,ad=/^(2[0-3]|[0-1]?\d)/,id=/^(2[0-4]|[0-1]?\d)/,od=/^(1[0-1]|0?\d)/,ld=/^(1[0-2]|0?\d)/,cd=/^[0-5]?\d/,dd=/^[0-5]?\d/,ud=/^\d/,hd=/^\d{1,2}/,md=/^\d{1,3}/,pd=/^\d{1,4}/,fd=/^-?\d+/,gd=/^-?\d/,xd=/^-?\d{1,2}/,yd=/^-?\d{1,3}/,vd=/^-?\d{1,4}/,bd=/^([+-])(\d{2})(\d{2})?|Z/,wd=/^([+-])(\d{2})(\d{2})|Z/,jd=/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,Nd=/^([+-])(\d{2}):(\d{2})|Z/,_d=/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/;function Sd(e,t){return e?{value:t(e.value),rest:e.rest}:e}function kd(e,t){const s=t.match(e);return s?{value:parseInt(s[0],10),rest:t.slice(s[0].length)}:null}function Cd(e,t){const s=t.match(e);if(!s)return null;if("Z"===s[0])return{value:0,rest:t.slice(1)};const r="+"===s[1]?1:-1,n=s[2]?parseInt(s[2],10):0,a=s[3]?parseInt(s[3],10):0,i=s[5]?parseInt(s[5],10):0;return{value:r*(n*$l+a*Rl+1e3*i),rest:t.slice(s[0].length)}}function Td(e){return kd(fd,e)}function Ed(e,t){switch(e){case 1:return kd(ud,t);case 2:return kd(hd,t);case 3:return kd(md,t);case 4:return kd(pd,t);default:return kd(new RegExp("^\\d{1,"+e+"}"),t)}}function Id(e,t){switch(e){case 1:return kd(gd,t);case 2:return kd(xd,t);case 3:return kd(yd,t);case 4:return kd(vd,t);default:return kd(new RegExp("^-?\\d{1,"+e+"}"),t)}}function Pd(e){switch(e){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;default:return 0}}function Od(e,t){const s=t>0,r=s?t:1-t;let n;if(r<=50)n=e||100;else{const t=r+50;n=e+100*Math.trunc(t/100)-(e>=t%100?100:0)}return s?n:1-n}function Ad(e){return e%400==0||e%4==0&&e%100!=0}const Dd=[31,28,31,30,31,30,31,31,30,31,30,31],Md=[31,29,31,30,31,30,31,31,30,31,30,31];function qd(e,t,s){var r,n,a,i;const o=Fl(),l=(null==s?void 0:s.weekStartsOn)??(null==(n=null==(r=null==s?void 0:s.locale)?void 0:r.options)?void 0:n.weekStartsOn)??o.weekStartsOn??(null==(i=null==(a=o.locale)?void 0:a.options)?void 0:i.weekStartsOn)??0,c=Ol(e),d=c.getDay(),u=7-l;return Dl(c,t<0||t>6?t-(d+u)%7:((t%7+7)%7+u)%7-(d+u)%7)}function Rd(e,t){const s=Ol(e),r=function(e){let t=Ol(e).getDay();return 0===t&&(t=7),t}(s);return Dl(s,t-r)}const $d={G:new class extends ed{constructor(){super(...arguments),t(this,"priority",140),t(this,"incompatibleTokens",["R","u","t","T"])}parse(e,t,s){switch(t){case"G":case"GG":case"GGG":return s.era(e,{width:"abbreviated"})||s.era(e,{width:"narrow"});case"GGGGG":return s.era(e,{width:"narrow"});default:return s.era(e,{width:"wide"})||s.era(e,{width:"abbreviated"})||s.era(e,{width:"narrow"})}}set(e,t,s){return t.era=s,e.setFullYear(s,0,1),e.setHours(0,0,0,0),e}},y:new class extends ed{constructor(){super(...arguments),t(this,"priority",130),t(this,"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"])}parse(e,t,s){const r=e=>({year:e,isTwoDigitYear:"yy"===t});switch(t){case"y":return Sd(Ed(4,e),r);case"yo":return Sd(s.ordinalNumber(e,{unit:"year"}),r);default:return Sd(Ed(t.length,e),r)}}validate(e,t){return t.isTwoDigitYear||t.year>0}set(e,t,s){const r=e.getFullYear();if(s.isTwoDigitYear){const t=Od(s.year,r);return e.setFullYear(t,0,1),e.setHours(0,0,0,0),e}const n="era"in t&&1!==t.era?1-s.year:s.year;return e.setFullYear(n,0,1),e.setHours(0,0,0,0),e}},Y:new class extends ed{constructor(){super(...arguments),t(this,"priority",130),t(this,"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"])}parse(e,t,s){const r=e=>({year:e,isTwoDigitYear:"YY"===t});switch(t){case"Y":return Sd(Ed(4,e),r);case"Yo":return Sd(s.ordinalNumber(e,{unit:"year"}),r);default:return Sd(Ed(t.length,e),r)}}validate(e,t){return t.isTwoDigitYear||t.year>0}set(e,t,s,r){const n=xc(e,r);if(s.isTwoDigitYear){const t=Od(s.year,n);return e.setFullYear(t,0,r.firstWeekContainsDate),e.setHours(0,0,0,0),Ul(e,r)}const a="era"in t&&1!==t.era?1-s.year:s.year;return e.setFullYear(a,0,r.firstWeekContainsDate),e.setHours(0,0,0,0),Ul(e,r)}},R:new class extends ed{constructor(){super(...arguments),t(this,"priority",130),t(this,"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"])}parse(e,t){return Id("R"===t?4:t.length,e)}set(e,t,s){const r=Al(e,0);return r.setFullYear(s,0,4),r.setHours(0,0,0,0),Wl(r)}},u:new class extends ed{constructor(){super(...arguments),t(this,"priority",130),t(this,"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"])}parse(e,t){return Id("u"===t?4:t.length,e)}set(e,t,s){return e.setFullYear(s,0,1),e.setHours(0,0,0,0),e}},Q:new class extends ed{constructor(){super(...arguments),t(this,"priority",120),t(this,"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"])}parse(e,t,s){switch(t){case"Q":case"QQ":return Ed(t.length,e);case"Qo":return s.ordinalNumber(e,{unit:"quarter"});case"QQQ":return s.quarter(e,{width:"abbreviated",context:"formatting"})||s.quarter(e,{width:"narrow",context:"formatting"});case"QQQQQ":return s.quarter(e,{width:"narrow",context:"formatting"});default:return s.quarter(e,{width:"wide",context:"formatting"})||s.quarter(e,{width:"abbreviated",context:"formatting"})||s.quarter(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=1&&t<=4}set(e,t,s){return e.setMonth(3*(s-1),1),e.setHours(0,0,0,0),e}},q:new class extends ed{constructor(){super(...arguments),t(this,"priority",120),t(this,"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"])}parse(e,t,s){switch(t){case"q":case"qq":return Ed(t.length,e);case"qo":return s.ordinalNumber(e,{unit:"quarter"});case"qqq":return s.quarter(e,{width:"abbreviated",context:"standalone"})||s.quarter(e,{width:"narrow",context:"standalone"});case"qqqqq":return s.quarter(e,{width:"narrow",context:"standalone"});default:return s.quarter(e,{width:"wide",context:"standalone"})||s.quarter(e,{width:"abbreviated",context:"standalone"})||s.quarter(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=1&&t<=4}set(e,t,s){return e.setMonth(3*(s-1),1),e.setHours(0,0,0,0),e}},M:new class extends ed{constructor(){super(...arguments),t(this,"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]),t(this,"priority",110)}parse(e,t,s){const r=e=>e-1;switch(t){case"M":return Sd(kd(td,e),r);case"MM":return Sd(Ed(2,e),r);case"Mo":return Sd(s.ordinalNumber(e,{unit:"month"}),r);case"MMM":return s.month(e,{width:"abbreviated",context:"formatting"})||s.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return s.month(e,{width:"narrow",context:"formatting"});default:return s.month(e,{width:"wide",context:"formatting"})||s.month(e,{width:"abbreviated",context:"formatting"})||s.month(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=11}set(e,t,s){return e.setMonth(s,1),e.setHours(0,0,0,0),e}},L:new class extends ed{constructor(){super(...arguments),t(this,"priority",110),t(this,"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"])}parse(e,t,s){const r=e=>e-1;switch(t){case"L":return Sd(kd(td,e),r);case"LL":return Sd(Ed(2,e),r);case"Lo":return Sd(s.ordinalNumber(e,{unit:"month"}),r);case"LLL":return s.month(e,{width:"abbreviated",context:"standalone"})||s.month(e,{width:"narrow",context:"standalone"});case"LLLLL":return s.month(e,{width:"narrow",context:"standalone"});default:return s.month(e,{width:"wide",context:"standalone"})||s.month(e,{width:"abbreviated",context:"standalone"})||s.month(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=0&&t<=11}set(e,t,s){return e.setMonth(s,1),e.setHours(0,0,0,0),e}},w:new class extends ed{constructor(){super(...arguments),t(this,"priority",100),t(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"])}parse(e,t,s){switch(t){case"w":return kd(nd,e);case"wo":return s.ordinalNumber(e,{unit:"week"});default:return Ed(t.length,e)}}validate(e,t){return t>=1&&t<=53}set(e,t,s,r){return Ul(function(e,t,s){const r=Ol(e),n=yc(r,s)-t;return r.setDate(r.getDate()-7*n),r}(e,s,r),r)}},I:new class extends ed{constructor(){super(...arguments),t(this,"priority",100),t(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"])}parse(e,t,s){switch(t){case"I":return kd(nd,e);case"Io":return s.ordinalNumber(e,{unit:"week"});default:return Ed(t.length,e)}}validate(e,t){return t>=1&&t<=53}set(e,t,s){return Wl(function(e,t){const s=Ol(e),r=gc(s)-t;return s.setDate(s.getDate()-7*r),s}(e,s))}},d:new class extends ed{constructor(){super(...arguments),t(this,"priority",90),t(this,"subPriority",1),t(this,"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"])}parse(e,t,s){switch(t){case"d":return kd(sd,e);case"do":return s.ordinalNumber(e,{unit:"date"});default:return Ed(t.length,e)}}validate(e,t){const s=Ad(e.getFullYear()),r=e.getMonth();return s?t>=1&&t<=Md[r]:t>=1&&t<=Dd[r]}set(e,t,s){return e.setDate(s),e.setHours(0,0,0,0),e}},D:new class extends ed{constructor(){super(...arguments),t(this,"priority",90),t(this,"subpriority",1),t(this,"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"])}parse(e,t,s){switch(t){case"D":case"DD":return kd(rd,e);case"Do":return s.ordinalNumber(e,{unit:"date"});default:return Ed(t.length,e)}}validate(e,t){return Ad(e.getFullYear())?t>=1&&t<=366:t>=1&&t<=365}set(e,t,s){return e.setMonth(0,s),e.setHours(0,0,0,0),e}},E:new class extends ed{constructor(){super(...arguments),t(this,"priority",90),t(this,"incompatibleTokens",["D","i","e","c","t","T"])}parse(e,t,s){switch(t){case"E":case"EE":case"EEE":return s.day(e,{width:"abbreviated",context:"formatting"})||s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"});case"EEEEE":return s.day(e,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"});default:return s.day(e,{width:"wide",context:"formatting"})||s.day(e,{width:"abbreviated",context:"formatting"})||s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=6}set(e,t,s,r){return(e=qd(e,s,r)).setHours(0,0,0,0),e}},e:new class extends ed{constructor(){super(...arguments),t(this,"priority",90),t(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"])}parse(e,t,s,r){const n=e=>{const t=7*Math.floor((e-1)/7);return(e+r.weekStartsOn+6)%7+t};switch(t){case"e":case"ee":return Sd(Ed(t.length,e),n);case"eo":return Sd(s.ordinalNumber(e,{unit:"day"}),n);case"eee":return s.day(e,{width:"abbreviated",context:"formatting"})||s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"});case"eeeee":return s.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"});default:return s.day(e,{width:"wide",context:"formatting"})||s.day(e,{width:"abbreviated",context:"formatting"})||s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=6}set(e,t,s,r){return(e=qd(e,s,r)).setHours(0,0,0,0),e}},c:new class extends ed{constructor(){super(...arguments),t(this,"priority",90),t(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"])}parse(e,t,s,r){const n=e=>{const t=7*Math.floor((e-1)/7);return(e+r.weekStartsOn+6)%7+t};switch(t){case"c":case"cc":return Sd(Ed(t.length,e),n);case"co":return Sd(s.ordinalNumber(e,{unit:"day"}),n);case"ccc":return s.day(e,{width:"abbreviated",context:"standalone"})||s.day(e,{width:"short",context:"standalone"})||s.day(e,{width:"narrow",context:"standalone"});case"ccccc":return s.day(e,{width:"narrow",context:"standalone"});case"cccccc":return s.day(e,{width:"short",context:"standalone"})||s.day(e,{width:"narrow",context:"standalone"});default:return s.day(e,{width:"wide",context:"standalone"})||s.day(e,{width:"abbreviated",context:"standalone"})||s.day(e,{width:"short",context:"standalone"})||s.day(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=0&&t<=6}set(e,t,s,r){return(e=qd(e,s,r)).setHours(0,0,0,0),e}},i:new class extends ed{constructor(){super(...arguments),t(this,"priority",90),t(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"])}parse(e,t,s){const r=e=>0===e?7:e;switch(t){case"i":case"ii":return Ed(t.length,e);case"io":return s.ordinalNumber(e,{unit:"day"});case"iii":return Sd(s.day(e,{width:"abbreviated",context:"formatting"})||s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"}),r);case"iiiii":return Sd(s.day(e,{width:"narrow",context:"formatting"}),r);case"iiiiii":return Sd(s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"}),r);default:return Sd(s.day(e,{width:"wide",context:"formatting"})||s.day(e,{width:"abbreviated",context:"formatting"})||s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"}),r)}}validate(e,t){return t>=1&&t<=7}set(e,t,s){return(e=Rd(e,s)).setHours(0,0,0,0),e}},a:new class extends ed{constructor(){super(...arguments),t(this,"priority",80),t(this,"incompatibleTokens",["b","B","H","k","t","T"])}parse(e,t,s){switch(t){case"a":case"aa":case"aaa":return s.dayPeriod(e,{width:"abbreviated",context:"formatting"})||s.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaaa":return s.dayPeriod(e,{width:"narrow",context:"formatting"});default:return s.dayPeriod(e,{width:"wide",context:"formatting"})||s.dayPeriod(e,{width:"abbreviated",context:"formatting"})||s.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,s){return e.setHours(Pd(s),0,0,0),e}},b:new class extends ed{constructor(){super(...arguments),t(this,"priority",80),t(this,"incompatibleTokens",["a","B","H","k","t","T"])}parse(e,t,s){switch(t){case"b":case"bb":case"bbb":return s.dayPeriod(e,{width:"abbreviated",context:"formatting"})||s.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbbb":return s.dayPeriod(e,{width:"narrow",context:"formatting"});default:return s.dayPeriod(e,{width:"wide",context:"formatting"})||s.dayPeriod(e,{width:"abbreviated",context:"formatting"})||s.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,s){return e.setHours(Pd(s),0,0,0),e}},B:new class extends ed{constructor(){super(...arguments),t(this,"priority",80),t(this,"incompatibleTokens",["a","b","t","T"])}parse(e,t,s){switch(t){case"B":case"BB":case"BBB":return s.dayPeriod(e,{width:"abbreviated",context:"formatting"})||s.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBBB":return s.dayPeriod(e,{width:"narrow",context:"formatting"});default:return s.dayPeriod(e,{width:"wide",context:"formatting"})||s.dayPeriod(e,{width:"abbreviated",context:"formatting"})||s.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,s){return e.setHours(Pd(s),0,0,0),e}},h:new class extends ed{constructor(){super(...arguments),t(this,"priority",70),t(this,"incompatibleTokens",["H","K","k","t","T"])}parse(e,t,s){switch(t){case"h":return kd(ld,e);case"ho":return s.ordinalNumber(e,{unit:"hour"});default:return Ed(t.length,e)}}validate(e,t){return t>=1&&t<=12}set(e,t,s){const r=e.getHours()>=12;return r&&s<12?e.setHours(s+12,0,0,0):r||12!==s?e.setHours(s,0,0,0):e.setHours(0,0,0,0),e}},H:new class extends ed{constructor(){super(...arguments),t(this,"priority",70),t(this,"incompatibleTokens",["a","b","h","K","k","t","T"])}parse(e,t,s){switch(t){case"H":return kd(ad,e);case"Ho":return s.ordinalNumber(e,{unit:"hour"});default:return Ed(t.length,e)}}validate(e,t){return t>=0&&t<=23}set(e,t,s){return e.setHours(s,0,0,0),e}},K:new class extends ed{constructor(){super(...arguments),t(this,"priority",70),t(this,"incompatibleTokens",["h","H","k","t","T"])}parse(e,t,s){switch(t){case"K":return kd(od,e);case"Ko":return s.ordinalNumber(e,{unit:"hour"});default:return Ed(t.length,e)}}validate(e,t){return t>=0&&t<=11}set(e,t,s){return e.getHours()>=12&&s<12?e.setHours(s+12,0,0,0):e.setHours(s,0,0,0),e}},k:new class extends ed{constructor(){super(...arguments),t(this,"priority",70),t(this,"incompatibleTokens",["a","b","h","H","K","t","T"])}parse(e,t,s){switch(t){case"k":return kd(id,e);case"ko":return s.ordinalNumber(e,{unit:"hour"});default:return Ed(t.length,e)}}validate(e,t){return t>=1&&t<=24}set(e,t,s){const r=s<=24?s%24:s;return e.setHours(r,0,0,0),e}},m:new class extends ed{constructor(){super(...arguments),t(this,"priority",60),t(this,"incompatibleTokens",["t","T"])}parse(e,t,s){switch(t){case"m":return kd(cd,e);case"mo":return s.ordinalNumber(e,{unit:"minute"});default:return Ed(t.length,e)}}validate(e,t){return t>=0&&t<=59}set(e,t,s){return e.setMinutes(s,0,0),e}},s:new class extends ed{constructor(){super(...arguments),t(this,"priority",50),t(this,"incompatibleTokens",["t","T"])}parse(e,t,s){switch(t){case"s":return kd(dd,e);case"so":return s.ordinalNumber(e,{unit:"second"});default:return Ed(t.length,e)}}validate(e,t){return t>=0&&t<=59}set(e,t,s){return e.setSeconds(s,0),e}},S:new class extends ed{constructor(){super(...arguments),t(this,"priority",30),t(this,"incompatibleTokens",["t","T"])}parse(e,t){return Sd(Ed(t.length,e),e=>Math.trunc(e*Math.pow(10,3-t.length)))}set(e,t,s){return e.setMilliseconds(s),e}},X:new class extends ed{constructor(){super(...arguments),t(this,"priority",10),t(this,"incompatibleTokens",["t","T","x"])}parse(e,t){switch(t){case"X":return Cd(bd,e);case"XX":return Cd(wd,e);case"XXXX":return Cd(jd,e);case"XXXXX":return Cd(_d,e);default:return Cd(Nd,e)}}set(e,t,s){return t.timestampIsSet?e:Al(e,e.getTime()-Bl(e)-s)}},x:new class extends ed{constructor(){super(...arguments),t(this,"priority",10),t(this,"incompatibleTokens",["t","T","X"])}parse(e,t){switch(t){case"x":return Cd(bd,e);case"xx":return Cd(wd,e);case"xxxx":return Cd(jd,e);case"xxxxx":return Cd(_d,e);default:return Cd(Nd,e)}}set(e,t,s){return t.timestampIsSet?e:Al(e,e.getTime()-Bl(e)-s)}},t:new class extends ed{constructor(){super(...arguments),t(this,"priority",40),t(this,"incompatibleTokens","*")}parse(e){return Td(e)}set(e,t,s){return[Al(e,1e3*s),{timestampIsSet:!0}]}},T:new class extends ed{constructor(){super(...arguments),t(this,"priority",20),t(this,"incompatibleTokens","*")}parse(e){return Td(e)}set(e,t,s){return[Al(e,s),{timestampIsSet:!0}]}}},Ld=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Qd=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Fd=/^'([^]*?)'?$/,Ud=/''/g,Wd=/\S/,Vd=/[a-zA-Z]/;function zd(e,t,s,r){var n,a,i,o;const l=Object.assign({},Fl()),c=l.locale??fc,d={firstWeekContainsDate:l.firstWeekContainsDate??(null==(a=null==(n=l.locale)?void 0:n.options)?void 0:a.firstWeekContainsDate)??1,weekStartsOn:l.weekStartsOn??(null==(o=null==(i=l.locale)?void 0:i.options)?void 0:o.weekStartsOn)??0,locale:c},u=[new Xc],h=t.match(Qd).map(e=>{const t=e[0];if(t in Ac){return(0,Ac[t])(e,c.formatLong)}return e}).join("").match(Ld),m=[];for(let x of h){$c(x)&&Lc(x,t,e),Rc(x)&&Lc(x,t,e);const r=x[0],n=$d[r];if(n){const{incompatibleTokens:t}=n;if(Array.isArray(t)){const e=m.find(e=>t.includes(e.token)||e.token===r);if(e)throw new RangeError(`The format string mustn't contain \`${e.fullToken}\` and \`${x}\` at the same time`)}else if("*"===n.incompatibleTokens&&m.length>0)throw new RangeError(`The format string mustn't contain \`${x}\` and any other token at the same time`);m.push({token:r,fullToken:x});const a=n.run(e,x,c.match,d);if(!a)return Al(s,NaN);u.push(a.setter),e=a.rest}else{if(r.match(Vd))throw new RangeError("Format string contains an unescaped latin alphabet character `"+r+"`");if("''"===x?x="'":"'"===r&&(x=Bd(x)),0!==e.indexOf(x))return Al(s,NaN);e=e.slice(x.length)}}if(e.length>0&&Wd.test(e))return Al(s,NaN);const p=u.map(e=>e.priority).sort((e,t)=>t-e).filter((e,t,s)=>s.indexOf(e)===t).map(e=>u.filter(t=>t.priority===e).sort((e,t)=>t.subPriority-e.subPriority)).map(e=>e[0]);let f=Ol(s);if(isNaN(f.getTime()))return Al(s,NaN);const g={};for(const x of p){if(!x.validate(f,d))return Al(s,NaN);const e=x.set(f,g,d);Array.isArray(e)?(f=e[0],Object.assign(g,e[1])):f=e}return Al(s,f)}function Bd(e){return e.match(Fd)[1].replace(Ud,"'")}function Hd(e,t){const s=Ol(e),r=Ol(t);return s.getFullYear()===r.getFullYear()&&s.getMonth()===r.getMonth()}function Gd(e,t){return Dl(e,-t)}function Kd(e,t){const s=function(e){const t={},s=e.split(Yd.dateTimeDelimiter);let r;if(s.length>2)return t;/:/.test(s[0])?r=s[0]:(t.date=s[0],r=s[1],Yd.timeZoneDelimiter.test(t.date)&&(t.date=e.split(Yd.timeZoneDelimiter)[0],r=e.substr(t.date.length,e.length)));if(r){const e=Yd.timezone.exec(r);e?(t.time=r.replace(e[1],""),t.timezone=e[1]):t.time=r}return t}(e);let r;if(s.date){const e=function(e,t){const s=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),r=e.match(s);if(!r)return{year:NaN,restDateString:""};const n=r[1]?parseInt(r[1]):null,a=r[2]?parseInt(r[2]):null;return{year:null===a?n:100*a,restDateString:e.slice((r[1]||r[2]).length)}}(s.date,2);r=function(e,t){if(null===t)return new Date(NaN);const s=e.match(Jd);if(!s)return new Date(NaN);const r=!!s[4],n=eu(s[1]),a=eu(s[2])-1,i=eu(s[3]),o=eu(s[4]),l=eu(s[5])-1;if(r)return function(e,t,s){return t>=1&&t<=53&&s>=0&&s<=6}(0,o,l)?function(e,t,s){const r=new Date(0);r.setUTCFullYear(e,0,4);const n=r.getUTCDay()||7,a=7*(t-1)+s+1-n;return r.setUTCDate(r.getUTCDate()+a),r}(t,o,l):new Date(NaN);{const e=new Date(0);return function(e,t,s){return t>=0&&t<=11&&s>=1&&s<=(su[t]||(ru(e)?29:28))}(t,a,i)&&function(e,t){return t>=1&&t<=(ru(e)?366:365)}(t,n)?(e.setUTCFullYear(t,a,Math.max(n,i)),e):new Date(NaN)}}(e.restDateString,e.year)}if(!r||isNaN(r.getTime()))return new Date(NaN);const n=r.getTime();let a,i=0;if(s.time&&(i=function(e){const t=e.match(Zd);if(!t)return NaN;const s=tu(t[1]),r=tu(t[2]),n=tu(t[3]);if(!function(e,t,s){if(24===e)return 0===t&&0===s;return s>=0&&s<60&&t>=0&&t<60&&e>=0&&e<25}(s,r,n))return NaN;return s*$l+r*Rl+1e3*n}(s.time),isNaN(i)))return new Date(NaN);if(!s.timezone){const e=new Date(n+i),t=new Date(0);return t.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),t.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),t}return a=function(e){if("Z"===e)return 0;const t=e.match(Xd);if(!t)return 0;const s="+"===t[1]?-1:1,r=parseInt(t[2]),n=t[3]&&parseInt(t[3])||0;if(!function(e,t){return t>=0&&t<=59}(0,n))return NaN;return s*(r*$l+n*Rl)}(s.timezone),isNaN(a)?new Date(NaN):new Date(n+i+a)}const Yd={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Jd=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Zd=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Xd=/^([+-])(\d{2})(?::?(\d{2}))?$/;function eu(e){return e?parseInt(e):1}function tu(e){return e&&parseFloat(e.replace(",","."))||0}const su=[31,null,31,30,31,30,31,31,30,31,30,31];function ru(e){return e%400==0||e%4==0&&e%100!=0}function nu(e,t){const s=Ol(e),r=s.getFullYear(),n=s.getDate(),a=Al(e,0);a.setFullYear(r,t,15),a.setHours(0,0,0,0);const i=function(e){const t=Ol(e),s=t.getFullYear(),r=t.getMonth(),n=Al(e,0);return n.setFullYear(s,r+1,0),n.setHours(0,0,0,0),n.getDate()}(a);return s.setMonth(t,Math.min(n,i)),s}function au(e,t){const s=Ol(e);return isNaN(+s)?Al(e,NaN):(s.setFullYear(t),s)}const iu={lessThanXSeconds:{one:" 1 ",other:" {{count}} "},xSeconds:{one:"1 ",other:"{{count}} "},halfAMinute:"",lessThanXMinutes:{one:" 1 ",other:" {{count}} "},xMinutes:{one:"1 ",other:"{{count}} "},aboutXHours:{one:" 1 ",other:" {{count}} "},xHours:{one:"1 ",other:"{{count}} "},xDays:{one:"1 ",other:"{{count}} "},aboutXWeeks:{one:" 1 ",other:" {{count}} "},xWeeks:{one:"1 ",other:"{{count}} "},aboutXMonths:{one:" 1 ",other:" {{count}} "},xMonths:{one:"1 ",other:"{{count}} "},aboutXYears:{one:" 1 ",other:" {{count}} "},xYears:{one:"1 ",other:"{{count}} "},overXYears:{one:" 1 ",other:" {{count}} "},almostXYears:{one:" 1 ",other:" {{count}} "}},ou={date:cc({formats:{full:"EEEE do MMMM y",long:"do MMMM y",medium:"d MMM y",short:"dd/MM/yyyy"},defaultWidth:"full"}),time:cc({formats:{full:"H:mm:ss . zzzz",long:"H:mm:ss . z",medium:"H:mm:ss .",short:"H:mm ."},defaultWidth:"medium"}),dateTime:cc({formats:{full:"{{date}} '' {{time}}",long:"{{date}} '' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},lu={lastWeek:"eeee'' p",yesterday:"'' p",today:"'' p",tomorrow:"'' p",nextWeek:"eeee '' p",other:"P"},cu={code:"th",formatDistance:(e,t,s)=>{let r;const n=iu[e];return r="string"==typeof n?n:1===t?n.one:n.other.replace("{{count}}",String(t)),(null==s?void 0:s.addSuffix)?s.comparison&&s.comparison>0?"halfAMinute"===e?""+r:" "+r:r+"":r},formatLong:ou,formatRelative:(e,t,s,r)=>lu[e],localize:{ordinalNumber:(e,t)=>String(e),era:hc({values:{narrow:["B",""],abbreviated:["BC",".."],wide:["",""]},defaultWidth:"wide"}),quarter:hc({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["","","",""]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:hc({values:{narrow:["..","..","..","..","..","..","..","..","..","..","..",".."],abbreviated:["..","..","..","..","..","..","..","..","..","..","..",".."],wide:["","","","","","","","","","","",""]},defaultWidth:"wide"}),day:hc({values:{narrow:[".",".",".",".",".",".","."],short:[".",".",".",".",".",".","."],abbreviated:[".",".",".",".",".",".","."],wide:["","","","","","",""]},defaultWidth:"wide"}),dayPeriod:hc({values:{narrow:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},abbreviated:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},wide:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""}},defaultWidth:"wide",formattingValues:{narrow:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},abbreviated:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""},wide:{am:"",pm:"",midnight:"",noon:"",morning:"",afternoon:"",evening:"",night:""}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:pc({matchPattern:/^\d+/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)}),era:mc({matchPatterns:{narrow:/^([bB]|[aA]|)/i,abbreviated:/^([bB]\.?\s?[cC]\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?|\.?\.?)/i,wide:/^(||)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^[bB]/i,/^(^[aA]|\.?\.?|||)/i]},defaultParseWidth:"any"}),quarter:mc({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^()? ?[1234]/i},defaultMatchWidth:"wide",parsePatterns:{any:[/(1||)/i,/(2|)/i,/(3|)/i,/(4|)/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:mc({matchPatterns:{narrow:/^(\.?\.?|\.?\.?|\.?\.?|\.?\.?|\.?\.?|\.?\.?|\.?\.?|\.?\.?|\.?\.?|\.?\.?|\.?\.?|\.?\.?)/i,abbreviated:/^(\.?\.?|\.?\.?|\.?\.?|\.?\.?|\.?\.?|\.?\.?|\.?\.?|\.?\.?|\.?\.?|\.?\.?|\.?\.?|\.?\.?')/i,wide:/^(|||||||||||)/i},defaultMatchWidth:"wide",parsePatterns:{wide:[/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i],any:[/^\.?\.?/i,/^\.?\.?/i,/^\.?\.?/i,/^\.?\.?/i,/^\.?\.?/i,/^\.?\.?/i,/^\.?\.?/i,/^\.?\.?/i,/^\.?\.?/i,/^\.?\.?/i,/^\.?\.?/i,/^\.?\.?/i]},defaultParseWidth:"any"}),day:mc({matchPatterns:{narrow:/^(\.?|\.?|\.?|\.?|\.?|\.?|\.?)/i,short:/^(\.?|\.?|\.?|\.?|\.?|\.?|\.?)/i,abbreviated:/^(\.?|\.?|\.?|\.?|\.?|\.?|\.?)/i,wide:/^(||||||)/i},defaultMatchWidth:"wide",parsePatterns:{wide:[/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i],any:[/^/i,/^/i,/^/i,/^(?!)/i,/^/i,/^/i,/^/i]},defaultParseWidth:"any"}),dayPeriod:mc({matchPatterns:{any:/^(||||(.*?)?.*(||||))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^/i,pm:/^/i,midnight:/^/i,noon:/^/i,morning://i,afternoon://i,evening://i,night://i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}},du=({totalQueues:e,totalPatients:t,avgWaitingTime:s=15,avgServiceTime:r=8,className:n,queueDistribution:a={regular:70,urgent:10,elderly:15,special:5},queueTypeNames:o={regular:"",urgent:"",elderly:"",special:""},predictedWaitTime:l,isSimulationMode:c=!1,avgWaitTimeToday:d,avgServiceTimeToday:u,insQueues:h=[],totalInsQueues:m=0,totalInsPatients:p=0,waitingInsQueues:f=[],activeInsQueues:g=[]})=>{localStorage.getItem("enable_wait_time_prediction");const x=Math.round(d);return i.jsx("div",{className:`space-y-6 ${n}`,children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsx(Fi,{children:i.jsxs(zi,{className:"p-6",children:[i.jsx("div",{className:"flex justify-between items-start mb-4",children:i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:" ()"}),i.jsx("p",{className:"text-xs text-gray-400",children:""})]})}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"flex flex-col items-center gap-3 p-4 border border-gray-200 rounded-lg min-w-0",children:[i.jsx("div",{className:"bg-blue-100 p-2 rounded-full flex-shrink-0",children:i.jsx(tl,{className:"w-5 h-5 text-blue-600"})}),i.jsxs("div",{className:"text-center w-full",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:""}),i.jsx("p",{className:"text-2xl font-bold text-blue-600 whitespace-nowrap",children:e})]})]}),i.jsxs("div",{className:"flex flex-col items-center gap-3 p-4 border border-gray-200 rounded-lg min-w-0",children:[i.jsx("div",{className:"bg-purple-100 p-2 rounded-full flex-shrink-0",children:i.jsx(xl,{className:"w-5 h-5 text-purple-600"})}),i.jsxs("div",{className:"text-center w-full",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:""}),i.jsx("p",{className:"text-2xl font-bold text-purple-600 whitespace-nowrap",children:m})]})]})]}),i.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:[""," ",i.jsx("span",{className:"font-medium",children:zc(new Date,"dd MMM HH:mm .",{locale:cu})})]})]})}),i.jsx(Fi,{children:i.jsxs(zi,{className:"p-6",children:[i.jsx("div",{className:"flex justify-between items-start mb-4",children:i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:" ()"}),i.jsx("p",{className:"text-xs text-gray-400",children:""})]})}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"flex flex-col items-center gap-3 p-4 border border-gray-200 rounded-lg min-w-0",children:[i.jsx("div",{className:"bg-blue-100 p-2 rounded-full flex-shrink-0",children:i.jsx(tl,{className:"w-5 h-5 text-blue-600"})}),i.jsxs("div",{className:"text-center w-full",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:""}),i.jsxs("p",{className:"text-2xl font-bold text-blue-600 whitespace-nowrap",children:[x," "]})]})]}),i.jsxs("div",{className:"flex flex-col items-center gap-3 p-4 border border-gray-200 rounded-lg min-w-0",children:[i.jsx("div",{className:"bg-purple-100 p-2 rounded-full flex-shrink-0",children:i.jsx(xl,{className:"w-5 h-5 text-purple-600"})}),i.jsxs("div",{className:"text-center w-full",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:""}),i.jsxs("p",{className:"text-2xl font-bold text-purple-600 whitespace-nowrap",children:[x," "]})]})]})]}),i.jsx("div",{className:"mt-4 text-xs text-gray-500",children:""})]})}),i.jsx(Fi,{children:i.jsxs(zi,{className:"p-6",children:[i.jsx("div",{className:"flex justify-between items-start mb-4",children:i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:" ()"}),i.jsx("p",{className:"text-xs text-gray-400",children:""})]})}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"flex flex-col items-center gap-3 p-4 border border-gray-200 rounded-lg min-w-0",children:[i.jsx("div",{className:"bg-blue-100 p-2 rounded-full flex-shrink-0",children:i.jsx(tl,{className:"w-5 h-5 text-blue-600"})}),i.jsxs("div",{className:"text-center w-full",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:""}),i.jsx("p",{className:"text-2xl font-bold text-blue-600 whitespace-nowrap",children:t})]})]}),i.jsxs("div",{className:"flex flex-col items-center gap-3 p-4 border border-gray-200 rounded-lg min-w-0",children:[i.jsx("div",{className:"bg-purple-100 p-2 rounded-full flex-shrink-0",children:i.jsx(xl,{className:"w-5 h-5 text-purple-600"})}),i.jsxs("div",{className:"text-center w-full",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:""}),i.jsx("p",{className:"text-2xl font-bold text-purple-600 whitespace-nowrap",children:p})]})]})]}),i.jsx("div",{className:"mt-4 text-xs text-gray-500",children:""})]})})]})})},uu=({waitingQueues:e,activeQueues:t,completedQueues:s,queues:r,avgWaitTime:n,avgServiceTime:a,avgServiceTimeToday:o,avgWaitTimeToday:l,isSimulationMode:c=!1,insQueues:d=[],waitingInsQueues:u=[],activeInsQueues:h=[],completedInsQueues:m=[],insAvgWaitTime:p=0,insAvgServiceTime:f=0,insAvgWaitTimeToday:g=0,insAvgServiceTimeToday:x=0})=>{const y=o?Math.round(e.length*o/Math.max(t.length,1)):void 0,v=new Set(r.map(e=>e.patient_id)).size,b=new Set(d.map(e=>e.ID_card||e.phone_number).filter(e=>e)).size;return i.jsx("div",{className:"mb-6",children:i.jsx(du,{totalQueues:s.length,totalPatients:v,avgWaitingTime:n,avgServiceTime:a,predictedWaitTime:y,avgWaitTimeToday:Math.round(l)||0,avgServiceTimeToday:o,queueDistribution:{regular:e.filter(e=>"GENERAL"===e.type).length,urgent:e.filter(e=>"URGENT"===e.type).length,elderly:e.filter(e=>"ELDERLY"===e.type).length,special:e.filter(e=>"APPOINTMENT"===e.type).length},queueTypeNames:{regular:"",urgent:"",elderly:"",special:""},isSimulationMode:c,insQueues:d,totalInsQueues:m.length,totalInsPatients:b,waitingInsQueues:u,activeInsQueues:h})})},hu=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,mu=lt,pu=(e,t)=>s=>{var r;if(null==(null==t?void 0:t.variants))return mu(e,null==s?void 0:s.class,null==s?void 0:s.className);const{variants:n,defaultVariants:a}=t,i=Object.keys(n).map(e=>{const t=null==s?void 0:s[e],r=null==a?void 0:a[e];if(null===t)return null;const i=hu(t)||hu(r);return n[e][i]}),o=s&&Object.entries(s).reduce((e,t)=>{let[s,r]=t;return void 0===r||(e[s]=r),e},{}),l=null==t||null===(r=t.compoundVariants)||void 0===r?void 0:r.reduce((e,t)=>{let{class:s,className:r,...n}=t;return Object.entries(n).every(e=>{let[t,s]=e;return Array.isArray(s)?s.includes({...a,...o}[t]):{...a,...o}[t]===s})?[...e,s,r]:e},[]);return mu(e,i,l,null==s?void 0:s.class,null==s?void 0:s.className)},fu=pu("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),gu=n.forwardRef(({className:e,variant:t,size:s,asChild:r=!1,...n},a)=>{const o=r?S:"button";return i.jsx(o,{className:Qi(fu({variant:t,size:s,className:e})),ref:a,...n})});gu.displayName="Button";const xu=()=>i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:""}),i.jsx("p",{className:"text-gray-500",children:""})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(gu,{variant:"outline",className:"text-pharmacy-600 border-pharmacy-200",asChild:!0,children:i.jsxs(o,{to:"/patient-portal",children:[i.jsx(fl,{className:"w-4 h-4 mr-2"}),""]})}),i.jsx(gu,{className:"bg-pharmacy-600 hover:bg-pharmacy-700 text-white",asChild:!0,children:i.jsxs(o,{to:"/queue-board",children:[i.jsx(Mo,{className:"w-4 h-4 mr-2"}),""]})}),i.jsx(gu,{className:"bg-pharmacy-600 hover:bg-pharmacy-700 text-white",asChild:!0,children:i.jsxs(o,{to:"/queue-board-ins",children:[i.jsx(Mo,{className:"w-4 h-4 mr-2"}),""]})}),i.jsx(gu,{className:"bg-pharmacy-600 hover:bg-pharmacy-700 text-white",asChild:!0,children:i.jsxs(o,{to:"/combined-queue-board",children:[i.jsx(Mo,{className:"w-4 h-4 mr-2"}),""]})})]})]}),yu={async createQueuesFromAppointments(){try{const{data:e,error:t}=await qa.rpc("create_queues_from_appointments");if(t)return a.error(""),0;const s=e||0;return s>0&&a.success(` ${s} `),s}catch(e){return a.error(""),0}},async syncAppointmentQueueStatus(){try{const{error:e}=await qa.rpc("sync_appointment_queue_status");if(e)return void a.error("")}catch(e){a.error("")}},async getAppointmentByQueueId(e){try{const{data:t,error:s}=await qa.from("queues").select("\n          appointment_id,\n          appointments (\n            id,\n            date,\n            purpose,\n            notes,\n            status\n          )\n        ").eq("id",e).single();return s?null:null==t?void 0:t.appointments}catch(t){return null}}},vu=({waitingQueues:e,activeQueues:t,completedQueues:s,patientsCount:r,avgWaitTime:a,waitingInsQueues:l,activeInsQueues:c,completedInsQueues:d,avgInsWaitTime:u})=>{n.useEffect(()=>{(async()=>{await yu.createQueuesFromAppointments(),await yu.syncAppointmentQueueStatus()})()},[]);return i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[i.jsxs(Fi,{className:"h-full bg-gradient-to-br from-teal-50 to-cyan-50 hover:shadow-md border-teal-100",children:[i.jsx(Ui,{className:"pb-2",children:i.jsxs(Wi,{className:"flex items-center",children:[i.jsx(xl,{className:"mr-2 h-5 w-5 text-teal-600"}),""]})}),i.jsxs(zi,{children:[i.jsx("p",{className:"text-gray-600",children:"  "}),i.jsxs("div",{className:"mt-4 text-sm text-teal-600",children:[": ",l.length," | :"," ",c.length]})]}),i.jsx(Bi,{className:"pt-2 flex justify-end",children:i.jsx(gu,{asChild:!0,size:"sm",className:"bg-teal-600 hover:bg-teal-700 text-white",children:i.jsxs(o,{to:"/queue/create-ins",children:[i.jsx(yo,{className:"h-3 w-3 mr-1"}),""]})})})]}),i.jsxs(Fi,{className:"h-full bg-gradient-to-br from-blue-50 to-purple-50 hover:shadow-md border-blue-100",children:[i.jsx(Ui,{className:"pb-2",children:i.jsxs(Wi,{className:"flex items-center",children:[i.jsx(Ro,{className:"mr-2 h-5 w-5 text-blue-600"}),""]})}),i.jsxs(zi,{children:[i.jsx("p",{className:"text-gray-600",children:"  "}),i.jsxs("div",{className:"mt-4 text-sm text-blue-600",children:[": ",e.length," | :"," ",t.length]})]}),i.jsxs(Bi,{className:"pt-2 flex justify-between",children:[i.jsx(gu,{asChild:!0,variant:"outline",size:"sm",className:"text-blue-600 border-blue-200",children:i.jsx(o,{to:"/queue",children:""})}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx(gu,{onClick:async()=>{await yu.createQueuesFromAppointments(),await yu.syncAppointmentQueueStatus()},variant:"outline",size:"sm",className:"text-green-600 border-green-200",title:"",children:i.jsx(al,{className:"h-3 w-3"})}),i.jsx(gu,{asChild:!0,size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white",children:i.jsxs(o,{to:"/queue/create",children:[i.jsx(yo,{className:"h-3 w-3 mr-1"}),""]})})]})]})]}),i.jsx(o,{to:"/analytics",className:"transition-transform hover:scale-105",children:i.jsxs(Fi,{className:"h-full bg-gradient-to-br from-green-50 to-emerald-50 hover:shadow-md border-green-100",children:[i.jsx(Ui,{className:"pb-2",children:i.jsxs(Wi,{className:"flex items-center",children:[i.jsx(oo,{className:"mr-2 h-5 w-5 text-green-600"}),""]})}),i.jsxs(zi,{children:[i.jsx("p",{className:"text-gray-600",children:""}),i.jsxs("div",{className:"mt-4 space-y-1",children:[i.jsxs("div",{className:"text-sm text-green-600",children:[" (): ",Math.round(a)," "]}),i.jsxs("div",{className:"text-sm text-teal-600",children:[" (): ",Math.round(u)," "]})]})]})]})}),i.jsx(o,{to:"/patients",className:"transition-transform hover:scale-105",children:i.jsxs(Fi,{className:"h-full bg-gradient-to-br from-amber-50 to-yellow-50 hover:shadow-md border-amber-100",children:[i.jsx(Ui,{className:"pb-2",children:i.jsxs(Wi,{className:"flex items-center",children:[i.jsx(Tl,{className:"mr-2 h-5 w-5 text-amber-600"}),""]})}),i.jsxs(zi,{children:[i.jsx("p",{className:"text-gray-600",children:""}),i.jsxs("div",{className:"mt-4 text-sm text-amber-600",children:[": ",r]})]})]})}),i.jsx(o,{to:"/medications",className:"transition-transform hover:scale-105",children:i.jsxs(Fi,{className:"h-full bg-gradient-to-br from-red-50 to-pink-50 hover:shadow-md border-red-100",children:[i.jsx(Ui,{className:"pb-2",children:i.jsxs(Wi,{className:"flex items-center",children:[i.jsx(tl,{className:"mr-2 h-5 w-5 text-red-600"}),""]})}),i.jsxs(zi,{children:[i.jsx("p",{className:"text-gray-600",children:""}),i.jsx("div",{className:"mt-4 text-sm text-red-600",children:""})]})]})}),i.jsx(o,{to:"/appointments",className:"transition-transform hover:scale-105",children:i.jsxs(Fi,{className:"h-full bg-gradient-to-br from-indigo-50 to-blue-50 hover:shadow-md border-indigo-100",children:[i.jsx(Ui,{className:"pb-2",children:i.jsxs(Wi,{className:"flex items-center",children:[i.jsx(ao,{className:"mr-2 h-5 w-5 text-indigo-600"}),""]})}),i.jsxs(zi,{children:[i.jsx("p",{className:"text-gray-600",children:""}),i.jsx("div",{className:"mt-4 text-sm text-indigo-600",children:""})]})]})}),i.jsx(o,{to:"/queue-history",className:"transition-transform hover:scale-105",children:i.jsxs(Fi,{className:"h-full bg-gradient-to-br from-purple-50 to-violet-50 hover:shadow-md border-purple-100",children:[i.jsx(Ui,{className:"pb-2",children:i.jsxs(Wi,{className:"flex items-center",children:[i.jsx(jo,{className:"mr-2 h-5 w-5 text-purple-600"}),""]})}),i.jsxs(zi,{children:[i.jsx("p",{className:"text-gray-600",children:""}),i.jsxs("div",{className:"mt-4 text-sm text-purple-600",children:[": ",s.length]})]})]})}),i.jsx(o,{to:"/ins-queue-history",className:"transition-transform hover:scale-105",children:i.jsxs(Fi,{className:"h-full bg-gradient-to-br from-cyan-50 to-sky-50 hover:shadow-md border-cyan-100",children:[i.jsx(Ui,{className:"pb-2",children:i.jsxs(Wi,{className:"flex items-center",children:[i.jsx(jo,{className:"mr-2 h-5 w-5 text-cyan-600"}),""]})}),i.jsxs(zi,{children:[i.jsx("p",{className:"text-gray-600",children:""}),i.jsxs("div",{className:"mt-4 text-sm text-cyan-600",children:[": ",d.length]})]})]})})]})},bu=e=>{return{id:e.id,number:e.number,patient_id:e.patient_id,type:e.type,status:(t=e.status,["WAITING","ACTIVE","COMPLETED","SKIPPED","CANCELLED"].includes(t)?t:"WAITING"),service_point_id:e.service_point_id,notes:e.notes||null,created_at:e.created_at,updated_at:e.updated_at,called_at:e.called_at||null,completed_at:e.completed_at||null,queue_date:e.queue_date||null,skipped_at:e.skipped_at||null,cancelled_at:e.cancelled_at||null,paused_at:e.paused_at||null,appointment_id:e.appointment_id||null};var t};function wu(e){if(!e)return"-";try{return new Date(e).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"numeric"})}catch(t){return e}}const ju=e=>{if(!e)return"";const t=new Date,s="string"==typeof e?new Date(e):e,r=t.getTime()-s.getTime(),n=Math.floor(r/6e4);if(n<1)return"";if(n<60)return`${n} `;if(n<1440){return`${Math.floor(n/60)} `}return`${Math.floor(n/1440)} `},Nu=()=>{const e=new Date;return new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().split("T")[0]},_u=e=>{const t=Nu();return e.split("T")[0]===t},Su=(e,t)=>_u(e||t),ku=Qa("useQueueCore"),Cu={voice:"th",rate:1,pitch:1,volume:1,language:"th",debug:!1};let Tu=null,Eu=!1,Iu=[],Pu=0;function Ou(){Eu=!1,Tu&&(Tu.pause(),Tu=null),Pu=0,Iu=[]}function Au(e,t,s){if(!Eu||Pu>=Iu.length)return Eu=!1,Pu=0,Iu=[],void t();const r=Iu[Pu];let n=e.language||"th",i=e.rate||1;const o=e.voice||"th";if(o.includes("+")){const e=o.split("+");n=e[0],"s"===e[1]&&(i=.7)}else n=o;try{const o=new Audio;o.onended=()=>{Eu&&(Pu++,Au(e,t,s))},o.onerror=async r=>{a.error(` ${Pu+1}`),Eu&&(Pu++,setTimeout(()=>Au(e,t,s),500))};const c=function(e,t){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?`https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(e)}&tl=${t}&client=tw-ob`:`/.netlify/functions/tts-proxy?text=${encodeURIComponent(e)}&lang=${t}`}(r,n);o.volume=e.volume||1;try{o.playbackRate=i}catch(l){}o.src=c,Tu=o,o.play().catch(r=>{"NotAllowedError"===r.name&&a.error(":  ()"),Eu&&(Pu++,setTimeout(()=>Au(e,t,s),500))})}catch(c){if(a.error(`: ${c instanceof Error?c.message:"Unknown error"}`),!Eu)return;Pu++,setTimeout(()=>Au(e,t,s),500)}}const Du=()=>{Ou()};let Mu={};const qu=e=>"string"==typeof e?e.length||3:"number"==typeof e&&e||3,Ru=e=>{const t={};for(const s of e||[]){const e=null==s?void 0:s.code;if(!e)continue;const r=((null==s?void 0:s.prefix)||e.charAt(0)||"Q").toString(),n=qu(null==s?void 0:s.format);t[e]={prefix:r,padLength:n}}return t};(()=>{try{(()=>{try{if("undefined"==typeof window)return;const e=localStorage.getItem("queue_types");if(!e)return;const t=JSON.parse(e);Mu=Ru(t)}catch(e){}})(),(async()=>{try{const{data:e,error:t}=await qa.from("queue_types").select("code, prefix, format").order("priority",{ascending:!1}),{data:s}=await qa.from("queue_ins_types").select("code, prefix, format");if(t)throw t;e&&s&&(Mu=Ru([...e,...s]))}catch(e){}})()}catch{}})();const $u=(e,t)=>{const s=Mu[e];if(!s){return`${(null==e?void 0:e.charAt(0))||"Q"}${t.toString().padStart(3,"0")}`}return`${s.prefix}${t.toString().padStart(s.padLength,"0")}`},Lu={A:"",B:"",C:"",D:"",E:"",F:"",G:"",H:"",I:"",J:"",K:"",L:"",M:"",N:"",O:"",P:"",Q:"",R:"",S:"",T:"",U:"",V:"",W:"",X:"",Y:"",Z:"",0:"",1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:""};function Qu(e,t,s){try{const r=function(e){return e?e.split("").map(e=>{const t=e.toUpperCase();return Lu[t]||e}).join(" "):""}($u(s||"GENERAL",e)),n=function(e){if("string"==typeof e)return` ${e}`;if(e&&(e.code||e.name)){let t=[];return e.name&&t.push(e.name),` ${t.join(" ")}`}return" "}(t);return` ${r} ${n}`}catch(r){return` ${e}`}}const Fu=(e,t={})=>{const s="true"===localStorage.getItem("tts_debug_mode")||!0===t.debug;return new Promise((r,n)=>{Ou();const a={...Cu,...t,debug:s},i=function(e,t=200){const s=e.split(new RegExp("(?<=[.!?])\\s+")),r=[];let n="";for(let a=0;a<s.length;a++){const e=s[a];if(e.length>t){const s=e.split(new RegExp("(?<=[,;:])(?=\\s)"));for(const e of s)if(e.length>t)for(let s=0;s<e.length;s+=t)r.push(e.substring(s,s+t));else n.length+e.length>t?(r.push(n),n=e):n+=(n?" ":"")+e}else n.length+e.length>t?(r.push(n),n=e):n+=(n?" ":"")+e}return n&&r.push(n),r}(e);!function(e){Iu=e,Pu=0,Eu=!0}(i),Au(a,r,n)})};function Uu(e,t,s){try{const r=Qu(e,t,s),n=localStorage.getItem("queue_voice_volume"),a=localStorage.getItem("queue_voice_rate"),i=localStorage.getItem("queue_voice_type")||"th",o="true"===localStorage.getItem("tts_debug_mode"),l=n?parseInt(n)/100:1,c=a?parseInt(a)/100:1;Fu(r,{volume:l,rate:c,voice:i,debug:o})}catch(r){Fu(` ${e}`)}}let Wu=null,Vu=0;async function zu(e){try{const t=(await async function(){const e=Date.now();if(Wu&&e-Vu<3e5)return Wu;try{const{data:t,error:s}=await qa.from("service_points").select("*").eq("enabled",!0).order("code");return s?[]:(Wu=t||[],Vu=e,Wu)}catch(t){return[]}}()).find(t=>t.id===e);return t?{name:t.name}:null}catch(t){return null}}const Bu=Qa("smsSettings"),Hu=async()=>{try{const{data:e,error:t}=await qa.from("settings").select("value").eq("category","sms").eq("key","enabled").single();return t||!e?(Bu.warn("SMS enabled setting not found, defaulting to disabled"),!1):"true"===e.value||!0===e.value}catch(e){return Bu.error("Error checking SMS enabled status:",e),!1}},Gu=async()=>{try{const{data:e,error:t}=await qa.from("settings").select("value").eq("category","sms").eq("key","message_template").single();if(t||!e)return null;const s=e.value;return"string"==typeof s?s.startsWith('"')&&s.endsWith('"')?JSON.parse(s):s:s?String(s):null}catch(e){return Bu.error("Error getting message template:",e),null}};let Ku={};const Yu=e=>"string"==typeof e?e.length||3:"number"==typeof e&&e||3,Ju=e=>{const t={};for(const s of e||[]){const e=null==s?void 0:s.code;if(!e)continue;const r=((null==s?void 0:s.prefix)||e.charAt(0)||"I").toString(),n=Yu(null==s?void 0:s.format);t[e]={prefix:r,padLength:n}}return t};(()=>{try{(()=>{try{if("undefined"==typeof window)return;const e=localStorage.getItem("queue_ins_types");if(!e)return;const t=JSON.parse(e);Ku=Ju(t)}catch(e){}})(),(async()=>{try{const{data:e,error:t}=await qa.from("queue_ins_types").select("code, prefix, format").order("id",{ascending:!0});if(t)throw t;e&&(Ku=Ju(e))}catch(e){}})()}catch{}})();const Zu=(e,t)=>{if(!t)return"-";const s=e?Ku[e]:void 0;if(!s){return`${(null==e?void 0:e.charAt(0))||"I"}${t.toString().padStart(3,"0")}`}return`${s.prefix}${t.toString().padStart(s.padLength,"0")}`},Xu=Qa("smsService"),eh=async(e,t,s)=>{try{if(!(null==e?void 0:e.phone))return Xu.warn(`No phone number for patient ${null==e?void 0:e.name} (Queue ${t.number})`),!1;const r=$u(t.type,t.number),n=await Gu(),a=n?n.replace("{queueNumber}",r).replace("{servicePoint}",(null==s?void 0:s.name)||""):`  ${r}${(null==s?void 0:s.name)?`  ${s.name}`:""} `,{data:i,error:o}=await qa.functions.invoke("send-sms-notification",{body:{phoneNumber:null==e?void 0:e.phone,message:a,queueNumber:r,patientName:null==e?void 0:e.name,servicePointName:null==s?void 0:s.name}});if(o)return Xu.error(`SMS error for queue ${r}:`,o),!1;Xu.info(`SMS sent successfully to queue ${r} (${null==e?void 0:e.name})`);const{error:l}=await qa.from("queues").update({noti_at:(new Date).toISOString()}).eq("id",t.id);return l?Xu.error(`Failed to update noti_at for queue ${r} (id=${t.id}):`,l):Xu.info(`Updated noti_at for queue ${r} (id=${t.id})`),!0}catch(r){return Xu.error(`Error sending SMS to patient ${null==e?void 0:e.name}:`,r),!1}},th=async(e,t)=>{try{const s=e.phone_number;if(!s)return Xu.warn(`No phone number for INS queue ${e.number}`),!1;const r=Zu(e.type,e.number),n=await(async()=>{try{const{data:e,error:t}=await qa.from("settings").select("value").eq("category","sms").eq("key","message_template_ins").single();if(t||!e)return null;const s=e.value;return"string"==typeof s?s.startsWith('"')&&s.endsWith('"')?JSON.parse(s):s:s?String(s):null}catch(i){return Bu.error("Error getting message template ins:",i),null}})(),a=n?n.replace("{queueNumber}",r).replace("{servicePoint}",(null==t?void 0:t.name)||""):`  ${r}${(null==t?void 0:t.name)?`  ${t.name}`:""} `,{error:i}=await qa.functions.invoke("send-sms-notification",{body:{phoneNumber:s,message:a,queueNumber:r,patientName:void 0,servicePointName:null==t?void 0:t.name}});if(i)return Xu.error(`SMS error for INS queue ${r}:`,i),!1;Xu.info(`SMS sent successfully to INS queue ${r}`);const{error:o}=await qa.from("queues_ins").update({noti_at:(new Date).toISOString()}).eq("id",e.id);return o?Xu.error(`Failed to update noti_at for INS queue ${r} (id=${e.id}):`,o):Xu.info(`Updated noti_at for INS queue ${r} (id=${e.id})`),!0}catch(s){return Xu.error(`Error sending SMS for INS queue ${e.number}:`,s),!1}},sh=Qa("queueFetching"),rh=async()=>{try{const e=Nu(),{data:t,error:s}=await qa.from("queues").select("\n        *,\n        patients (*),\n        service_points:service_points!queues_service_point_id_fkey (*)\n      ").eq("status","WAITING").eq("queue_date",e).is("paused_at",null).order("created_at",{ascending:!0}).limit(3);if(s)return sh.error("Error fetching next 3 waiting queues:",s),[];if(!t||0===t.length)return sh.info("No waiting queues found"),[];const r=t.filter(e=>e.patients&&e.service_points).map(e=>({queue:e,patient:e.patients,servicePoint:e.service_points}));return sh.info(`Found ${r.length} waiting queues with patients`),r}catch(e){return sh.error("Error getting next 3 waiting queues:",e),[]}},nh=async()=>{try{const{data:e,error:t}=await qa.from("service_points").select("*").eq("enabled",!0);if(t)throw t;if(!e||0===e.length)return[];const s=[];for(const r of e){const e=Nu(),{data:t,error:n}=await qa.from("queues").select("\n          *,\n          patients (*),\n          service_points:service_points!queues_service_point_id_fkey (*)\n        ").eq("status","WAITING").eq("queue_date",e).or(`service_point_id.eq.${r.id},service_point_id.is.null`).is("paused_at",null).order("created_at",{ascending:!0}).limit(3);if(n)sh.error(`Error fetching queues for service point ${r.name}:`,n);else if(t&&t.length>0){const e=t.map(e=>e.patients).filter(Boolean);s.push({servicePoint:r,queues:t,patients:e})}}return s}catch(e){return sh.error("Error getting next queues per service point:",e),[]}},ah=Qa("useSmsNotifications"),ih=()=>({sendSmsToNextQueues:n.useCallback(async()=>{try{if(!(await Hu()))return void ah.info("SMS notifications are disabled");ah.info("Starting SMS notifications for next 3 queues...");const e=await rh();if(0===e.length)return void ah.info("No waiting queues found");let t=0;const s=e.length;for(const{queue:n,patient:a,servicePoint:i}of e){if(n.noti_at)continue;await eh(a,n,i)&&t++}const r=` SMS  ${t}/${s} `;t>0&&a.success(r),ah.info(r)}catch(e){ah.error("Error in sendSmsToNextQueues:",e),a.error(" SMS ")}},[]),sendSmsToNextQueueIns:n.useCallback(async()=>{try{if(!(await Hu()))return void ah.info("SMS notifications are disabled");ah.info("Starting SMS notifications for next 3 INS queues...");const e=await(async()=>{try{const e=Nu(),{data:t,error:s}=await qa.from("queues_ins").select("\n        *,\n        service_points_ins (*)\n      ").eq("status","WAITING").eq("queue_date",e).is("paused_at",null).order("created_at",{ascending:!0}).limit(3);if(s)return sh.error("Error fetching next 3 waiting queues:",s),[];if(!t||0===t.length)return sh.info("No waiting queues found"),[];const r=t.map(e=>({queue:e,servicePoint:e.service_points_ins}));return sh.info(`Found ${r.length} waiting queues with patients`),r}catch(e){return sh.error("Error getting next 3 waiting queues:",e),[]}})();if(0===e.length)return void ah.info("No waiting INS queues found");let t=0;const s=e.length;for(const{queue:n,servicePoint:a}of e){if(n.noti_at)continue;await th(n,a)&&t++}const r=` SMS  ${t}/${s}  (INS)`;t>0&&a.success(r),ah.info(r)}catch(e){ah.error("Error in sendSmsToNextQueueIns:",e),a.error(" SMS  (INS)")}},[]),getNextQueuesPerServicePoint:nh,getNext3WaitingQueues:rh,sendSmsToPatient:eh,checkSmsEnabled:Hu,getMessageTemplate:Gu}),oh=Qa("useQueueCoreActions"),lh=Qa("useQueueTransferActions"),ch=Qa("useServicePointActions"),dh=Qa("useQueueActions"),uh=(e,t,s,r,i,o,l,c)=>{const{callQueue:d,returnSkippedQueueToWaiting:u}=((e,t,s)=>{const{sendSmsToNextQueues:r}=ih();return{callQueue:n.useCallback(async(n,i)=>{try{const l=e.find(e=>e.id===n);if(!l)return a.error(""),null;let c=i;!c&&l.service_point_id&&(c=l.service_point_id);const d={status:"ACTIVE",called_at:(new Date).toISOString()};c&&(d.service_point_id=c);const{data:u,error:h}=await qa.from("queues").update(d).eq("id",n).select().single();if(h)return oh.error("Error calling queue:",h),a.error(""),null;if(u){const e=bu(u);if(t(e),s){const e=c?await zu(c):null;await Uu(l.number,e||{code:"",name:" "},l.type)}try{await r()}catch(o){oh.error("SMS notification error (non-blocking):",o)}return a.success(` ${l.number} `),e}return null}catch(l){return oh.error("Error in callQueue:",l),a.error(""),null}},[e,t,s,r]),returnSkippedQueueToWaiting:n.useCallback(async e=>{try{const{data:s,error:r}=await qa.from("queues").update({status:"WAITING",skipped_at:null}).eq("id",e).select().single();if(r)return oh.error("Error returning skipped queue to waiting:",r),a.error(""),null;if(s){const e=bu(s);return t(e),a.success(""),e}return null}catch(s){return oh.error("Error in returnSkippedQueueToWaiting:",s),a.error(""),null}},[t])}})(e,s,c),{transferQueueToServicePoint:h,putQueueOnHold:m}=(e=>({transferQueueToServicePoint:n.useCallback(async(t,s,r,n,i)=>{try{const o={service_point_id:r,transferred_to_service_point_id:s,transferred_at:(new Date).toISOString()};n&&(o.notes=n),i&&(o.type=i);const{data:l,error:c}=await qa.from("queues").update(o).eq("id",t).select().single();if(c)return lh.error("Error transferring queue:",c),a.error(""),null;if(l){const t=bu(l);return e(t),a.success(""),t}return null}catch(o){return lh.error("Error in transferQueueToServicePoint:",o),a.error(""),null}},[e]),putQueueOnHold:n.useCallback(async(t,s,r)=>{try{const s={status:"WAITING",paused_at:(new Date).toISOString()};r&&(s.notes=r);const{data:n,error:i}=await qa.from("queues").update(s).eq("id",t).select().single();if(i)return lh.error("Error putting queue on hold:",i),a.error(""),null;if(n){const t=bu(n);return e(t),a.success(""),t}return null}catch(n){return lh.error("Error in putQueueOnHold:",n),a.error(""),null}},[e])}))(s),{getIntelligentServicePointSuggestion:p,getNextQueueToCall:f}=((e,t)=>({getIntelligentServicePointSuggestion:n.useCallback(async e=>{try{const{data:t,error:s}=await qa.from("service_point_queue_types").select("\n          service_point_id,\n          service_point:service_points!inner(*)\n        ").eq("service_point.enabled",!0);if(s)return ch.error("Error fetching service point mappings:",s),null;const{data:r,error:n}=await qa.from("queue_types").select("id").eq("code",e).single();if(n||!r)return ch.error("Error fetching queue type:",n),null;const a=null==t?void 0:t.filter(e=>e.service_point_id===r.id);return a&&a.length>0?a[0].service_point:null}catch(t){return ch.error("Error in getIntelligentServicePointSuggestion:",t),null}},[]),getNextQueueToCall:n.useCallback(async s=>{try{const r=e.filter(e=>"WAITING"===e.status&&(e.service_point_id===s||!e.service_point_id));return 0===r.length?null:t(r,[],s)[0]||null}catch(r){return ch.error("Error getting next queue:",r),null}},[e,t])}))(e,i);return{callQueue:n.useCallback(async(t,s)=>{try{const r=e.find(e=>e.id===t);if(!r)return a.error(""),null;let n=s;if(n||r.service_point_id)r.service_point_id&&(n=r.service_point_id);else{const e=await p(r.type);e&&(n=e.id)}return await d(t,n)}catch(r){return dh.error("Error in enhanced callQueue:",r),a.error(""),null}},[e,d,p]),getNextQueueToCall:f,transferQueueToServicePoint:h,putQueueOnHold:m,returnSkippedQueueToWaiting:u,getIntelligentServicePointSuggestion:p}},hh=()=>{const[e,t]=n.useState(()=>{const e=localStorage.getItem("queue_voice_enabled");return null===e||"true"===e}),[s,r]=n.useState(()=>localStorage.getItem("queue_counter_name")||"1");n.useEffect(()=>{localStorage.setItem("queue_voice_enabled",String(e))},[e]),n.useEffect(()=>{localStorage.setItem("queue_counter_name",s)},[s]);return{voiceEnabled:e,setVoiceEnabled:t,counterName:s,setCounterName:r,updateQueueSettings:e=>{void 0!==e.voiceEnabled&&t(e.voiceEnabled),void 0!==e.counterName&&r(e.counterName)},recallQueue:async(t,r)=>{const n=r(t);if(n&&e)try{const e=(n.service_point_id?await zu(n.service_point_id):null)||{code:"",name:s};return await Uu(n.number,e,n.type),a.success(` ${n.number}`),!0}catch(i){return a.error(""),!1}return!1}}},mh=Qa("QueueAlgorithms");var ph=(e=>(e.FIFO="fifo",e.PRIORITY="priority",e.MULTILEVEL="multilevel",e.MULTILEVEL_FEEDBACK="multilevel_feedback",e.ROUND_ROBIN="round_robin",e))(ph||{});const fh=Qa("useQueueAlgorithm"),gh=()=>{const[e,t]=n.useState(ph.FIFO),[s,r]=n.useState([]);n.useEffect(()=>{fh.info("Loading queue algorithm and types");const e=async()=>{try{const{data:e,error:s}=await qa.from("settings").select("value").eq("category","queue").eq("key","queue_algorithm").maybeSingle();let r=ph.FIFO;if(!s&&(null==e?void 0:e.value)){const t=e.value,s="string"==typeof t?t:String(t);Object.values(ph).includes(s)?(r=s,fh.info("Successfully loaded queue algorithm from queue category:",r)):fh.warn("Invalid algorithm value from queue category, using default FIFO:",s)}else{fh.info("No queue algorithm in queue category, checking general category");const{data:e,error:t}=await qa.from("settings").select("value").eq("category","general").eq("key","queue_algorithm").maybeSingle();if(!t&&(null==e?void 0:e.value)){const t=e.value,s="string"==typeof t?t:String(t);Object.values(ph).includes(s)?(r=s,fh.info("Successfully loaded queue algorithm from general category:",r)):fh.warn("Invalid algorithm value from general category, using default FIFO:",s)}}t(r),localStorage.setItem("queue_algorithm",r)}catch(e){fh.error("Error in fetchQueueAlgorithm:",e);const s=localStorage.getItem("queue_algorithm");s&&Object.values(ph).includes(s)?t(s):t(ph.FIFO)}},s=async()=>{try{const{data:t,error:s}=await qa.from("queue_types").select("*").eq("enabled",!0),{data:n}=await qa.from("queue_ins_types").select("*").eq("enabled",!0);let a=[...t,...n];if(s){fh.error("Error fetching queue types from database:",s);const t=localStorage.getItem("queue_types");if(t)try{const e=JSON.parse(t);r(e)}catch(e){fh.error("Error parsing queue types from localStorage:",e)}return}a&&a.length>0?(r(a),localStorage.setItem("queue_types",JSON.stringify(a)),fh.info("Successfully loaded queue types:",a.length)):(fh.warn("No enabled queue types found in database"),r([]))}catch(t){fh.error("Error in fetchQueueTypes:",t);const e=localStorage.getItem("queue_types");if(e)try{const t=JSON.parse(e);r(t)}catch(s){fh.error("Error parsing queue types from localStorage:",s)}}};e(),s();const n=qa.channel("settings-changes").on("postgres_changes",{event:"*",schema:"public",table:"settings"},t=>{var s;fh.debug("Settings change detected:",t),"queue_algorithm"===(null==(s=t.new)?void 0:s.key)&&e()}).subscribe(),a=qa.channel("queue-types-changes").on("postgres_changes",{event:"*",schema:"public",table:"queue_types"},e=>{fh.debug("Queue types change detected:",e),s()}).subscribe();return()=>{qa.removeChannel(n),qa.removeChannel(a)}},[]);const a=n.useCallback((t,r=[],n)=>{fh.debug("Sorting queues with algorithm:",e,"for service point:",n),fh.debug("Service point capabilities:",r),fh.debug("Queue types available:",s);const a=((e,t,s="fifo",r=[],n)=>{mh.debug("sortQueuesByAlgorithm called with:",{queuesCount:e.length,algorithm:s,selectedServicePointId:n,servicePointCapabilities:r});let a=[...e];if(n&&r.length>0){const s=r.find(e=>e.servicePointId===n);mh.debug("Found capability for service point:",s),s&&s.queueTypeIds.length>0?(a=a.filter(e=>{const r=t.find(t=>t.code===e.type),n=r&&s.queueTypeIds.includes(r.id);return mh.debug("Queue filtering:",{queueId:e.id,queueNumber:e.number,queueType:e.type,queueTypeId:null==r?void 0:r.id,canHandle:n,capabilityQueueTypeIds:s.queueTypeIds}),n}),mh.debug("Filtered queues by service point capability:",{originalCount:e.length,filteredCount:a.length,servicePointId:n})):mh.warn("No capabilities found for service point or no queue types configured:",n)}else mh.debug("No service point selected or no capabilities configured, showing all queues");const i=t.reduce((e,t)=>(e[t.code]=t,e),{});switch(s){case"fifo":return a.sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime());case"priority":return a.sort((e,t)=>{var s,r;const n=(null==(s=i[e.type])?void 0:s.priority)||5,a=(null==(r=i[t.type])?void 0:r.priority)||5;return n!==a?a-n:new Date(e.created_at).getTime()-new Date(t.created_at).getTime()});case"multilevel":const e={};return a.forEach(t=>{e[t.type]||(e[t.type]=[]),e[t.type].push(t)}),Object.keys(e).forEach(t=>{e[t].sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime())}),Object.keys(e).sort((e,t)=>{var s,r;const n=(null==(s=i[e])?void 0:s.priority)||5;return((null==(r=i[t])?void 0:r.priority)||5)-n}).flatMap(t=>e[t]);case"multilevel_feedback":return a.sort((e,t)=>{var s,r;let n=(null==(s=i[e.type])?void 0:s.priority)||5,a=(null==(r=i[t.type])?void 0:r.priority)||5;const o=(Date.now()-new Date(e.created_at).getTime())/6e4,l=(Date.now()-new Date(t.created_at).getTime())/6e4;return n+=Math.floor(o/30),a+=Math.floor(l/30),n!==a?a-n:new Date(e.created_at).getTime()-new Date(t.created_at).getTime()});case"round_robin":const t={};a.forEach(e=>{t[e.type]||(t[e.type]=[]),t[e.type].push(e)}),Object.keys(t).forEach(e=>{t[e].sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime())});const s=[];let r=!0,n=0;for(;r;){r=!1;for(const e of Object.keys(t))n<t[e].length&&(s.push(t[e][n]),r=!0);n++}return s;default:return a}})(t,s,e,r,n);return fh.debug("Sorted queues result:",a),a},[e,s]);return{queueAlgorithm:e,setQueueAlgorithm:t,queueTypes:s,sortQueues:a}},xh=Qa("useQueues"),yh=()=>{xh.debug("Hook initialized");const{queues:e,allQueues:t,loading:s,error:r,fetchQueues:i,addQueue:o,updateQueueStatus:d,removeQueue:u,getQueuesByStatus:h,updateQueueInState:m,allQueuesNofilter:p}=(()=>{const[e,t]=n.useState(!1),[s,r]=n.useState(null),i=l(),{data:o=[],isLoading:d}=c({queryKey:["queues"],queryFn:async()=>{const{data:e,error:t}=await qa.from("queues").select("*").eq("queue_date",Nu()).not("service_point_id","is",null).order("number",{ascending:!0}).order("created_at",{ascending:!0});if(t)throw ku.error("Error fetching queues:",t),t;return e?e.map(bu):[]},refetchInterval:5e3}),{data:u=[]}=c({queryKey:["allQueuesNofilter"],queryFn:async()=>{const{data:e,error:t}=await qa.from("queues").select("*").order("created_at",{ascending:!0});if(t)throw ku.error("Error fetching queues:",t),t;return e?e.map(bu):[]},refetchInterval:5e3}),{data:h=[]}=c({queryKey:["queues_all"],queryFn:async()=>{const{data:e,error:t}=await qa.from("queues").select("*").eq("queue_date",Nu()).order("created_at",{ascending:!0});if(t)throw ku.error("Error fetching all queues:",t),t;return e?e.map(bu):[]},refetchInterval:5e3}),m=n.useCallback(async(e=!1)=>{t(!0);try{await Promise.all([i.invalidateQueries({queryKey:["queues"]}),i.invalidateQueries({queryKey:["queues_all"]})]),e&&await Promise.all([i.refetchQueries({queryKey:["queues"]}),i.refetchQueries({queryKey:["queues_all"]})])}catch(s){ku.error("Error fetching queues:",s),r("Failed to fetch queues")}finally{t(!1)}},[i]),p=n.useCallback(async e=>{try{const t={patient_id:e.patient_id,number:e.number,type:e.type||"GENERAL",status:e.status||"WAITING",service_point_id:e.service_point_id,notes:e.notes,queue_date:e.queue_date||Nu()},{data:s,error:r}=await qa.from("queues").insert(t).select().single();if(r)return ku.error("Error adding queue:",r),a.error(""),null;if(s){const e=bu(s);return await m(),a.success(""),e}return null}catch(t){return ku.error("Error in addQueue:",t),a.error(""),null}},[m]),f=n.useCallback(async(e,t)=>{try{const s={status:t};"ACTIVE"===t?s.called_at=(new Date).toISOString():"COMPLETED"===t?s.completed_at=(new Date).toISOString():"SKIPPED"===t?s.skipped_at=(new Date).toISOString():"CANCELLED"===t&&(s.cancelled_at=(new Date).toISOString());const{data:r,error:n}=await qa.from("queues").update(s).eq("id",e).select().single();if(n)return ku.error("Error updating queue status:",n),a.error(""),null;if(r){const e=bu(r);return await m(),e}return null}catch(s){return ku.error("Error in updateQueueStatus:",s),a.error(""),null}},[m]),g=n.useCallback(async e=>{try{const{error:t}=await qa.from("queues").delete().eq("id",e);return t?(ku.error("Error removing queue:",t),a.error(""),!1):(await m(),a.success(""),!0)}catch(t){return ku.error("Error in removeQueue:",t),a.error(""),!1}},[m]),x=n.useCallback(e=>{i.setQueryData(["queues"],(t=[])=>t.map(t=>t.id===e.id?e:t))},[i]),y=n.useCallback(e=>o.filter(t=>t.status===e),[o]);return n.useEffect(()=>{t(!!d)},[d]),{queues:o,loading:e||d,error:s,fetchQueues:m,addQueue:p,updateQueueStatus:f,removeQueue:g,getQueuesByStatus:y,updateQueueInState:x,allQueues:h,allQueuesNofilter:u}})(),{voiceEnabled:f,setVoiceEnabled:g,counterName:x,setCounterName:y,updateQueueSettings:v,recallQueue:b,queueAlgorithm:w,setQueueAlgorithm:j,sortQueues:N,callQueue:_,getNextQueueToCall:S,transferQueueToServicePoint:k,putQueueOnHold:C,returnSkippedQueueToWaiting:T}=((e,t,s)=>{const{voiceEnabled:r,setVoiceEnabled:a,counterName:i,setCounterName:o,updateQueueSettings:l,recallQueue:c}=hh(),{queueAlgorithm:d,setQueueAlgorithm:u,sortQueues:h}=gh(),m=n.useCallback(t=>c(t,t=>e.find(e=>e.id===t)),[e,c]),{callQueue:p,getNextQueueToCall:f,transferQueueToServicePoint:g,putQueueOnHold:x,returnSkippedQueueToWaiting:y}=uh(e,0,s,0,h,0,0,r);return{voiceEnabled:r,setVoiceEnabled:a,counterName:i,setCounterName:o,updateQueueSettings:l,recallQueue:m,queueAlgorithm:d,setQueueAlgorithm:u,sortQueues:h,callQueue:p,getNextQueueToCall:f,transferQueueToServicePoint:g,putQueueOnHold:x,returnSkippedQueueToWaiting:y}})(e,0,m);return{queues:e,allQueues:t,allQueuesNofilter:p,loading:s,error:r,fetchQueues:i,addQueue:o,updateQueueStatus:d,removeQueue:u,getQueuesByStatus:h,callQueue:_,recallQueue:b,voiceEnabled:f,setVoiceEnabled:g,counterName:x,setCounterName:y,updateQueueSettings:v,sortQueues:N,queueAlgorithm:w,setQueueAlgorithm:j,getNextQueueToCall:S,transferQueueToServicePoint:k,putQueueOnHold:C,returnSkippedQueueToWaiting:T}},vh=Qa("useDashboardQueues"),bh=()=>{vh.debug("Hook initialized");const{queues:e=[],sortQueues:t}=yh()||{},[s,r]=n.useState({waiting:[],active:[],completed:[],skipped:[]}),a=n.useMemo(()=>e,[null==e?void 0:e.length,JSON.stringify(null==e?void 0:e.map(e=>({id:e.id,status:e.status})))]),i=n.useMemo(()=>t,[JSON.stringify(null==t?void 0:t.toString())]);return n.useEffect(()=>{if(!Array.isArray(a))return;const e=a.filter(e=>"WAITING"===e.status),t=a.filter(e=>"ACTIVE"===e.status),s=a.filter(e=>"COMPLETED"===e.status),n=a.filter(e=>"SKIPPED"===e.status),o=i?i(e):e;r(e=>e.waiting.length!==o.length||e.active.length!==t.length||e.completed.length!==s.length||e.skipped.length!==n.length?{waiting:o,active:t,completed:s,skipped:n}:e)},[a,i]),{waitingQueues:s.waiting,activeQueues:s.active,completedQueues:s.completed,skippedQueues:s.skipped}};const wh=new class{constructor(){t(this,"logs",[]),t(this,"sessionId"),this.sessionId=`sim_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,this.log("SESSION_START","IDLE","FIFO","Simulation session initialized")}log(e,t,s,r,n){const a={timestamp:(new Date).toISOString(),phase:t,event:e,algorithm:s,details:r,metrics:n};this.logs.push(a)}logDecision(e,t,s,r,n){this.log("USER_DECISION",`PAUSE_${e}`,t,{decisionPoint:`${e}%`,action:s,previousAlgorithm:t,newAlgorithm:r||t,reasoning:n||"No reasoning provided"})}logAlgorithmProcessing(e,t,s){this.log("ALGORITHM_PROCESSING",t,e,{...s,processingTimestamp:(new Date).toISOString()})}logMetricsCapture(e,t,s){this.log("METRICS_CAPTURED",t,e,"Performance metrics captured at checkpoint",s)}logQueueStateChange(e,t,s,r,n){this.log("QUEUE_STATUS_CHANGE",n,r,{queueId:e,from:t,to:s,timestamp:(new Date).toISOString()})}getAllLogs(){return[...this.logs]}getLogsByEvent(e){return this.logs.filter(t=>t.event===e)}getDecisionTimeline(){return this.logs.filter(e=>"USER_DECISION"===e.event)}generateReport(){const e={sessionId:this.sessionId,generatedAt:(new Date).toISOString(),summary:{totalLogs:this.logs.length,sessionDuration:this.getSessionDuration(),algorithmsUsed:this.getAlgorithmsUsed(),decisionPoints:this.getDecisionTimeline().length},decisionTimeline:this.getDecisionTimeline(),performanceMetrics:this.getMetricsSummary(),algorithmProcessingLogs:this.getLogsByEvent("ALGORITHM_PROCESSING"),allLogs:this.logs};return JSON.stringify(e,null,2)}downloadReport(){const e=this.generateReport(),t=new Blob([e],{type:"application/json"}),s=window.URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.download=`simulation_log_${this.sessionId}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(s)}getSessionDuration(){if(this.logs.length<2)return"0ms";const e=new Date(this.logs[0].timestamp).getTime();return new Date(this.logs[this.logs.length-1].timestamp).getTime()-e+"ms"}getAlgorithmsUsed(){const e=new Set(this.logs.map(e=>e.algorithm));return Array.from(e)}getMetricsSummary(){return this.logs.filter(e=>"METRICS_CAPTURED"===e.event).map(e=>({timestamp:e.timestamp,phase:e.phase,algorithm:e.algorithm,metrics:e.metrics}))}clearLogs(){this.logs=[],this.sessionId=`sim_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,this.log("SESSION_RESET","IDLE","FIFO","Logs cleared, new session started")}},jh=Qa("SimulationModeSync");let Nh=!1,_h=[];const Sh=e=>{jh.info(" Mode change broadcast: "+(e?"SIMULATION":"REAL-TIME")),Nh=e,_h.forEach(t=>t(e))},kh=e=>(_h.push(e),e(Nh),()=>{_h=_h.filter(t=>t!==e)}),Ch=()=>Nh,Th=Qa("SimulationDataIsolation"),Eh=()=>{const[e,t]=n.useState({avgWaitTime:0,avgServiceTime:0,totalQueues:0,completedQueues:0,waitingQueues:0,activeQueues:0,avgWaitTimeToday:0,avgServiceTimeToday:0,isSimulationMode:!1}),s=n.useCallback(async()=>{try{Th.info(" Fetching simulation-only metrics...");const{data:e,error:s}=await qa.from("queues").select("*").like("notes","%%");if(s)return void Th.error("Error fetching simulation queues:",s);if(!e||0===e.length){return t({avgWaitTime:0,avgServiceTime:0,totalQueues:0,completedQueues:0,waitingQueues:0,activeQueues:0,isSimulationMode:!1}),void Sh(!1)}const r=e.filter(e=>"COMPLETED"===e.status),n=e.filter(e=>"WAITING"===e.status),a=e.filter(e=>"ACTIVE"===e.status);let i=0,o=0;if(r.length>0){const e=r.reduce((e,t)=>{if(t.called_at&&t.created_at){return e+(new Date(t.called_at).getTime()-new Date(t.created_at).getTime())/6e4}return e},0),t=r.reduce((e,t)=>{if(t.completed_at&&t.called_at){return e+(new Date(t.completed_at).getTime()-new Date(t.called_at).getTime())/6e4}return e},0);i=e/r.length,o=t/r.length}const l={avgWaitTime:Math.round(100*i)/100,avgServiceTime:Math.round(100*o)/100,totalQueues:e.length,completedQueues:r.length,waitingQueues:n.length,activeQueues:a.length,isSimulationMode:!0};t(l),Sh(!0),Th.info(" Simulation metrics calculated:",l),wh.log("METRICS_CAPTURED","METRICS_FETCH","CURRENT","Simulation metrics fetched",l)}catch(e){Th.error("Error fetching simulation metrics:",e)}},[]),r=n.useCallback(async()=>{try{Th.info(" Fetching real hospital data metrics...");(new Date).setHours(0,0,0,0);const{data:e,error:s}=await qa.from("queues").select("*").eq("status","COMPLETED").order("created_at",{ascending:!1});if(s)return void Th.error("Error fetching real metrics:",s);if(!e||0===e.length){return t({avgWaitTime:0,avgServiceTime:0,totalQueues:0,completedQueues:0,waitingQueues:0,activeQueues:0,isSimulationMode:!1,avgWaitTimeToday:0,avgServiceTimeToday:0}),void Sh(!1)}const r=e.reduce((e,t)=>t.called_at&&t.created_at&&t.completed_at&&t.queue_date===Nu()?e+1:e,0),n=e.reduce((e,t)=>{if(t.called_at&&t.created_at){return e+(new Date(t.called_at).getTime()-new Date(t.created_at).getTime())/6e4}return e},0),a=e.reduce((e,t)=>{if(t.completed_at&&t.called_at){return e+(new Date(t.completed_at).getTime()-new Date(t.called_at).getTime())/6e4}return e},0),i=e.reduce((e,t)=>{if(t.called_at&&t.created_at&&t.queue_date===Nu()){return e+(new Date(t.called_at).getTime()-new Date(t.created_at).getTime())/6e4}return e},0),o=e.reduce((e,t)=>{if(t.completed_at&&t.called_at&&t.queue_date===Nu()){return e+(new Date(t.completed_at).getTime()-new Date(t.called_at).getTime())/6e4}return e},0),l={avgWaitTime:Math.round(n/e.length),avgServiceTime:Math.round(a/e.length),totalQueues:e.length,completedQueues:e.length,waitingQueues:0,activeQueues:0,avgWaitTimeToday:Math.round(i/r),avgServiceTimeToday:Math.round(o/r),isSimulationMode:!1};t(l),Sh(!1),Th.info(" Real hospital metrics calculated:",l)}catch(e){Th.error("Error fetching real metrics:",e)}},[]),a=n.useCallback(async()=>{try{const{data:e}=await qa.from("queues").select("id").like("notes","%%").limit(1);e&&e.length>0?await s():await r()}catch(e){Th.error("Error refreshing metrics:",e)}},[s,r]),i=n.useCallback(async()=>{try{Th.info(" Verifying cleanup completion...");const{data:e,error:t}=await qa.from("queues").select("id, notes, status, created_at").like("notes","%%");if(t)return Th.error("Error verifying cleanup:",t),!1;const s=!e||0===e.length;return Th.info(" Cleanup verification: "+(s?"COMPLETE":"INCOMPLETE"),{remainingSimQueues:(null==e?void 0:e.length)||0}),s}catch(e){return Th.error("Error during cleanup verification:",e),!1}},[]);return n.useEffect(()=>{a();const e=qa.channel("simulation-data-isolation").on("postgres_changes",{event:"*",schema:"public",table:"queues"},e=>{Th.info("Queue change detected, refreshing metrics...",e),a()}).subscribe();return()=>{qa.removeChannel(e)}},[a]),{simulationMetrics:e,refreshMetrics:a,verifyCleanup:i,fetchSimulationMetrics:s,fetchRealMetrics:r}},Ih=Qa("Dashboard"),Ph=()=>{Ih.debug("Dashboard component rendering");const{patients:e=[]}=Ha()||{patients:[]},{waitingQueues:t=[],activeQueues:s=[],completedQueues:r=[]}=bh()||{},{simulationMetrics:a}=Eh(),[o,l]=n.useState([]),[c,d]=n.useState([]),[u,h]=n.useState([]),[m,p]=n.useState([]),[f,g]=n.useState({avgWaitTime:0,avgServiceTime:0,avgWaitTimeToday:0,avgServiceTimeToday:0});return n.useEffect(()=>{const e=async()=>{try{const{data:e,error:t}=await qa.from("queues_ins").select("*").eq("queue_date",Nu()).order("created_at",{ascending:!0});if(t)throw t;if(e){l(e);const t=e.filter(e=>"WAITING"===e.status),s=e.filter(e=>"ACTIVE"===e.status),r=e.filter(e=>"COMPLETED"===e.status);d(t),h(s),p(r)}const{data:s,error:r}=await qa.from("queues_ins").select("created_at, called_at, completed_at").eq("status","COMPLETED").not("called_at","is",null).not("completed_at","is",null).order("completed_at",{ascending:!1});if(r)throw r;if(s&&s.length>0){const t=[],r=[];s.forEach(e=>{const s=new Date(e.created_at).getTime(),n=new Date(e.called_at).getTime(),a=(n-s)/6e4,i=(new Date(e.completed_at).getTime()-n)/6e4;a>=0&&t.push(a),i>=0&&r.push(i)});const n=t.length>0?t.reduce((e,t)=>e+t,0)/t.length:0,a=r.length>0?r.reduce((e,t)=>e+t,0)/r.length:0,i=(null==e?void 0:e.filter(e=>"COMPLETED"===e.status))||[],o=[],l=[];i.forEach(e=>{if(e.called_at&&e.completed_at){const t=new Date(e.created_at).getTime(),s=new Date(e.called_at).getTime(),r=(s-t)/6e4,n=(new Date(e.completed_at).getTime()-s)/6e4;r>=0&&o.push(r),n>=0&&l.push(n)}});const c=o.length>0?o.reduce((e,t)=>e+t,0)/o.length:0,d=l.length>0?l.reduce((e,t)=>e+t,0)/l.length:0;g({avgWaitTime:n,avgServiceTime:a,avgWaitTimeToday:c,avgServiceTimeToday:d})}}catch(e){Ih.error("Error fetching INS queues:",e)}};e();const t=qa.channel("ins-queues-index").on("postgres_changes",{event:"*",schema:"public",table:"queues_ins",filter:`queue_date=eq.${Nu()}`},()=>{e()}).subscribe();return()=>{qa.removeChannel(t)}},[]),i.jsxs("div",{className:"p-6",children:[i.jsx(xu,{}),i.jsx(uu,{waitingQueues:t||[],activeQueues:s||[],completedQueues:r||[],avgWaitTimeToday:(null==a?void 0:a.avgWaitTimeToday)||0,avgServiceTimeToday:(null==a?void 0:a.avgServiceTimeToday)||0,queues:[...t||[],...s||[],...r||[]],avgWaitTime:(null==a?void 0:a.avgWaitTime)||0,avgServiceTime:(null==a?void 0:a.avgServiceTime)||0,insQueues:o,waitingInsQueues:c,activeInsQueues:u,completedInsQueues:m,insAvgWaitTime:f.avgWaitTime,insAvgServiceTime:f.avgServiceTime,insAvgWaitTimeToday:f.avgWaitTimeToday,insAvgServiceTimeToday:f.avgServiceTimeToday}),i.jsx(vu,{waitingQueues:t||[],activeQueues:s||[],completedQueues:r||[],patientsCount:(null==e?void 0:e.length)||0,avgWaitTime:(null==a?void 0:a.avgWaitTime)||0,waitingInsQueues:c,activeInsQueues:u,completedInsQueues:m,avgInsWaitTime:f.avgWaitTime})]})},Oh=E,Ah=n.forwardRef(({className:e,...t},s)=>i.jsx(k,{ref:s,className:Qi("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));Ah.displayName=k.displayName;const Dh=n.forwardRef(({className:e,...t},s)=>i.jsx(C,{ref:s,className:Qi("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));Dh.displayName=C.displayName;const Mh=n.forwardRef(({className:e,...t},s)=>i.jsx(T,{ref:s,className:Qi("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Mh.displayName=T.displayName;const qh=({queue:e})=>i.jsxs("div",{className:"text-sm text-gray-500 flex items-center",children:[i.jsx(jo,{className:"h-4 w-4 mr-1"}),i.jsx("span",{children:ju(e.created_at)})]}),Rh=({queue:e,onComplete:t,onSkip:s,onCall:r,onRecall:n,onTransfer:a,onReturnToWaiting:o,onHold:l,onViewPatientInfo:c,onCancel:d,onPaused:u,isPharmacyInterface:h=!1})=>{const m=!!e.paused_at;return i.jsxs(i.Fragment,{children:[c&&("ACTIVE"===e.status||"WAITING"===e.status||m)&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:c,children:[i.jsx(Cl,{className:"h-4 w-4 mr-1"}),""]}),d&&"WAITING"===e.status&&!m&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:d,className:"border-red-200 text-red-700 hover:bg-red-50",children:[i.jsx(Pl,{className:"h-4 w-4 mr-1"}),""]}),o&&("SKIPPED"===e.status||m)&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:o,children:[i.jsx(il,{className:"h-4 w-4 mr-1"}),m?"":""]}),u&&"ACTIVE"===e.status&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:l,children:[i.jsx(Yo,{className:"h-4 w-4 mr-1"}),""]}),a&&"ACTIVE"===e.status&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:a,children:[i.jsx(Xi,{className:"h-4 w-4 mr-1"}),""]}),s&&"ACTIVE"===e.status&&!m&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:s,children:[i.jsx(pl,{className:"h-4 w-4 mr-1"}),""]}),r&&("WAITING"===e.status||m)&&i.jsxs(gu,{variant:"default",size:"sm",onClick:r,className:h?"bg-pharmacy-600 hover:bg-pharmacy-700":"",children:[i.jsx(Zo,{className:"h-4 w-4 mr-1"}),""]}),n&&"ACTIVE"===e.status&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:n,className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:[i.jsx(Xo,{className:"h-4 w-4 mr-1"}),""]}),t&&"ACTIVE"===e.status&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:t,className:"border-green-200 text-green-700 hover:bg-green-50",children:[i.jsx(lo,{className:"h-4 w-4 mr-1"}),""]})]})},$h=pu("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Lh({className:e,variant:t,...s}){return i.jsx("div",{className:Qi($h({variant:t}),e),...s})}const Qh=({queue:e,patient:t,patientName:s,servicePointName:r,suggestedServicePointName:a,showServicePointInfo:o=!0})=>{const[l,c]=n.useState(null);return n.useEffect(()=>{(async()=>{if(e.appointment_id){const t=await yu.getAppointmentByQueueId(e.id);c(t)}})()},[e.id,e.appointment_id]),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("span",{className:"text-2xl font-bold text-gray-900",children:$u(e.type,e.number)}),i.jsx(Lh,{variant:"APPOINTMENT"===e.type?"default":"secondary",children:"APPOINTMENT"===e.type?"":e.type})]}),i.jsxs("div",{className:"flex items-center gap-1 text-gray-700 mb-1",children:[i.jsx(Cl,{className:"w-4 h-4"}),i.jsx("span",{className:"font-medium",children:s})]}),i.jsxs("div",{className:"flex items-center gap-1 text-gray-700 mb-1",children:[i.jsx(_o,{className:"w-4 h-4"}),i.jsx("span",{className:"font-medium",children:null==t?void 0:t.ID_card})]}),(null==t?void 0:t.address)&&i.jsxs("div",{className:"flex items-center gap-1 text-gray-700 mb-1",children:[i.jsx(Po,{className:"w-4 h-4"}),i.jsx("span",{className:"font-medium",children:null==t?void 0:t.address})]}),l&&i.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded-md border border-blue-200",children:[i.jsxs("div",{className:"flex items-center gap-1 text-blue-700 text-sm mb-1",children:[i.jsx(ao,{className:"w-3 h-3"}),i.jsx("span",{className:"font-medium",children:":"})]}),i.jsxs("div",{className:"text-sm text-blue-600",children:[i.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[i.jsx(jo,{className:"w-3 h-3"}),i.jsx("span",{children:new Date(l.date).toLocaleDateString("th-TH",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),i.jsx("div",{className:"font-medium",children:l.purpose}),l.notes&&i.jsx("div",{className:"text-xs text-blue-500 mt-1",children:l.notes})]})]}),o&&i.jsx("div",{className:"mt-2",children:r?i.jsxs("div",{className:"text-sm text-gray-600",children:[i.jsx("span",{className:"font-medium",children:":"})," ",r]}):a?i.jsxs("div",{className:"text-sm text-orange-600",children:[i.jsx("span",{className:"font-medium",children:":"})," ",a]}):i.jsx("div",{className:"text-sm text-gray-400",children:""})}),e.notes&&i.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[i.jsx("span",{className:"font-medium",children:":"})," ",e.notes]})]})},Fh=({queue:e,patientName:t,onComplete:s,onSkip:r,onCall:n,onRecall:a,onTransfer:o,onReturnToWaiting:l,onHold:c,onPaused:d,onViewPatientInfo:u,onCancel:h,servicePointName:m,suggestedServicePointName:p,showServicePointInfo:f=!1,isPharmacyInterface:g=!1,patientData:x})=>{const y=s||r||n||a||o||l||c||u||h||d;return i.jsxs(Fi,{className:g?"border-pharmacy-200":"",children:[i.jsx(zi,{className:"p-4",children:i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsx(Qh,{queue:e,patientName:t,patient:x,servicePointName:m,suggestedServicePointName:p,showServicePointInfo:f}),i.jsx(qh,{queue:e})]})}),y&&i.jsx(Bi,{className:"px-4 py-3 flex justify-end gap-2 flex-wrap "+(g?"bg-pharmacy-50":"bg-gray-50"),children:i.jsx(Rh,{queue:e,onComplete:s,onSkip:r,onCall:n,onRecall:a,onTransfer:o,onReturnToWaiting:l,onHold:c,onPaused:d,onViewPatientInfo:u,onCancel:h,isPharmacyInterface:g})})]})},Uh=q,Wh=R,Vh=P,zh=n.forwardRef(({className:e,...t},s)=>i.jsx(I,{ref:s,className:Qi("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));zh.displayName=I.displayName;const Bh=n.forwardRef(({className:e,children:t,...s},r)=>i.jsxs(Vh,{children:[i.jsx(zh,{}),i.jsxs(O,{ref:r,className:Qi("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s,children:[t,i.jsxs(A,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[i.jsx(Pl,{className:"h-4 w-4"}),i.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Bh.displayName=O.displayName;const Hh=({className:e,...t})=>i.jsx("div",{className:Qi("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});Hh.displayName="DialogHeader";const Gh=({className:e,...t})=>i.jsx("div",{className:Qi("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Gh.displayName="DialogFooter";const Kh=n.forwardRef(({className:e,...t},s)=>i.jsx(D,{ref:s,className:Qi("text-lg font-semibold leading-none tracking-tight",e),...t}));Kh.displayName=D.displayName;const Yh=n.forwardRef(({className:e,...t},s)=>i.jsx(M,{ref:s,className:Qi("text-sm text-muted-foreground",e),...t}));Yh.displayName=M.displayName;const Jh=Y,Zh=J,Xh=n.forwardRef(({className:e,children:t,...s},r)=>i.jsxs($,{ref:r,className:Qi("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...s,children:[t,i.jsx(L,{asChild:!0,children:i.jsx(co,{className:"h-4 w-4 opacity-50"})})]}));Xh.displayName=$.displayName;const em=n.forwardRef(({className:e,...t},s)=>i.jsx(Q,{ref:s,className:Qi("flex cursor-default items-center justify-center py-1",e),...t,children:i.jsx(mo,{className:"h-4 w-4"})}));em.displayName=Q.displayName;const tm=n.forwardRef(({className:e,...t},s)=>i.jsx(F,{ref:s,className:Qi("flex cursor-default items-center justify-center py-1",e),...t,children:i.jsx(co,{className:"h-4 w-4"})}));tm.displayName=F.displayName;const sm=n.forwardRef(({className:e,children:t,position:s="popper",...r},n)=>i.jsx(U,{children:i.jsxs(W,{ref:n,className:Qi("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...r,children:[i.jsx(em,{}),i.jsx(V,{className:Qi("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),i.jsx(tm,{})]})}));sm.displayName=W.displayName;n.forwardRef(({className:e,...t},s)=>i.jsx(z,{ref:s,className:Qi("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t})).displayName=z.displayName;const rm=n.forwardRef(({className:e,children:t,...s},r)=>i.jsxs(B,{ref:r,className:Qi("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(H,{children:i.jsx(lo,{className:"h-4 w-4"})})}),i.jsx(G,{children:t})]}));rm.displayName=B.displayName;n.forwardRef(({className:e,...t},s)=>i.jsx(K,{ref:s,className:Qi("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=K.displayName;const nm=({isOpen:e,onClose:t,onConfirm:s,queue:r,servicePoints:a,suggestedServicePoint:o})=>{const[l,c]=n.useState(r.service_point_id||(null==o?void 0:o.id)||""),d=a.filter(e=>e.enabled);return i.jsx(Uh,{open:e,onOpenChange:t,children:i.jsxs(Bh,{className:"sm:max-w-md",children:[i.jsx(Hh,{children:i.jsxs(Kh,{children:[" ",r.number]})}),i.jsxs("div",{className:"space-y-4",children:[o&&i.jsxs("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-2 text-yellow-800 mb-2",children:[i.jsx(qo,{className:"w-4 h-4"}),i.jsx("span",{className:"font-medium",children:""})]}),i.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[i.jsx(Uo,{className:"w-4 h-4"}),i.jsxs("span",{children:[o.name," (",o.code,")"]})]}),i.jsxs("p",{className:"text-xs text-yellow-700 mt-1",children:[' "',r.type,'" ']})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium",children:":"}),i.jsxs(Jh,{value:l,onValueChange:c,children:[i.jsx(Xh,{children:i.jsx(Zh,{placeholder:""})}),i.jsx(sm,{children:d.map(e=>i.jsx(rm,{value:e.id,children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Uo,{className:"w-4 h-4"}),i.jsxs("span",{children:[e.name," (",e.code,")"]}),e.id===(null==o?void 0:o.id)&&i.jsx("span",{className:"text-xs text-yellow-600",children:"()"})]})},e.id))})]})]}),i.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[i.jsx(gu,{variant:"outline",onClick:t,children:""}),i.jsx(gu,{onClick:()=>{l&&(s(l),t())},disabled:!l,children:""})]})]})]})})},am=({queues:e,getPatientName:t,status:s,onUpdateStatus:r,onCallQueue:a,onRecallQueue:o,onTransferQueue:l,onHoldQueue:c,onReturnToWaiting:d,onViewPatientInfo:u,selectedServicePoint:h,servicePoints:m=[],getIntelligentServicePointSuggestion:p,showServicePointInfo:f=!0,isPharmacyInterface:g=!1,getPatientById:x})=>{const[y,v]=n.useState(null),[b,w]=n.useState(null);if(0===e.length){const t=(()=>{if(e.some(e=>e.paused_at))return{title:"",description:""};switch(s){case"WAITING":return{title:"",description:""};case"ACTIVE":return{title:"",description:""};case"COMPLETED":return{title:"",description:""};case"SKIPPED":return{title:"",description:""};default:return{title:"",description:""}}})();return i.jsx("div",{className:"flex items-center justify-center h-full min-h-[400px]",children:i.jsxs("div",{className:"text-center p-8",children:[i.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center "+(g?"bg-pharmacy-100":"bg-gray-100"),children:i.jsx("div",{className:"w-8 h-8 rounded opacity-50 "+(g?"bg-pharmacy-300":"bg-gray-300")})}),i.jsx("p",{className:"text-gray-500 mb-2 font-medium",children:t.title}),i.jsx("p",{className:"text-sm text-gray-400",children:t.description})]})})}return i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"h-full overflow-auto",children:i.jsx("div",{className:"space-y-3 p-6",children:e.map(e=>{const n=e.service_point_id?m.find(t=>t.id===e.service_point_id):null,y=!n&&p?p(e):null,b=!!e.paused_at;return i.jsx(Fh,{queue:e,patientData:x(e.patient_id),patientName:t(e.patient_id),onComplete:r&&"COMPLETED"!==s?()=>r(e.id,"COMPLETED"):void 0,onSkip:!r||"WAITING"!==s&&"ACTIVE"!==s?void 0:()=>r(e.id,"SKIPPED"),onCall:a&&("WAITING"===s||b)?()=>(async e=>{if(e.service_point_id||h)return null==a?void 0:a(e.id);if(!(p&&m.length>0))return null==a?void 0:a(e.id);{const t=p(e);w(t),v(e)}})(e):void 0,onRecall:o&&"ACTIVE"===s?()=>o(e.id):void 0,onTransfer:l&&"ACTIVE"===s?()=>l(e.id):void 0,onHold:c&&"ACTIVE"===s?()=>c(e.id):void 0,onReturnToWaiting:d&&("SKIPPED"===s||b)?()=>d(e.id):void 0,onViewPatientInfo:u?()=>u(e.patient_id):void 0,servicePointId:e.service_point_id,servicePointName:null==n?void 0:n.name,suggestedServicePointName:null==y?void 0:y.name,showServicePointInfo:f,isPharmacyInterface:g},e.id)})})}),y&&i.jsx(nm,{isOpen:!0,onClose:()=>{v(null),w(null)},onConfirm:async e=>{y&&a&&(await a(y.id,e),v(null),w(null))},queue:y,servicePoints:m,suggestedServicePoint:b})]})},im=({waitingQueues:e,activeQueues:t,completedQueues:s,skippedQueues:r,patients:n,onUpdateStatus:a,onCallQueue:o,onRecallQueue:l,selectedServicePoint:c})=>{const d=e=>{const t=n.find(t=>t.id===e);return t?t.name:""},u=e=>n.find(t=>t.id===e);return i.jsxs(Oh,{defaultValue:"waiting",className:"w-full",children:[i.jsxs(Ah,{className:"mb-4 w-full justify-start overflow-x-auto pb-1 no-scrollbar sticky top-0 z-10 bg-white",children:[i.jsxs(Dh,{value:"waiting",className:"min-w-fit",children:[" (",e.length,")"]}),i.jsxs(Dh,{value:"active",className:"min-w-fit",children:[" (",t.length,")"]}),i.jsxs(Dh,{value:"completed",className:"min-w-fit",children:[" (",s.length,")"]}),i.jsxs(Dh,{value:"skipped",className:"min-w-fit",children:[" (",r.length,")"]})]}),i.jsx(Mh,{value:"waiting",className:"animate-fade-in",children:i.jsx(am,{queues:e,getPatientName:d,getPatientById:u,status:"WAITING",onUpdateStatus:a,onCallQueue:o,onRecallQueue:l,selectedServicePoint:c})}),i.jsx(Mh,{value:"active",className:"animate-fade-in",children:i.jsx(am,{queues:t,getPatientName:d,getPatientById:u,status:"ACTIVE",onUpdateStatus:a,onCallQueue:o,onRecallQueue:l,selectedServicePoint:c})}),i.jsx(Mh,{value:"completed",className:"animate-fade-in",children:i.jsx(am,{queues:s,getPatientName:d,getPatientById:u,status:"COMPLETED",onUpdateStatus:a,onCallQueue:o,onRecallQueue:l,selectedServicePoint:c})}),i.jsx(Mh,{value:"skipped",className:"animate-fade-in",children:i.jsx(am,{queues:r,getPatientName:d,getPatientById:u,status:"SKIPPED",onUpdateStatus:a,onCallQueue:o,onRecallQueue:l,selectedServicePoint:c})})]})};var om,lm,cm=Object.defineProperty,dm=Object.getOwnPropertySymbols,um=Object.prototype.hasOwnProperty,hm=Object.prototype.propertyIsEnumerable,mm=(e,t,s)=>t in e?cm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;(e=>{const t=class{constructor(e,s,r,n){if(this.version=e,this.errorCorrectionLevel=s,this.modules=[],this.isFunction=[],e<t.MIN_VERSION||e>t.MAX_VERSION)throw new RangeError("Version value out of range");if(n<-1||n>7)throw new RangeError("Mask value out of range");this.size=4*e+17;let i=[];for(let t=0;t<this.size;t++)i.push(!1);for(let t=0;t<this.size;t++)this.modules.push(i.slice()),this.isFunction.push(i.slice());this.drawFunctionPatterns();const o=this.addEccAndInterleave(r);if(this.drawCodewords(o),-1==n){let e=1e9;for(let t=0;t<8;t++){this.applyMask(t),this.drawFormatBits(t);const s=this.getPenaltyScore();s<e&&(n=t,e=s),this.applyMask(t)}}a(0<=n&&n<=7),this.mask=n,this.applyMask(n),this.drawFormatBits(n),this.isFunction=[]}static encodeText(s,r){const n=e.QrSegment.makeSegments(s);return t.encodeSegments(n,r)}static encodeBinary(s,r){const n=e.QrSegment.makeBytes(s);return t.encodeSegments([n],r)}static encodeSegments(e,s,n=1,i=40,l=-1,c=!0){if(!(t.MIN_VERSION<=n&&n<=i&&i<=t.MAX_VERSION)||l<-1||l>7)throw new RangeError("Invalid value");let d,u;for(d=n;;d++){const r=8*t.getNumDataCodewords(d,s),n=o.getTotalBits(e,d);if(n<=r){u=n;break}if(d>=i)throw new RangeError("Data too long")}for(const r of[t.Ecc.MEDIUM,t.Ecc.QUARTILE,t.Ecc.HIGH])c&&u<=8*t.getNumDataCodewords(d,r)&&(s=r);let h=[];for(const t of e){r(t.mode.modeBits,4,h),r(t.numChars,t.mode.numCharCountBits(d),h);for(const e of t.getData())h.push(e)}a(h.length==u);const m=8*t.getNumDataCodewords(d,s);a(h.length<=m),r(0,Math.min(4,m-h.length),h),r(0,(8-h.length%8)%8,h),a(h.length%8==0);for(let t=236;h.length<m;t^=253)r(t,8,h);let p=[];for(;8*p.length<h.length;)p.push(0);return h.forEach((e,t)=>p[t>>>3]|=e<<7-(7&t)),new t(d,s,p,l)}getModule(e,t){return 0<=e&&e<this.size&&0<=t&&t<this.size&&this.modules[t][e]}getModules(){return this.modules}drawFunctionPatterns(){for(let s=0;s<this.size;s++)this.setFunctionModule(6,s,s%2==0),this.setFunctionModule(s,6,s%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),t=e.length;for(let s=0;s<t;s++)for(let r=0;r<t;r++)0==s&&0==r||0==s&&r==t-1||s==t-1&&0==r||this.drawAlignmentPattern(e[s],e[r]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const t=this.errorCorrectionLevel.formatBits<<3|e;let s=t;for(let n=0;n<10;n++)s=s<<1^1335*(s>>>9);const r=21522^(t<<10|s);a(r>>>15==0);for(let a=0;a<=5;a++)this.setFunctionModule(8,a,n(r,a));this.setFunctionModule(8,7,n(r,6)),this.setFunctionModule(8,8,n(r,7)),this.setFunctionModule(7,8,n(r,8));for(let a=9;a<15;a++)this.setFunctionModule(14-a,8,n(r,a));for(let a=0;a<8;a++)this.setFunctionModule(this.size-1-a,8,n(r,a));for(let a=8;a<15;a++)this.setFunctionModule(8,this.size-15+a,n(r,a));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let s=0;s<12;s++)e=e<<1^7973*(e>>>11);const t=this.version<<12|e;a(t>>>18==0);for(let s=0;s<18;s++){const e=n(t,s),r=this.size-11+s%3,a=Math.floor(s/3);this.setFunctionModule(r,a,e),this.setFunctionModule(a,r,e)}}drawFinderPattern(e,t){for(let s=-4;s<=4;s++)for(let r=-4;r<=4;r++){const n=Math.max(Math.abs(r),Math.abs(s)),a=e+r,i=t+s;0<=a&&a<this.size&&0<=i&&i<this.size&&this.setFunctionModule(a,i,2!=n&&4!=n)}}drawAlignmentPattern(e,t){for(let s=-2;s<=2;s++)for(let r=-2;r<=2;r++)this.setFunctionModule(e+r,t+s,1!=Math.max(Math.abs(r),Math.abs(s)))}setFunctionModule(e,t,s){this.modules[t][e]=s,this.isFunction[t][e]=!0}addEccAndInterleave(e){const s=this.version,r=this.errorCorrectionLevel;if(e.length!=t.getNumDataCodewords(s,r))throw new RangeError("Invalid argument");const n=t.NUM_ERROR_CORRECTION_BLOCKS[r.ordinal][s],i=t.ECC_CODEWORDS_PER_BLOCK[r.ordinal][s],o=Math.floor(t.getNumRawDataModules(s)/8),l=n-o%n,c=Math.floor(o/n);let d=[];const u=t.reedSolomonComputeDivisor(i);for(let a=0,m=0;a<n;a++){let s=e.slice(m,m+c-i+(a<l?0:1));m+=s.length;const r=t.reedSolomonComputeRemainder(s,u);a<l&&s.push(0),d.push(s.concat(r))}let h=[];for(let t=0;t<d[0].length;t++)d.forEach((e,s)=>{(t!=c-i||s>=l)&&h.push(e[t])});return a(h.length==o),h}drawCodewords(e){if(e.length!=Math.floor(t.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let s=0;for(let t=this.size-1;t>=1;t-=2){6==t&&(t=5);for(let r=0;r<this.size;r++)for(let a=0;a<2;a++){const i=t-a,o=!(t+1&2)?this.size-1-r:r;!this.isFunction[o][i]&&s<8*e.length&&(this.modules[o][i]=n(e[s>>>3],7-(7&s)),s++)}}a(s==8*e.length)}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let t=0;t<this.size;t++)for(let s=0;s<this.size;s++){let r;switch(e){case 0:r=(s+t)%2==0;break;case 1:r=t%2==0;break;case 2:r=s%3==0;break;case 3:r=(s+t)%3==0;break;case 4:r=(Math.floor(s/3)+Math.floor(t/2))%2==0;break;case 5:r=s*t%2+s*t%3==0;break;case 6:r=(s*t%2+s*t%3)%2==0;break;case 7:r=((s+t)%2+s*t%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[t][s]&&r&&(this.modules[t][s]=!this.modules[t][s])}}getPenaltyScore(){let e=0;for(let a=0;a<this.size;a++){let s=!1,r=0,n=[0,0,0,0,0,0,0];for(let i=0;i<this.size;i++)this.modules[a][i]==s?(r++,5==r?e+=t.PENALTY_N1:r>5&&e++):(this.finderPenaltyAddHistory(r,n),s||(e+=this.finderPenaltyCountPatterns(n)*t.PENALTY_N3),s=this.modules[a][i],r=1);e+=this.finderPenaltyTerminateAndCount(s,r,n)*t.PENALTY_N3}for(let a=0;a<this.size;a++){let s=!1,r=0,n=[0,0,0,0,0,0,0];for(let i=0;i<this.size;i++)this.modules[i][a]==s?(r++,5==r?e+=t.PENALTY_N1:r>5&&e++):(this.finderPenaltyAddHistory(r,n),s||(e+=this.finderPenaltyCountPatterns(n)*t.PENALTY_N3),s=this.modules[i][a],r=1);e+=this.finderPenaltyTerminateAndCount(s,r,n)*t.PENALTY_N3}for(let a=0;a<this.size-1;a++)for(let s=0;s<this.size-1;s++){const r=this.modules[a][s];r==this.modules[a][s+1]&&r==this.modules[a+1][s]&&r==this.modules[a+1][s+1]&&(e+=t.PENALTY_N2)}let s=0;for(const t of this.modules)s=t.reduce((e,t)=>e+(t?1:0),s);const r=this.size*this.size,n=Math.ceil(Math.abs(20*s-10*r)/r)-1;return a(0<=n&&n<=9),e+=n*t.PENALTY_N4,a(0<=e&&e<=2568888),e}getAlignmentPatternPositions(){if(1==this.version)return[];{const e=Math.floor(this.version/7)+2,t=32==this.version?26:2*Math.ceil((4*this.version+4)/(2*e-2));let s=[6];for(let r=this.size-7;s.length<e;r-=t)s.splice(1,0,r);return s}}static getNumRawDataModules(e){if(e<t.MIN_VERSION||e>t.MAX_VERSION)throw new RangeError("Version number out of range");let s=(16*e+128)*e+64;if(e>=2){const t=Math.floor(e/7)+2;s-=(25*t-10)*t-55,e>=7&&(s-=36)}return a(208<=s&&s<=29648),s}static getNumDataCodewords(e,s){return Math.floor(t.getNumRawDataModules(e)/8)-t.ECC_CODEWORDS_PER_BLOCK[s.ordinal][e]*t.NUM_ERROR_CORRECTION_BLOCKS[s.ordinal][e]}static reedSolomonComputeDivisor(e){if(e<1||e>255)throw new RangeError("Degree out of range");let s=[];for(let t=0;t<e-1;t++)s.push(0);s.push(1);let r=1;for(let n=0;n<e;n++){for(let e=0;e<s.length;e++)s[e]=t.reedSolomonMultiply(s[e],r),e+1<s.length&&(s[e]^=s[e+1]);r=t.reedSolomonMultiply(r,2)}return s}static reedSolomonComputeRemainder(e,s){let r=s.map(e=>0);for(const n of e){const e=n^r.shift();r.push(0),s.forEach((s,n)=>r[n]^=t.reedSolomonMultiply(s,e))}return r}static reedSolomonMultiply(e,t){if(e>>>8!=0||t>>>8!=0)throw new RangeError("Byte out of range");let s=0;for(let r=7;r>=0;r--)s=s<<1^285*(s>>>7),s^=(t>>>r&1)*e;return a(s>>>8==0),s}finderPenaltyCountPatterns(e){const t=e[1];a(t<=3*this.size);const s=t>0&&e[2]==t&&e[3]==3*t&&e[4]==t&&e[5]==t;return(s&&e[0]>=4*t&&e[6]>=t?1:0)+(s&&e[6]>=4*t&&e[0]>=t?1:0)}finderPenaltyTerminateAndCount(e,t,s){return e&&(this.finderPenaltyAddHistory(t,s),t=0),t+=this.size,this.finderPenaltyAddHistory(t,s),this.finderPenaltyCountPatterns(s)}finderPenaltyAddHistory(e,t){0==t[0]&&(e+=this.size),t.pop(),t.unshift(e)}};let s=t;function r(e,t,s){if(t<0||t>31||e>>>t!=0)throw new RangeError("Value out of range");for(let r=t-1;r>=0;r--)s.push(e>>>r&1)}function n(e,t){return!!(e>>>t&1)}function a(e){if(!e)throw new Error("Assertion error")}s.MIN_VERSION=1,s.MAX_VERSION=40,s.PENALTY_N1=3,s.PENALTY_N2=3,s.PENALTY_N3=40,s.PENALTY_N4=10,s.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],s.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],e.QrCode=s;const i=class{constructor(e,t,s){if(this.mode=e,this.numChars=t,this.bitData=s,t<0)throw new RangeError("Invalid argument");this.bitData=s.slice()}static makeBytes(e){let t=[];for(const s of e)r(s,8,t);return new i(i.Mode.BYTE,e.length,t)}static makeNumeric(e){if(!i.isNumeric(e))throw new RangeError("String contains non-numeric characters");let t=[];for(let s=0;s<e.length;){const n=Math.min(e.length-s,3);r(parseInt(e.substr(s,n),10),3*n+1,t),s+=n}return new i(i.Mode.NUMERIC,e.length,t)}static makeAlphanumeric(e){if(!i.isAlphanumeric(e))throw new RangeError("String contains unencodable characters in alphanumeric mode");let t,s=[];for(t=0;t+2<=e.length;t+=2){let n=45*i.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t));n+=i.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t+1)),r(n,11,s)}return t<e.length&&r(i.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t)),6,s),new i(i.Mode.ALPHANUMERIC,e.length,s)}static makeSegments(e){return""==e?[]:i.isNumeric(e)?[i.makeNumeric(e)]:i.isAlphanumeric(e)?[i.makeAlphanumeric(e)]:[i.makeBytes(i.toUtf8ByteArray(e))]}static makeEci(e){let t=[];if(e<0)throw new RangeError("ECI assignment value out of range");if(e<128)r(e,8,t);else if(e<16384)r(2,2,t),r(e,14,t);else{if(!(e<1e6))throw new RangeError("ECI assignment value out of range");r(6,3,t),r(e,21,t)}return new i(i.Mode.ECI,0,t)}static isNumeric(e){return i.NUMERIC_REGEX.test(e)}static isAlphanumeric(e){return i.ALPHANUMERIC_REGEX.test(e)}getData(){return this.bitData.slice()}static getTotalBits(e,t){let s=0;for(const r of e){const e=r.mode.numCharCountBits(t);if(r.numChars>=1<<e)return 1/0;s+=4+e+r.bitData.length}return s}static toUtf8ByteArray(e){e=encodeURI(e);let t=[];for(let s=0;s<e.length;s++)"%"!=e.charAt(s)?t.push(e.charCodeAt(s)):(t.push(parseInt(e.substr(s+1,2),16)),s+=2);return t}};let o=i;o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",e.QrSegment=o})(om||(om={})),(e=>{const t=class{constructor(e,t){this.ordinal=e,this.formatBits=t}};let s=t;s.LOW=new t(0,1),s.MEDIUM=new t(1,0),s.QUARTILE=new t(2,3),s.HIGH=new t(3,2),e.Ecc=s})((lm=om||(om={})).QrCode||(lm.QrCode={})),(e=>{(e=>{const t=class{constructor(e,t){this.modeBits=e,this.numBitsCharCount=t}numCharCountBits(e){return this.numBitsCharCount[Math.floor((e+7)/17)]}};let s=t;s.NUMERIC=new t(1,[10,12,14]),s.ALPHANUMERIC=new t(2,[9,11,13]),s.BYTE=new t(4,[8,16,16]),s.KANJI=new t(8,[8,10,12]),s.ECI=new t(7,[0,0,0]),e.Mode=s})(e.QrSegment||(e.QrSegment={}))})(om||(om={}));var pm=om,fm={L:pm.QrCode.Ecc.LOW,M:pm.QrCode.Ecc.MEDIUM,Q:pm.QrCode.Ecc.QUARTILE,H:pm.QrCode.Ecc.HIGH},gm=128,xm="L",ym="#FFFFFF",vm="#000000",bm=!1;
/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */function wm(e){const t=e,{value:s,size:r=gm,level:n=xm,bgColor:a=ym,fgColor:i=vm,includeMargin:o=bm,imageSettings:l}=t,c=((e,t)=>{var s={};for(var r in e)um.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&dm)for(var r of dm(e))t.indexOf(r)<0&&hm.call(e,r)&&(s[r]=e[r]);return s})(t,["value","size","level","bgColor","fgColor","includeMargin","imageSettings"]);let u=pm.QrCode.encodeText(s,fm[n]).getModules();const h=o?4:0,m=u.length+2*h,p=function(e,t,s,r){if(null==r)return null;const n=s?4:0,a=e.length+2*n,i=Math.floor(.1*t),o=a/t,l=(r.width||i)*o,c=(r.height||i)*o,d=null==r.x?e.length/2-l/2:r.x*o,u=null==r.y?e.length/2-c/2:r.y*o;let h=null;if(r.excavate){let e=Math.floor(d),t=Math.floor(u);h={x:e,y:t,w:Math.ceil(l+d-e),h:Math.ceil(c+u-t)}}return{x:d,y:u,h:c,w:l,excavation:h}}(u,r,o,l);let f=null;var g,x;null!=l&&null!=p&&(null!=p.excavation&&(g=u,x=p.excavation,u=g.slice().map((e,t)=>t<x.y||t>=x.y+x.h?e:e.map((e,t)=>(t<x.x||t>=x.x+x.w)&&e))),f=d.createElement("image",{xlinkHref:l.src,height:p.h,width:p.w,x:p.x+h,y:p.y+h,preserveAspectRatio:"none"}));const y=function(e,t=0){const s=[];return e.forEach(function(e,r){let n=null;e.forEach(function(a,i){if(!a&&null!==n)return s.push(`M${n+t} ${r+t}h${i-n}v1H${n+t}z`),void(n=null);if(i!==e.length-1)a&&null===n&&(n=i);else{if(!a)return;null===n?s.push(`M${i+t},${r+t} h1v1H${i+t}z`):s.push(`M${n+t},${r+t} h${i+1-n}v1H${n+t}z`)}})}),s.join("")}(u,h);return d.createElement("svg",((e,t)=>{for(var s in t||(t={}))um.call(t,s)&&mm(e,s,t[s]);if(dm)for(var s of dm(t))hm.call(t,s)&&mm(e,s,t[s]);return e})({height:r,width:r,viewBox:`0 0 ${m} ${m}`},c),d.createElement("path",{fill:a,d:`M0,0 h${m}v${m}H0z`,shapeRendering:"crispEdges"}),d.createElement("path",{fill:i,d:y,shapeRendering:"crispEdges"}),f)}!function(){try{(new Path2D).addPath(new Path2D)}catch(e){return!1}}();const jm="https://subdis-th-que.netlify.app",Nm=({queueNumber:e,queueType:t,size:s=150,className:r})=>{const n=`${jm}/patient-portal?queue=${e}${t?`&type=${t}`:""}`;return i.jsxs("div",{className:`flex flex-col items-center ${r||""}`,children:[i.jsx(wm,{value:n,size:s,bgColor:"#ffffff",fgColor:"#000000",level:"L",includeMargin:!1}),i.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"LINE QR Code"})]})},_m=({completedQueuesLength:e})=>i.jsxs("div",{className:"space-y-6",children:[i.jsxs(Fi,{className:"dashboard-card",children:[i.jsx(Ui,{className:"pb-2",children:i.jsxs(Wi,{className:"text-lg flex items-center",children:[i.jsx(nl,{className:"h-5 w-5 mr-2 text-pharmacy-600"})," LINE"]})}),i.jsxs(zi,{children:[i.jsx(Nm,{queueNumber:999}),i.jsxs("div",{className:"mt-4 text-center text-sm text-gray-500",children:[i.jsx("p",{children:""}),i.jsx("p",{className:"mt-1 text-xs text-pharmacy-600",children:""})]})]})]}),i.jsxs(Fi,{className:"dashboard-card bg-pharmacy-50 border-pharmacy-100",children:[i.jsx(Ui,{className:"pb-2",children:i.jsxs(Wi,{className:"text-lg text-pharmacy-800 flex items-center",children:[i.jsx(Nl,{className:"h-5 w-5 mr-2 text-pharmacy-600"}),""]})}),i.jsxs(zi,{children:[i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("span",{className:"text-sm text-gray-600 flex items-center",children:[i.jsx(jo,{className:"h-4 w-4 mr-1.5 text-pharmacy-500"}),""]}),i.jsx("span",{className:"font-semibold",children:"12 "})]}),i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("span",{className:"text-sm text-gray-600 flex items-center",children:[i.jsx(Tl,{className:"h-4 w-4 mr-1.5 text-pharmacy-500"}),""]}),i.jsxs("span",{className:"font-semibold",children:[e," "]})]}),i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("span",{className:"text-sm text-gray-600",children:""}),i.jsx("span",{className:"font-semibold",children:"25 "})]}),i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("span",{className:"text-sm text-gray-600",children:""}),i.jsx("span",{className:"font-semibold",children:"8"})]})]}),i.jsx("div",{className:"mt-4 pt-3 border-t border-pharmacy-100",children:i.jsxs("p",{className:"text-xs text-gray-500",children:[": ",zc(new Date,"dd MMMM yyyy, HH:mm .",{locale:cu})]})})]})]})]}),Sm=()=>{const[e,t]=n.useState("day");return{timeFrame:e,setTimeFrame:t}},km=Qa("AnalyticsData"),Cm=(e,t)=>{const[s,r]=n.useState(!1),[a,i]=n.useState(0),{timeFrame:o,setTimeFrame:l}=Sm(),c=((e,t)=>{const[s,r]=n.useState([]),a=n.useCallback(async()=>{try{let t,s=new Date;t="day"===e?zl(new Date):"week"===e?Ul(new Date,{weekStartsOn:1}):nc(new Date);const{data:n,error:a}=await qa.from("queues").select("created_at, called_at").not("called_at","is",null).gte("created_at",t.toISOString()).lte("created_at",s.toISOString()).order("created_at",{ascending:!0});if(a)return;const i=new Map;null==n||n.forEach(t=>{if(t.called_at&&t.created_at){const s=(new Date(t.called_at).getTime()-new Date(t.created_at).getTime())/6e4;let r;r=zc(new Date(t.created_at),"day"===e?"HH:00":"dd MMM",{locale:cu}),i.has(r)||i.set(r,{count:0,total:0});const n=i.get(r);i.set(r,{count:n.count+1,total:n.total+s})}});const o=[];if("day"===e)for(let e=0;e<24;e++){const t=`${e.toString().padStart(2,"0")}:00`,s=i.get(t);o.push({time:t,waitTime:s?Math.round(s.total/s.count):0})}else{let e=new Date(t);for(;e<=s;){const t=zc(e,"dd MMM",{locale:cu}),s=i.get(t);o.push({time:t,waitTime:s?Math.round(s.total/s.count):0}),e=new Date(e.setDate(e.getDate()+1))}}r(o)}catch(t){}},[e,t]);return n.useEffect(()=>{a()},[a]),s})(o,a),d=((e,t)=>{const[s,r]=n.useState([]),a=n.useCallback(async()=>{try{let t,s=new Date;t="day"===e?zl(new Date):"week"===e?Ul(new Date,{weekStartsOn:1}):nc(new Date);const{data:n,error:a}=await qa.from("queues").select("completed_at, status").eq("status","COMPLETED").gte("completed_at",t.toISOString()).lte("completed_at",s.toISOString()).order("completed_at",{ascending:!0});if(a)return;const i=new Map;null==n||n.forEach(t=>{if(t.completed_at){let s;s=zc(new Date(t.completed_at),"day"===e?"HH:00":"dd MMM",{locale:cu}),i.has(s)||i.set(s,0),i.set(s,i.get(s)+1)}});const o=[];if("day"===e)for(let e=0;e<24;e++){const t=`${e.toString().padStart(2,"0")}:00`;o.push({time:t,count:i.get(t)||0})}else{let e=new Date(t);for(;e<=s;){const t=zc(e,"dd MMM",{locale:cu});o.push({time:t,count:i.get(t)||0}),e=new Date(e.setDate(e.getDate()+1))}}r(o)}catch(t){}},[e,t]);return n.useEffect(()=>{a()},[a]),s})(o,a),{averageWaitTime:u,averageServiceTime:h,urgentCount:m,elderlyCount:p}=(e=>{const[t,s]=n.useState({averageWaitTime:0,averageServiceTime:0,urgentCount:0,elderlyCount:0}),r=n.useCallback(e=>{if(!e||0===e.length)return{averageWaitTime:0,averageServiceTime:0,urgentCount:0,elderlyCount:0};let t=0,s=0,r=0,n=0,a=0,i=0;return e.forEach(e=>{if("URGENT"===e.type&&a++,"ELDERLY"===e.type&&i++,e.created_at&&e.called_at){const r=new Date(e.called_at).getTime()-new Date(e.created_at).getTime();t+=r/6e4,s++}if(e.called_at&&e.completed_at){const t=new Date(e.completed_at).getTime()-new Date(e.called_at).getTime();r+=t/6e4,n++}}),{averageWaitTime:s>0?Math.round(t/s):0,averageServiceTime:n>0?Math.round(r/n):0,urgentCount:a,elderlyCount:i}},[]);return n.useEffect(()=>{s(r(e))},[e,r]),t})(e),f=t.filter(e=>"URGENT"===e.type).length,g=t.filter(e=>"ELDERLY"===e.type).length,{currentAlgorithm:x,recommendedAlgorithm:y,shouldChangeAlgorithm:v,handleChangeAlgorithm:b}=((e,t,s)=>{const[r,a]=n.useState(localStorage.getItem("queue_algorithm")||ph.FIFO),[i,o]=n.useState(r),[l,c]=n.useState(!1),d=n.useCallback(()=>{localStorage.setItem("queue_algorithm",i),a(i),c(!1)},[i]);return n.useEffect(()=>{let n=ph.FIFO,a=!1;if(0===s)return o(n),void c(!1);const i=t/s*100;e>=3||e/s*100>20?(n=ph.PRIORITY,a=r!==ph.PRIORITY):t>=2||i>15?(n=ph.MULTILEVEL,a=r!==ph.MULTILEVEL):s>15&&(n=ph.MULTILEVEL_FEEDBACK,a=r!==ph.MULTILEVEL_FEEDBACK),o(n),c(a)},[e,t,s,r]),{currentAlgorithm:r,recommendedAlgorithm:i,shouldChangeAlgorithm:l,handleChangeAlgorithm:d}})(f,g,t.length);return n.useEffect(()=>{e.length+t.length>0&&i(e=>e+1)},[e.length,t.length]),n.useEffect(()=>{km.debug("Analytics data prepared",{timeFrame:o,averageWaitTime:u,averageServiceTime:h,currentAlgorithm:x}),r(!0)},[o,u,h,x]),km.debug("Hook initialized with completed queue count:",null==e?void 0:e.length),{timeFrame:o,setTimeFrame:l,waitTimeData:c,throughputData:d,averageWaitTime:u,averageServiceTime:h,currentAlgorithm:x,recommendedAlgorithm:y,shouldChangeAlgorithm:v,urgentCount:f,elderlyCount:g,handleChangeAlgorithm:b,refreshTrigger:a}},Tm=({waitingQueueCount:e,averageWaitTime:t,averageServiceTime:s,completedQueueCount:r,waitingInsQueueCount:n=0,averageInsWaitTime:a=0,averageInsServiceTime:o=0,completedInsQueueCount:l=0})=>i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[i.jsx(Fi,{className:"shadow-sm bg-card",children:i.jsxs(zi,{className:"p-4",children:[i.jsxs("div",{className:"flex justify-between items-start mb-3",children:[i.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),i.jsx(Tl,{className:"h-4 w-4 text-muted-foreground"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs("div",{className:"flex flex-col items-center gap-2 p-3 border border-gray-200 rounded-lg min-w-0",children:[i.jsx("div",{className:"bg-blue-100 p-1.5 rounded-full flex-shrink-0",children:i.jsx(tl,{className:"w-4 h-4 text-blue-600"})}),i.jsxs("div",{className:"text-center w-full",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-0.5",children:""}),i.jsx("p",{className:"text-xl font-bold text-blue-600 whitespace-nowrap",children:e})]})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2 p-3 border border-gray-200 rounded-lg min-w-0",children:[i.jsx("div",{className:"bg-purple-100 p-1.5 rounded-full flex-shrink-0",children:i.jsx(xl,{className:"w-4 h-4 text-purple-600"})}),i.jsxs("div",{className:"text-center w-full",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-0.5",children:""}),i.jsx("p",{className:"text-xl font-bold text-purple-600 whitespace-nowrap",children:n})]})]})]})]})}),i.jsx(Fi,{className:"shadow-sm bg-card",children:i.jsxs(zi,{className:"p-4",children:[i.jsxs("div",{className:"flex justify-between items-start mb-3",children:[i.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),i.jsx(jo,{className:"h-4 w-4 text-muted-foreground"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs("div",{className:"flex flex-col items-center gap-2 p-3 border border-gray-200 rounded-lg min-w-0",children:[i.jsx("div",{className:"bg-blue-100 p-1.5 rounded-full flex-shrink-0",children:i.jsx(tl,{className:"w-4 h-4 text-blue-600"})}),i.jsxs("div",{className:"text-center w-full",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-0.5",children:""}),i.jsxs("p",{className:"text-xl font-bold text-blue-600 whitespace-nowrap",children:[Math.round(s)," "]})]})]}),i.jsxs("div",{className:"flex flex-col items-center gap-2 p-3 border border-gray-200 rounded-lg min-w-0",children:[i.jsx("div",{className:"bg-purple-100 p-1.5 rounded-full flex-shrink-0",children:i.jsx(xl,{className:"w-4 h-4 text-purple-600"})}),i.jsxs("div",{className:"text-center w-full",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-0.5",children:""}),i.jsxs("p",{className:"text-xl font-bold text-purple-600 whitespace-nowrap",children:[Math.round(o)," "]})]})]})]})]})})]}),Em=pu("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Im=n.forwardRef(({className:e,variant:t,...s},r)=>i.jsx("div",{ref:r,role:"alert",className:Qi(Em({variant:t}),e),...s}));Im.displayName="Alert";n.forwardRef(({className:e,...t},s)=>i.jsx("h5",{ref:s,className:Qi("mb-1 font-medium leading-none tracking-tight",e),...t})).displayName="AlertTitle";const Pm=n.forwardRef(({className:e,...t},s)=>i.jsx("div",{ref:s,className:Qi("text-sm [&_p]:leading-relaxed",e),...t}));Pm.displayName="AlertDescription";const Om=({currentAlgorithm:e,recommendedAlgorithm:t,urgentCount:s,elderlyCount:r,waitingQueueCount:a,onConfirmChange:o})=>{const[l,c]=n.useState(!1),d=e=>{switch(e){case ph.FIFO:return" (First In, First Out)";case ph.PRIORITY:return"";case ph.MULTILEVEL:return"";case ph.MULTILEVEL_FEEDBACK:return"";case ph.ROUND_ROBIN:return"";default:return""}},u=t===ph.PRIORITY?{waitTime:{value:-25,text:" 25%"},urgentHandling:{value:80,text:" 80%"},satisfaction:{value:30,text:" 30%"}}:t===ph.MULTILEVEL?{waitTime:{value:-15,text:" 15%"},elderlyHandling:{value:60,text:" 60%"},efficiency:{value:20,text:" 20%"}}:{waitTime:{value:-10,text:" 10%"},efficiency:{value:15,text:" 15%"},balance:{value:25,text:" 25%"}};return i.jsxs(Uh,{open:l,onOpenChange:c,children:[i.jsx(Wh,{asChild:!0,children:i.jsx(gu,{variant:"default",className:"bg-blue-600 hover:bg-blue-700",children:""})}),i.jsxs(Bh,{className:"max-w-4xl",children:[i.jsx(Hh,{children:i.jsx(Kh,{children:""})}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center",children:[i.jsxs(Fi,{children:[i.jsx(Ui,{className:"pb-3",children:i.jsx(Wi,{className:"text-sm text-gray-600",children:""})}),i.jsx(zi,{children:i.jsxs("div",{className:"space-y-2",children:[i.jsx(Lh,{variant:"outline",children:e}),i.jsx("p",{className:"text-sm text-gray-600",children:d(e)})]})})]}),i.jsx("div",{className:"flex justify-center",children:i.jsx(eo,{className:"h-8 w-8 text-blue-500"})}),i.jsxs(Fi,{className:"border-blue-200 bg-blue-50",children:[i.jsx(Ui,{className:"pb-3",children:i.jsx(Wi,{className:"text-sm text-blue-800",children:""})}),i.jsx(zi,{children:i.jsxs("div",{className:"space-y-2",children:[i.jsx(Lh,{className:"bg-blue-600",children:t}),i.jsx("p",{className:"text-sm text-blue-700",children:d(t)})]})})]})]}),i.jsxs(Fi,{children:[i.jsx(Ui,{children:i.jsx(Wi,{className:"text-lg",children:""})}),i.jsx(zi,{children:i.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-orange-600",children:s}),i.jsx("div",{className:"text-sm text-gray-600",children:""})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-purple-600",children:r}),i.jsx("div",{className:"text-sm text-gray-600",children:""})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a}),i.jsx("div",{className:"text-sm text-gray-600",children:""})]})]})})]}),i.jsxs(Fi,{className:"border-green-200 bg-green-50",children:[i.jsx(Ui,{children:i.jsx(Wi,{className:"text-lg text-green-800",children:""})}),i.jsx(zi,{children:i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(u).map(([e,t])=>{const s=t.value>0,r=t.value<0;return i.jsxs("div",{className:"flex items-center space-x-2",children:[s&&i.jsx(Nl,{className:"h-5 w-5 text-green-600"}),r&&i.jsx(jl,{className:"h-5 w-5 text-green-600"}),0===t.value&&i.jsx(Bo,{className:"h-5 w-5 text-gray-400"}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium text-green-800",children:t.text}),i.jsx("div",{className:"text-sm text-green-600 capitalize",children:e.replace(/([A-Z])/g," $1")})]})]},e)})})})]}),i.jsxs("div",{className:"flex justify-end space-x-3",children:[i.jsx(gu,{variant:"outline",onClick:()=>c(!1),children:""}),i.jsx(gu,{onClick:()=>{o(),c(!1)},className:"bg-green-600 hover:bg-green-700",children:""})]})]})]})]})};var Am=e=>"checkbox"===e.type,Dm=e=>e instanceof Date,Mm=e=>null==e;const qm=e=>"object"==typeof e;var Rm=e=>!Mm(e)&&!Array.isArray(e)&&qm(e)&&!Dm(e),$m=e=>Rm(e)&&e.target?Am(e.target)?e.target.checked:e.target.value:e,Lm=(e,t)=>e.has((e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e)(t)),Qm="undefined"!=typeof window&&void 0!==window.HTMLElement&&"undefined"!=typeof document;function Fm(e){let t;const s=Array.isArray(e),r="undefined"!=typeof FileList&&e instanceof FileList;if(e instanceof Date)t=new Date(e);else{if(Qm&&(e instanceof Blob||r)||!s&&!Rm(e))return e;if(t=s?[]:Object.create(Object.getPrototypeOf(e)),s||(e=>{const t=e.constructor&&e.constructor.prototype;return Rm(t)&&t.hasOwnProperty("isPrototypeOf")})(e))for(const s in e)e.hasOwnProperty(s)&&(t[s]=Fm(e[s]));else t=e}return t}var Um=e=>/^\w*$/.test(e),Wm=e=>void 0===e,Vm=e=>Array.isArray(e)?e.filter(Boolean):[],zm=e=>Vm(e.replace(/["|']|\]/g,"").split(/\.|\[/)),Bm=(e,t,s)=>{if(!t||!Rm(e))return s;const r=(Um(t)?[t]:zm(t)).reduce((e,t)=>Mm(e)?e:e[t],e);return Wm(r)||r===e?Wm(e[t])?s:e[t]:r},Hm=e=>"boolean"==typeof e,Gm=(e,t,s)=>{let r=-1;const n=Um(t)?[t]:zm(t),a=n.length,i=a-1;for(;++r<a;){const t=n[r];let a=s;if(r!==i){const s=e[t];a=Rm(s)||Array.isArray(s)?s:isNaN(+n[r+1])?{}:[]}if("__proto__"===t||"constructor"===t||"prototype"===t)return;e[t]=a,e=e[t]}};const Km="blur",Ym="focusout",Jm="change",Zm="onBlur",Xm="onChange",ep="onSubmit",tp="onTouched",sp="all",rp="max",np="min",ap="maxLength",ip="minLength",op="pattern",lp="required",cp="validate",dp=d.createContext(null);dp.displayName="HookFormContext";const up=()=>d.useContext(dp);var hp=(e,t,s,r=!0)=>{const n={defaultValues:t._defaultValues};for(const a in e)Object.defineProperty(n,a,{get:()=>{const n=a;return t._proxyFormState[n]!==sp&&(t._proxyFormState[n]=!r||sp),s&&(s[n]=!0),e[n]}});return n};const mp="undefined"!=typeof window?d.useLayoutEffect:d.useEffect;var pp=e=>"string"==typeof e,fp=(e,t,s,r,n)=>pp(e)?(r&&t.watch.add(e),Bm(s,e,n)):Array.isArray(e)?e.map(e=>(r&&t.watch.add(e),Bm(s,e))):(r&&(t.watchAll=!0),s),gp=e=>Mm(e)||!qm(e);function xp(e,t,s=new WeakSet){if(gp(e)||gp(t))return e===t;if(Dm(e)&&Dm(t))return e.getTime()===t.getTime();const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;if(s.has(e)||s.has(t))return!0;s.add(e),s.add(t);for(const a of r){const r=e[a];if(!n.includes(a))return!1;if("ref"!==a){const e=t[a];if(Dm(r)&&Dm(e)||Rm(r)&&Rm(e)||Array.isArray(r)&&Array.isArray(e)?!xp(r,e,s):r!==e)return!1}}return!0}function yp(e){const t=up(),{name:s,disabled:r,control:n=t.control,shouldUnregister:a,defaultValue:i}=e,o=Lm(n._names.array,s),l=d.useMemo(()=>Bm(n._formValues,s,Bm(n._defaultValues,s,i)),[n,s,i]),c=function(e){const t=up(),{control:s=t.control,name:r,defaultValue:n,disabled:a,exact:i,compute:o}=e||{},l=d.useRef(n),c=d.useRef(o),u=d.useRef(void 0);c.current=o;const h=d.useMemo(()=>s._getWatch(r,l.current),[s,r]),[m,p]=d.useState(c.current?c.current(h):h);return mp(()=>s._subscribe({name:r,formState:{values:!0},exact:i,callback:e=>{if(!a){const t=fp(r,s._names,e.values||s._formValues,!1,l.current);if(c.current){const e=c.current(t);xp(e,u.current)||(p(e),u.current=e)}else p(t)}}}),[s,a,r,i]),d.useEffect(()=>s._removeUnmounted()),m}({control:n,name:s,defaultValue:l,exact:!0}),u=function(e){const t=up(),{control:s=t.control,disabled:r,name:n,exact:a}=e||{},[i,o]=d.useState(s._formState),l=d.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return mp(()=>s._subscribe({name:n,formState:l.current,exact:a,callback:e=>{!r&&o({...s._formState,...e})}}),[n,r,a]),d.useEffect(()=>{l.current.isValid&&s._setValid(!0)},[s]),d.useMemo(()=>hp(i,s,l.current,!1),[i,s])}({control:n,name:s,exact:!0}),h=d.useRef(e),m=d.useRef(void 0),p=d.useRef(n.register(s,{...e.rules,value:c,...Hm(e.disabled)?{disabled:e.disabled}:{}}));h.current=e;const f=d.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!Bm(u.errors,s)},isDirty:{enumerable:!0,get:()=>!!Bm(u.dirtyFields,s)},isTouched:{enumerable:!0,get:()=>!!Bm(u.touchedFields,s)},isValidating:{enumerable:!0,get:()=>!!Bm(u.validatingFields,s)},error:{enumerable:!0,get:()=>Bm(u.errors,s)}}),[u,s]),g=d.useCallback(e=>p.current.onChange({target:{value:$m(e),name:s},type:Jm}),[s]),x=d.useCallback(()=>p.current.onBlur({target:{value:Bm(n._formValues,s),name:s},type:Km}),[s,n._formValues]),y=d.useCallback(e=>{const t=Bm(n._fields,s);t&&e&&(t._f.ref={focus:()=>e.focus&&e.focus(),select:()=>e.select&&e.select(),setCustomValidity:t=>e.setCustomValidity(t),reportValidity:()=>e.reportValidity()})},[n._fields,s]),v=d.useMemo(()=>({name:s,value:c,...Hm(r)||u.disabled?{disabled:u.disabled||r}:{},onChange:g,onBlur:x,ref:y}),[s,r,u.disabled,g,x,y,c]);return d.useEffect(()=>{const e=n._options.shouldUnregister||a,t=m.current;t&&t!==s&&!o&&n.unregister(t),n.register(s,{...h.current.rules,...Hm(h.current.disabled)?{disabled:h.current.disabled}:{}});const r=(e,t)=>{const s=Bm(n._fields,e);s&&s._f&&(s._f.mount=t)};if(r(s,!0),e){const e=Fm(Bm(n._options.defaultValues,s,h.current.defaultValue));Gm(n._defaultValues,s,e),Wm(Bm(n._formValues,s))&&Gm(n._formValues,s,e)}return!o&&n.register(s),m.current=s,()=>{(o?e&&!n._state.action:e)?n.unregister(s):r(s,!1)}},[s,n,o,a]),d.useEffect(()=>{n._setDisabledField({disabled:r,name:s})},[r,s,n]),d.useMemo(()=>({field:v,formState:u,fieldState:f}),[v,u,f])}const vp=e=>e.render(yp(e));var bp=(e,t,s,r,n)=>t?{...s[e],types:{...s[e]&&s[e].types?s[e].types:{},[r]:n||!0}}:{},wp=e=>Array.isArray(e)?e:[e],jp=()=>{let e=[];return{get observers(){return e},next:t=>{for(const s of e)s.next&&s.next(t)},subscribe:t=>(e.push(t),{unsubscribe:()=>{e=e.filter(e=>e!==t)}}),unsubscribe:()=>{e=[]}}};function Np(e,t){const s={};for(const r in e)if(e.hasOwnProperty(r)){const n=e[r],a=t[r];if(n&&Rm(n)&&a){const e=Np(n,a);Rm(e)&&(s[r]=e)}else e[r]&&(s[r]=a)}return s}var _p=e=>Rm(e)&&!Object.keys(e).length,Sp=e=>"file"===e.type,kp=e=>"function"==typeof e,Cp=e=>{if(!Qm)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},Tp=e=>"select-multiple"===e.type,Ep=e=>"radio"===e.type,Ip=e=>Cp(e)&&e.isConnected;function Pp(e,t){const s=Array.isArray(t)?t:Um(t)?[t]:zm(t),r=1===s.length?e:function(e,t){const s=t.slice(0,-1).length;let r=0;for(;r<s;)e=Wm(e)?r++:e[t[r++]];return e}(e,s),n=s.length-1,a=s[n];return r&&delete r[a],0!==n&&(Rm(r)&&_p(r)||Array.isArray(r)&&function(e){for(const t in e)if(e.hasOwnProperty(t)&&!Wm(e[t]))return!1;return!0}(r))&&Pp(e,s.slice(0,-1)),e}function Op(e){return Array.isArray(e)||Rm(e)&&!(e=>{for(const t in e)if(kp(e[t]))return!0;return!1})(e)}function Ap(e,t={}){for(const s in e)Op(e[s])?(t[s]=Array.isArray(e[s])?[]:{},Ap(e[s],t[s])):Wm(e[s])||(t[s]=!0);return t}function Dp(e,t,s){s||(s=Ap(t));for(const r in e)Op(e[r])?Wm(t)||gp(s[r])?s[r]=Ap(e[r],Array.isArray(e[r])?[]:{}):Dp(e[r],Mm(t)?{}:t[r],s[r]):s[r]=!xp(e[r],t[r]);return s}const Mp={value:!1,isValid:!1},qp={value:!0,isValid:!0};var Rp=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(e=>e&&e.checked&&!e.disabled).map(e=>e.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!Wm(e[0].attributes.value)?Wm(e[0].value)||""===e[0].value?qp:{value:e[0].value,isValid:!0}:qp:Mp}return Mp},$p=(e,{valueAsNumber:t,valueAsDate:s,setValueAs:r})=>Wm(e)?e:t?""===e?NaN:e?+e:e:s&&pp(e)?new Date(e):r?r(e):e;const Lp={isValid:!1,value:null};var Qp=e=>Array.isArray(e)?e.reduce((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e,Lp):Lp;function Fp(e){const t=e.ref;return Sp(t)?t.files:Ep(t)?Qp(e.refs).value:Tp(t)?[...t.selectedOptions].map(({value:e})=>e):Am(t)?Rp(e.refs).value:$p(Wm(t.value)?e.ref.value:t.value,e)}var Up=e=>e instanceof RegExp,Wp=e=>Wm(e)?e:Up(e)?e.source:Rm(e)?Up(e.value)?e.value.source:e.value:e,Vp=e=>({isOnSubmit:!e||e===ep,isOnBlur:e===Zm,isOnChange:e===Xm,isOnAll:e===sp,isOnTouch:e===tp});const zp="AsyncFunction";var Bp=e=>!!e&&!!e.validate&&!!(kp(e.validate)&&e.validate.constructor.name===zp||Rm(e.validate)&&Object.values(e.validate).find(e=>e.constructor.name===zp)),Hp=(e,t,s)=>!s&&(t.watchAll||t.watch.has(e)||[...t.watch].some(t=>e.startsWith(t)&&/^\.\w+/.test(e.slice(t.length))));const Gp=(e,t,s,r)=>{for(const n of s||Object.keys(e)){const s=Bm(e,n);if(s){const{_f:e,...a}=s;if(e){if(e.refs&&e.refs[0]&&t(e.refs[0],n)&&!r)return!0;if(e.ref&&t(e.ref,e.name)&&!r)return!0;if(Gp(a,t))break}else if(Rm(a)&&Gp(a,t))break}}};function Kp(e,t,s){const r=Bm(e,s);if(r||Um(s))return{error:r,name:s};const n=s.split(".");for(;n.length;){const r=n.join("."),a=Bm(t,r),i=Bm(e,r);if(a&&!Array.isArray(a)&&s!==r)return{name:s};if(i&&i.type)return{name:r,error:i};if(i&&i.root&&i.root.type)return{name:`${r}.root`,error:i.root};n.pop()}return{name:s}}var Yp=(e,t,s)=>{const r=wp(Bm(e,s));return Gm(r,"root",t[s]),Gm(e,s,r),e};function Jp(e,t,s="validate"){if(pp(e)||Array.isArray(e)&&e.every(pp)||Hm(e)&&!e)return{type:s,message:pp(e)?e:"",ref:t}}var Zp=e=>Rm(e)&&!Up(e)?e:{value:e,message:""},Xp=async(e,t,s,r,n,a)=>{const{ref:i,refs:o,required:l,maxLength:c,minLength:d,min:u,max:h,pattern:m,validate:p,name:f,valueAsNumber:g,mount:x}=e._f,y=Bm(s,f);if(!x||t.has(f))return{};const v=o?o[0]:i,b=e=>{n&&v.reportValidity&&(v.setCustomValidity(Hm(e)?"":e||""),v.reportValidity())},w={},j=Ep(i),N=Am(i),_=j||N,S=(g||Sp(i))&&Wm(i.value)&&Wm(y)||Cp(i)&&""===i.value||""===y||Array.isArray(y)&&!y.length,k=bp.bind(null,f,r,w),C=(e,t,s,r=ap,n=ip)=>{const a=e?t:s;w[f]={type:e?r:n,message:a,ref:i,...k(e?r:n,a)}};if(a?!Array.isArray(y)||!y.length:l&&(!_&&(S||Mm(y))||Hm(y)&&!y||N&&!Rp(o).isValid||j&&!Qp(o).isValid)){const{value:e,message:t}=pp(l)?{value:!!l,message:l}:Zp(l);if(e&&(w[f]={type:lp,message:t,ref:v,...k(lp,t)},!r))return b(t),w}if(!(S||Mm(u)&&Mm(h))){let e,t;const s=Zp(h),n=Zp(u);if(Mm(y)||isNaN(y)){const r=i.valueAsDate||new Date(y),a=e=>new Date((new Date).toDateString()+" "+e),o="time"==i.type,l="week"==i.type;pp(s.value)&&y&&(e=o?a(y)>a(s.value):l?y>s.value:r>new Date(s.value)),pp(n.value)&&y&&(t=o?a(y)<a(n.value):l?y<n.value:r<new Date(n.value))}else{const r=i.valueAsNumber||(y?+y:y);Mm(s.value)||(e=r>s.value),Mm(n.value)||(t=r<n.value)}if((e||t)&&(C(!!e,s.message,n.message,rp,np),!r))return b(w[f].message),w}if((c||d)&&!S&&(pp(y)||a&&Array.isArray(y))){const e=Zp(c),t=Zp(d),s=!Mm(e.value)&&y.length>+e.value,n=!Mm(t.value)&&y.length<+t.value;if((s||n)&&(C(s,e.message,t.message),!r))return b(w[f].message),w}if(m&&!S&&pp(y)){const{value:e,message:t}=Zp(m);if(Up(e)&&!y.match(e)&&(w[f]={type:op,message:t,ref:i,...k(op,t)},!r))return b(t),w}if(p)if(kp(p)){const e=Jp(await p(y,s),v);if(e&&(w[f]={...e,...k(cp,e.message)},!r))return b(e.message),w}else if(Rm(p)){let e={};for(const t in p){if(!_p(e)&&!r)break;const n=Jp(await p[t](y,s),v,t);n&&(e={...n,...k(t,n.message)},b(n.message),r&&(w[f]=e))}if(!_p(e)&&(w[f]={ref:v,...e},!r))return w}return b(!0),w};const ef={mode:ep,reValidateMode:Xm,shouldFocusError:!0};function tf(e={}){let t,s={...ef,...e},r={submitCount:0,isDirty:!1,isReady:!1,isLoading:kp(s.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:s.errors||{},disabled:s.disabled||!1},n={},a=(Rm(s.defaultValues)||Rm(s.values))&&Fm(s.defaultValues||s.values)||{},i=s.shouldUnregister?{}:Fm(a),o={action:!1,mount:!1,watch:!1},l={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},c=0;const d={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let u={...d};const h={array:jp(),state:jp()},m=s.criteriaMode===sp,p=async e=>{if(!s.disabled&&(d.isValid||u.isValid||e)){const e=s.resolver?_p((await v()).errors):await b(n,!0);e!==r.isValid&&h.state.next({isValid:e})}},f=(e,t)=>{!s.disabled&&(d.isValidating||d.validatingFields||u.isValidating||u.validatingFields)&&((e||Array.from(l.mount)).forEach(e=>{e&&(t?Gm(r.validatingFields,e,t):Pp(r.validatingFields,e))}),h.state.next({validatingFields:r.validatingFields,isValidating:!_p(r.validatingFields)}))},g=(e,t,s,r)=>{const l=Bm(n,e);if(l){const n=Bm(i,e,Wm(s)?Bm(a,e):s);Wm(n)||r&&r.defaultChecked||t?Gm(i,e,t?n:Fp(l._f)):N(e,n),o.mount&&p()}},x=(e,t,n,i,o)=>{let l=!1,c=!1;const m={name:e};if(!s.disabled){if(!n||i){(d.isDirty||u.isDirty)&&(c=r.isDirty,r.isDirty=m.isDirty=w(),l=c!==m.isDirty);const s=xp(Bm(a,e),t);c=!!Bm(r.dirtyFields,e),s?Pp(r.dirtyFields,e):Gm(r.dirtyFields,e,!0),m.dirtyFields=r.dirtyFields,l=l||(d.dirtyFields||u.dirtyFields)&&c!==!s}if(n){const t=Bm(r.touchedFields,e);t||(Gm(r.touchedFields,e,n),m.touchedFields=r.touchedFields,l=l||(d.touchedFields||u.touchedFields)&&t!==n)}l&&o&&h.state.next(m)}return l?m:{}},y=(e,n,a,i)=>{const o=Bm(r.errors,e),l=(d.isValid||u.isValid)&&Hm(n)&&r.isValid!==n;var m;if(s.delayError&&a?(m=()=>((e,t)=>{Gm(r.errors,e,t),h.state.next({errors:r.errors})})(e,a),t=e=>{clearTimeout(c),c=setTimeout(m,e)},t(s.delayError)):(clearTimeout(c),t=null,a?Gm(r.errors,e,a):Pp(r.errors,e)),(a?!xp(o,a):o)||!_p(i)||l){const t={...i,...l&&Hm(n)?{isValid:n}:{},errors:r.errors,name:e};r={...r,...t},h.state.next(t)}},v=async e=>{f(e,!0);const t=await s.resolver(i,s.context,((e,t,s,r)=>{const n={};for(const a of e){const e=Bm(t,a);e&&Gm(n,a,e._f)}return{criteriaMode:s,names:[...e],fields:n,shouldUseNativeValidation:r}})(e||l.mount,n,s.criteriaMode,s.shouldUseNativeValidation));return f(e),t},b=async(e,t,n={valid:!0})=>{for(const a in e){const o=e[a];if(o){const{_f:e,...a}=o;if(e){const a=l.array.has(e.name),c=o._f&&Bp(o._f);c&&d.validatingFields&&f([e.name],!0);const u=await Xp(o,l.disabled,i,m,s.shouldUseNativeValidation&&!t,a);if(c&&d.validatingFields&&f([e.name]),u[e.name]&&(n.valid=!1,t))break;!t&&(Bm(u,e.name)?a?Yp(r.errors,u,e.name):Gm(r.errors,e.name,u[e.name]):Pp(r.errors,e.name))}!_p(a)&&await b(a,t,n)}}return n.valid},w=(e,t)=>!s.disabled&&(e&&t&&Gm(i,e,t),!xp(E(),a)),j=(e,t,s)=>fp(e,l,{...o.mount?i:Wm(t)?a:pp(e)?{[e]:t}:t},s,t),N=(e,t,s={})=>{const r=Bm(n,e);let a=t;if(r){const s=r._f;s&&(!s.disabled&&Gm(i,e,$p(t,s)),a=Cp(s.ref)&&Mm(t)?"":t,Tp(s.ref)?[...s.ref.options].forEach(e=>e.selected=a.includes(e.value)):s.refs?Am(s.ref)?s.refs.forEach(e=>{e.defaultChecked&&e.disabled||(Array.isArray(a)?e.checked=!!a.find(t=>t===e.value):e.checked=a===e.value||!!a)}):s.refs.forEach(e=>e.checked=e.value===a):Sp(s.ref)?s.ref.value="":(s.ref.value=a,s.ref.type||h.state.next({name:e,values:Fm(i)})))}(s.shouldDirty||s.shouldTouch)&&x(e,a,s.shouldTouch,s.shouldDirty,!0),s.shouldValidate&&T(e)},_=(e,t,s)=>{for(const r in t){if(!t.hasOwnProperty(r))return;const a=t[r],i=e+"."+r,o=Bm(n,i);(l.array.has(e)||Rm(a)||o&&!o._f)&&!Dm(a)?_(i,a,s):N(i,a,s)}},S=(e,t,s={})=>{const c=Bm(n,e),m=l.array.has(e),p=Fm(t);Gm(i,e,p),m?(h.array.next({name:e,values:Fm(i)}),(d.isDirty||d.dirtyFields||u.isDirty||u.dirtyFields)&&s.shouldDirty&&h.state.next({name:e,dirtyFields:Dp(a,i),isDirty:w(e,p)})):!c||c._f||Mm(p)?N(e,p,s):_(e,p,s),Hp(e,l)&&h.state.next({...r,name:e}),h.state.next({name:o.mount?e:void 0,values:Fm(i)})},k=async e=>{o.mount=!0;const a=e.target;let c=a.name,g=!0;const w=Bm(n,c),j=e=>{g=Number.isNaN(e)||Dm(e)&&isNaN(e.getTime())||xp(e,Bm(i,c,e))},N=Vp(s.mode),_=Vp(s.reValidateMode);if(w){let o,S;const k=a.type?Fp(w._f):$m(e),C=e.type===Km||e.type===Ym,E=!(e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate))(w._f)&&!s.resolver&&!Bm(r.errors,c)&&!w._f.deps||((e,t,s,r,n)=>!n.isOnAll&&(!s&&n.isOnTouch?!(t||e):(s?r.isOnBlur:n.isOnBlur)?!e:!(s?r.isOnChange:n.isOnChange)||e))(C,Bm(r.touchedFields,c),r.isSubmitted,_,N),I=Hp(c,l,C);Gm(i,c,k),C?a&&a.readOnly||(w._f.onBlur&&w._f.onBlur(e),t&&t(0)):w._f.onChange&&w._f.onChange(e);const P=x(c,k,C),O=!_p(P)||I;if(!C&&h.state.next({name:c,type:e.type,values:Fm(i)}),E)return(d.isValid||u.isValid)&&("onBlur"===s.mode?C&&p():C||p()),O&&h.state.next({name:c,...I?{}:P});if(!C&&I&&h.state.next({...r}),s.resolver){const{errors:e}=await v([c]);if(j(k),g){const t=Kp(r.errors,n,c),s=Kp(e,n,t.name||c);o=s.error,c=s.name,S=_p(e)}}else f([c],!0),o=(await Xp(w,l.disabled,i,m,s.shouldUseNativeValidation))[c],f([c]),j(k),g&&(o?S=!1:(d.isValid||u.isValid)&&(S=await b(n,!0)));g&&(w._f.deps&&(!Array.isArray(w._f.deps)||w._f.deps.length>0)&&T(w._f.deps),y(c,S,o,P))}},C=(e,t)=>{if(Bm(r.errors,t)&&e.focus)return e.focus(),1},T=async(e,t={})=>{let a,i;const o=wp(e);if(s.resolver){const t=await(async e=>{const{errors:t}=await v(e);if(e)for(const s of e){const e=Bm(t,s);e?Gm(r.errors,s,e):Pp(r.errors,s)}else r.errors=t;return t})(Wm(e)?e:o);a=_p(t),i=e?!o.some(e=>Bm(t,e)):a}else e?(i=(await Promise.all(o.map(async e=>{const t=Bm(n,e);return await b(t&&t._f?{[e]:t}:t)}))).every(Boolean),(i||r.isValid)&&p()):i=a=await b(n);return h.state.next({...!pp(e)||(d.isValid||u.isValid)&&a!==r.isValid?{}:{name:e},...s.resolver||!e?{isValid:a}:{},errors:r.errors}),t.shouldFocus&&!i&&Gp(n,C,e?o:l.mount),i},E=(e,t)=>{let s={...o.mount?i:a};return t&&(s=Np(t.dirtyFields?r.dirtyFields:r.touchedFields,s)),Wm(e)?s:pp(e)?Bm(s,e):e.map(e=>Bm(s,e))},I=(e,t)=>({invalid:!!Bm((t||r).errors,e),isDirty:!!Bm((t||r).dirtyFields,e),error:Bm((t||r).errors,e),isValidating:!!Bm(r.validatingFields,e),isTouched:!!Bm((t||r).touchedFields,e)}),P=(e,t,s)=>{const a=(Bm(n,e,{_f:{}})._f||{}).ref,i=Bm(r.errors,e)||{},{ref:o,message:l,type:c,...d}=i;Gm(r.errors,e,{...d,...t,ref:a}),h.state.next({name:e,errors:r.errors,isValid:!1}),s&&s.shouldFocus&&a&&a.focus&&a.focus()},O=e=>h.state.subscribe({next:t=>{var s,n,o;s=e.name,n=t.name,o=e.exact,s&&n&&s!==n&&!wp(s).some(e=>e&&(o?e===n:e.startsWith(n)||n.startsWith(e)))||!((e,t,s,r)=>{s(e);const{name:n,...a}=e;return _p(a)||Object.keys(a).length>=Object.keys(t).length||Object.keys(a).find(e=>t[e]===(!r||sp))})(t,e.formState||d,Q,e.reRenderRoot)||e.callback({values:{...i},...r,...t,defaultValues:a})}}).unsubscribe,A=(e,t={})=>{for(const o of e?wp(e):l.mount)l.mount.delete(o),l.array.delete(o),t.keepValue||(Pp(n,o),Pp(i,o)),!t.keepError&&Pp(r.errors,o),!t.keepDirty&&Pp(r.dirtyFields,o),!t.keepTouched&&Pp(r.touchedFields,o),!t.keepIsValidating&&Pp(r.validatingFields,o),!s.shouldUnregister&&!t.keepDefaultValue&&Pp(a,o);h.state.next({values:Fm(i)}),h.state.next({...r,...t.keepDirty?{isDirty:w()}:{}}),!t.keepIsValid&&p()},D=({disabled:e,name:t})=>{(Hm(e)&&o.mount||e||l.disabled.has(t))&&(e?l.disabled.add(t):l.disabled.delete(t))},M=(e,t={})=>{let r=Bm(n,e);const i=Hm(t.disabled)||Hm(s.disabled);return Gm(n,e,{...r||{},_f:{...r&&r._f?r._f:{ref:{name:e}},name:e,mount:!0,...t}}),l.mount.add(e),r?D({disabled:Hm(t.disabled)?t.disabled:s.disabled,name:e}):g(e,!0,t.value),{...i?{disabled:t.disabled||s.disabled}:{},...s.progressive?{required:!!t.required,min:Wp(t.min),max:Wp(t.max),minLength:Wp(t.minLength),maxLength:Wp(t.maxLength),pattern:Wp(t.pattern)}:{},name:e,onChange:k,onBlur:k,ref:i=>{if(i){M(e,t),r=Bm(n,e);const s=Wm(i.value)&&i.querySelectorAll&&i.querySelectorAll("input,select,textarea")[0]||i,o=(e=>Ep(e)||Am(e))(s),l=r._f.refs||[];if(o?l.find(e=>e===s):s===r._f.ref)return;Gm(n,e,{_f:{...r._f,...o?{refs:[...l.filter(Ip),s,...Array.isArray(Bm(a,e))?[{}]:[]],ref:{type:s.type,name:e}}:{ref:s}}}),g(e,!1,void 0,s)}else r=Bm(n,e,{}),r._f&&(r._f.mount=!1),(s.shouldUnregister||t.shouldUnregister)&&(!Lm(l.array,e)||!o.action)&&l.unMount.add(e)}}},q=()=>s.shouldFocusError&&Gp(n,C,l.mount),R=(e,t)=>async a=>{let o;a&&(a.preventDefault&&a.preventDefault(),a.persist&&a.persist());let c=Fm(i);if(h.state.next({isSubmitting:!0}),s.resolver){const{errors:e,values:t}=await v();r.errors=e,c=Fm(t)}else await b(n);if(l.disabled.size)for(const e of l.disabled)Pp(c,e);if(Pp(r.errors,"root"),_p(r.errors)){h.state.next({errors:{}});try{await e(c,a)}catch(d){o=d}}else t&&await t({...r.errors},a),q(),setTimeout(q);if(h.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:_p(r.errors)&&!o,submitCount:r.submitCount+1,errors:r.errors}),o)throw o},$=(e,t={})=>{const c=e?Fm(e):a,u=Fm(c),m=_p(e),p=m?a:u;if(t.keepDefaultValues||(a=c),!t.keepValues){if(t.keepDirtyValues){const e=new Set([...l.mount,...Object.keys(Dp(a,i))]);for(const t of Array.from(e))Bm(r.dirtyFields,t)?Gm(p,t,Bm(i,t)):S(t,Bm(p,t))}else{if(Qm&&Wm(e))for(const e of l.mount){const t=Bm(n,e);if(t&&t._f){const e=Array.isArray(t._f.refs)?t._f.refs[0]:t._f.ref;if(Cp(e)){const t=e.closest("form");if(t){t.reset();break}}}}if(t.keepFieldsRef)for(const e of l.mount)S(e,Bm(p,e));else n={}}i=s.shouldUnregister?t.keepDefaultValues?Fm(a):{}:Fm(p),h.array.next({values:{...p}}),h.state.next({values:{...p}})}l={mount:t.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},o.mount=!d.isValid||!!t.keepIsValid||!!t.keepDirtyValues,o.watch=!!s.shouldUnregister,h.state.next({submitCount:t.keepSubmitCount?r.submitCount:0,isDirty:!m&&(t.keepDirty?r.isDirty:!(!t.keepDefaultValues||xp(e,a))),isSubmitted:!!t.keepIsSubmitted&&r.isSubmitted,dirtyFields:m?{}:t.keepDirtyValues?t.keepDefaultValues&&i?Dp(a,i):r.dirtyFields:t.keepDefaultValues&&e?Dp(a,e):t.keepDirty?r.dirtyFields:{},touchedFields:t.keepTouched?r.touchedFields:{},errors:t.keepErrors?r.errors:{},isSubmitSuccessful:!!t.keepIsSubmitSuccessful&&r.isSubmitSuccessful,isSubmitting:!1,defaultValues:a})},L=(e,t)=>$(kp(e)?e(i):e,t),Q=e=>{r={...r,...e}},F={control:{register:M,unregister:A,getFieldState:I,handleSubmit:R,setError:P,_subscribe:O,_runSchema:v,_focusError:q,_getWatch:j,_getDirty:w,_setValid:p,_setFieldArray:(e,t=[],l,c,m=!0,p=!0)=>{if(c&&l&&!s.disabled){if(o.action=!0,p&&Array.isArray(Bm(n,e))){const t=l(Bm(n,e),c.argA,c.argB);m&&Gm(n,e,t)}if(p&&Array.isArray(Bm(r.errors,e))){const t=l(Bm(r.errors,e),c.argA,c.argB);m&&Gm(r.errors,e,t),((e,t)=>{!Vm(Bm(e,t)).length&&Pp(e,t)})(r.errors,e)}if((d.touchedFields||u.touchedFields)&&p&&Array.isArray(Bm(r.touchedFields,e))){const t=l(Bm(r.touchedFields,e),c.argA,c.argB);m&&Gm(r.touchedFields,e,t)}(d.dirtyFields||u.dirtyFields)&&(r.dirtyFields=Dp(a,i)),h.state.next({name:e,isDirty:w(e,t),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else Gm(i,e,t)},_setDisabledField:D,_setErrors:e=>{r.errors=e,h.state.next({errors:r.errors,isValid:!1})},_getFieldArray:e=>Vm(Bm(o.mount?i:a,e,s.shouldUnregister?Bm(a,e,[]):[])),_reset:$,_resetDefaultValues:()=>kp(s.defaultValues)&&s.defaultValues().then(e=>{L(e,s.resetOptions),h.state.next({isLoading:!1})}),_removeUnmounted:()=>{for(const e of l.unMount){const t=Bm(n,e);t&&(t._f.refs?t._f.refs.every(e=>!Ip(e)):!Ip(t._f.ref))&&A(e)}l.unMount=new Set},_disableForm:e=>{Hm(e)&&(h.state.next({disabled:e}),Gp(n,(t,s)=>{const r=Bm(n,s);r&&(t.disabled=r._f.disabled||e,Array.isArray(r._f.refs)&&r._f.refs.forEach(t=>{t.disabled=r._f.disabled||e}))},0,!1))},_subjects:h,_proxyFormState:d,get _fields(){return n},get _formValues(){return i},get _state(){return o},set _state(e){o=e},get _defaultValues(){return a},get _names(){return l},set _names(e){l=e},get _formState(){return r},get _options(){return s},set _options(e){s={...s,...e}}},subscribe:e=>(o.mount=!0,u={...u,...e.formState},O({...e,formState:u})),trigger:T,register:M,handleSubmit:R,watch:(e,t)=>kp(e)?h.state.subscribe({next:s=>"values"in s&&e(j(void 0,t),s)}):j(e,t,!0),setValue:S,getValues:E,reset:L,resetField:(e,t={})=>{Bm(n,e)&&(Wm(t.defaultValue)?S(e,Fm(Bm(a,e))):(S(e,t.defaultValue),Gm(a,e,Fm(t.defaultValue))),t.keepTouched||Pp(r.touchedFields,e),t.keepDirty||(Pp(r.dirtyFields,e),r.isDirty=t.defaultValue?w(e,Fm(Bm(a,e))):w()),t.keepError||(Pp(r.errors,e),d.isValid&&p()),h.state.next({...r}))},clearErrors:e=>{e&&wp(e).forEach(e=>Pp(r.errors,e)),h.state.next({errors:e?r.errors:{}})},unregister:A,setError:P,setFocus:(e,t={})=>{const s=Bm(n,e),r=s&&s._f;if(r){const e=r.refs?r.refs[0]:r.ref;e.focus&&(e.focus(),t.shouldSelect&&kp(e.select)&&e.select())}},getFieldState:I};return{...F,formControl:F}}function sf(e={}){const t=d.useRef(void 0),s=d.useRef(void 0),[r,n]=d.useState({isDirty:!1,isValidating:!1,isLoading:kp(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:kp(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current={...e.formControl,formState:r},e.defaultValues&&!kp(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:s,...n}=tf(e);t.current={...n,formState:r}}const a=t.current.control;return a._options=e,mp(()=>{const e=a._subscribe({formState:a._proxyFormState,callback:()=>n({...a._formState}),reRenderRoot:!0});return n(e=>({...e,isReady:!0})),a._formState.isReady=!0,e},[a]),d.useEffect(()=>a._disableForm(e.disabled),[a,e.disabled]),d.useEffect(()=>{e.mode&&(a._options.mode=e.mode),e.reValidateMode&&(a._options.reValidateMode=e.reValidateMode)},[a,e.mode,e.reValidateMode]),d.useEffect(()=>{e.errors&&(a._setErrors(e.errors),a._focusError())},[a,e.errors]),d.useEffect(()=>{e.shouldUnregister&&a._subjects.state.next({values:a._getWatch()})},[a,e.shouldUnregister]),d.useEffect(()=>{if(a._proxyFormState.isDirty){const e=a._getDirty();e!==r.isDirty&&a._subjects.state.next({isDirty:e})}},[a,r.isDirty]),d.useEffect(()=>{e.values&&!xp(e.values,s.current)?(a._reset(e.values,{keepFieldsRef:!0,...a._options.resetOptions}),s.current=e.values,n(e=>({...e}))):a._resetDefaultValues()},[a,e.values]),d.useEffect(()=>{a._state.mount||(a._setValid(),a._state.mount=!0),a._state.watch&&(a._state.watch=!1,a._subjects.state.next({...a._formState})),a._removeUnmounted()}),t.current.formState=hp(r,a),t.current}const rf=(e,t,s)=>{if(e&&"reportValidity"in e){const r=Bm(s,t);e.setCustomValidity(r&&r.message||""),e.reportValidity()}},nf=(e,t)=>{for(const s in t.fields){const r=t.fields[s];r&&r.ref&&"reportValidity"in r.ref?rf(r.ref,s,e):r.refs&&r.refs.forEach(t=>rf(t,s,e))}},af=(e,t)=>{t.shouldUseNativeValidation&&nf(e,t);const s={};for(const r in e){const n=Bm(t.fields,r),a=Object.assign(e[r]||{},{ref:n&&n.ref});if(of(t.names||Object.keys(e),r)){const e=Object.assign({},Bm(s,r));Gm(e,"root",a),Gm(s,r,e)}else Gm(s,r,a)}return s},of=(e,t)=>e.some(e=>e.startsWith(t+"."));var lf,cf,df,uf=function(e,t){for(var s={};e.length;){var r=e[0],n=r.code,a=r.message,i=r.path.join(".");if(!s[i])if("unionErrors"in r){var o=r.unionErrors[0].errors[0];s[i]={message:o.message,type:o.code}}else s[i]={message:a,type:n};if("unionErrors"in r&&r.unionErrors.forEach(function(t){return t.errors.forEach(function(t){return e.push(t)})}),t){var l=s[i].types,c=l&&l[r.code];s[i]=bp(i,t,s,n,c?[].concat(c,r.message):r.message)}e.shift()}return s},hf=function(e,t,s){return void 0===s&&(s={}),function(r,n,a){try{return Promise.resolve(function(n,i){try{var o=Promise.resolve(e["sync"===s.mode?"parse":"parseAsync"](r,t)).then(function(e){return a.shouldUseNativeValidation&&nf({},a),{errors:{},values:s.raw?r:e}})}catch(l){return i(l)}return o&&o.then?o.then(void 0,i):o}(0,function(e){if(t=e,Array.isArray(null==t?void 0:t.errors))return{values:{},errors:af(uf(e.errors,!a.shouldUseNativeValidation&&"all"===a.criteriaMode),a)};var t;throw e}))}catch(i){return Promise.reject(i)}}};(cf=lf||(lf={})).assertEqual=e=>{},cf.assertIs=function(e){},cf.assertNever=function(e){throw new Error},cf.arrayToEnum=e=>{const t={};for(const s of e)t[s]=s;return t},cf.getValidEnumValues=e=>{const t=cf.objectKeys(e).filter(t=>"number"!=typeof e[e[t]]),s={};for(const r of t)s[r]=e[r];return cf.objectValues(s)},cf.objectValues=e=>cf.objectKeys(e).map(function(t){return e[t]}),cf.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.push(s);return t},cf.find=(e,t)=>{for(const s of e)if(t(s))return s},cf.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,cf.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},cf.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(df||(df={})).mergeShapes=(e,t)=>({...e,...t});const mf=lf.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),pf=e=>{switch(typeof e){case"undefined":return mf.undefined;case"string":return mf.string;case"number":return Number.isNaN(e)?mf.nan:mf.number;case"boolean":return mf.boolean;case"function":return mf.function;case"bigint":return mf.bigint;case"symbol":return mf.symbol;case"object":return Array.isArray(e)?mf.array:null===e?mf.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?mf.promise:"undefined"!=typeof Map&&e instanceof Map?mf.map:"undefined"!=typeof Set&&e instanceof Set?mf.set:"undefined"!=typeof Date&&e instanceof Date?mf.date:mf.object;default:return mf.unknown}},ff=lf.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class gf extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},s={_errors:[]},r=e=>{for(const n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(r);else if("invalid_return_type"===n.code)r(n.returnTypeError);else if("invalid_arguments"===n.code)r(n.argumentsError);else if(0===n.path.length)s._errors.push(t(n));else{let e=s,r=0;for(;r<n.path.length;){const s=n.path[r];r===n.path.length-1?(e[s]=e[s]||{_errors:[]},e[s]._errors.push(t(n))):e[s]=e[s]||{_errors:[]},e=e[s],r++}}};return r(this),s}static assert(e){if(!(e instanceof gf))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,lf.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},s=[];for(const r of this.issues)if(r.path.length>0){const s=r.path[0];t[s]=t[s]||[],t[s].push(e(r))}else s.push(e(r));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}gf.create=e=>new gf(e);const xf=(e,t)=>{let s;switch(e.code){case ff.invalid_type:s=e.received===mf.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case ff.invalid_literal:s=`Invalid literal value, expected ${JSON.stringify(e.expected,lf.jsonStringifyReplacer)}`;break;case ff.unrecognized_keys:s=`Unrecognized key(s) in object: ${lf.joinValues(e.keys,", ")}`;break;case ff.invalid_union:s="Invalid input";break;case ff.invalid_union_discriminator:s=`Invalid discriminator value. Expected ${lf.joinValues(e.options)}`;break;case ff.invalid_enum_value:s=`Invalid enum value. Expected ${lf.joinValues(e.options)}, received '${e.received}'`;break;case ff.invalid_arguments:s="Invalid function arguments";break;case ff.invalid_return_type:s="Invalid function return type";break;case ff.invalid_date:s="Invalid date";break;case ff.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(s=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(s=`${s} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?s=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?s=`Invalid input: must end with "${e.validation.endsWith}"`:lf.assertNever(e.validation):s="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case ff.too_small:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case ff.too_big:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case ff.custom:s="Invalid input";break;case ff.invalid_intersection_types:s="Intersection results could not be merged";break;case ff.not_multiple_of:s=`Number must be a multiple of ${e.multipleOf}`;break;case ff.not_finite:s="Number must be finite";break;default:s=t.defaultError,lf.assertNever(e)}return{message:s}};let yf=xf;function vf(e,t){const s=yf,r=(e=>{const{data:t,path:s,errorMaps:r,issueData:n}=e,a=[...s,...n.path||[]],i={...n,path:a};if(void 0!==n.message)return{...n,path:a,message:n.message};let o="";const l=r.filter(e=>!!e).slice().reverse();for(const c of l)o=c(i,{data:t,defaultError:o}).message;return{...n,path:a,message:o}})({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,s,s===xf?void 0:xf].filter(e=>!!e)});e.common.issues.push(r)}class bf{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const r of t){if("aborted"===r.status)return wf;"dirty"===r.status&&e.dirty(),s.push(r.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const r of t){const e=await r.key,t=await r.value;s.push({key:e,value:t})}return bf.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const r of t){const{key:t,value:n}=r;if("aborted"===t.status)return wf;if("aborted"===n.status)return wf;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"===t.value||void 0===n.value&&!r.alwaysSet||(s[t.value]=n.value)}return{status:e.value,value:s}}}const wf=Object.freeze({status:"aborted"}),jf=e=>({status:"dirty",value:e}),Nf=e=>({status:"valid",value:e}),_f=e=>"aborted"===e.status,Sf=e=>"dirty"===e.status,kf=e=>"valid"===e.status,Cf=e=>"undefined"!=typeof Promise&&e instanceof Promise;var Tf,Ef;(Ef=Tf||(Tf={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},Ef.toString=e=>"string"==typeof e?e:null==e?void 0:e.message;class If{constructor(e,t,s,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Pf=(e,t)=>{if(kf(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new gf(e.common.issues);return this._error=t,this._error}}};function Of(e){if(!e)return{};const{errorMap:t,invalid_type_error:s,required_error:r,description:n}=e;if(t&&(s||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:n};return{errorMap:(t,n)=>{const{message:a}=e;return"invalid_enum_value"===t.code?{message:a??n.defaultError}:void 0===n.data?{message:a??r??n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:a??s??n.defaultError}},description:n}}class Af{get description(){return this._def.description}_getType(e){return pf(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:pf(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new bf,ctx:{common:e.parent.common,data:e.data,parsedType:pf(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Cf(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){const s={common:{issues:[],async:(null==t?void 0:t.async)??!1,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:pf(e)},r=this._parseSync({data:e,path:s.path,parent:s});return Pf(s,r)}"~validate"(e){var t,s;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:pf(e)};if(!this["~standard"].async)try{const t=this._parseSync({data:e,path:[],parent:r});return kf(t)?{value:t.value}:{issues:r.common.issues}}catch(n){(null==(s=null==(t=null==n?void 0:n.message)?void 0:t.toLowerCase())?void 0:s.includes("encountered"))&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(e=>kf(e)?{value:e.value}:{issues:r.common.issues})}async parseAsync(e,t){const s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){const s={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:pf(e)},r=this._parse({data:e,path:s.path,parent:s}),n=await(Cf(r)?r:Promise.resolve(r));return Pf(s,n)}refine(e,t){const s=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,r)=>{const n=e(t),a=()=>r.addIssue({code:ff.custom,...s(t)});return"undefined"!=typeof Promise&&n instanceof Promise?n.then(e=>!!e||(a(),!1)):!!n||(a(),!1)})}refinement(e,t){return this._refinement((s,r)=>!!e(s)||(r.addIssue("function"==typeof t?t(s,r):t),!1))}_refinement(e){return new Pg({schema:this,typeName:Fg.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Og.create(this,this._def)}nullable(){return Ag.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return gg.create(this)}promise(){return Ig.create(this,this._def)}or(e){return vg.create([this,e],this._def)}and(e){return wg.create(this,e,this._def)}transform(e){return new Pg({...Of(this._def),schema:this,typeName:Fg.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new Dg({...Of(this._def),innerType:this,defaultValue:t,typeName:Fg.ZodDefault})}brand(){return new Rg({typeName:Fg.ZodBranded,type:this,...Of(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new Mg({...Of(this._def),innerType:this,catchValue:t,typeName:Fg.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return $g.create(this,e)}readonly(){return Lg.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Df=/^c[^\s-]{8,}$/i,Mf=/^[0-9a-z]+$/,qf=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Rf=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,$f=/^[a-z0-9_-]{21}$/i,Lf=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Qf=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Ff=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let Uf;const Wf=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Vf=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,zf=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Bf=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Hf=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Gf=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Kf="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Yf=new RegExp(`^${Kf}$`);function Jf(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${e.precision?"+":"?"}`}function Zf(e){return new RegExp(`^${Jf(e)}$`)}function Xf(e){let t=`${Kf}T${Jf(e)}`;const s=[];return s.push(e.local?"Z?":"Z"),e.offset&&s.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${s.join("|")})`,new RegExp(`^${t}$`)}function eg(e,t){return!("v4"!==t&&t||!Wf.test(e))||!("v6"!==t&&t||!zf.test(e))}function tg(e,t){if(!Lf.test(e))return!1;try{const[s]=e.split(".");if(!s)return!1;const r=s.replace(/-/g,"+").replace(/_/g,"/").padEnd(s.length+(4-s.length%4)%4,"="),n=JSON.parse(atob(r));return"object"==typeof n&&null!==n&&((!("typ"in n)||"JWT"===(null==n?void 0:n.typ))&&(!!n.alg&&(!t||n.alg===t)))}catch{return!1}}function sg(e,t){return!("v4"!==t&&t||!Vf.test(e))||!("v6"!==t&&t||!Bf.test(e))}class rg extends Af{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==mf.string){const t=this._getOrReturnCtx(e);return vf(t,{code:ff.invalid_type,expected:mf.string,received:t.parsedType}),wf}const t=new bf;let s;for(const r of this._def.checks)if("min"===r.kind)e.data.length<r.value&&(s=this._getOrReturnCtx(e,s),vf(s,{code:ff.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),t.dirty());else if("max"===r.kind)e.data.length>r.value&&(s=this._getOrReturnCtx(e,s),vf(s,{code:ff.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),t.dirty());else if("length"===r.kind){const n=e.data.length>r.value,a=e.data.length<r.value;(n||a)&&(s=this._getOrReturnCtx(e,s),n?vf(s,{code:ff.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):a&&vf(s,{code:ff.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),t.dirty())}else if("email"===r.kind)Ff.test(e.data)||(s=this._getOrReturnCtx(e,s),vf(s,{validation:"email",code:ff.invalid_string,message:r.message}),t.dirty());else if("emoji"===r.kind)Uf||(Uf=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Uf.test(e.data)||(s=this._getOrReturnCtx(e,s),vf(s,{validation:"emoji",code:ff.invalid_string,message:r.message}),t.dirty());else if("uuid"===r.kind)Rf.test(e.data)||(s=this._getOrReturnCtx(e,s),vf(s,{validation:"uuid",code:ff.invalid_string,message:r.message}),t.dirty());else if("nanoid"===r.kind)$f.test(e.data)||(s=this._getOrReturnCtx(e,s),vf(s,{validation:"nanoid",code:ff.invalid_string,message:r.message}),t.dirty());else if("cuid"===r.kind)Df.test(e.data)||(s=this._getOrReturnCtx(e,s),vf(s,{validation:"cuid",code:ff.invalid_string,message:r.message}),t.dirty());else if("cuid2"===r.kind)Mf.test(e.data)||(s=this._getOrReturnCtx(e,s),vf(s,{validation:"cuid2",code:ff.invalid_string,message:r.message}),t.dirty());else if("ulid"===r.kind)qf.test(e.data)||(s=this._getOrReturnCtx(e,s),vf(s,{validation:"ulid",code:ff.invalid_string,message:r.message}),t.dirty());else if("url"===r.kind)try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),vf(s,{validation:"url",code:ff.invalid_string,message:r.message}),t.dirty()}else if("regex"===r.kind){r.regex.lastIndex=0;r.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),vf(s,{validation:"regex",code:ff.invalid_string,message:r.message}),t.dirty())}else if("trim"===r.kind)e.data=e.data.trim();else if("includes"===r.kind)e.data.includes(r.value,r.position)||(s=this._getOrReturnCtx(e,s),vf(s,{code:ff.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),t.dirty());else if("toLowerCase"===r.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===r.kind)e.data=e.data.toUpperCase();else if("startsWith"===r.kind)e.data.startsWith(r.value)||(s=this._getOrReturnCtx(e,s),vf(s,{code:ff.invalid_string,validation:{startsWith:r.value},message:r.message}),t.dirty());else if("endsWith"===r.kind)e.data.endsWith(r.value)||(s=this._getOrReturnCtx(e,s),vf(s,{code:ff.invalid_string,validation:{endsWith:r.value},message:r.message}),t.dirty());else if("datetime"===r.kind){Xf(r).test(e.data)||(s=this._getOrReturnCtx(e,s),vf(s,{code:ff.invalid_string,validation:"datetime",message:r.message}),t.dirty())}else if("date"===r.kind){Yf.test(e.data)||(s=this._getOrReturnCtx(e,s),vf(s,{code:ff.invalid_string,validation:"date",message:r.message}),t.dirty())}else if("time"===r.kind){Zf(r).test(e.data)||(s=this._getOrReturnCtx(e,s),vf(s,{code:ff.invalid_string,validation:"time",message:r.message}),t.dirty())}else"duration"===r.kind?Qf.test(e.data)||(s=this._getOrReturnCtx(e,s),vf(s,{validation:"duration",code:ff.invalid_string,message:r.message}),t.dirty()):"ip"===r.kind?eg(e.data,r.version)||(s=this._getOrReturnCtx(e,s),vf(s,{validation:"ip",code:ff.invalid_string,message:r.message}),t.dirty()):"jwt"===r.kind?tg(e.data,r.alg)||(s=this._getOrReturnCtx(e,s),vf(s,{validation:"jwt",code:ff.invalid_string,message:r.message}),t.dirty()):"cidr"===r.kind?sg(e.data,r.version)||(s=this._getOrReturnCtx(e,s),vf(s,{validation:"cidr",code:ff.invalid_string,message:r.message}),t.dirty()):"base64"===r.kind?Hf.test(e.data)||(s=this._getOrReturnCtx(e,s),vf(s,{validation:"base64",code:ff.invalid_string,message:r.message}),t.dirty()):"base64url"===r.kind?Gf.test(e.data)||(s=this._getOrReturnCtx(e,s),vf(s,{validation:"base64url",code:ff.invalid_string,message:r.message}),t.dirty()):lf.assertNever(r);return{status:t.value,value:e.data}}_regex(e,t,s){return this.refinement(t=>e.test(t),{validation:t,code:ff.invalid_string,...Tf.errToObj(s)})}_addCheck(e){return new rg({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Tf.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Tf.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Tf.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Tf.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Tf.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Tf.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Tf.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Tf.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Tf.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Tf.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Tf.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Tf.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Tf.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:(null==e?void 0:e.offset)??!1,local:(null==e?void 0:e.local)??!1,...Tf.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...Tf.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Tf.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Tf.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...Tf.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Tf.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Tf.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Tf.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Tf.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Tf.errToObj(t)})}nonempty(e){return this.min(1,Tf.errToObj(e))}trim(){return new rg({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new rg({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new rg({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function ng(e,t){const s=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,n=s>r?s:r;return Number.parseInt(e.toFixed(n).replace(".",""))%Number.parseInt(t.toFixed(n).replace(".",""))/10**n}rg.create=e=>new rg({checks:[],typeName:Fg.ZodString,coerce:(null==e?void 0:e.coerce)??!1,...Of(e)});class ag extends Af{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==mf.number){const t=this._getOrReturnCtx(e);return vf(t,{code:ff.invalid_type,expected:mf.number,received:t.parsedType}),wf}let t;const s=new bf;for(const r of this._def.checks)if("int"===r.kind)lf.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),vf(t,{code:ff.invalid_type,expected:"integer",received:"float",message:r.message}),s.dirty());else if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),vf(t,{code:ff.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),s.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),vf(t,{code:ff.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),s.dirty())}else"multipleOf"===r.kind?0!==ng(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),vf(t,{code:ff.not_multiple_of,multipleOf:r.value,message:r.message}),s.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),vf(t,{code:ff.not_finite,message:r.message}),s.dirty()):lf.assertNever(r);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Tf.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Tf.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Tf.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Tf.toString(t))}setLimit(e,t,s,r){return new ag({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:Tf.toString(r)}]})}_addCheck(e){return new ag({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Tf.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Tf.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Tf.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Tf.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Tf.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Tf.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Tf.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Tf.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Tf.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&lf.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if("finite"===s.kind||"int"===s.kind||"multipleOf"===s.kind)return!0;"min"===s.kind?(null===t||s.value>t)&&(t=s.value):"max"===s.kind&&(null===e||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ag.create=e=>new ag({checks:[],typeName:Fg.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...Of(e)});class ig extends Af{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==mf.bigint)return this._getInvalidInput(e);let t;const s=new bf;for(const r of this._def.checks)if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),vf(t,{code:ff.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),s.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),vf(t,{code:ff.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),s.dirty())}else"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),vf(t,{code:ff.not_multiple_of,multipleOf:r.value,message:r.message}),s.dirty()):lf.assertNever(r);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return vf(t,{code:ff.invalid_type,expected:mf.bigint,received:t.parsedType}),wf}gte(e,t){return this.setLimit("min",e,!0,Tf.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Tf.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Tf.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Tf.toString(t))}setLimit(e,t,s,r){return new ig({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:Tf.toString(r)}]})}_addCheck(e){return new ig({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Tf.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Tf.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Tf.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Tf.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Tf.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}ig.create=e=>new ig({checks:[],typeName:Fg.ZodBigInt,coerce:(null==e?void 0:e.coerce)??!1,...Of(e)});class og extends Af{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==mf.boolean){const t=this._getOrReturnCtx(e);return vf(t,{code:ff.invalid_type,expected:mf.boolean,received:t.parsedType}),wf}return Nf(e.data)}}og.create=e=>new og({typeName:Fg.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...Of(e)});class lg extends Af{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==mf.date){const t=this._getOrReturnCtx(e);return vf(t,{code:ff.invalid_type,expected:mf.date,received:t.parsedType}),wf}if(Number.isNaN(e.data.getTime())){return vf(this._getOrReturnCtx(e),{code:ff.invalid_date}),wf}const t=new bf;let s;for(const r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(s=this._getOrReturnCtx(e,s),vf(s,{code:ff.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),t.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(s=this._getOrReturnCtx(e,s),vf(s,{code:ff.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),t.dirty()):lf.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new lg({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Tf.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Tf.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}lg.create=e=>new lg({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:Fg.ZodDate,...Of(e)});class cg extends Af{_parse(e){if(this._getType(e)!==mf.symbol){const t=this._getOrReturnCtx(e);return vf(t,{code:ff.invalid_type,expected:mf.symbol,received:t.parsedType}),wf}return Nf(e.data)}}cg.create=e=>new cg({typeName:Fg.ZodSymbol,...Of(e)});class dg extends Af{_parse(e){if(this._getType(e)!==mf.undefined){const t=this._getOrReturnCtx(e);return vf(t,{code:ff.invalid_type,expected:mf.undefined,received:t.parsedType}),wf}return Nf(e.data)}}dg.create=e=>new dg({typeName:Fg.ZodUndefined,...Of(e)});class ug extends Af{_parse(e){if(this._getType(e)!==mf.null){const t=this._getOrReturnCtx(e);return vf(t,{code:ff.invalid_type,expected:mf.null,received:t.parsedType}),wf}return Nf(e.data)}}ug.create=e=>new ug({typeName:Fg.ZodNull,...Of(e)});class hg extends Af{constructor(){super(...arguments),this._any=!0}_parse(e){return Nf(e.data)}}hg.create=e=>new hg({typeName:Fg.ZodAny,...Of(e)});class mg extends Af{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Nf(e.data)}}mg.create=e=>new mg({typeName:Fg.ZodUnknown,...Of(e)});class pg extends Af{_parse(e){const t=this._getOrReturnCtx(e);return vf(t,{code:ff.invalid_type,expected:mf.never,received:t.parsedType}),wf}}pg.create=e=>new pg({typeName:Fg.ZodNever,...Of(e)});class fg extends Af{_parse(e){if(this._getType(e)!==mf.undefined){const t=this._getOrReturnCtx(e);return vf(t,{code:ff.invalid_type,expected:mf.void,received:t.parsedType}),wf}return Nf(e.data)}}fg.create=e=>new fg({typeName:Fg.ZodVoid,...Of(e)});class gg extends Af{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),r=this._def;if(t.parsedType!==mf.array)return vf(t,{code:ff.invalid_type,expected:mf.array,received:t.parsedType}),wf;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,n=t.data.length<r.exactLength.value;(e||n)&&(vf(t,{code:e?ff.too_big:ff.too_small,minimum:n?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),s.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(vf(t,{code:ff.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),s.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(vf(t,{code:ff.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((e,s)=>r.type._parseAsync(new If(t,e,t.path,s)))).then(e=>bf.mergeArray(s,e));const n=[...t.data].map((e,s)=>r.type._parseSync(new If(t,e,t.path,s)));return bf.mergeArray(s,n)}get element(){return this._def.type}min(e,t){return new gg({...this._def,minLength:{value:e,message:Tf.toString(t)}})}max(e,t){return new gg({...this._def,maxLength:{value:e,message:Tf.toString(t)}})}length(e,t){return new gg({...this._def,exactLength:{value:e,message:Tf.toString(t)}})}nonempty(e){return this.min(1,e)}}function xg(e){if(e instanceof yg){const t={};for(const s in e.shape){const r=e.shape[s];t[s]=Og.create(xg(r))}return new yg({...e._def,shape:()=>t})}return e instanceof gg?new gg({...e._def,type:xg(e.element)}):e instanceof Og?Og.create(xg(e.unwrap())):e instanceof Ag?Ag.create(xg(e.unwrap())):e instanceof jg?jg.create(e.items.map(e=>xg(e))):e}gg.create=(e,t)=>new gg({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Fg.ZodArray,...Of(t)});class yg extends Af{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=lf.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==mf.object){const t=this._getOrReturnCtx(e);return vf(t,{code:ff.invalid_type,expected:mf.object,received:t.parsedType}),wf}const{status:t,ctx:s}=this._processInputParams(e),{shape:r,keys:n}=this._getCached(),a=[];if(!(this._def.catchall instanceof pg&&"strip"===this._def.unknownKeys))for(const o in s.data)n.includes(o)||a.push(o);const i=[];for(const o of n){const e=r[o],t=s.data[o];i.push({key:{status:"valid",value:o},value:e._parse(new If(s,t,s.path,o)),alwaysSet:o in s.data})}if(this._def.catchall instanceof pg){const e=this._def.unknownKeys;if("passthrough"===e)for(const t of a)i.push({key:{status:"valid",value:t},value:{status:"valid",value:s.data[t]}});else if("strict"===e)a.length>0&&(vf(s,{code:ff.unrecognized_keys,keys:a}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of a){const r=s.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new If(s,r,s.path,t)),alwaysSet:t in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const e=[];for(const t of i){const s=await t.key,r=await t.value;e.push({key:s,value:r,alwaysSet:t.alwaysSet})}return e}).then(e=>bf.mergeObjectSync(t,e)):bf.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return Tf.errToObj,new yg({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,s)=>{var r,n;const a=(null==(n=(r=this._def).errorMap)?void 0:n.call(r,t,s).message)??s.defaultError;return"unrecognized_keys"===t.code?{message:Tf.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new yg({...this._def,unknownKeys:"strip"})}passthrough(){return new yg({...this._def,unknownKeys:"passthrough"})}extend(e){return new yg({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new yg({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Fg.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new yg({...this._def,catchall:e})}pick(e){const t={};for(const s of lf.objectKeys(e))e[s]&&this.shape[s]&&(t[s]=this.shape[s]);return new yg({...this._def,shape:()=>t})}omit(e){const t={};for(const s of lf.objectKeys(this.shape))e[s]||(t[s]=this.shape[s]);return new yg({...this._def,shape:()=>t})}deepPartial(){return xg(this)}partial(e){const t={};for(const s of lf.objectKeys(this.shape)){const r=this.shape[s];e&&!e[s]?t[s]=r:t[s]=r.optional()}return new yg({...this._def,shape:()=>t})}required(e){const t={};for(const s of lf.objectKeys(this.shape))if(e&&!e[s])t[s]=this.shape[s];else{let e=this.shape[s];for(;e instanceof Og;)e=e._def.innerType;t[s]=e}return new yg({...this._def,shape:()=>t})}keyof(){return Cg(lf.objectKeys(this.shape))}}yg.create=(e,t)=>new yg({shape:()=>e,unknownKeys:"strip",catchall:pg.create(),typeName:Fg.ZodObject,...Of(t)}),yg.strictCreate=(e,t)=>new yg({shape:()=>e,unknownKeys:"strict",catchall:pg.create(),typeName:Fg.ZodObject,...Of(t)}),yg.lazycreate=(e,t)=>new yg({shape:e,unknownKeys:"strip",catchall:pg.create(),typeName:Fg.ZodObject,...Of(t)});class vg extends Af{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;if(t.common.async)return Promise.all(s.map(async e=>{const s={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}})).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const s=e.map(e=>new gf(e.ctx.common.issues));return vf(t,{code:ff.invalid_union,unionErrors:s}),wf});{let e;const r=[];for(const a of s){const s={...t,common:{...t.common,issues:[]},parent:null},n=a._parseSync({data:t.data,path:t.path,parent:s});if("valid"===n.status)return n;"dirty"!==n.status||e||(e={result:n,ctx:s}),s.common.issues.length&&r.push(s.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const n=r.map(e=>new gf(e));return vf(t,{code:ff.invalid_union,unionErrors:n}),wf}}get options(){return this._def.options}}function bg(e,t){const s=pf(e),r=pf(t);if(e===t)return{valid:!0,data:e};if(s===mf.object&&r===mf.object){const s=lf.objectKeys(t),r=lf.objectKeys(e).filter(e=>-1!==s.indexOf(e)),n={...e,...t};for(const a of r){const s=bg(e[a],t[a]);if(!s.valid)return{valid:!1};n[a]=s.data}return{valid:!0,data:n}}if(s===mf.array&&r===mf.array){if(e.length!==t.length)return{valid:!1};const s=[];for(let r=0;r<e.length;r++){const n=bg(e[r],t[r]);if(!n.valid)return{valid:!1};s.push(n.data)}return{valid:!0,data:s}}return s===mf.date&&r===mf.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}vg.create=(e,t)=>new vg({options:e,typeName:Fg.ZodUnion,...Of(t)});class wg extends Af{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),r=(e,r)=>{if(_f(e)||_f(r))return wf;const n=bg(e.value,r.value);return n.valid?((Sf(e)||Sf(r))&&t.dirty(),{status:t.value,value:n.data}):(vf(s,{code:ff.invalid_intersection_types}),wf)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([e,t])=>r(e,t)):r(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}wg.create=(e,t,s)=>new wg({left:e,right:t,typeName:Fg.ZodIntersection,...Of(s)});class jg extends Af{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==mf.array)return vf(s,{code:ff.invalid_type,expected:mf.array,received:s.parsedType}),wf;if(s.data.length<this._def.items.length)return vf(s,{code:ff.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),wf;!this._def.rest&&s.data.length>this._def.items.length&&(vf(s,{code:ff.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...s.data].map((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new If(s,e,s.path,t)):null}).filter(e=>!!e);return s.common.async?Promise.all(r).then(e=>bf.mergeArray(t,e)):bf.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new jg({...this._def,rest:e})}}jg.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new jg({items:e,typeName:Fg.ZodTuple,rest:null,...Of(t)})};class Ng extends Af{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==mf.map)return vf(s,{code:ff.invalid_type,expected:mf.map,received:s.parsedType}),wf;const r=this._def.keyType,n=this._def.valueType,a=[...s.data.entries()].map(([e,t],a)=>({key:r._parse(new If(s,e,s.path,[a,"key"])),value:n._parse(new If(s,t,s.path,[a,"value"]))}));if(s.common.async){const e=new Map;return Promise.resolve().then(async()=>{for(const s of a){const r=await s.key,n=await s.value;if("aborted"===r.status||"aborted"===n.status)return wf;"dirty"!==r.status&&"dirty"!==n.status||t.dirty(),e.set(r.value,n.value)}return{status:t.value,value:e}})}{const e=new Map;for(const s of a){const r=s.key,n=s.value;if("aborted"===r.status||"aborted"===n.status)return wf;"dirty"!==r.status&&"dirty"!==n.status||t.dirty(),e.set(r.value,n.value)}return{status:t.value,value:e}}}}Ng.create=(e,t,s)=>new Ng({valueType:t,keyType:e,typeName:Fg.ZodMap,...Of(s)});class _g extends Af{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==mf.set)return vf(s,{code:ff.invalid_type,expected:mf.set,received:s.parsedType}),wf;const r=this._def;null!==r.minSize&&s.data.size<r.minSize.value&&(vf(s,{code:ff.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&s.data.size>r.maxSize.value&&(vf(s,{code:ff.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const n=this._def.valueType;function a(e){const s=new Set;for(const r of e){if("aborted"===r.status)return wf;"dirty"===r.status&&t.dirty(),s.add(r.value)}return{status:t.value,value:s}}const i=[...s.data.values()].map((e,t)=>n._parse(new If(s,e,s.path,t)));return s.common.async?Promise.all(i).then(e=>a(e)):a(i)}min(e,t){return new _g({...this._def,minSize:{value:e,message:Tf.toString(t)}})}max(e,t){return new _g({...this._def,maxSize:{value:e,message:Tf.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}_g.create=(e,t)=>new _g({valueType:e,minSize:null,maxSize:null,typeName:Fg.ZodSet,...Of(t)});class Sg extends Af{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Sg.create=(e,t)=>new Sg({getter:e,typeName:Fg.ZodLazy,...Of(t)});class kg extends Af{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return vf(t,{received:t.data,code:ff.invalid_literal,expected:this._def.value}),wf}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Cg(e,t){return new Tg({values:e,typeName:Fg.ZodEnum,...Of(t)})}kg.create=(e,t)=>new kg({value:e,typeName:Fg.ZodLiteral,...Of(t)});class Tg extends Af{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),s=this._def.values;return vf(t,{expected:lf.joinValues(s),received:t.parsedType,code:ff.invalid_type}),wf}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return vf(t,{received:t.data,code:ff.invalid_enum_value,options:s}),wf}return Nf(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Tg.create(e,{...this._def,...t})}exclude(e,t=this._def){return Tg.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}Tg.create=Cg;class Eg extends Af{_parse(e){const t=lf.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==mf.string&&s.parsedType!==mf.number){const e=lf.objectValues(t);return vf(s,{expected:lf.joinValues(e),received:s.parsedType,code:ff.invalid_type}),wf}if(this._cache||(this._cache=new Set(lf.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const e=lf.objectValues(t);return vf(s,{received:s.data,code:ff.invalid_enum_value,options:e}),wf}return Nf(e.data)}get enum(){return this._def.values}}Eg.create=(e,t)=>new Eg({values:e,typeName:Fg.ZodNativeEnum,...Of(t)});class Ig extends Af{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==mf.promise&&!1===t.common.async)return vf(t,{code:ff.invalid_type,expected:mf.promise,received:t.parsedType}),wf;const s=t.parsedType===mf.promise?t.data:Promise.resolve(t.data);return Nf(s.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Ig.create=(e,t)=>new Ig({type:e,typeName:Fg.ZodPromise,...Of(t)});class Pg extends Af{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Fg.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),r=this._def.effect||null,n={addIssue:e=>{vf(s,e),e.fatal?t.abort():t.dirty()},get path(){return s.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===r.type){const e=r.transform(s.data,n);if(s.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return wf;const r=await this._def.schema._parseAsync({data:e,path:s.path,parent:s});return"aborted"===r.status?wf:"dirty"===r.status||"dirty"===t.value?jf(r.value):r});{if("aborted"===t.value)return wf;const r=this._def.schema._parseSync({data:e,path:s.path,parent:s});return"aborted"===r.status?wf:"dirty"===r.status||"dirty"===t.value?jf(r.value):r}}if("refinement"===r.type){const e=e=>{const t=r.refinement(e,n);if(s.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===s.common.async){const r=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===r.status?wf:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(s=>"aborted"===s.status?wf:("dirty"===s.status&&t.dirty(),e(s.value).then(()=>({status:t.value,value:s.value}))))}if("transform"===r.type){if(!1===s.common.async){const e=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!kf(e))return wf;const a=r.transform(e.value,n);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(e=>kf(e)?Promise.resolve(r.transform(e.value,n)).then(e=>({status:t.value,value:e})):wf)}lf.assertNever(r)}}Pg.create=(e,t,s)=>new Pg({schema:e,typeName:Fg.ZodEffects,effect:t,...Of(s)}),Pg.createWithPreprocess=(e,t,s)=>new Pg({schema:t,effect:{type:"preprocess",transform:e},typeName:Fg.ZodEffects,...Of(s)});class Og extends Af{_parse(e){return this._getType(e)===mf.undefined?Nf(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Og.create=(e,t)=>new Og({innerType:e,typeName:Fg.ZodOptional,...Of(t)});class Ag extends Af{_parse(e){return this._getType(e)===mf.null?Nf(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ag.create=(e,t)=>new Ag({innerType:e,typeName:Fg.ZodNullable,...Of(t)});class Dg extends Af{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===mf.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Dg.create=(e,t)=>new Dg({innerType:e,typeName:Fg.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...Of(t)});class Mg extends Af{_parse(e){const{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return Cf(r)?r.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new gf(s.common.issues)},input:s.data})})):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new gf(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}Mg.create=(e,t)=>new Mg({innerType:e,typeName:Fg.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...Of(t)});class qg extends Af{_parse(e){if(this._getType(e)!==mf.nan){const t=this._getOrReturnCtx(e);return vf(t,{code:ff.invalid_type,expected:mf.nan,received:t.parsedType}),wf}return{status:"valid",value:e.data}}}qg.create=e=>new qg({typeName:Fg.ZodNaN,...Of(e)});class Rg extends Af{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class $g extends Af{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?wf:"dirty"===e.status?(t.dirty(),jf(e.value)):this._def.out._parseAsync({data:e.value,path:s.path,parent:s})})()}{const e=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?wf:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:s.path,parent:s})}}static create(e,t){return new $g({in:e,out:t,typeName:Fg.ZodPipeline})}}class Lg extends Af{_parse(e){const t=this._def.innerType._parse(e),s=e=>(kf(e)&&(e.value=Object.freeze(e.value)),e);return Cf(t)?t.then(e=>s(e)):s(t)}unwrap(){return this._def.innerType}}function Qg(e,t){const s="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof s?{message:s}:s}var Fg,Ug;Lg.create=(e,t)=>new Lg({innerType:e,typeName:Fg.ZodReadonly,...Of(t)}),(Ug=Fg||(Fg={})).ZodString="ZodString",Ug.ZodNumber="ZodNumber",Ug.ZodNaN="ZodNaN",Ug.ZodBigInt="ZodBigInt",Ug.ZodBoolean="ZodBoolean",Ug.ZodDate="ZodDate",Ug.ZodSymbol="ZodSymbol",Ug.ZodUndefined="ZodUndefined",Ug.ZodNull="ZodNull",Ug.ZodAny="ZodAny",Ug.ZodUnknown="ZodUnknown",Ug.ZodNever="ZodNever",Ug.ZodVoid="ZodVoid",Ug.ZodArray="ZodArray",Ug.ZodObject="ZodObject",Ug.ZodUnion="ZodUnion",Ug.ZodDiscriminatedUnion="ZodDiscriminatedUnion",Ug.ZodIntersection="ZodIntersection",Ug.ZodTuple="ZodTuple",Ug.ZodRecord="ZodRecord",Ug.ZodMap="ZodMap",Ug.ZodSet="ZodSet",Ug.ZodFunction="ZodFunction",Ug.ZodLazy="ZodLazy",Ug.ZodLiteral="ZodLiteral",Ug.ZodEnum="ZodEnum",Ug.ZodEffects="ZodEffects",Ug.ZodNativeEnum="ZodNativeEnum",Ug.ZodOptional="ZodOptional",Ug.ZodNullable="ZodNullable",Ug.ZodDefault="ZodDefault",Ug.ZodCatch="ZodCatch",Ug.ZodPromise="ZodPromise",Ug.ZodBranded="ZodBranded",Ug.ZodPipeline="ZodPipeline",Ug.ZodReadonly="ZodReadonly";const Wg=rg.create,Vg=ag.create;ig.create;const zg=og.create;lg.create;const Bg=ug.create;hg.create,pg.create;const Hg=gg.create,Gg=yg.create,Kg=vg.create;wg.create,jg.create;const Yg=kg.create,Jg=Tg.create,Zg=Eg.create;Ig.create,Og.create,Ag.create;const Xg=Pg.createWithPreprocess,ex=e=>ag.create({...e,coerce:!0}),tx=[{value:ph.FIFO,label:"First In, First Out (FIFO)",description:"-"},{value:ph.PRIORITY,label:"Priority Queue",description:""},{value:ph.MULTILEVEL,label:"Multilevel Queue",description:""},{value:ph.MULTILEVEL_FEEDBACK,label:"Multilevel Feedback Queue",description:""}],sx=Gg({hospital_name:Wg().min(2,{message:" 2 "}),hospital_address:Wg().optional(),hospital_phone:Wg().optional(),hospital_website:Wg().url().optional().or(Yg("")),pharmacy_name:Wg().optional(),pharmacy_phone:Wg().optional(),pharmacy_email:Wg().email().optional().or(Yg("")),queue_types:Hg(Gg({id:Wg(),code:Wg().min(1,{message:""}),name:Wg().min(1,{message:""}),prefix:Wg().min(1,{message:""}),purpose:Wg().optional(),format:Jg(["0","00","000"]),enabled:zg().default(!0),algorithm:Zg(ph).default(ph.FIFO),priority:Vg().min(0).max(10).default(0)})),queue_reset_daily:zg().default(!0),queue_start_number:ex().int().positive().default(1),queue_algorithm:Zg(ph).default(ph.FIFO),enable_wait_time_prediction:zg().default(!0),queue_announcement_enabled:zg().default(!0),queue_announcement_text:Wg().min(5).default(" {queueNumber}  {counter}"),queue_voice_enabled:zg().default(!0),queue_voice_speed:ex().min(.5).max(2).default(.8),queue_voice_pitch:ex().min(.5).max(2).default(1),line_notification_enabled:zg().default(!0),sms_notification_enabled:zg().default(!1),appointment_notifications_enabled:zg().default(!0),voice_notifications_enabled:zg().default(!0),notify_day_before:zg().default(!0),notify_hours_before:zg().default(!0),notify_hour_before:zg().default(!1),notify_queue_position:zg().default(!0),notify_queue_waiting_time:zg().default(!0)}),rx=[{id:"REGULAR",code:"GENERAL",name:"",prefix:"A",purpose:"",format:"00",enabled:!0,algorithm:ph.FIFO,priority:5},{id:"ELDERLY",code:"ELDERLY",name:"",prefix:"E",purpose:" 60 ",format:"00",enabled:!0,algorithm:ph.PRIORITY,priority:7},{id:"URGENT",code:"URGENT",name:"",prefix:"U",purpose:"",format:"00",enabled:!0,algorithm:ph.PRIORITY,priority:10},{id:"SPECIAL",code:"SPECIAL",name:"",prefix:"S",purpose:"",format:"00",enabled:!0,algorithm:ph.MULTILEVEL,priority:8}],nx=(e="general")=>{const{settings:t,loading:s,error:r,fetchSettings:i}=((e="general")=>{const[t,s]=n.useState(null),[r,i]=n.useState(!0),[o,l]=n.useState(null),c=async()=>{try{i(!0),l(null);const{data:t,error:r}=await qa.from("settings").select("key, value").eq("category",e);if(r)throw r;t&&t.length>0?s(t):s([]),localStorage.setItem(`settings_${e}`,JSON.stringify(t||[]))}catch(t){l(t.message||`Failed to fetch ${e} settings`);const n=localStorage.getItem(`settings_${e}`);if(n)try{const e=JSON.parse(n);s(e),a.info("")}catch(r){s([])}else s([])}finally{i(!1)}};return n.useEffect(()=>{c()},[e]),{settings:t,loading:r,error:o,fetchSettings:c}})(e),{updateSetting:o,updateMultipleSettings:l,isUpdating:c}=(()=>{const[e,t]=n.useState(!1);return{updateSetting:async(e,s="queue")=>{try{t(!0);const{key:r,value:n}=e,a="string"==typeof n?n:JSON.stringify(n),{error:i}=await qa.from("settings").upsert({category:s,key:r,value:a},{onConflict:"category,key",ignoreDuplicates:!1});if(i)throw i;const o=[...JSON.parse(localStorage.getItem(`settings_${s}`)||"[]")],l=o.findIndex(e=>e.key===r);return l>=0?o[l]={...o[l],value:n}:o.push({category:s,key:r,value:n}),localStorage.setItem(`settings_${s}`,JSON.stringify(o)),!0}catch(r){return a.error(`: ${r.message||"Unknown error"}`),!1}finally{t(!1)}},updateMultipleSettings:async(e,s="queue")=>{try{t(!0);const r=(Array.isArray(e)?e:Object.entries(e).map(([e,t])=>({category:s,key:e,value:t}))).filter(e=>e.key&&""!==e.key.trim());if(0===r.length)return!0;const n=r.map(e=>({category:e.category||s,key:e.key,value:"string"==typeof e.value?e.value:JSON.stringify(e.value)})),{error:i}=await qa.from("settings").upsert(n,{onConflict:"category,key",ignoreDuplicates:!1});if(i)throw i;const o=JSON.parse(localStorage.getItem(`settings_${s}`)||"[]"),l=Array.isArray(o)?[...o]:[];for(const e of r){const t=e.key,r=e.value,n=l.findIndex(e=>e.key===t);n>=0?l[n]={...l[n],value:r}:l.push({category:e.category||s,key:t,value:r})}return localStorage.setItem(`settings_${s}`,JSON.stringify(l)),a.success(""),!0}catch(r){return a.error(`: ${r.message||"Unknown error"}`),!1}finally{t(!1)}},isUpdating:e}})();return((e="general",t)=>{n.useEffect(()=>{const s=qa.channel("settings-changes").on("postgres_changes",{event:"*",schema:"public",table:"settings",filter:`category=eq.${e}`},e=>{t()}).subscribe();return()=>{qa.removeChannel(s)}},[e,t])})(e,i),{settings:t,loading:s,error:r,isUpdating:c,updateSettings:(t,s=e)=>o(t,s),updateMultipleSettings:(t,s=e)=>l(t,s),fetchSettings:i}},ax=()=>{const[e,t]=n.useState([]),[s,r]=n.useState(!0),[i,o]=n.useState(null),l=async()=>{try{r(!0),o(null);const{data:e,error:s}=await qa.from("queue_types").select("*").order("priority",{ascending:!1}),{data:n}=await qa.from("queue_ins_types").select("*");if(s)throw s;if(e){const s=e.map(e=>({id:e.id,code:e.code,name:e.name,prefix:e.prefix,purpose:e.purpose||void 0,format:e.format,enabled:e.enabled,algorithm:e.algorithm,priority:e.priority}));if(n&&n.length>0){const e=n.map(e=>({id:e.id,code:e.code,name:e.name,prefix:e.prefix,purpose:"INS",format:e.format,enabled:e.enabled,algorithm:e.algorithm,priority:e.priority}));s.push(...e)}t(s),localStorage.setItem("queue_types",JSON.stringify(s))}else c()}catch(e){o(e.message||"Failed to fetch queue types"),c()}finally{r(!1)}},c=()=>{try{const e=localStorage.getItem("queue_types");e&&(t(JSON.parse(e)),a.info(""))}catch(e){}};return n.useEffect(()=>{l();const e=qa.channel("queue-types-changes").on("postgres_changes",{event:"*",schema:"public",table:"queue_types"},e=>{l()}).subscribe();return()=>{qa.removeChannel(e)}},[]),{queueTypes:e,loading:s,error:i,fetchQueueTypes:l,saveQueueType:async e=>{try{const{data:t,error:s}=await qa.from("queue_types").upsert({id:e.id,code:e.code,name:e.name,prefix:e.prefix,purpose:e.purpose||null,format:e.format,enabled:e.enabled,algorithm:e.algorithm,priority:e.priority}).select();if(s)throw s;return await l(),!0}catch(t){return a.error(` ${e.name} : ${t.message||"Unknown error"}`),!1}},deleteQueueType:async e=>{try{const{error:t}=await qa.from("queue_types").delete().eq("id",e);if(t)throw t;return await l(),!0}catch(t){return a.error(`: ${t.message||"Unknown error"}`),!1}}}},ix=Qa("useQueueTypes"),ox=e=>"0"===e||"00"===e||"000"===e?e:"00",lx=e=>e||ph.FIFO,cx=e=>"string"==typeof e?{id:e,code:e,name:e,prefix:e.charAt(0),format:"00",enabled:!0,algorithm:ph.FIFO,priority:5}:{...e,format:ox(e.format),algorithm:lx(e.algorithm)},dx=()=>{const[e,t]=n.useState([]),[s,r]=n.useState(!0),[i,o]=n.useState(null),l=async()=>{try{r(!0),o(null);const{data:e,error:s}=await qa.from("queue_types").select("*").order("priority",{ascending:!0}),{data:n}=await qa.from("queue_ins_types").select("*");if(s)throw s;let a=[];if(e){const t=e.map(e=>({...e,format:ox(e.format),algorithm:lx(e.algorithm)}));a.push(...t)}if(n){const e=n.map(e=>({...e,format:ox(e.format),algorithm:lx(e.algorithm)}));a.push(...e)}t(a)}catch(e){ix.error("Error fetching queue types:",e),o(e.message||"Error fetching queue types"),a.error("Failed to load queue types")}finally{r(!1)}};return n.useEffect(()=>{l()},[]),{queueTypes:e,loading:s,error:i,fetchQueueTypes:l,convertToQueueType:cx}},ux={hospital_name:"",hospital_address:" 7    44130",hospital_phone:"",hospital_website:"",pharmacy_name:"",pharmacy_phone:"",pharmacy_email:"",queue_types:rx,queue_reset_daily:!0,queue_start_number:1,queue_algorithm:ph.FIFO,enable_wait_time_prediction:!0,queue_announcement_enabled:!0,queue_announcement_text:" {queueNumber}  {counter}",queue_voice_enabled:!0,queue_voice_speed:.8,queue_voice_pitch:1,line_notification_enabled:!0,sms_notification_enabled:!1,appointment_notifications_enabled:!0,voice_notifications_enabled:!0,notify_day_before:!0,notify_hours_before:!0,notify_hour_before:!1,notify_queue_position:!0,notify_queue_waiting_time:!0},hx=[];for(let OI=0;OI<256;++OI)hx.push((OI+256).toString(16).slice(1));let mx;const px=new Uint8Array(16);const fx={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function gx(e,t,s){var r;if(fx.randomUUID&&!e)return fx.randomUUID();const n=(e=e||{}).random??(null==(r=e.rng)?void 0:r.call(e))??function(){if(!mx){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");mx=crypto.getRandomValues.bind(crypto)}return mx(px)}();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=15&n[6]|64,n[8]=63&n[8]|128,function(e,t=0){return(hx[e[t+0]]+hx[e[t+1]]+hx[e[t+2]]+hx[e[t+3]]+"-"+hx[e[t+4]]+hx[e[t+5]]+"-"+hx[e[t+6]]+hx[e[t+7]]+"-"+hx[e[t+8]]+hx[e[t+9]]+"-"+hx[e[t+10]]+hx[e[t+11]]+hx[e[t+12]]+hx[e[t+13]]+hx[e[t+14]]+hx[e[t+15]]).toLowerCase()}(n)}const xx=e=>({...(({form:e,setEditingQueueType:t,setNewQueueType:s,newQueueType:r})=>({handleAddQueueType:()=>{const r=e.getValues("queue_types")||[],n=gx(),a={id:n,code:"",name:"",prefix:"",purpose:"",format:"00",enabled:!0,algorithm:ph.FIFO,priority:5};e.setValue("queue_types",[...r,a]),t(n),s(!0)},handleEditQueueType:e=>{t(e),s(!1)},handleSaveQueueType:r=>{const n=e.getValues(`queue_types.${r}`);n.code&&n.name&&n.prefix&&(t(null),s(!1))},handleCancelEdit:n=>{const a=[...e.getValues("queue_types")];r&&(a.splice(n,1),e.setValue("queue_types",a)),t(null),s(!1)}}))(e),...(({form:e})=>({handleRemoveQueueType:t=>{const s=[...e.getValues("queue_types")];s.splice(t,1),e.setValue("queue_types",s)},handleDuplicateQueueType:t=>{const s=[...e.getValues("queue_types")],r=s[t],n={id:gx(),code:`${r.code}_COPY`,name:`${r.name} (Copy)`,prefix:r.prefix||"",purpose:r.purpose||"",format:ox(r.format),enabled:void 0===r.enabled||r.enabled,algorithm:lx(r.algorithm),priority:void 0!==r.priority?r.priority:5};s.splice(t+1,0,n),e.setValue("queue_types",s)},handleQueueTypeChange:(t,s,r)=>{const n=[...e.getValues("queue_types")];n[t]&&(n[t]={...n[t],[s]:r},e.setValue("queue_types",n))}}))(e)}),yx=n.createContext(void 0),vx=({children:e})=>{const t=(()=>{const[e,t]=n.useState(!0),[s,r]=n.useState(!1),a=nx("general"),i=nx("queue"),o=nx("notification"),{queueTypes:l,loading:c}=ax(),d=sf({resolver:hf(sx),defaultValues:ux});return n.useEffect(()=>{const{settings:e}=a,{settings:s}=i,{settings:r}=o;if(e||s||r){let a={...ux};if(Array.isArray(e))for(const t of e)try{t.key in ux&&(a={...a,[t.key]:t.value})}catch(n){}if(Array.isArray(s))for(const e of s)try{if("queue_algorithm"===e.key){const t=e.value;t&&Object.values(ph).includes(t)&&(a.queue_algorithm=t)}else if(e.key in ux){let t=e.value;"queue_start_number"===e.key?t=parseInt(t)||1:"queue_reset_daily"!==e.key&&"enable_wait_time_prediction"!==e.key&&"queue_voice_enabled"!==e.key||(t="true"===t||!0===t),a={...a,[e.key]:t}}}catch(n){}if(Array.isArray(r))for(const e of r)try{if(e.key in ux){let t=e.value;"string"==typeof t&&(t="true"===t),a={...a,[e.key]:t}}}catch(n){}d.reset(a),t(!1)}},[a.settings,i.settings,o.settings,d]),n.useEffect(()=>{if(!c&&l&&l.length>0){const e=l.map(e=>({id:e.id,code:e.code,name:e.name,prefix:e.prefix,purpose:e.purpose,format:ox(e.format),enabled:e.enabled,algorithm:lx(e.algorithm),priority:"number"==typeof e.priority?e.priority:5}));d.setValue("queue_types",e),r(!0)}},[c,l,d]),{form:d,settings:{form:d},loading:e,loadingQueueTypes:c,updateMultipleSettings:async(e,t="queue")=>{try{const s=Object.entries(e).map(([e,s])=>({category:t,key:e,value:s}));let r=!1;return r="general"===t?await a.updateMultipleSettings(s,t):"notification"===t?await o.updateMultipleSettings(s,t):await i.updateMultipleSettings(s,t),r}catch(s){return!1}},initialized:s}})(),{editingQueueType:s,setEditingQueueType:r,newQueueType:a,setNewQueueType:o}=(()=>{const[e,t]=n.useState(null),[s,r]=n.useState(!1);return{editingQueueType:e,setEditingQueueType:t,newQueueType:s,setNewQueueType:r}})();if(!t.form)return i.jsx("div",{children:"Loading settings..."});const{isSubmitting:l,setIsSubmitting:c,onSubmit:d}=(({form:e,updateMultipleSettings:t})=>{const[s,r]=n.useState(!1);return{isSubmitting:s,setIsSubmitting:r,onSubmit:async e=>{r(!0);try{await t({hospital_name:e.hospital_name,hospital_address:e.hospital_address,pharmacy_name:e.pharmacy_name,pharmacy_phone:e.pharmacy_phone,pharmacy_email:e.pharmacy_email},"general"),await t({queue_start_number:String(e.queue_start_number),queue_reset_daily:String(e.queue_reset_daily),queue_announcement_text:e.queue_announcement_text,queue_voice_enabled:String(e.queue_voice_enabled),queue_algorithm:e.queue_algorithm,enable_wait_time_prediction:String(e.enable_wait_time_prediction)},"queue"),await t({line_notification_enabled:String(e.line_notification_enabled),sms_notification_enabled:String(e.sms_notification_enabled),appointment_notifications_enabled:String(e.appointment_notifications_enabled),voice_notifications_enabled:String(e.voice_notifications_enabled),notify_day_before:String(e.notify_day_before),notify_hours_before:String(e.notify_hours_before),notify_hour_before:String(e.notify_hour_before),notify_queue_position:String(e.notify_queue_position),notify_queue_waiting_time:String(e.notify_queue_waiting_time)},"notification"),localStorage.setItem("queue_algorithm",e.queue_algorithm)}catch(s){}finally{r(!1)}}}})({form:t.form,updateMultipleSettings:t.updateMultipleSettings}),u=xx({form:t.form,setEditingQueueType:r,setNewQueueType:o,newQueueType:a}),h={form:t.form,isSubmitting:l,setIsSubmitting:c,settings:t.settings,loading:t.loading,loadingQueueTypes:t.loadingQueueTypes,editingQueueType:s,setEditingQueueType:r,newQueueType:a,setNewQueueType:o,onSubmit:d,updateMultipleSettings:t.updateMultipleSettings,...u};return i.jsx(yx.Provider,{value:h,children:e})},bx=()=>{const e=n.useContext(yx);if(void 0===e)throw new Error("useSettingsContext must be used within a SettingsProvider");return e},wx=({shouldChangeAlgorithm:e,currentAlgorithm:t,recommendedAlgorithm:s,urgentCount:r,elderlyCount:n,waitingQueueCount:o,handleChangeAlgorithm:l})=>{if(!e)return null;const{updateMultipleSettings:c}=bx();return i.jsxs(Fi,{className:"border-amber-200 bg-amber-50",children:[i.jsx(Ui,{className:"pb-4",children:i.jsxs(Wi,{className:"flex items-center gap-2 text-amber-800",children:[i.jsx(qo,{className:"h-5 w-5"}),""]})}),i.jsxs(zi,{className:"space-y-4",children:[i.jsx(Im,{className:"border-amber-200 bg-amber-100",children:i.jsxs(Pm,{className:"text-amber-800",children:[i.jsx("strong",{children:":"})," ",(()=>{const e=o>0?Math.round(r/o*100):0,t=o>0?Math.round(n/o*100):0;return s===ph.PRIORITY?` ${r}  (${e}% )`:s===ph.MULTILEVEL?` ${n}  (${t}% )`:` (${o} ) `})(),i.jsx("br",{}),i.jsx("strong",{children:":"})," "," ",i.jsx(Lh,{variant:"outline",children:t})," "," ",i.jsx(Lh,{className:"bg-amber-600",children:s})]})}),i.jsx("div",{className:"flex justify-center",children:i.jsx(Om,{currentAlgorithm:t,recommendedAlgorithm:s,urgentCount:r,elderlyCount:n,waitingQueueCount:o,onConfirmChange:async()=>{await c({queue_algorithm:s})?(l(),a.success("")):a.error("")}})})]})]})},jx=({timeFrame:e,setTimeFrame:t})=>i.jsx("div",{className:"flex justify-end mb-2",children:i.jsx(Z,{dir:"ltr",children:i.jsx(Oh,{value:e,onValueChange:e=>t(e),children:i.jsxs(Ah,{children:[i.jsx(Dh,{value:"day",className:"day"===e?"bg-blue-100":"",children:""}),i.jsx(Dh,{value:"week",className:"week"===e?"bg-blue-100":"",children:"7 "}),i.jsx(Dh,{value:"month",className:"month"===e?"bg-blue-100":"",children:"30 "})]})})})}),Nx=n.createContext(null);function _x(){const e=n.useContext(Nx);if(!e)throw new Error("useChart must be used within a <ChartContainer />");return e}const Sx={light:"",dark:".dark"},kx=({id:e,config:t})=>{const s=Object.entries(t).filter(([e,t])=>t.theme||t.color),r="hsl(12 76% 61%)",n="hsl(173 58% 39%)",a="hsl(197 37% 24%)",o="hsl(43 74% 66%)",l="hsl(27 87% 67%)";return s.length?i.jsx("style",{dangerouslySetInnerHTML:{__html:Object.entries(Sx).map(([t,i])=>`\n${i} [data-chart=${e}] {\n${s.map(([e,s])=>{var r;const n=(null==(r=s.theme)?void 0:r[t])||s.color;return n?`  --color-${e}: ${n};`:null}).join("\n")}\n  --chart-1: ${r};\n  --chart-2: ${n};\n  --chart-3: ${a};\n  --chart-4: ${o};\n  --chart-5: ${l};\n}\n`).join("\n")}}):i.jsx("style",{dangerouslySetInnerHTML:{__html:Object.entries(Sx).map(([t,s])=>`\n${s} [data-chart=${e}] {\n  --color-waitTime: ${r};\n  --color-count: ${n};\n  --chart-1: ${r};\n  --chart-2: ${n};\n  --chart-3: ${a};\n  --chart-4: ${o};\n  --chart-5: ${l};\n}\n`).join("\n")}})},Cx=n.forwardRef(({id:e,className:t,children:s,config:r,...a},o)=>{const l=n.useId(),c=`chart-${e||l.replace(/:/g,"")}`;return i.jsx(Nx.Provider,{value:{config:r},children:i.jsxs("div",{"data-chart":c,ref:o,className:Qi("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",t),...a,children:[i.jsx(kx,{id:c,config:r}),i.jsx(ct,{children:s})]})})});function Tx(e,t,s){if("object"!=typeof t||null===t)return;const r="payload"in t&&"object"==typeof t.payload&&null!==t.payload?t.payload:void 0;let n=s;return s in t&&"string"==typeof t[s]?n=t[s]:r&&s in r&&"string"==typeof r[s]&&(n=r[s]),n in e?e[n]:e[s]}Cx.displayName="Chart";const Ex=dt,Ix=n.forwardRef(({active:e,payload:t,className:s,indicator:r="dot",hideLabel:a=!1,hideIndicator:o=!1,label:l,labelFormatter:c,labelClassName:d,formatter:u,color:h,nameKey:m,labelKey:p},f)=>{const{config:g}=_x(),x=n.useMemo(()=>{var e;if(a||!(null==t?void 0:t.length))return null;const[s]=t,r=`${p||s.dataKey||s.name||"value"}`,n=Tx(g,s,r),o=p||"string"!=typeof l?null==n?void 0:n.label:(null==(e=g[l])?void 0:e.label)||l;return c?i.jsx("div",{className:Qi("font-medium",d),children:c(o,t)}):o?i.jsx("div",{className:Qi("font-medium",d),children:o}):null},[l,c,t,a,d,g,p]);if(!e||!(null==t?void 0:t.length))return null;const y=1===t.length&&"dot"!==r;return i.jsxs("div",{ref:f,className:Qi("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",s),children:[y?null:x,i.jsx("div",{className:"grid gap-1.5",children:t.map((e,t)=>{const s=`${m||e.name||e.dataKey||"value"}`,n=Tx(g,e,s),a=h||e.payload.fill||e.color;return i.jsx("div",{className:Qi("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground","dot"===r&&"items-center"),children:u&&void 0!==(null==e?void 0:e.value)&&e.name?u(e.value,e.name,e,t,e.payload):i.jsxs(i.Fragment,{children:[(null==n?void 0:n.icon)?i.jsx(n.icon,{}):!o&&i.jsx("div",{className:Qi("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":"dot"===r,"w-1":"line"===r,"w-0 border-[1.5px] border-dashed bg-transparent":"dashed"===r,"my-0.5":y&&"dashed"===r}),style:{"--color-bg":a,"--color-border":a}}),i.jsxs("div",{className:Qi("flex flex-1 justify-between leading-none",y?"items-end":"items-center"),children:[i.jsxs("div",{className:"grid gap-1.5",children:[y?x:null,i.jsx("span",{className:"text-muted-foreground",children:(null==n?void 0:n.label)||e.name})]}),e.value&&i.jsx("span",{className:"font-mono font-medium tabular-nums text-foreground",children:e.value.toLocaleString()})]})]})},e.dataKey)})})]})});Ix.displayName="ChartTooltip";n.forwardRef(({className:e,hideIcon:t=!1,payload:s,verticalAlign:r="bottom",nameKey:n},a)=>{const{config:o}=_x();return(null==s?void 0:s.length)?i.jsx("div",{ref:a,className:Qi("flex items-center justify-center gap-4","top"===r?"pb-3":"pt-3",e),children:s.map(e=>{const s=`${n||e.dataKey||"value"}`,r=Tx(o,e,s);return i.jsxs("div",{className:Qi("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[(null==r?void 0:r.icon)&&!t?i.jsx(r.icon,{}):i.jsx("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:e.color}}),null==r?void 0:r.label]},e.value)})}):null}).displayName="ChartLegend";const Px={waitTime:{label:"",color:"hsl(217, 91%, 60%)"},insWaitTime:{label:"",color:"hsl(271, 91%, 65%)"}},Ox=({data:e,timeFrame:t})=>e&&0!==e.length?i.jsx(Cx,{config:Px,className:"min-h-[300px] w-full",children:i.jsx(ct,{width:"100%",height:"100%",children:i.jsxs(ut,{data:e,margin:{top:20,right:30,left:20,bottom:20},children:[i.jsx(ht,{strokeDasharray:"3 3",className:"stroke-muted"}),i.jsx(mt,{dataKey:"time",tick:{fontSize:12},tickLine:{stroke:"hsl(var(--muted-foreground))"}}),i.jsx(pt,{tick:{fontSize:12},tickLine:{stroke:"hsl(var(--muted-foreground))"},label:{value:"",angle:-90,position:"insideLeft",style:{fontSize:12}}}),i.jsx(Ex,{content:i.jsx(Ix,{labelFormatter:e=>`: ${e}`})}),i.jsx(ft,{wrapperStyle:{paddingTop:"10px"},iconType:"line"}),i.jsx(gt,{type:"monotone",dataKey:"waitTime",name:Px.waitTime.label,stroke:Px.waitTime.color,strokeWidth:2,dot:{fill:Px.waitTime.color,strokeWidth:2,r:4},activeDot:{r:6,strokeWidth:0}}),i.jsx(gt,{type:"monotone",dataKey:"insWaitTime",name:Px.insWaitTime.label,stroke:Px.insWaitTime.color,strokeWidth:2,dot:{fill:Px.insWaitTime.color,strokeWidth:2,r:4},activeDot:{r:6,strokeWidth:0}})]})})}):i.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:""}),Ax={count:{label:"",color:"hsl(217, 91%, 60%)"},insCount:{label:"",color:"hsl(271, 91%, 65%)"}},Dx=({data:e,timeFrame:t})=>e&&0!==e.length?i.jsx(Cx,{config:Ax,className:"min-h-[300px] w-full",children:i.jsx(ct,{width:"100%",height:"100%",children:i.jsxs(xt,{data:e,margin:{top:20,right:30,left:20,bottom:20},children:[i.jsx(ht,{strokeDasharray:"3 3",className:"stroke-muted"}),i.jsx(mt,{dataKey:"time",tick:{fontSize:12},tickLine:{stroke:"hsl(var(--muted-foreground))"}}),i.jsx(pt,{tick:{fontSize:12},tickLine:{stroke:"hsl(var(--muted-foreground))"},label:{value:"",angle:-90,position:"insideLeft",style:{fontSize:12}}}),i.jsx(Ex,{content:i.jsx(Ix,{labelFormatter:e=>`: ${e}`})}),i.jsx(ft,{wrapperStyle:{paddingTop:"10px"}}),i.jsx(yt,{dataKey:"count",name:Ax.count.label,fill:Ax.count.color,radius:[4,4,0,0]}),i.jsx(yt,{dataKey:"insCount",name:Ax.insCount.label,fill:Ax.insCount.color,radius:[4,4,0,0]})]})})}):i.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:""}),Mx={count:{label:"",color:"hsl(var(--chart-3))"}},qx=({waitingQueues:e,waitingInsQueues:t=[]})=>{const[s,r]=n.useState(!1),[a,o]=n.useState([]);return n.useEffect(()=>{(async()=>{const s=(await(async()=>{const{data:e}=await qa.from("queue_types").select("code, name"),{data:t}=await qa.from("queue_ins_types").select("code, name");return e.concat(t)})()).map(s=>{const r=e.filter(e=>e.type===s.code).length+t.filter(e=>e.type===s.code).length;return{type:s.name,count:r}});o(s);const n=s.some(e=>e.count>0);r(n)})()},[e,t]),s?i.jsx(Cx,{config:Mx,className:"min-h-[300px] w-full",children:i.jsx(ct,{width:"100%",height:"100%",children:i.jsxs(xt,{data:a,layout:"vertical",margin:{top:20,right:30,left:60,bottom:20},children:[i.jsx(ht,{strokeDasharray:"3 3",className:"stroke-muted"}),i.jsx(mt,{type:"number",tick:{fontSize:12},tickLine:{stroke:"hsl(var(--muted-foreground))"}}),i.jsx(pt,{dataKey:"type",type:"category",tick:{fontSize:12},tickLine:{stroke:"hsl(var(--muted-foreground))"},width:50}),i.jsx(Ex,{content:i.jsx(Ix,{labelFormatter:e=>`: ${e}`,formatter:(e,t)=>[`${e} `,Mx.count.label]})}),i.jsx(yt,{dataKey:"count",fill:"var(--color-count)",radius:[0,4,4,0]})]})})}):i.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:""})},Rx=({completedQueues:e,waitingQueues:t,activeQueues:s,skippedQueues:r,completedInsQueues:a=[],waitingInsQueues:o=[],activeInsQueues:l=[],skippedInsQueues:c=[],className:d})=>{const{timeFrame:u,setTimeFrame:h}=Sm(),[m,p]=n.useState(0),f=((e,t)=>{const[s,r]=n.useState([]),a=n.useCallback(async()=>{try{let t,s=new Date;t="day"===e?zl(new Date):"week"===e?Ul(new Date,{weekStartsOn:1}):nc(new Date);const{data:n,error:a}=await qa.from("queues").select("created_at, called_at").not("called_at","is",null).gte("created_at",t.toISOString()).lte("created_at",s.toISOString()).order("created_at",{ascending:!0}),{data:i,error:o}=await qa.from("queues_ins").select("created_at, called_at").not("called_at","is",null).gte("created_at",t.toISOString()).lte("created_at",s.toISOString()).order("created_at",{ascending:!0}),l=new Map;null==n||n.forEach(t=>{if(t.called_at&&t.created_at){const s=(new Date(t.called_at).getTime()-new Date(t.created_at).getTime())/6e4;let r;r=zc(new Date(t.created_at),"day"===e?"HH:00":"dd MMM",{locale:cu}),l.has(r)||l.set(r,{count:0,total:0});const n=l.get(r);l.set(r,{count:n.count+1,total:n.total+s})}});const c=new Map;null==i||i.forEach(t=>{if(t.called_at&&t.created_at){const s=(new Date(t.called_at).getTime()-new Date(t.created_at).getTime())/6e4;let r;r=zc(new Date(t.created_at),"day"===e?"HH:00":"dd MMM",{locale:cu}),c.has(r)||c.set(r,{count:0,total:0});const n=c.get(r);c.set(r,{count:n.count+1,total:n.total+s})}});const d=[];if("day"===e)for(let e=0;e<24;e++){const t=`${e.toString().padStart(2,"0")}:00`,s=l.get(t),r=c.get(t);d.push({time:t,waitTime:s?Math.round(s.total/s.count):0,insWaitTime:r?Math.round(r.total/r.count):0})}else{let e=new Date(t);for(;e<=s;){const t=zc(e,"dd MMM",{locale:cu}),s=l.get(t),r=c.get(t);d.push({time:t,waitTime:s?Math.round(s.total/s.count):0,insWaitTime:r?Math.round(r.total/r.count):0}),e=new Date(e.setDate(e.getDate()+1))}}r(d)}catch(t){}},[e,t]);return n.useEffect(()=>{a()},[a]),s})(u,m),g=((e,t)=>{const[s,r]=n.useState([]),a=n.useCallback(async()=>{try{let t,s=new Date;t="day"===e?zl(new Date):"week"===e?Ul(new Date,{weekStartsOn:1}):nc(new Date);const{data:n,error:a}=await qa.from("queues").select("completed_at").eq("status","COMPLETED").gte("completed_at",t.toISOString()).lte("completed_at",s.toISOString()).order("completed_at",{ascending:!0}),{data:i,error:o}=await qa.from("queues_ins").select("completed_at").eq("status","COMPLETED").gte("completed_at",t.toISOString()).lte("completed_at",s.toISOString()).order("completed_at",{ascending:!0}),l=new Map;null==n||n.forEach(t=>{if(t.completed_at){let s;s=zc(new Date(t.completed_at),"day"===e?"HH:00":"dd MMM",{locale:cu}),l.set(s,(l.get(s)||0)+1)}});const c=new Map;null==i||i.forEach(t=>{if(t.completed_at){let s;s=zc(new Date(t.completed_at),"day"===e?"HH:00":"dd MMM",{locale:cu}),c.set(s,(c.get(s)||0)+1)}});const d=[];if("day"===e)for(let e=0;e<24;e++){const t=`${e.toString().padStart(2,"0")}:00`;d.push({time:t,count:l.get(t)||0,insCount:c.get(t)||0})}else{let e=new Date(t);for(;e<=s;){const t=zc(e,"dd MMM",{locale:cu});d.push({time:t,count:l.get(t)||0,insCount:c.get(t)||0}),e=new Date(e.setDate(e.getDate()+1))}}r(d)}catch(t){}},[e,t]);return n.useEffect(()=>{a()},[a]),s})(u,m),{averageWaitTime:x,averageServiceTime:y,currentAlgorithm:v,recommendedAlgorithm:b,shouldChangeAlgorithm:w,urgentCount:j,elderlyCount:N,handleChangeAlgorithm:_}=Cm(e,t);n.useEffect(()=>{e.length+t.length+a.length+o.length>0&&p(e=>e+1)},[e.length,t.length,a.length,o.length]);const S=n.useMemo(()=>{const e=a.filter(e=>e.called_at&&e.completed_at);let t=0,s=0;return e.forEach(e=>{if(e.created_at&&e.called_at){const s=new Date(e.called_at).getTime()-new Date(e.created_at).getTime();t+=s/1e3/60}if(e.called_at&&e.completed_at){const t=new Date(e.completed_at).getTime()-new Date(e.called_at).getTime();s+=t/1e3/60}}),{averageInsWaitTime:e.length>0?t/e.length:0,averageInsServiceTime:e.length>0?s/e.length:0}},[a]);return i.jsx(Z,{dir:"ltr",children:i.jsxs("div",{className:Qi("space-y-6",d),children:[i.jsx(Tm,{waitingQueueCount:t.length,averageWaitTime:x,averageServiceTime:y,completedQueueCount:e.length,waitingInsQueueCount:o.length,averageInsWaitTime:S.averageInsWaitTime,averageInsServiceTime:S.averageInsServiceTime,completedInsQueueCount:a.length}),w&&i.jsx(vx,{children:i.jsx(wx,{shouldChangeAlgorithm:w,currentAlgorithm:v,recommendedAlgorithm:b,urgentCount:j,elderlyCount:N,waitingQueueCount:t.length,handleChangeAlgorithm:_})}),i.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[i.jsxs(Fi,{className:"w-full",children:[i.jsx(Ui,{className:"pb-4",children:i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[i.jsx(Wi,{className:"text-lg",children:""}),i.jsx(jx,{timeFrame:u,setTimeFrame:h})]})}),i.jsx(zi,{className:"pt-0",children:i.jsx(Ox,{data:f,timeFrame:u})})]}),i.jsxs(Fi,{className:"w-full",children:[i.jsx(Ui,{className:"pb-4",children:i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[i.jsx(Wi,{className:"text-lg",children:""}),i.jsx(jx,{timeFrame:u,setTimeFrame:h})]})}),i.jsx(zi,{className:"pt-0",children:i.jsx(Dx,{data:g,timeFrame:u})})]})]}),i.jsxs(Fi,{className:"w-full",children:[i.jsxs(Ui,{className:"pb-4",children:[i.jsx(Wi,{className:"text-lg",children:""}),i.jsx("p",{className:"text-sm text-muted-foreground",children:""})]}),i.jsx(zi,{className:"pt-0",children:i.jsx(Oh,{defaultValue:"composition",className:"w-full",children:i.jsx(Mh,{value:"composition",className:"mt-0",children:i.jsx(qx,{waitingQueues:t,waitingInsQueues:o})})})})]})]})})},$x=({waitingQueues:e,activeQueues:t,completedQueues:s,skippedQueues:r,patients:n,onUpdateStatus:a,onCallQueue:o,onRecallQueue:l})=>i.jsxs("div",{className:"space-y-6",children:[i.jsx(Rx,{completedQueues:s,waitingQueues:e,activeQueues:t,skippedQueues:r,className:"mb-6"}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[i.jsx("div",{className:"lg:col-span-3",children:i.jsx(im,{waitingQueues:e,activeQueues:t,completedQueues:s,skippedQueues:r,patients:n,onUpdateStatus:a,onCallQueue:o,onRecallQueue:l})}),i.jsx(_m,{completedQueuesLength:s.length})]})]}),Lx=()=>{const{updateQueueStatus:e,callQueue:t,recallQueue:s}=yh(),{patients:r}=Ha(),{waitingQueues:n,activeQueues:a,completedQueues:o,skippedQueues:l}=bh();return i.jsxs("div",{className:"flex flex-col h-screen overflow-hidden p-6",children:[i.jsx(xu,{}),i.jsx($x,{waitingQueues:n,activeQueues:a,completedQueues:o,skippedQueues:l,patients:r,onUpdateStatus:e,onCallQueue:t,onRecallQueue:s})]})},Qx=({onAddPatient:e})=>i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:""}),i.jsx("p",{className:"text-gray-500",children:""})]}),i.jsx("div",{className:"flex items-center gap-2",children:i.jsxs(gu,{className:"bg-pharmacy-600 hover:bg-pharmacy-700 text-white",onClick:e,children:[i.jsx(kl,{className:"w-4 h-4 mr-2"}),""]})})]}),Fx=({patients:e})=>{const t=Math.round(e.filter(e=>void 0!==e.distance_from_hospital&&e.distance_from_hospital<=20).length/(e.length||1)*100),s=Math.round(e.filter(e=>e.line_id).length/(e.length||1)*100);return i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[i.jsx(Fi,{className:"dashboard-card",children:i.jsxs(zi,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:""}),i.jsx("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:e.length})]}),i.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:i.jsx(kl,{className:"w-6 h-6 text-blue-600"})})]}),i.jsx("div",{className:"mt-4",children:i.jsx("div",{className:"text-xs text-gray-500",children:" Supabase"})})]})}),i.jsx(Fi,{className:"dashboard-card",children:i.jsxs(zi,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:""}),i.jsxs("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:[t,"%"]})]}),i.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:i.jsx(Uo,{className:"w-6 h-6 text-green-600"})})]}),i.jsx("div",{className:"mt-4",children:i.jsx("div",{className:"text-xs text-gray-500",children:" 20 "})})]})}),i.jsx(Fi,{className:"dashboard-card",children:i.jsxs(zi,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:" LINE ID"}),i.jsxs("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:[s,"%"]})]}),i.jsx("div",{className:"bg-purple-100 p-3 rounded-full",children:i.jsx(al,{className:"w-6 h-6 text-purple-600"})})]}),i.jsx("div",{className:"mt-4",children:i.jsx("div",{className:"text-xs text-gray-500",children:" LINE "})})]})})]})},Ux=n.forwardRef(({className:e,type:t,...s},r)=>i.jsx("input",{type:t,className:Qi("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:r,...s}));Ux.displayName="Input";const Wx=pu("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Vx=n.forwardRef(({className:e,...t},s)=>i.jsx(X,{ref:s,className:Qi(Wx(),e),...t}));Vx.displayName=X.displayName;const zx=n.forwardRef(({className:e,...t},s)=>i.jsx("textarea",{className:Qi("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...t}));zx.displayName="Textarea";const Bx=({patient:e,onSubmit:t,onCancel:s})=>{var r;const[a,o]=n.useState(e||{name:"",phone:"",line_id:"",address:"",ID_card:"",gender:"",birth_date:"",distance_from_hospital:null}),l=e=>{const{name:t,value:s}=e.target;o(e=>({...e,[t]:s}))};return i.jsxs(Fi,{className:"w-full max-w-2xl mx-auto bg-white shadow-lg animate-scale-in",children:[i.jsxs(Ui,{children:[i.jsx(Wi,{className:"text-xl text-pharmacy-800",children:e?"":""}),i.jsx(Vi,{children:""})]}),i.jsxs("form",{onSubmit:e=>{e.preventDefault(),t(a)},children:[i.jsxs(zi,{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(Vx,{htmlFor:"name",children:"-"}),i.jsx(Ux,{id:"name",name:"name",value:a.name||"",onChange:l,placeholder:"-",required:!0})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(Vx,{htmlFor:"ID_card",children:""}),i.jsx(Ux,{id:"ID_card",name:"ID_card",value:a.ID_card||"",onChange:l,placeholder:" 13 ",maxLength:13,pattern:"[0-9]{13}",required:!0})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(Vx,{htmlFor:"phone",children:""}),i.jsx(Ux,{id:"phone",name:"phone",value:a.phone||"",onChange:l,placeholder:""})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(Vx,{htmlFor:"line_id",children:"LINE ID ()"}),i.jsx(Ux,{id:"line_id",name:"line_id",value:a.line_id||"",onChange:l,placeholder:"LINE ID"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(Vx,{htmlFor:"gender",children:""}),i.jsxs(Jh,{value:a.gender||"",onValueChange:e=>((e,t)=>{o(s=>({...s,[e]:t}))})("gender",e),children:[i.jsx(Xh,{children:i.jsx(Zh,{placeholder:""})}),i.jsxs(sm,{children:[i.jsx(rm,{value:"",children:""}),i.jsx(rm,{value:"",children:""}),i.jsx(rm,{value:"",children:""})]})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(Vx,{htmlFor:"birth_date",children:""}),i.jsx(Ux,{type:"date",id:"birth_date",name:"birth_date",value:a.birth_date||"",onChange:l})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(Vx,{htmlFor:"address",children:""}),i.jsx(zx,{id:"address",name:"address",value:a.address||"",onChange:l,placeholder:"",rows:3})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(Vx,{htmlFor:"distance_from_hospital",children:" ()"}),i.jsx(Ux,{type:"number",step:"0.1",min:"0",id:"distance_from_hospital",name:"distance_from_hospital",value:(null==(r=a.distance_from_hospital)?void 0:r.toString())||"",onChange:l,placeholder:" 5.2"})]})]}),i.jsxs(Bi,{className:"flex justify-end space-x-2",children:[i.jsx(gu,{type:"button",variant:"outline",onClick:s,children:""}),i.jsx(gu,{type:"submit",className:"bg-pharmacy-600 hover:bg-pharmacy-700 text-white",children:e?"":""})]})]})]})},Hx=({patient:e,onSubmit:t,onCancel:s})=>i.jsxs(Fi,{children:[i.jsx(Ui,{children:i.jsx(Wi,{children:e?"":""})}),i.jsx(zi,{children:i.jsx(Bx,{patient:e||void 0,onSubmit:t,onCancel:s})})]}),Gx=({searchTerm:e,onSearchChange:t})=>i.jsx("div",{className:"flex",children:i.jsxs("div",{className:"relative flex-1 max-w-md",children:[i.jsx(cl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),i.jsx(Ux,{placeholder:"  ...",className:"pl-10",value:e,onChange:e=>t(e.target.value)})]})}),Kx=({patients:e,onSelectPatient:t=()=>{},onEditPatient:s=()=>{}})=>i.jsx("div",{className:"space-y-4",children:0===e.length?i.jsx("div",{className:"text-center py-8 bg-gray-50 rounded-lg border border-gray-100",children:i.jsx("p",{className:"text-gray-500",children:""})}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map(e=>i.jsx(Fi,{className:"overflow-hidden transition-all duration-300 hover:shadow-md animate-fade-in",onClick:()=>t(e),children:i.jsx(zi,{className:"p-4",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"h-10 w-10 rounded-full overflow-hidden bg-pharmacy-100 flex items-center justify-center mr-3",children:e.profile_image?i.jsx("img",{src:e.profile_image,alt:e.name,className:"h-full w-full object-cover"}):i.jsx("span",{className:"text-pharmacy-500 font-semibold",children:e.name.charAt(0)})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium text-gray-900",children:e.name}),e.phone&&i.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[i.jsx(el,{className:"h-3 w-3 mr-1"}),e.phone]}),e.ID_card&&i.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-0.5",children:[i.jsx(_o,{className:"h-3 w-3 mr-1"}),e.ID_card]}),e.line_id&&i.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-0.5",children:[i.jsx(Vo,{className:"h-3 w-3 mr-1"}),"LINE: ",e.line_id]}),e.address&&i.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-0.5",children:[i.jsx(Uo,{className:"h-3 w-3 mr-1"}),i.jsx("span",{className:"line-clamp-2",children:e.address})]}),void 0!==e.distance_from_hospital&&null!==e.distance_from_hospital&&i.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:[":"," ",e.distance_from_hospital," ."]})]})]}),i.jsx(gu,{variant:"ghost",size:"icon",className:"h-8 w-8 text-gray-400 hover:text-pharmacy-600",onClick:t=>{t.stopPropagation(),s(e)},children:i.jsx(gl,{className:"h-4 w-4"})})]})})},e.id))})}),Yx=({patients:e,loading:t,error:s,onSelectPatient:r,onEditPatient:n})=>i.jsx(Fi,{children:i.jsx(zi,{className:"p-6",children:t?i.jsx("div",{className:"text-center py-8",children:i.jsx("p",{className:"text-gray-500",children:"..."})}):s?i.jsx("div",{className:"text-center py-8 text-red-500",children:i.jsxs("p",{children:[": ",s]})}):i.jsx(Kx,{patients:e,onSelectPatient:r,onEditPatient:n})})}),Jx=({searchTerm:e,onSearchChange:t,filteredPatients:s,loading:r,error:n,onSelectPatient:a,onEditPatient:o})=>i.jsxs("div",{className:"space-y-6",children:[i.jsx(Gx,{searchTerm:e,onSearchChange:t}),i.jsx(Yx,{patients:s,loading:r,error:n,onSelectPatient:a,onEditPatient:o})]}),Zx=n.forwardRef(({className:e,...t},s)=>i.jsx("div",{className:"relative w-full overflow-auto",children:i.jsx("table",{ref:s,className:Qi("w-full caption-bottom text-sm",e),...t})}));Zx.displayName="Table";const Xx=n.forwardRef(({className:e,...t},s)=>i.jsx("thead",{ref:s,className:Qi("[&_tr]:border-b",e),...t}));Xx.displayName="TableHeader";const ey=n.forwardRef(({className:e,...t},s)=>i.jsx("tbody",{ref:s,className:Qi("[&_tr:last-child]:border-0",e),...t}));ey.displayName="TableBody";n.forwardRef(({className:e,...t},s)=>i.jsx("tfoot",{ref:s,className:Qi("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";const ty=n.forwardRef(({className:e,...t},s)=>i.jsx("tr",{ref:s,className:Qi("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));ty.displayName="TableRow";const sy=n.forwardRef(({className:e,...t},s)=>i.jsx("th",{ref:s,className:Qi("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));sy.displayName="TableHead";const ry=n.forwardRef(({className:e,...t},s)=>i.jsx("td",{ref:s,className:Qi("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));ry.displayName="TableCell";function ny({className:e,...t}){return i.jsx("div",{className:Qi("animate-pulse rounded-md bg-muted",e),...t})}n.forwardRef(({className:e,...t},s)=>i.jsx("caption",{ref:s,className:Qi("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption";const ay=({patientName:e,medications:t,loading:s,onRefresh:r,showCheckNotes:a=!1})=>{const[o,l]=n.useState({}),[c,d]=n.useState(null),[u,h]=n.useState(!1);return n.useEffect(()=>{},[e,t,s]),n.useEffect(()=>{(async()=>{const e=t.filter(e=>e.patient_check_id).map(e=>e.patient_check_id);if(0!==e.length){h(!0);try{const{data:t,error:s}=await qa.from("patient_check").select("id, check_note").in("id",e);if(!s&&t){const e={};t.forEach(t=>{e[t.id]=t.check_note||""}),l(e)}}catch(s){}finally{h(!1)}}})()},[t]),i.jsxs(Fi,{children:[i.jsxs(Ui,{className:"flex flex-row items-center justify-between",children:[i.jsxs(Wi,{className:"text-lg",children:[" ",e||""]}),r&&i.jsx(gu,{variant:"outline",size:"sm",onClick:r,disabled:s,children:i.jsx(al,{className:"h-4 w-4 "+(s?"animate-spin":"")})})]}),i.jsx(zi,{children:s?i.jsxs("div",{className:"space-y-2",children:[i.jsx(ny,{className:"h-6 w-full"}),i.jsx(ny,{className:"h-12 w-full"}),i.jsx(ny,{className:"h-12 w-full"}),i.jsx(ny,{className:"h-12 w-full"})]}):0===t.length?i.jsxs("div",{className:"text-center py-8 text-gray-500",children:[i.jsx("div",{className:"mb-2",children:""}),i.jsx("div",{className:"text-sm",children:" "})]}):i.jsx("div",{className:"overflow-auto max-h-[500px]",children:i.jsxs(Zx,{children:[i.jsx(Xx,{children:i.jsxs(ty,{children:[i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),a&&i.jsx(sy,{className:"text-center",children:""})]})}),i.jsx(ey,{children:t.map(e=>{var t,s;return i.jsxs(ty,{children:[i.jsx(ry,{className:"font-medium whitespace-nowrap",children:wu(e.start_date)}),i.jsx(ry,{children:(null==(t=e.medication)?void 0:t.name)||""}),i.jsx(ry,{className:"text-xs text-gray-600",children:(null==(s=e.medication)?void 0:s.code)||"-"}),i.jsx(ry,{children:e.dosage}),i.jsx(ry,{className:"max-w-[250px] break-words",children:e.instructions||"-"}),a&&i.jsx(ry,{className:"text-center",children:e.patient_check_id&&o[e.patient_check_id]?i.jsx(gu,{variant:"ghost",size:"sm",onClick:()=>d(o[e.patient_check_id]),className:"text-blue-600 hover:text-blue-700",children:i.jsx(Co,{className:"h-4 w-4"})}):i.jsx("span",{className:"text-gray-400 text-xs",children:"-"})})]},e.id)})})]})})}),i.jsx(Uh,{open:!!c,onOpenChange:()=>d(null),children:i.jsxs(Bh,{className:"max-w-2xl",children:[i.jsx(Hh,{children:i.jsx(Kh,{children:"/"})}),i.jsx("div",{className:"mt-4",children:i.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:i.jsx("p",{className:"text-sm whitespace-pre-wrap",children:c})})})]})})]})};const iy=new class{constructor(e=3,s=300){t(this,"requestQueue",[]),t(this,"inProgress",0),t(this,"maxConcurrent"),t(this,"batchDelay"),t(this,"processing",!1),this.maxConcurrent=e,this.batchDelay=s}queue(e){return new Promise((t,s)=>{this.requestQueue.push(async()=>{try{const s=await e();return t(s),s}catch(r){throw s(r),r}finally{this.inProgress--,this.processQueue()}}),this.processQueue()})}processQueue(){if(this.processing||0===this.requestQueue.length)return;this.processing=!0;const e=Math.min(this.maxConcurrent-this.inProgress,this.requestQueue.length);if(e<=0)this.processing=!1;else{for(let t=0;t<e;t++){const e=this.requestQueue.shift();e&&(this.inProgress++,e().catch(()=>{}))}setTimeout(()=>{this.processing=!1,this.requestQueue.length>0&&this.processQueue()},this.batchDelay)}}clear(){this.requestQueue=[]}};const oy=Qa("usePatientMedications"),ly=e=>{const[t,s]=n.useState([]),[r,i]=n.useState(!0),[o,l]=n.useState(null),c=n.useCallback(async(e,t,s,r)=>{try{const{data:n,error:a}=await qa.from("patient_medications").select("id").eq("patient_id",e).eq("medication_id",t).eq("dosage",s).eq("start_date",r).limit(1);return a?(oy.error("Error checking duplicate medication:",a),!1):n&&n.length>0}catch(n){return oy.error("Error in duplicate check:",n),!1}},[]),d=n.useCallback(async e=>{if(!e)return s([]),i(!1),[];try{i(!0),l(null),oy.info(`Fetching medication history for patient ${e}`);const r=await(t=async()=>await qa.from("patient_medications").select("\n            *,\n            medication:medications(*)\n          ").eq("patient_id",e).order("created_at",{ascending:!1}),iy.queue(t));if(r.error)throw r.error;const n=r.data||[];return oy.info(`Fetched ${n.length} medication records`),s(n),n}catch(r){const e=r instanceof Error?r.message:"Failed to fetch medication history";return oy.error("Error fetching medication history:",r),l(e),a.error(""),[]}finally{i(!1)}var t},[]);return n.useEffect(()=>{e?d(e):(s([]),i(!1))},[e,d]),{medications:t,loading:r,error:o,fetchMedicationHistory:d,addMedication:async e=>{try{l(null),oy.info(`Adding medication for patient ${e.patient_id}`);if(await c(e.patient_id,e.medication_id,e.dosage,e.start_date)){const e="";return a.error(e),l(e),null}const{data:t,error:r}=await qa.from("patient_medications").insert(e).select("*, medication:medications(*)");if(r){if("23505"===r.code&&r.message.includes("unique_patient_medication_per_day")){const e="";return a.error(e),l(e),null}throw r}return t&&t.length>0?(s(e=>[t[0],...e]),t[0]):null}catch(t){const e=t instanceof Error?t.message:"Failed to add medication";return oy.error("Error adding medication:",t),l(e),a.error(""),null}},updateMedication:async(e,t)=>{try{l(null),oy.info(`Updating medication record ${e}`);const{data:r,error:n}=await qa.from("patient_medications").update(t).eq("id",e).select("*, medication:medications(*)");if(n)throw n;return r&&r.length>0?(s(t=>t.map(t=>t.id===e?r[0]:t)),r[0]):null}catch(r){const e=r instanceof Error?r.message:"Failed to update medication";return oy.error("Error updating medication:",r),l(e),a.error(""),null}},deleteMedication:async e=>{try{l(null),oy.info(`Deleting medication record ${e}`);const{error:t}=await qa.from("patient_medications").delete().eq("id",e);if(t)throw t;return s(t=>t.filter(t=>t.id!==e)),!0}catch(t){const e=t instanceof Error?t.message:"Failed to delete medication";return oy.error("Error deleting medication:",t),l(e),a.error(""),!1}},checkDuplicateMedication:c}},cy=async(e,t="medications")=>{try{const s=e.name.split(".").pop(),r=`${`${gx()}.${s}`}`,{data:n,error:a}=await qa.storage.from(t).upload(r,e,{cacheControl:"3600",upsert:!1,contentType:e.type||"application/octet-stream"});if(a)return null;const{data:{publicUrl:i}}=qa.storage.from(t).getPublicUrl(r);return i}catch(s){return null}},dy=async(e,t="medications")=>{try{const s=new URL(e).pathname.split("/"),r=s[s.length-1],{error:n}=await qa.storage.from(t).remove([r]);return!n}catch(s){return!1}},uy=()=>{const[e,t]=n.useState([]),[s,r]=n.useState(!0),[i,o]=n.useState(null),l=n.useCallback(async()=>{try{r(!0),o(null);const{data:e,error:s}=await qa.from("medications").select("*").order("name",{ascending:!0});if(s)throw s;t(e||[])}catch(e){o(e.message||"Failed to fetch medications"),a.error("")}finally{r(!1)}},[]);n.useEffect(()=>{l()},[l]);const c=n.useCallback(async e=>{try{if(o(null),!e.code||!e.name||!e.unit)throw new Error("Code, name, and unit are required fields");let s=null;const r=e.image;if(r instanceof File){if(s=await cy(r),!s)throw new Error("Failed to upload image")}else"string"==typeof r&&(s=r);const{data:n,error:i}=await qa.from("medications").insert([{code:e.code,name:e.name,description:e.description,unit:e.unit,stock:e.stock||0,min_stock:e.min_stock||0,image:s,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}]).select();if(i)throw s&&"string"!=typeof e.image&&await dy(s),i;return n&&n.length>0?(t(e=>[...e,n[0]].sort((e,t)=>e.name.localeCompare(t.name))),a.success(` ${e.name} `),n[0]):null}catch(s){return o(s.message||"Failed to add medication"),a.error(""),null}},[]),d=n.useCallback(async(e,s)=>{try{o(null);const{data:r,error:n}=await qa.from("medications").select("*").eq("id",e).single();if(n)throw n;let i;if(s.image instanceof File){if(i=await cy(s.image),!i)throw new Error("Failed to upload image")}else if(null===s.image){i=null;const e=null==r?void 0:r.image;e&&await dy(e)}else"string"==typeof s.image&&(i=s.image);const l={...s,updated_at:(new Date).toISOString()};void 0!==i&&(l.image=i),"image"in l&&l.image instanceof File&&delete l.image;const{data:c,error:d}=await qa.from("medications").update(l).eq("id",e).select();if(d)throw i&&"string"!=typeof s.image&&null!==s.image&&await dy(i),d;const u=null==r?void 0:r.image;return i&&u&&i!==u&&await dy(u),c&&c.length>0?(t(t=>t.map(t=>t.id===e?{...t,...c[0]}:t)),a.success(` ${c[0].name} `),c[0]):null}catch(r){return o(r.message||"Failed to update medication"),a.error(""),null}},[]),u=n.useCallback(async(e,s)=>{try{o(null);const{data:r,error:n}=await qa.from("medications").update({stock:s,updated_at:(new Date).toISOString()}).eq("id",e).select();if(n)throw n;return r&&r.length>0?(t(t=>t.map(t=>t.id===e?{...t,...r[0]}:t)),a.success(` ${r[0].name} `),r[0]):null}catch(r){return o(r.message||"Failed to update medication stock"),a.error(""),null}},[]),h=n.useCallback(async e=>{try{o(null);const{data:s,error:r}=await qa.from("medications").select("*").eq("id",e).single();if(r)throw r;const{error:n}=await qa.from("medications").delete().eq("id",e);if(n)throw n;const i=null==s?void 0:s.image;return i&&await dy(i),t(t=>t.filter(t=>t.id!==e)),a.success(""),!0}catch(s){return o(s.message||"Failed to delete medication"),a.error(""),!1}},[]);return{medications:e,loading:s,error:i,fetchMedications:l,addMedication:c,updateMedication:d,updateStock:u,deleteMedication:h}},hy=n.createContext(void 0),my=({children:e})=>{const{medications:t,loading:s,error:r,fetchMedications:a,addMedication:o,updateMedication:l,deleteMedication:c}=uy(),[d,u]=n.useState(null),[h,m]=n.useState(!1),p={medications:t,loading:s,error:r,fetchMedications:a,addMedication:o,updateMedication:l,deleteMedication:c,selectedMedication:d,setSelectedMedication:u,isDialogOpen:h,setIsDialogOpen:m};return i.jsx(hy.Provider,{value:p,children:e})},py=()=>{const e=n.useContext(hy);if(void 0===e)throw new Error("useMedicationsContext must be used within a MedicationsProvider");return e},fy=n.forwardRef(({className:e,...t},s)=>i.jsx(ee,{ref:s,className:Qi("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:i.jsx(te,{className:Qi("flex items-center justify-center text-current"),children:i.jsx(lo,{className:"h-4 w-4"})})}));fy.displayName=ee.displayName;const gy=({medications:e,loading:t,onCopySelected:s,onCopyAll:r})=>{const[a,o]=n.useState(new Set),l=e.length>0&&a.size===e.length,c=a.size>0;return i.jsxs(Fi,{className:"h-full",children:[i.jsx(Ui,{className:"pb-3",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(Wi,{className:"text-lg",children:""}),i.jsxs("div",{className:"flex gap-2",children:[c&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:()=>{const t=e.filter(e=>a.has(e.id));s(t),o(new Set)},className:"text-xs",children:[i.jsx(No,{className:"h-3 w-3 mr-1"})," (",a.size,")"]}),e.length>0&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:()=>{r(),o(new Set)},className:"text-xs",children:[i.jsx(No,{className:"h-3 w-3 mr-1"}),""]})]})]})}),i.jsx(zi,{className:"p-0",children:t?i.jsxs("div",{className:"p-4 space-y-2",children:[i.jsx(ny,{className:"h-4 w-full"}),i.jsx(ny,{className:"h-10 w-full"}),i.jsx(ny,{className:"h-10 w-full"}),i.jsx(ny,{className:"h-10 w-full"})]}):0===e.length?i.jsxs("div",{className:"p-6 text-center text-gray-500",children:[i.jsx("div",{className:"mb-2",children:""}),i.jsx("div",{className:"text-sm",children:" "})]}):i.jsx("div",{className:"max-h-[500px] overflow-auto",children:i.jsxs(Zx,{children:[i.jsx(Xx,{className:"sticky top-0 bg-white z-10",children:i.jsxs(ty,{children:[i.jsx(sy,{className:"w-12",children:i.jsx(fy,{checked:l,onCheckedChange:t=>{o(t?new Set(e.map(e=>e.id)):new Set)},className:c&&!l?"data-[state=indeterminate]:bg-primary":""})}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""})]})}),i.jsx(ey,{children:e.map(e=>{var t,s;return i.jsxs(ty,{className:"hover:bg-gray-50",children:[i.jsx(ry,{children:i.jsx(fy,{checked:a.has(e.id),onCheckedChange:t=>((e,t)=>{const s=new Set(a);t?s.add(e):s.delete(e),o(s)})(e.id,t)})}),i.jsx(ry,{className:"font-medium whitespace-nowrap",children:wu(e.start_date)}),i.jsx(ry,{children:i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:(null==(t=e.medication)?void 0:t.name)||""}),i.jsx("div",{className:"text-xs text-gray-500",children:(null==(s=e.medication)?void 0:s.code)||"-"})]})}),i.jsx(ry,{children:e.dosage}),i.jsx(ry,{className:"max-w-[200px] break-words text-sm",children:e.instructions||"-"})]},e.id)})})]})})})]})};var xy="Popover",[yy]=se(xy,[ae]),vy=ae(),[by,wy]=yy(xy),jy=e=>{const{__scopePopover:t,children:s,open:r,defaultOpen:a,onOpenChange:o,modal:l=!1}=e,c=vy(t),d=n.useRef(null),[u,h]=n.useState(!1),[m,p]=fe({prop:r,defaultProp:a??!1,onChange:o,caller:xy});return i.jsx(ge,{...c,children:i.jsx(by,{scope:t,contentId:xe(),triggerRef:d,open:m,onOpenChange:p,onOpenToggle:n.useCallback(()=>p(e=>!e),[p]),hasCustomAnchor:u,onCustomAnchorAdd:n.useCallback(()=>h(!0),[]),onCustomAnchorRemove:n.useCallback(()=>h(!1),[]),modal:l,children:s})})};jy.displayName=xy;var Ny="PopoverAnchor";n.forwardRef((e,t)=>{const{__scopePopover:s,...r}=e,a=wy(Ny,s),o=vy(s),{onCustomAnchorAdd:l,onCustomAnchorRemove:c}=a;return n.useEffect(()=>(l(),()=>c()),[l,c]),i.jsx(ve,{...o,...r,ref:t})}).displayName=Ny;var _y="PopoverTrigger",Sy=n.forwardRef((e,t)=>{const{__scopePopover:s,...r}=e,n=wy(_y,s),a=vy(s),o=ie(t,n.triggerRef),l=i.jsx(ye.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":Ry(n.open),...r,ref:o,onClick:de(e.onClick,n.onOpenToggle)});return n.hasCustomAnchor?l:i.jsx(ve,{asChild:!0,...a,children:l})});Sy.displayName=_y;var ky="PopoverPortal",[Cy,Ty]=yy(ky,{forceMount:void 0}),Ey=e=>{const{__scopePopover:t,forceMount:s,children:r,container:n}=e,a=wy(ky,t);return i.jsx(Cy,{scope:t,forceMount:s,children:i.jsx(re,{present:s||a.open,children:i.jsx(ne,{asChild:!0,container:n,children:r})})})};Ey.displayName=ky;var Iy="PopoverContent",Py=n.forwardRef((e,t)=>{const s=Ty(Iy,e.__scopePopover),{forceMount:r=s.forceMount,...n}=e,a=wy(Iy,e.__scopePopover);return i.jsx(re,{present:r||a.open,children:a.modal?i.jsx(Ay,{...n,ref:t}):i.jsx(Dy,{...n,ref:t})})});Py.displayName=Iy;var Oy=ce("PopoverContent.RemoveScroll"),Ay=n.forwardRef((e,t)=>{const s=wy(Iy,e.__scopePopover),r=n.useRef(null),a=ie(t,r),o=n.useRef(!1);return n.useEffect(()=>{const e=r.current;if(e)return oe(e)},[]),i.jsx(le,{as:Oy,allowPinchZoom:!0,children:i.jsx(My,{...e,ref:a,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:de(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),o.current||null==(t=s.triggerRef.current)||t.focus()}),onPointerDownOutside:de(e.onPointerDownOutside,e=>{const t=e.detail.originalEvent,s=0===t.button&&!0===t.ctrlKey,r=2===t.button||s;o.current=r},{checkForDefaultPrevented:!1}),onFocusOutside:de(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),Dy=n.forwardRef((e,t)=>{const s=wy(Iy,e.__scopePopover),r=n.useRef(!1),a=n.useRef(!1);return i.jsx(My,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var n,i;null==(n=e.onCloseAutoFocus)||n.call(e,t),t.defaultPrevented||(r.current||null==(i=s.triggerRef.current)||i.focus(),t.preventDefault()),r.current=!1,a.current=!1},onInteractOutside:t=>{var n,i;null==(n=e.onInteractOutside)||n.call(e,t),t.defaultPrevented||(r.current=!0,"pointerdown"===t.detail.originalEvent.type&&(a.current=!0));const o=t.target;(null==(i=s.triggerRef.current)?void 0:i.contains(o))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&a.current&&t.preventDefault()}})}),My=n.forwardRef((e,t)=>{const{__scopePopover:s,trapFocus:r,onOpenAutoFocus:n,onCloseAutoFocus:a,disableOutsidePointerEvents:o,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:u,...h}=e,m=wy(Iy,s),p=vy(s);return ue(),i.jsx(he,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:n,onUnmountAutoFocus:a,children:i.jsx(me,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:u,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>m.onOpenChange(!1),children:i.jsx(pe,{"data-state":Ry(m.open),role:"dialog",id:m.contentId,...p,...h,ref:t,style:{...h.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),qy="PopoverClose";n.forwardRef((e,t)=>{const{__scopePopover:s,...r}=e,n=wy(qy,s);return i.jsx(ye.button,{type:"button",...r,ref:t,onClick:de(e.onClick,()=>n.onOpenChange(!1))})}).displayName=qy;function Ry(e){return e?"open":"closed"}n.forwardRef((e,t)=>{const{__scopePopover:s,...r}=e,n=vy(s);return i.jsx(be,{...n,...r,ref:t})}).displayName="PopoverArrow";var $y=Ey,Ly=Py;const Qy=jy,Fy=Sy,Uy=n.forwardRef(({className:e,align:t="center",sideOffset:s=4,...r},n)=>i.jsx($y,{children:i.jsx(Ly,{ref:n,align:t,sideOffset:s,className:Qi("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));Uy.displayName=Ly.displayName;const Wy=({medications:e=[],selectedMedication:t,onSelectMedication:s,open:r,setOpen:a})=>{const[o,l]=n.useState(""),c=Array.isArray(e)?e:[],d=n.useMemo(()=>{if(!o.trim())return c;const e=o.toLowerCase();return c.filter(t=>t.name.toLowerCase().includes(e)||t.code.toLowerCase().includes(e))},[c,o]);return i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium",children:""}),i.jsxs(Qy,{open:r,onOpenChange:e=>{a(e),e||l("")},children:[i.jsx(Fy,{asChild:!0,children:i.jsxs(gu,{variant:"outline",role:"combobox","aria-expanded":r,className:"w-full justify-between",onClick:()=>{a(!r)},children:[(null==t?void 0:t.name)||"...",i.jsx(po,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),i.jsx(Uy,{className:"w-full p-0 bg-white border shadow-lg z-50",align:"start",children:c.length>0?i.jsxs("div",{className:"flex flex-col",children:[i.jsxs("div",{className:"flex items-center border-b px-3 py-2",children:[i.jsx(cl,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),i.jsx(Ux,{placeholder:"...",value:o,onChange:e=>{return t=e.target.value,void l(t);var t},className:"border-0 p-0 focus-visible:ring-0 focus-visible:ring-offset-0"})]}),i.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:0===d.length?i.jsx("div",{className:"py-4 text-center text-sm text-gray-500",children:""}):i.jsx("div",{className:"p-1",children:d.map(e=>i.jsxs("div",{className:"relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-gray-100 focus:bg-gray-100",onClick:()=>{(e=>{s(e),a(!1),l("")})(e)},onMouseEnter:()=>{},children:[i.jsx(lo,{className:Qi("mr-2 h-4 w-4",(null==t?void 0:t.id)===e.id?"opacity-100":"opacity-0")}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{children:e.name}),i.jsxs("span",{className:"text-xs text-gray-500",children:[e.code," | : ",e.stock," ",e.unit]})]})]},e.id))})})]}):i.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:""})})]})]})},Vy=({medications:e,availableMedications:t,checkNote:s,onCheckNoteChange:r,onAddMedication:o,onUpdateMedication:l,onRemoveMedication:c,onSaveAll:d,isLoading:u})=>{const[h,m]=n.useState(null),[p,f]=n.useState(""),[g,x]=n.useState(""),[y,v]=n.useState(""),[b,w]=n.useState(!1);return i.jsxs(Fi,{className:"h-full flex flex-col",children:[i.jsx(Ui,{className:"pb-3",children:i.jsx(Wi,{className:"text-lg",children:""})}),i.jsxs(zi,{className:"flex-1 flex flex-col space-y-4",children:[i.jsxs("div",{className:"space-y-2 p-3 border rounded-lg bg-blue-50",children:[i.jsx("label",{className:"text-sm font-medium text-blue-900",children:"/"}),i.jsx(zx,{value:s,onChange:e=>r(e.target.value),placeholder:", , ...",className:"text-sm min-h-[80px] bg-white"}),i.jsx("p",{className:"text-xs text-blue-700",children:" "})]}),i.jsxs("div",{className:"space-y-3 p-3 border rounded-lg bg-gray-50",children:[i.jsx("h4",{className:"text-sm font-medium",children:""}),i.jsx(Wy,{medications:t,selectedMedication:h,onSelectMedication:m,open:b,setOpen:w}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:""}),i.jsx(Ux,{value:p,onChange:e=>f(e.target.value),placeholder:" 500mg, 2 ",className:"text-sm"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:""}),i.jsx(Ux,{value:g,onChange:e=>x(e.target.value),placeholder:" ",className:"text-sm"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:""}),i.jsx(Ux,{value:y,onChange:e=>v(e.target.value),placeholder:" 1 (), 20 ()",className:"text-sm"}),h&&i.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[": ",h.unit]})]})]}),i.jsxs(gu,{onClick:()=>{if(!h||!p.trim())return void a.error("");if(e.some(e=>e.medication.id===h.id&&e.dosage.trim()===p.trim()))return void a.error("");const t={id:`new-${Date.now()}`,medication:h,dosage:p.trim(),instructions:g.trim(),dispensed:y};o(t),m(null),f(""),x(""),v("")},disabled:!h||!p.trim(),size:"sm",className:"w-full",children:[i.jsx(sl,{className:"w-3 h-3 mr-1"}),""]})]}),i.jsx("div",{className:"flex-1 overflow-auto border rounded-lg",children:0===e.length?i.jsx("div",{className:"flex items-center justify-center h-32 text-gray-500",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"mb-2",children:""}),i.jsx("div",{className:"text-sm",children:" "}),i.jsx("div",{className:"text-xs text-blue-600 mt-1",children:" "})]})}):i.jsxs(Zx,{children:[i.jsx(Xx,{children:i.jsxs(ty,{children:[i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{className:"w-12"})]})}),i.jsx(ey,{children:e.map(t=>i.jsxs(ty,{children:[i.jsx(ry,{children:i.jsxs("div",{children:[i.jsx("div",{className:"font-medium text-sm",children:t.medication.name}),i.jsxs("div",{className:"text-xs text-gray-500",children:[t.medication.code," | :"," ",t.medication.stock," ",t.medication.unit]})]})}),i.jsx(ry,{children:i.jsx(Ux,{value:t.dosage,onChange:s=>((t,s)=>{if(s.trim()){const r=e.find(e=>e.id===t);if(r&&e.some(e=>e.id!==t&&e.medication.id===r.medication.id&&e.dosage===s.trim()))return void a.error("");l(t,{dosage:s.trim()})}})(t.id,s.target.value),className:"text-sm h-8",placeholder:""})}),i.jsx(ry,{children:i.jsx(zx,{value:t.instructions,onChange:e=>{return s=t.id,r=e.target.value,void l(s,{instructions:r});var s,r},className:"text-sm min-h-[32px] h-8 resize-none",placeholder:""})}),i.jsx(ry,{children:i.jsx(gu,{variant:"ghost",size:"sm",onClick:()=>c(t.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:i.jsx(bl,{className:"h-3 w-3"})})})]},t.id))})]})}),e.length>0&&i.jsxs(gu,{onClick:d,disabled:u,className:"w-full bg-pharmacy-600 hover:bg-pharmacy-700",children:[i.jsx(ll,{className:"w-4 h-4 mr-2"}),u?"...":` (${e.length} )`]})]})]})},zy=({patientId:e,medications:t,patientMedications:s,loading:r,onDispenseMedication:o,onRefreshHistory:l})=>{const[c,d]=n.useState([]),[u,h]=n.useState(""),[m,p]=n.useState(!1);n.useEffect(()=>{},[e,t.length,s.length,c.length]);const f=e=>{const t=e.map(e=>({id:`copied-${e.id}-${Date.now()}-${Math.random()}`,medication:e.medication,dosage:e.dosage,instructions:e.instructions||""})),s=t.filter(e=>!c.some(t=>t.medication.id===e.medication.id&&t.dosage===e.dosage));if(s.length!==t.length){const e=t.length-s.length;a.warning(` ${s.length}  ${t.length}  (${e} )`)}else a.success(` ${s.length}  - `);d(e=>[...e,...s])};return i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 h-[600px]",children:[i.jsx(gy,{medications:s,loading:r,onCopySelected:f,onCopyAll:()=>{f(s)}}),i.jsx(Vy,{medications:c,availableMedications:t,checkNote:u,onCheckNoteChange:h,onAddMedication:e=>{c.some(t=>t.medication.id===e.medication.id&&t.dosage===e.dosage)?a.error(""):(d(t=>[...t,e]),a.success(""))},onUpdateMedication:(e,t)=>{if(t.dosage){const s=c.find(t=>t.id===e);if(s){if(c.some(r=>r.id!==e&&r.medication.id===s.medication.id&&r.dosage===t.dosage))return void a.error("")}}d(s=>s.map(s=>s.id===e?{...s,...t}:s))},onRemoveMedication:e=>{d(t=>t.filter(t=>t.id!==e)),a.success("")},onSaveAll:async()=>{if(0===c.length)return void a.error("");p(!0);let t=0,s=[],r=null;try{if(u.trim()){const{supabase:t}=await jt(async()=>{const{supabase:e}=await Promise.resolve().then(()=>$a);return{supabase:e}},void 0),{data:s,error:n}=await t.from("patient_check").insert({patient_id:e,check_note:u.trim()}).select("id").single();if(n)return a.error(""),void p(!1);r=s.id}for(const a of c){const i={patient_id:e,medication_id:a.medication.id,dosage:a.dosage,dispensed:a.dispensed?parseFloat(a.dispensed):void 0,instructions:a.instructions||void 0,start_date:Nu(),end_date:void 0,notes:void 0,patient_check_id:r||void 0};try{await o(i)?t++:s.push(a.medication.name)}catch(n){s.push(a.medication.name)}}if(t===c.length){d([]),h("");const e=u.trim()?` ${t} `:` ${t} `;a.success(e),setTimeout(()=>{l()},500)}else if(t>0){const e=s.map(e=>{var t;return null==(t=c.find(t=>t.medication.name===e))?void 0:t.medication.id}).filter(Boolean);d(t=>t.filter(t=>e.includes(t.medication.id))),a.warning(` ${t}  ${c.length} `),setTimeout(()=>{l()},500)}else a.error("")}catch(n){a.error("")}finally{p(!1)}},isLoading:m})]})},By=({patientId:e,queueId:t})=>{const[s,r]=n.useState(null),[o,l]=n.useState([]),[c,d]=n.useState(null),[u,h]=n.useState(!0),[m,p]=n.useState(!1);n.useEffect(()=>{f()},[e,t]);const f=async()=>{var s;h(!0);try{let n=null;if(t){const{data:e}=await qa.from("queues").select("appointment_id").eq("id",t).single();n=(null==e?void 0:e.appointment_id)||null}if(n){const{data:e}=await qa.from("appointments").select("*").eq("id",n).single();e&&r(e)}else{const t=(new Date).toISOString().split("T")[0],{data:s}=await qa.from("appointments").select("*").eq("patient_id",e).eq("date",t).order("created_at",{ascending:!1}).limit(1).single();s&&(r(s),n=s.id)}const a=(new Date).toISOString().split("T")[0],{data:i,error:o}=await qa.from("patient_medications").select("\n          *,\n          medication:medications(*)\n        ").eq("patient_id",e).eq("start_date",a).order("created_at",{ascending:!1});if(!o&&i){l(i);const e=null==(s=i[0])?void 0:s.patient_check_id;if(e){const{data:t}=await qa.from("patient_check").select("*").eq("id",e).single();t&&d(t)}}}catch(n){a.error("")}finally{h(!1)}};return u?i.jsxs("div",{className:"space-y-4",children:[i.jsx(ny,{className:"h-32 w-full"}),i.jsx(ny,{className:"h-48 w-full"})]}):i.jsxs("div",{className:"space-y-4",children:[s&&i.jsxs(Fi,{className:"border-blue-200 bg-blue-50",children:[i.jsx(Ui,{children:i.jsxs(Wi,{className:"text-lg flex items-center gap-2",children:[i.jsx(Co,{className:"h-5 w-5 text-blue-600"}),""]})}),i.jsxs(zi,{className:"space-y-2",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-sm text-gray-600",children:":"}),i.jsx("p",{className:"font-medium",children:wu(s.date)})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-sm text-gray-600",children:":"}),i.jsx("p",{className:"font-medium",children:s.purpose})]})]}),s.notes&&i.jsxs("div",{children:[i.jsx("span",{className:"text-sm text-gray-600",children:":"}),i.jsx("p",{className:"text-sm mt-1",children:s.notes})]})]})]}),i.jsxs(Fi,{children:[i.jsx(Ui,{children:i.jsxs(Wi,{className:"text-lg flex items-center gap-2",children:[i.jsx(tl,{className:"h-5 w-5 text-pharmacy-600"}),"",o.length>0&&i.jsxs(Lh,{variant:"secondary",className:"ml-2",children:[o.length," "]})]})}),i.jsx(zi,{children:0===o.length?i.jsxs("div",{className:"text-center py-8 text-gray-500",children:[i.jsx(fo,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),i.jsx("p",{className:"mb-1",children:""}),i.jsx("p",{className:"text-sm",children:' "" '})]}):i.jsx(i.Fragment,{children:i.jsxs(Zx,{children:[i.jsx(Xx,{children:i.jsxs(ty,{children:[i.jsx(sy,{className:"w-12",children:"#"}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""})]})}),i.jsx(ey,{children:o.map((e,t)=>{var s,r,n,a,o;return i.jsxs(ty,{children:[i.jsx(ry,{className:"font-medium",children:t+1}),i.jsx(ry,{children:i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:null==(s=e.medication)?void 0:s.name}),i.jsxs("div",{className:"text-xs text-gray-500",children:[": ",null==(r=e.medication)?void 0:r.stock," ",null==(n=e.medication)?void 0:n.unit]})]})}),i.jsx(ry,{className:"text-xs text-gray-600",children:null==(a=e.medication)?void 0:a.code}),i.jsx(ry,{children:e.dosage}),i.jsx(ry,{children:e.dispensed?i.jsxs("span",{className:"font-medium text-green-600",children:[e.dispensed," ",null==(o=e.medication)?void 0:o.unit]}):i.jsx("span",{className:"text-gray-400",children:"-"})}),i.jsx(ry,{className:"max-w-[200px]",children:e.instructions||i.jsx("span",{className:"text-gray-400",children:"-"})})]},e.id)})})]})})})]})]})},Hy=({open:e,onOpenChange:t,patient:s,queueNumber:r,queueId:a,showPharmacyTab:o=!0,mode:l="dispense",showCheckNotes:c=!0})=>{const[d,u]=n.useState([]),[h,m]=n.useState(!1),[p,f]=n.useState(null),[g,x]=n.useState({}),{medications:y,loading:v,addMedication:b,fetchMedicationHistory:w}=ly(null==s?void 0:s.id);let j,N;try{const e=py();j=e.medications,N=e.loading}catch(T){const e=uy();j=e.medications,N=e.loading}const _=async()=>{if(null==s?void 0:s.id){m(!0);try{const{data:e,error:t}=await qa.from("patient_check").select("*").eq("patient_id",s.id).order("created_at",{ascending:!1});!t&&e&&u(e)}catch(T){}finally{m(!1)}}};if(n.useEffect(()=>{e&&(null==s?void 0:s.id)?_():e||(f(null),x({}))},[e,null==s?void 0:s.id]),!s)return null;const S=Array.isArray(j)?j:[],k=Array.isArray(y)?y:[],C=()=>{(null==s?void 0:s.id)&&w(s.id)};return i.jsx(Uh,{open:e,onOpenChange:t,children:i.jsxs(Bh,{className:"max-w-7xl max-h-[90vh] overflow-y-auto",children:[i.jsx(Hh,{children:i.jsxs(Kh,{className:"flex items-center gap-2",children:[i.jsx(Cl,{className:"h-5 w-5"})," ",r&&`-  ${r}`]})}),i.jsxs(Oh,{defaultValue:"info",className:"space-y-4",children:[i.jsxs(Ah,{className:"grid w-full "+("view"===l?o?"grid-cols-3":"grid-cols-2":o?"grid-cols-4":"grid-cols-3"),children:[i.jsx(Dh,{value:"info",children:""}),i.jsx(Dh,{value:"history",children:""}),"view"!==l&&i.jsx(Dh,{value:"checks",children:""}),o&&i.jsx(Dh,{value:"dispense",children:"view"===l?"":""})]}),i.jsx(Mh,{value:"info",children:i.jsxs(Fi,{children:[i.jsx(Ui,{children:i.jsx(Wi,{children:""})}),i.jsx(zi,{className:"space-y-4",children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Cl,{className:"h-4 w-4 text-gray-500"}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm text-gray-500",children:"-"}),i.jsx("div",{className:"font-medium",children:s.name})]})]}),i.jsx("div",{className:"flex items-center gap-2",children:i.jsxs(Lh,{variant:"outline",children:[": ",s.patient_id]})}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Oo,{className:"h-4 w-4 text-gray-500"}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm text-gray-500",children:""}),i.jsx("div",{className:"font-medium",children:s.ID_card||"-"})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(el,{className:"h-4 w-4 text-gray-500"}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm text-gray-500",children:""}),i.jsx("div",{className:"font-medium",children:s.phone||"-"})]})]}),s.birth_date&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(ao,{className:"h-4 w-4 text-gray-500"}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm text-gray-500",children:""}),i.jsx("div",{className:"font-medium",children:wu(s.birth_date)})]})]}),s.gender&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(vo,{className:"h-4 w-4 text-gray-500"}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm text-gray-500",children:""}),i.jsx("div",{className:"font-medium",children:s.gender})]})]}),s.distance_from_hospital&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Go,{className:"h-4 w-4 text-gray-500"}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm text-gray-500",children:""}),i.jsxs("div",{className:"font-medium",children:[s.distance_from_hospital," "]})]})]})]}),i.jsxs("div",{className:"space-y-3",children:[s.address&&i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(Uo,{className:"h-4 w-4 text-gray-500 mt-1"}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm text-gray-500",children:""}),i.jsx("div",{className:"font-medium",children:s.address})]})]}),s.line_id&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Vo,{className:"h-4 w-4 text-gray-500"}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm text-gray-500",children:"LINE ID"}),i.jsx("div",{className:"font-medium",children:s.line_id})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(no,{className:"h-4 w-4 text-gray-500"}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm text-gray-500",children:""}),i.jsx("div",{className:"font-medium",children:wu(s.created_at)})]})]})]})]})})]})}),i.jsx(Mh,{value:"history",children:i.jsx(ay,{patientName:s.name,medications:k,loading:v,onRefresh:C,showCheckNotes:c})}),"view"!==l&&i.jsx(Mh,{value:"checks",children:i.jsxs(Fi,{children:[i.jsxs(Ui,{className:"flex flex-row items-center justify-between",children:[i.jsx(Wi,{className:"text-lg",children:"/"}),i.jsx(gu,{variant:"outline",size:"sm",onClick:_,disabled:h,children:i.jsx(al,{className:"h-4 w-4 "+(h?"animate-spin":"")})})]}),i.jsx(zi,{children:h?i.jsxs("div",{className:"space-y-2",children:[i.jsx(ny,{className:"h-6 w-full"}),i.jsx(ny,{className:"h-24 w-full"}),i.jsx(ny,{className:"h-24 w-full"})]}):0===d.length?i.jsxs("div",{className:"text-center py-8 text-gray-500",children:[i.jsx(Co,{className:"h-12 w-12 mx-auto mb-2 text-gray-400"}),i.jsx("div",{className:"mb-2",children:""}),i.jsx("div",{className:"text-sm",children:""})]}):i.jsx("div",{className:"space-y-4 max-h-[500px] overflow-auto",children:d.map(e=>{return i.jsxs("div",{className:"border rounded-lg bg-blue-50 border-blue-200",children:[i.jsxs("div",{className:"p-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Co,{className:"h-4 w-4 text-blue-600"}),i.jsx("span",{className:"text-sm font-medium text-blue-900",children:""})]}),i.jsx("span",{className:"text-xs text-gray-600",children:wu(e.created_at)})]}),i.jsx("p",{className:"text-sm whitespace-pre-wrap text-gray-700 mb-3",children:e.check_note||""}),i.jsxs(gu,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(g[e])f(p===e?null:e);else try{const{data:t,error:s}=await qa.from("patient_medications").select("\n          *,\n          medication:medications(*)\n        ").eq("patient_check_id",e).order("created_at",{ascending:!1});!s&&t&&(x(s=>({...s,[e]:t})),f(e))}catch(T){}})(e.id),className:"w-full justify-between text-blue-700 hover:text-blue-800 hover:bg-blue-100",children:[i.jsxs("span",{className:"flex items-center gap-2",children:[i.jsx(tl,{className:"h-4 w-4"}),"",g[e.id]&&i.jsx(Lh,{variant:"secondary",className:"ml-1",children:(t=e.id,(null==(s=g[t])?void 0:s.length)||0)})]}),p===e.id?i.jsx(mo,{className:"h-4 w-4"}):i.jsx(co,{className:"h-4 w-4"})]})]}),p===e.id&&g[e.id]&&i.jsx("div",{className:"border-t border-blue-200 bg-white p-4",children:0===g[e.id].length?i.jsx("p",{className:"text-sm text-gray-500 text-center py-2",children:""}):i.jsx("div",{className:"space-y-2",children:g[e.id].map((e,t)=>{var s,r,n;return i.jsxs("div",{className:"flex items-start gap-3 p-2 rounded bg-gray-50 border border-gray-200",children:[i.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-pharmacy-100 text-pharmacy-700 flex items-center justify-center text-xs font-medium",children:t+1}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-start justify-between gap-2",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium text-gray-900",children:(null==(s=e.medication)?void 0:s.name)||""}),i.jsx("p",{className:"text-xs text-gray-500",children:null==(r=e.medication)?void 0:r.code})]}),i.jsxs("div",{className:"text-right flex-shrink-0",children:[i.jsx("p",{className:"text-sm font-medium text-pharmacy-700",children:e.dosage}),e.dispensed&&i.jsxs("p",{className:"text-xs text-gray-600",children:[": ",e.dispensed," ",null==(n=e.medication)?void 0:n.unit]})]})]}),e.instructions&&i.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[" ",e.instructions]})]})]},e.id)})})})]},e.id);var t,s})})})]})}),o&&i.jsx(Mh,{value:"dispense",children:"view"===l?i.jsx(By,{patientId:s.id,queueId:a}):N?i.jsx(Fi,{children:i.jsx(zi,{className:"flex items-center justify-center py-8",children:i.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[i.jsx(Lo,{className:"h-4 w-4 animate-spin"}),"..."]})})}):i.jsx(zy,{patientId:s.id,medications:S,patientMedications:k,loading:v,onDispenseMedication:async e=>{const t=await b(e);return t&&(null==s?void 0:s.id)&&setTimeout(()=>{C(),e.patient_check_id&&_()},500),t},onRefreshHistory:C})})]})]})})},Gy=()=>{const{patients:e,loading:t,error:s,addPatient:r,updatePatient:a,searchPatients:o,fetchPatients:l}=Ha(),[c,d]=n.useState(""),[h,m]=n.useState([]),[p,f]=n.useState(!1),[g,x]=n.useState(null),[y,v]=n.useState(!1);u(),n.useEffect(()=>{(async()=>{if(""===c.trim())m(e);else{const e=await o(c);m(e)}})()},[c,e,o]);return i.jsxs("div",{className:"p-6",children:[i.jsx(Qx,{onAddPatient:()=>{x(null),f(!0)}}),i.jsx(Fx,{patients:e}),p?i.jsx(Hx,{patient:g,onSubmit:e=>{g?(async e=>{g&&await a(g.id,e)&&(f(!1),x(null))})(e):(async e=>{await r(e)&&(f(!1),l())})(e)},onCancel:()=>{f(!1),x(null)}}):i.jsx(Jx,{searchTerm:c,onSearchChange:e=>{d(e)},filteredPatients:h,loading:t,error:s,onSelectPatient:e=>{x(e),v(!0)},onEditPatient:e=>{x(e),f(!0)}}),i.jsx(Hy,{open:y,onOpenChange:e=>v(e),patient:g,showPharmacyTab:!1,showCheckNotes:!0})]})},Ky=()=>i.jsx(Gy,{}),Yy=({medications:e})=>{const t=e||[],s=t.filter(e=>e.stock<e.min_stock&&e.stock>0).length,r=t.filter(e=>e.stock>=e.min_stock).length,n=t.length>0?Math.round(r/t.length*100):0;return i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[i.jsx(Fi,{className:"dashboard-card",children:i.jsxs(zi,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:""}),i.jsx("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:t.length})]}),i.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:i.jsx(tl,{className:"w-6 h-6 text-blue-600"})})]}),i.jsx("div",{className:"mt-4",children:i.jsxs("div",{className:"text-xs text-gray-500",children:[" ",i.jsxs("span",{className:"font-medium",children:[" ",(new Date).toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit"})]})]})})]})}),i.jsx(Fi,{className:"dashboard-card",children:i.jsxs(zi,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:""}),i.jsx("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:s})]}),i.jsx("div",{className:"bg-amber-100 p-3 rounded-full",children:i.jsx(fo,{className:"w-6 h-6 text-amber-600"})})]}),i.jsx("div",{className:"mt-4",children:i.jsxs("div",{className:"text-xs text-gray-500",children:[" ",i.jsx("span",{className:"font-medium text-amber-600",children:"7 "})]})})]})}),i.jsx(Fi,{className:"dashboard-card",children:i.jsxs(zi,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:""}),i.jsx("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:r})]}),i.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:i.jsx(lo,{className:"w-6 h-6 text-green-600"})})]}),i.jsx("div",{className:"mt-4",children:i.jsxs("div",{className:"text-xs text-gray-500",children:[" ",i.jsxs("span",{className:"font-medium text-green-600",children:[n,"%"]})," "]})})]})})]})},Jy=({stock:e,minStock:t})=>{return i.jsx(Lh,{className:(s=e,r=t,s<=0?"text-red-600 bg-red-50":s<r?"text-amber-600 bg-amber-50":"text-green-600 bg-green-50"),children:((e,t)=>e<=0?"":e<t?"":"")(e,t)});var s,r},Zy=Te,Xy=Ee,ev=je,tv=n.forwardRef(({className:e,...t},s)=>i.jsx(we,{className:Qi("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:s}));tv.displayName=we.displayName;const sv=n.forwardRef(({className:e,...t},s)=>i.jsxs(ev,{children:[i.jsx(tv,{}),i.jsx(Ne,{ref:s,className:Qi("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));sv.displayName=Ne.displayName;const rv=({className:e,...t})=>i.jsx("div",{className:Qi("flex flex-col space-y-2 text-center sm:text-left",e),...t});rv.displayName="AlertDialogHeader";const nv=({className:e,...t})=>i.jsx("div",{className:Qi("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});nv.displayName="AlertDialogFooter";const av=n.forwardRef(({className:e,...t},s)=>i.jsx(_e,{ref:s,className:Qi("text-lg font-semibold",e),...t}));av.displayName=_e.displayName;const iv=n.forwardRef(({className:e,...t},s)=>i.jsx(Se,{ref:s,className:Qi("text-sm text-muted-foreground",e),...t}));iv.displayName=Se.displayName;const ov=n.forwardRef(({className:e,...t},s)=>i.jsx(ke,{ref:s,className:Qi(fu(),e),...t}));ov.displayName=ke.displayName;const lv=n.forwardRef(({className:e,...t},s)=>i.jsx(Ce,{ref:s,className:Qi(fu({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));lv.displayName=Ce.displayName;const cv=({medications:e,filterText:t,filterFunction:s,onEditMedication:r})=>{var a;const[o,l]=n.useState(null),{deleteMedication:c}=py(),d=e||[],u=s?d.filter(s):d.filter(e=>e.name.toLowerCase().includes(t.toLowerCase())||e.code.toLowerCase().includes(t.toLowerCase()));return i.jsxs(i.Fragment,{children:[i.jsxs(Zx,{children:[i.jsx(Xx,{children:i.jsxs(ty,{children:[i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""})]})}),i.jsx(ey,{children:0===u.length?i.jsx(ty,{children:i.jsx(ry,{colSpan:7,className:"text-center py-6",children:""})}):u.map(e=>i.jsxs(ty,{children:[i.jsx(ry,{children:e.image?i.jsx("img",{src:e.image,alt:e.name,className:"h-16 w-16 object-cover rounded-md border"}):null}),i.jsx(ry,{className:"font-medium",children:e.code}),i.jsx(ry,{children:e.name}),i.jsx(ry,{children:e.unit}),i.jsxs(ry,{children:[e.stock," ",e.unit]}),i.jsx(ry,{children:i.jsx(Jy,{stock:e.stock,minStock:e.min_stock})}),i.jsx(ry,{children:i.jsxs("div",{className:"flex space-x-2",children:[i.jsxs(gu,{variant:"outline",size:"sm",className:"h-8 px-2 text-xs",onClick:()=>r(e),children:[i.jsx(gl,{className:"h-3.5 w-3.5 mr-1"}),""]}),i.jsxs(gu,{variant:"outline",size:"sm",className:"h-8 px-2 text-xs text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>l(e.id),children:[i.jsx(bl,{className:"h-3.5 w-3.5 mr-1"}),""]})]})})]},e.id))})]}),i.jsx(Zy,{open:!!o,onOpenChange:e=>!e&&l(null),children:i.jsxs(sv,{children:[i.jsxs(rv,{children:[i.jsx(av,{children:""}),i.jsxs(iv,{children:[' "',o&&(null==(h=o,a=d.find(e=>e.id===h))?void 0:a.name),'"? ']})]}),i.jsxs(nv,{children:[i.jsx(lv,{children:""}),i.jsx(ov,{className:"bg-red-600 hover:bg-red-700",onClick:async()=>{o&&(await c(o),l(null))},children:""})]})]})})]});var h},dv=({medications:e,searchTerm:t,setSearchTerm:s,onEditMedication:r})=>{const n=e||[],a=n.filter(e=>e.stock<e.min_stock&&e.stock>0).length,o=n.filter(e=>e.stock<=0).length;return i.jsxs(Oh,{defaultValue:"all",className:"space-y-4",children:[i.jsxs(Ah,{children:[i.jsxs(Dh,{value:"all",children:[" (",n.length,")"]}),i.jsxs(Dh,{value:"low-stock",children:[" (",a,")"]}),i.jsxs(Dh,{value:"out-of-stock",children:[" (",o,")"]})]}),i.jsx(Mh,{value:"all",className:"animate-fade-in",children:i.jsx(Fi,{children:i.jsx(zi,{className:"p-0",children:i.jsx(cv,{medications:n,filterText:t,onEditMedication:r})})})}),i.jsx(Mh,{value:"low-stock",className:"animate-fade-in",children:i.jsx(Fi,{children:i.jsx(zi,{className:"p-0",children:i.jsx(cv,{medications:n,filterText:t,filterFunction:e=>e.stock<e.min_stock&&e.stock>0,onEditMedication:r})})})}),i.jsx(Mh,{value:"out-of-stock",className:"animate-fade-in",children:i.jsx(Fi,{children:i.jsx(zi,{className:"p-0",children:i.jsx(cv,{medications:n,filterText:t,filterFunction:e=>e.stock<=0,onEditMedication:r})})})})]})},uv=({isEditing:e,medication:t})=>i.jsx(Hh,{children:i.jsx(Kh,{children:e?"":""})}),hv=e=>{const{children:t,...s}=e;return d.createElement(dp.Provider,{value:s},t)},mv=n.createContext({}),pv=({...e})=>i.jsx(mv.Provider,{value:{name:e.name},children:i.jsx(vp,{...e})}),fv=()=>{const e=n.useContext(mv),t=n.useContext(gv),{getFieldState:s,formState:r}=up(),a=s(e.name,r);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:i}=t;return{id:i,name:e.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`,...a}},gv=n.createContext({}),xv=n.forwardRef(({className:e,...t},s)=>{const r=n.useId();return i.jsx(gv.Provider,{value:{id:r},children:i.jsx("div",{ref:s,className:Qi("space-y-2",e),...t})})});xv.displayName="FormItem";const yv=n.forwardRef(({className:e,...t},s)=>{const{error:r,formItemId:n}=fv();return i.jsx(Vx,{ref:s,className:Qi(r&&"text-destructive",e),htmlFor:n,...t})});yv.displayName="FormLabel";const vv=n.forwardRef(({...e},t)=>{const{error:s,formItemId:r,formDescriptionId:n,formMessageId:a}=fv();return i.jsx(S,{ref:t,id:r,"aria-describedby":s?`${n} ${a}`:`${n}`,"aria-invalid":!!s,...e})});vv.displayName="FormControl";const bv=n.forwardRef(({className:e,...t},s)=>{const{formDescriptionId:r}=fv();return i.jsx("p",{ref:s,id:r,className:Qi("text-sm text-muted-foreground",e),...t})});bv.displayName="FormDescription";const wv=n.forwardRef(({className:e,children:t,...s},r)=>{const{error:n,formMessageId:a}=fv(),o=n?String(null==n?void 0:n.message):t;return o?i.jsx("p",{ref:r,id:a,className:Qi("text-sm font-medium text-destructive",e),...s,children:o}):null});wv.displayName="FormMessage";const jv=Gg({code:Wg().min(1,{message:""}),name:Wg().min(1,{message:""}),description:Wg().optional(),unit:Wg().min(1,{message:""}),stock:Xg(e=>Number(e??0),Vg().min(0,{message:" 0"})),min_stock:Xg(e=>Number(e??0),Vg().min(0,{message:" 0"})),image:Kg([((e,t={message:`Input not instance of ${e.name}`})=>function(e,t={},s){return e?hg.create().superRefine((r,n)=>{const a=e(r);if(a instanceof Promise)return a.then(e=>{if(!e){const e=Qg(t,r),a=e.fatal??s??!0;n.addIssue({code:"custom",...e,fatal:a})}});if(!a){const e=Qg(t,r),a=e.fatal??s??!0;n.addIssue({code:"custom",...e,fatal:a})}}):hg.create()}(t=>t instanceof e,t))(File),Wg(),Bg()]).optional()}),Nv=({control:e})=>i.jsx(pv,{control:e,name:"code",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{...e})}),i.jsx(wv,{})]})}),_v=({control:e})=>i.jsx(pv,{control:e,name:"name",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{...e})}),i.jsx(wv,{})]})}),Sv=({control:e})=>i.jsx(pv,{control:e,name:"description",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(zx,{...e})}),i.jsx(wv,{})]})}),kv=({control:e,unitOptions:t,onAddNewUnit:s})=>{const[r,a]=n.useState(!1),[o,l]=n.useState(""),c=n.useMemo(()=>o?t.filter(e=>e.toLowerCase().includes(o.toLowerCase())):t,[t,o]);return i.jsx(pv,{control:e,name:"unit",render:({field:e})=>(n.useEffect(()=>{e.value&&l(e.value)},[e.value]),i.jsxs(xv,{className:"flex flex-col relative",children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{placeholder:"...",value:o,onChange:t=>{const s=t.target.value;l(s),e.onChange(s),a(!0)},onFocus:()=>a(!0),className:"w-full"})}),r&&i.jsx("div",{className:"absolute z-50 top-full left-0 w-full mt-1 bg-white border rounded-md shadow-lg max-h-48 overflow-y-auto",children:c.length>0?i.jsx("ul",{className:"py-1",children:c.map(t=>i.jsx("li",{className:Qi("px-3 py-2 cursor-pointer hover:bg-gray-100",e.value===t&&"bg-gray-100"),onClick:()=>{e.onChange(t),l(t),a(!1)},children:t},t))}):o?i.jsxs("div",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100",onClick:()=>{s(o),e.onChange(o),a(!1)},children:[' "',o,'"']}):i.jsx("div",{className:"px-3 py-2 text-gray-500",children:""})}),i.jsx(wv,{})]}))})},Cv=({control:e})=>i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(pv,{control:e,name:"stock",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{type:"number",...e})}),i.jsx(wv,{})]})}),i.jsx(pv,{control:e,name:"min_stock",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{type:"number",...e})}),i.jsx(wv,{})]})})]}),Tv=({control:e})=>{const[t,s]=n.useState(null),r=n.useRef(null),a=n.useId();return i.jsx(pv,{control:e,name:"image",render:({field:{value:e,onChange:o,...l}})=>{n.useEffect(()=>{"string"==typeof e&&""!==e.trim()&&s(e)},[e]);n.useEffect(()=>()=>{t&&t.startsWith("blob:")&&URL.revokeObjectURL(t)},[t]);return i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsxs("div",{className:"space-y-2",children:[i.jsx("input",{id:`medication-image-input-${a}`,type:"file",accept:"image/*",ref:r,onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];if(!r)return;o(r);const n=URL.createObjectURL(r);s(n)},className:"sr-only",name:l.name,onBlur:l.onBlur}),i.jsx("label",{htmlFor:`medication-image-input-${a}`,className:"w-full",children:i.jsxs(gu,{type:"button",variant:"outline",className:"w-full flex items-center justify-center gap-2",onClick:()=>{var e;return null==(e=r.current)?void 0:e.click()},children:[i.jsx(Ao,{className:"w-4 h-4"}),""]})}),t&&i.jsxs("div",{className:"relative mt-2",children:[i.jsx("img",{src:t,alt:"Preview",className:"w-full h-auto max-h-48 object-contain rounded-md border"}),i.jsx(gu,{type:"button",variant:"destructive",size:"icon",className:"absolute top-1 right-1 h-6 w-6",onClick:()=>{o(null),s(null),r.current&&(r.current.value="")},children:i.jsx(Pl,{className:"h-4 w-4"})})]})]})}),i.jsx(wv,{})]})}})},Ev=({medication:e,medications:t,isEditing:s,open:r,onOpenChange:o,addMedication:l,updateMedication:c})=>{const{unitOptions:d,handleAddNewUnit:u}=(e=>{const[t,s]=n.useState(""),r=n.useMemo(()=>{try{if(!e||!Array.isArray(e))return[];const t=new Set(e.filter(e=>e&&"string"==typeof e.unit).map(e=>e.unit).filter(e=>e&&e.length>0));return Array.from(t).sort()}catch(t){return[]}},[e]),i=n.useMemo(()=>t?r.filter(e=>e.toLowerCase().includes(t.toLowerCase())):r,[r,t]);return{unitOptions:r,filteredUnits:i,searchQuery:t,setSearchQuery:s,handleAddNewUnit:e=>{try{return e&&""!==e.trim()?r.includes(e.trim())?(a.error(""),!1):(a.success(` "${e}" `),!0):(a.error(""),!1)}catch(t){return a.error(""),!1}}}})(t),{form:h,submitHandler:m}=((e,t,s)=>{const r=sf({resolver:hf(jv),defaultValues:{code:"",name:"",description:"",unit:"",stock:0,min_stock:0,image:null}});return n.useEffect(()=>{s&&(e?r.reset({code:e.code,name:e.name,description:e.description||"",unit:e.unit,stock:e.stock,min_stock:e.min_stock,image:e.image??null}):r.reset({code:"",name:"",description:"",unit:"",stock:0,min_stock:0,image:null}))},[s,e,r]),{form:r,submitHandler:async e=>{const s={...e,stock:Number(e.stock)||0,min_stock:Number(e.min_stock)||0};await t(s)}}})(e,async t=>{try{s&&e?await c(e.id,t):await l(t),o(!1)}catch(r){}},r);return i.jsx(hv,{...h,children:i.jsxs("form",{onSubmit:h.handleSubmit(m),className:"space-y-4",children:[i.jsx(Nv,{control:h.control}),i.jsx(_v,{control:h.control}),i.jsx(Sv,{control:h.control}),i.jsx(kv,{control:h.control,unitOptions:d,onAddNewUnit:u}),i.jsx(Cv,{control:h.control}),i.jsx(Tv,{control:h.control}),i.jsxs(Gh,{children:[i.jsx(gu,{type:"button",variant:"outline",onClick:()=>{o(!1)},children:""}),i.jsx(gu,{type:"submit",children:""})]})]})})},Iv=({medications:e=[],medication:t,isEditing:s,open:r,onOpenChange:n,addMedication:a,updateMedication:o})=>i.jsxs(i.Fragment,{children:[i.jsx(uv,{isEditing:s,medication:t}),i.jsx(Yh,{className:"text-sm text-gray-500",children:s?` ${(null==t?void 0:t.name)||""}`:""}),i.jsx(Ev,{medication:t,isEditing:s,medications:e||[],open:r,onOpenChange:n,addMedication:a,updateMedication:o})]}),Pv=({open:e,onOpenChange:t,medication:s,medications:r,addMedication:n,updateMedication:a})=>{const o=!!s,l=r||[];return i.jsx(Uh,{open:e,onOpenChange:t,children:i.jsx(Bh,{className:"sm:max-w-[500px]",children:i.jsx(Iv,{medications:l,medication:s,isEditing:o,open:e,onOpenChange:t,addMedication:n,updateMedication:a})})})},Ov=({value:e,onChange:t,placeholder:s="..."})=>i.jsxs("div",{className:"relative flex-1 max-w-md",children:[i.jsx(cl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),i.jsx(Ux,{placeholder:s,className:"pl-10",value:e,onChange:e=>t(e.target.value)})]}),Av=()=>{const{medications:e,loading:t,addMedication:s,updateMedication:r,selectedMedication:a,setSelectedMedication:o,isDialogOpen:l,setIsDialogOpen:c}=py(),[d,u]=n.useState(""),h=e||[];return t?i.jsx("div",{className:"flex justify-center py-8",children:i.jsx("p",{children:"..."})}):i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:""}),i.jsx("p",{className:"text-gray-500",children:""})]}),i.jsx("div",{className:"flex items-center gap-2",children:i.jsxs(gu,{className:"bg-pharmacy-600 hover:bg-pharmacy-700 text-white",onClick:()=>{o(null),c(!0)},children:[i.jsx(yo,{className:"w-4 h-4 mr-2"}),""]})})]}),i.jsx(Yy,{medications:h}),i.jsx("div",{className:"flex mb-4",children:i.jsx(Ov,{value:d,onChange:u,placeholder:"..."})}),i.jsx(dv,{medications:h,searchTerm:d,setSearchTerm:u,onEditMedication:e=>{o(e),c(!0)}}),i.jsx(Pv,{open:l,onOpenChange:c,medication:a,medications:h,addMedication:s,updateMedication:r})]})},Dv=()=>i.jsx(my,{children:i.jsx(Av,{})}),Mv=Qa("ServicePointQueueTypesService"),qv=async e=>{Mv.debug(`Fetching mappings for service point: ${e}`);const{data:t,error:s}=await qa.from("service_point_queue_types").select("\n      *,\n      queue_type:queue_types(id, name, code),\n      service_point:service_points(id, name, code)\n    ").eq("service_point_id",e);if(s)throw Mv.error("Supabase error during fetch:",s),s;return Mv.debug(`Successfully fetched ${(null==t?void 0:t.length)||0} mappings:`,t),t||[]},Rv=Qa("ServicePointQueueTypesActions"),$v=e=>async(t,s)=>{try{const r=await(async(e,t)=>{Mv.debug(`Adding mapping: servicePointId=${e}, queueTypeId=${t}`);try{const{data:s,error:r}=await qa.from("service_point_queue_types").insert({service_point_id:e,queue_type_id:t}).select("*").single();if(r)throw Mv.error("Supabase error during insert:",r),"23505"===r.code?new Error(""):r;return Mv.debug("Successfully added mapping:",s),{...s,queue_type:null,service_point:null}}catch(s){throw Mv.error("Error in createServicePointQueueTypeMapping:",s),s}})(t,s);return e(e=>[...e,r]),a.success(""),r}catch(r){return Rv.error("Error adding service point queue type mapping:",r),a.error(""),null}},Lv=(e,t,s)=>async r=>{try{s(r),t(e=>{const t=e.filter(e=>e.id!==r);return Rv.debug(`Optimistically removed mapping ${r} from local state, remaining: ${t.length}`),t});const e=await(async e=>{Mv.debug(`Attempting to delete mapping with id: ${e}`);const{data:t,error:s}=await qa.from("service_point_queue_types").select("id").eq("id",e).single();if(s||!t)return Mv.warn(`Record with id ${e} does not exist in database`),!1;const{error:r,count:n}=await qa.from("service_point_queue_types").delete({count:"exact"}).eq("id",e);if(r)throw Mv.error("Supabase error during delete:",r),r;return Mv.debug(`Delete operation completed. Rows affected: ${n}`),n>0})(r);return e?(a.success(""),Rv.debug(`Successfully deleted mapping with id: ${r}`)):(a.success(""),Rv.debug(`Mapping ${r} was already removed or didn't exist in database`)),!0}catch(n){if(Rv.error("Error removing service point queue type mapping:",n),e)try{const s=await qv(e);t(()=>s)}catch(i){Rv.error("Failed to refetch mappings after deletion error:",i)}return a.error(`: ${n.message}`),!1}finally{s(null)}},Qv=()=>async e=>{try{return await(async e=>{const{data:t,error:s}=await qa.from("service_point_queue_types").select("\n      queue_type_id,\n      queue_type:queue_types(*)\n    ").eq("service_point_id",e);if(s)throw s;return(null==t?void 0:t.map(e=>e.queue_type))||[]})(e)}catch(t){return Rv.error("Error fetching queue types for service point:",t),a.error(""),[]}},Fv=()=>async e=>{try{return await(async e=>{const{data:t,error:s}=await qa.from("service_point_queue_types").select("\n      service_point_id,\n      service_point:service_points(*)\n    ").eq("queue_type_id",e);if(s)throw s;return(null==t?void 0:t.map(e=>e.service_point))||[]})(e)}catch(t){return Rv.error("Error fetching service points for queue type:",t),a.error(""),[]}},Uv=e=>{const[t,s]=n.useState([]),[r,a]=n.useState([]),[i,o]=n.useState(!1),[l,c]=n.useState(null),[d,u]=n.useState(null),h=((e,t,s,r)=>async()=>{if(!e)return t([]),void s(!1);try{s(!0),r(null);const n=await qv(e);t(n)}catch(n){Rv.error("Error fetching service point queue type mappings:",n),r(n.message||"Failed to fetch service point queue type mappings"),t([])}finally{s(!1)}})(e,s,o,c),m=async()=>{try{Rv.debug("Fetching all service point queue type mappings");const{data:e,error:t}=await qa.from("service_point_queue_types").select("\n          *,\n          queue_type:queue_types(id, name, code),\n          service_point:service_points(id, name, code)\n        ");if(t)throw Rv.error("Supabase error during fetch all mappings:",t),t;return Rv.debug(`Successfully fetched ${(null==e?void 0:e.length)||0} total mappings:`,e),e||[]}catch(e){return Rv.error("Error fetching all service point queue type mappings:",e),[]}},p=$v(s),f=Lv(e,s,u),g=Qv(),x=Fv();return n.useEffect(()=>{h()},[e]),n.useEffect(()=>{(async()=>{const e=await m();a(e)})()},[]),{mappings:t,loading:i,error:l,allMappings:r,deletingId:d,fetchMappings:h,addMapping:p,removeMapping:f,getQueueTypesForServicePoint:g,getServicePointsForQueueType:x}},Wv=Qa("useAllServicePointQueueTypes"),Vv=()=>{const[e,t]=n.useState([]),[s,r]=n.useState(!1),[a,i]=n.useState(null),o=async()=>{try{r(!0),i(null),Wv.debug("Fetching all service point queue type mappings");const e=await(async()=>{Mv.debug("Fetching all service point queue type mappings");const{data:e,error:t}=await qa.from("service_point_queue_types").select("\n      *,\n      queue_type:queue_types(id, name, code),\n      service_point:service_points(id, name, code)\n    ");if(t)throw Mv.error("Supabase error during fetch all:",t),t;return Mv.debug(`Successfully fetched ${(null==e?void 0:e.length)||0} total mappings:`,e),e||[]})();t(e),Wv.debug(`Successfully loaded ${e.length} total mappings`)}catch(e){Wv.error("Error fetching all service point queue type mappings:",e),i(e.message||"Failed to fetch service point queue type mappings"),t([])}finally{r(!1)}};return n.useEffect(()=>{o()},[]),{mappings:e,loading:s,error:a,refetch:o}},zv=Qa("useQueueRecalculation"),Bv=()=>{const{fetchQueues:e}=yh(),{allMappings:t}=Uv(),{servicePoints:s}=Wa(),{queueTypes:r}=dx();return{recalculateAllQueues:n.useCallback(async()=>{try{zv.info("Starting queue recalculation..."),a.info("...");const i=Nu(),{data:o,error:l}=await qa.from("queues").select("*").eq("status","WAITING").eq("queue_date",i);if(l)throw zv.error("Error fetching waiting queues:",l),new Error(`Database error: ${l.message}`);if(!o||0===o.length)return zv.info("No waiting queues found for recalculation"),void a.info("");const c=s.filter(e=>e.enabled);if(0===c.length)return zv.warn("No enabled service points found"),void a.warning("");zv.info(`Found ${o.length} waiting queues to process`);const d=async e=>{const s=r.find(t=>t.code===e.type);if(!s)return zv.warn(`Queue type not found for queue ${e.id}: ${e.type}`),null;const n=t.filter(e=>e.queue_type_id===s.id).map(e=>c.find(t=>t.id===e.service_point_id)).filter(Boolean);if(0===n.length)return zv.warn(`No compatible service points found for queue type: ${s.code}`),c[0];let a=n[0],o=Number.MAX_SAFE_INTEGER;for(const t of n)try{const{count:e}=await qa.from("queues").select("*",{count:"exact",head:!0}).eq("service_point_id",t.id).eq("status","WAITING").eq("queue_date",i),s=e||0;s<o&&(o=s,a=t)}catch(l){zv.warn(`Error getting queue count for service point ${t.id}:`,l)}return a},u=[];let h=0,m=0;for(const e of o)try{const t=await d(e);if(!t){zv.warn(`Could not find suitable service point for queue ${e.id}`);continue}if(!e.service_point_id||e.service_point_id!==t.id){const s=Promise.resolve(qa.from("queues").update({service_point_id:t.id}).eq("id",e.id));u.push(s),e.service_point_id?(m++,zv.debug(`Reassigning queue ${e.id} to service point ${t.id}`)):(h++,zv.debug(`Assigning queue ${e.id} to service point ${t.id}`))}}catch(n){zv.warn(`Error processing queue ${e.id}:`,n)}if(u.length>0){const e=await Promise.allSettled(u),t=e.filter(e=>"rejected"===e.status);t.length>0&&(zv.warn(`${t.length} queue updates failed`),t.forEach((e,t)=>{"rejected"===e.status&&zv.error(`Update ${t} failed:`,e.reason)}));const s=e.filter(e=>"fulfilled"===e.status).length;zv.info(`Successfully processed ${s} queue assignments (${h} new assignments, ${m} reassignments)`),h>0||m>0?a.success(` ( ${h} ,  ${m} )`):a.info(""),t.length>0&&a.warning(` (${t.length} )`)}else zv.info("All queue assignments are already optimal"),a.info("");await e()}catch(n){zv.error("Error recalculating queues:",n);const e=n instanceof Error?n.message:"";a.error(`: ${e}`)}},[t,s,r,e])}},Hv=({waitingQueuesCount:e,onCancelAll:t,isLoading:s=!1})=>{const[r,a]=n.useState(!1);return 0===e?null:i.jsxs(i.Fragment,{children:[i.jsxs(gu,{variant:"destructive",onClick:()=>a(!0),disabled:s,className:"flex items-center gap-2",children:[i.jsx(Pl,{className:"w-4 h-4"})," (",e,")"]}),i.jsx(Zy,{open:r,onOpenChange:a,children:i.jsxs(sv,{children:[i.jsxs(rv,{children:[i.jsxs(av,{className:"flex items-center gap-2",children:[i.jsx(_l,{className:"w-5 h-5 text-destructive"}),""]}),i.jsxs(iv,{children:[" ",e,"  ?",i.jsx("br",{}),i.jsx("strong",{className:"text-destructive",children:""})]})]}),i.jsxs(nv,{children:[i.jsx(lv,{children:""}),i.jsx(ov,{onClick:async()=>{await t(),a(!1)},className:"bg-destructive hover:bg-destructive/90",disabled:s,children:s?"...":""})]})]})})]})},Gv=({waitingQueuesCount:e=0,onCancelAllQueues:t,isCancellingAll:s=!1})=>{const{recalculateAllQueues:r}=Bv();return i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:""}),i.jsxs("div",{className:"flex items-center gap-2",children:[t&&i.jsx(Hv,{waitingQueuesCount:e,onCancelAll:t,isLoading:s}),i.jsxs(gu,{variant:"outline",onClick:r,className:"flex items-center gap-2",children:[i.jsx(ro,{className:"w-4 h-4"}),""]})]})]})},Kv=({activeTab:e,onTabChange:t,waitingQueues:s,activeQueues:r,completedQueues:n,skippedQueues:a,pausedQueues:o})=>i.jsx("div",{className:"border-b bg-gray-50/50 px-6 py-3",children:i.jsxs(Ah,{className:"grid w-full grid-cols-5 bg-white shadow-sm",children:[i.jsxs(Dh,{value:"waiting",className:"flex items-center gap-2 data-[state=active]:bg-orange-50 data-[state=active]:text-orange-700",children:[i.jsx(jo,{className:"w-4 h-4"}),"",i.jsx(Lh,{variant:"secondary",className:"bg-orange-100 text-orange-700",children:s.length})]}),i.jsxs(Dh,{value:"active",className:"flex items-center gap-2 data-[state=active]:bg-green-50 data-[state=active]:text-green-700",children:[i.jsx(Tl,{className:"w-4 h-4"}),"",i.jsx(Lh,{variant:"secondary",className:"bg-green-100 text-green-700",children:r.length})]}),i.jsxs(Dh,{value:"skipped",className:"flex items-center gap-2 data-[state=active]:bg-amber-50 data-[state=active]:text-amber-700",children:[i.jsx(pl,{className:"w-4 h-4"}),"",i.jsx(Lh,{variant:"secondary",className:"bg-amber-100 text-amber-700",children:a.length})]}),i.jsxs(Dh,{value:"completed",className:"flex items-center gap-2 data-[state=active]:bg-gray-50 data-[state=active]:text-gray-700",children:[i.jsx(go,{className:"w-4 h-4"}),"",i.jsx(Lh,{variant:"secondary",className:"bg-gray-100 text-gray-700",children:n.length})]})]})}),Yv=({queues:e,patients:t,getPatientById:s,status:r,getPatientName:n,onUpdateStatus:a,onCallQueue:o,onRecallQueue:l,onTransferQueue:c,onHoldQueue:d,onReturnToWaiting:u,onViewPatientInfo:h,selectedServicePoint:m,servicePoints:p,getIntelligentServicePointSuggestion:f,isPharmacyInterface:g=!1})=>i.jsx(Fi,{className:"h-full border-0 shadow-none",children:i.jsx(zi,{className:"h-full p-0",children:i.jsx(am,{queues:e,getPatientById:s,getPatientName:n,onUpdateStatus:a,onCallQueue:o,onRecallQueue:l,onTransferQueue:c,onHoldQueue:d,onReturnToWaiting:u,onViewPatientInfo:h,status:r,selectedServicePoint:m,servicePoints:p,getIntelligentServicePointSuggestion:f,showServicePointInfo:!0,isPharmacyInterface:g})})}),Jv=({waitingQueues:e,activeQueues:t,completedQueues:s,skippedQueues:r,patients:a,queueTypes:o,onUpdateStatus:l,onCallQueue:c,onRecallQueue:d,onTransferQueue:u,onHoldQueue:h,onReturnToWaiting:m,onViewPatientInfo:p,selectedServicePoint:f,servicePoints:g,getIntelligentServicePointSuggestion:x,onTransferQueueClick:y,isPharmacyInterface:v=!1,getPatientName:b})=>{const[w,j]=n.useState("waiting"),N=e.filter(e=>e.paused_at),_=e.filter(e=>!e.paused_at),S=b||(e=>{const t=a.find(t=>t.id===e);return t?t.name:"Unknown"}),k=e=>a.find(t=>t.id===e);return i.jsx("div",{className:"h-full flex flex-col "+(v?"bg-pharmacy-50":"bg-white"),children:i.jsxs(Oh,{value:w,onValueChange:j,className:"h-full flex flex-col",children:[i.jsx(Kv,{activeTab:w,onTabChange:j,waitingQueues:_,activeQueues:t,completedQueues:s,skippedQueues:r,pausedQueues:N}),i.jsxs("div",{className:"flex-1 overflow-hidden",children:[i.jsx(Mh,{value:"waiting",className:"h-full m-0",children:i.jsx(Yv,{queues:_,getPatientById:k,patients:a,status:"WAITING",getPatientName:S,onViewPatientInfo:p,selectedServicePoint:f,servicePoints:g,isPharmacyInterface:v})}),i.jsx(Mh,{value:"active",className:"h-full m-0",children:i.jsx(Yv,{queues:t,patients:a,status:"ACTIVE",getPatientById:k,getPatientName:S,onUpdateStatus:l,onRecallQueue:d,onTransferQueue:y,onHoldQueue:e=>{const s=t.find(t=>t.id===e);h&&(null==s?void 0:s.service_point_id)&&h(e,s.service_point_id)},onViewPatientInfo:p,selectedServicePoint:f,servicePoints:g,getIntelligentServicePointSuggestion:x,isPharmacyInterface:v})}),i.jsx(Mh,{value:"paused",className:"h-full m-0",children:i.jsx(Yv,{queues:N,getPatientById:k,patients:a,status:"WAITING",getPatientName:S,onUpdateStatus:l,onCallQueue:c,onReturnToWaiting:m,onViewPatientInfo:p,selectedServicePoint:f,servicePoints:g,getIntelligentServicePointSuggestion:x,isPharmacyInterface:v})}),i.jsx(Mh,{value:"skipped",className:"h-full m-0",children:i.jsx(Yv,{queues:r,getPatientById:k,patients:a,status:"SKIPPED",getPatientName:S,onUpdateStatus:l,onReturnToWaiting:m,onViewPatientInfo:p,selectedServicePoint:f,servicePoints:g,getIntelligentServicePointSuggestion:x,isPharmacyInterface:v})}),i.jsx(Mh,{value:"completed",className:"h-full m-0",children:i.jsx(Yv,{queues:s,getPatientById:k,patients:a,status:"COMPLETED",getPatientName:S,onViewPatientInfo:p,selectedServicePoint:f,servicePoints:g,getIntelligentServicePointSuggestion:x,isPharmacyInterface:v})})]})]})})};var Zv="Radio",[Xv,eb]=se(Zv),[tb,sb]=Xv(Zv),rb=n.forwardRef((e,t)=>{const{__scopeRadio:s,name:r,checked:a=!1,required:o,disabled:l,value:c="on",onCheck:d,form:u,...h}=e,[m,p]=n.useState(null),f=ie(t,e=>p(e)),g=n.useRef(!1),x=!m||(u||!!m.closest("form"));return i.jsxs(tb,{scope:s,checked:a,disabled:l,children:[i.jsx(ye.button,{type:"button",role:"radio","aria-checked":a,"data-state":ob(a),"data-disabled":l?"":void 0,disabled:l,value:c,...h,ref:f,onClick:de(e.onClick,e=>{a||null==d||d(),x&&(g.current=e.isPropagationStopped(),g.current||e.stopPropagation())})}),x&&i.jsx(ib,{control:m,bubbles:!g.current,name:r,value:c,checked:a,required:o,disabled:l,form:u,style:{transform:"translateX(-100%)"}})]})});rb.displayName=Zv;var nb="RadioIndicator",ab=n.forwardRef((e,t)=>{const{__scopeRadio:s,forceMount:r,...n}=e,a=sb(nb,s);return i.jsx(re,{present:r||a.checked,children:i.jsx(ye.span,{"data-state":ob(a.checked),"data-disabled":a.disabled?"":void 0,...n,ref:t})})});ab.displayName=nb;var ib=n.forwardRef(({__scopeRadio:e,control:t,checked:s,bubbles:r=!0,...a},o)=>{const l=n.useRef(null),c=ie(l,o),d=De(s),u=Me(t);return n.useEffect(()=>{const e=l.current;if(!e)return;const t=window.HTMLInputElement.prototype,n=Object.getOwnPropertyDescriptor(t,"checked").set;if(d!==s&&n){const t=new Event("click",{bubbles:r});n.call(e,s),e.dispatchEvent(t)}},[d,s,r]),i.jsx(ye.input,{type:"radio","aria-hidden":!0,defaultChecked:s,...a,tabIndex:-1,ref:c,style:{...a.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function ob(e){return e?"checked":"unchecked"}ib.displayName="RadioBubbleInput";var lb=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],cb="RadioGroup",[db]=se(cb,[Ie,eb]),ub=Ie(),hb=eb(),[mb,pb]=db(cb),fb=n.forwardRef((e,t)=>{const{__scopeRadioGroup:s,name:r,defaultValue:n,value:a,required:o=!1,disabled:l=!1,orientation:c,dir:d,loop:u=!0,onValueChange:h,...m}=e,p=ub(s),f=Pe(d),[g,x]=fe({prop:a,defaultProp:n??null,onChange:h,caller:cb});return i.jsx(mb,{scope:s,name:r,required:o,disabled:l,value:g,onValueChange:x,children:i.jsx(Oe,{asChild:!0,...p,orientation:c,dir:f,loop:u,children:i.jsx(ye.div,{role:"radiogroup","aria-required":o,"aria-orientation":c,"data-disabled":l?"":void 0,dir:f,...m,ref:t})})})});fb.displayName=cb;var gb="RadioGroupItem",xb=n.forwardRef((e,t)=>{const{__scopeRadioGroup:s,disabled:r,...a}=e,o=pb(gb,s),l=o.disabled||r,c=ub(s),d=hb(s),u=n.useRef(null),h=ie(t,u),m=o.value===a.value,p=n.useRef(!1);return n.useEffect(()=>{const e=e=>{lb.includes(e.key)&&(p.current=!0)},t=()=>p.current=!1;return document.addEventListener("keydown",e),document.addEventListener("keyup",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",t)}},[]),i.jsx(Ae,{asChild:!0,...c,focusable:!l,active:m,children:i.jsx(rb,{disabled:l,required:o.required,checked:m,...d,...a,name:o.name,ref:h,onCheck:()=>o.onValueChange(a.value),onKeyDown:de(e=>{"Enter"===e.key&&e.preventDefault()}),onFocus:de(a.onFocus,()=>{var e;p.current&&(null==(e=u.current)||e.click())})})})});xb.displayName=gb;var yb=n.forwardRef((e,t)=>{const{__scopeRadioGroup:s,...r}=e,n=hb(s);return i.jsx(ab,{...n,...r,ref:t})});yb.displayName="RadioGroupIndicator";var vb=fb,bb=xb,wb=yb;const jb=n.forwardRef(({className:e,...t},s)=>i.jsx(vb,{className:Qi("grid gap-2",e),...t,ref:s}));jb.displayName=vb.displayName;const Nb=n.forwardRef(({className:e,...t},s)=>i.jsx(bb,{ref:s,className:Qi("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:i.jsx(wb,{className:"flex items-center justify-center",children:i.jsx(wo,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Nb.displayName=bb.displayName;const _b=({open:e,onOpenChange:t,onTransfer:s,servicePoints:r,currentServicePointId:a})=>{const[o,l]=n.useState(""),[c,d]=n.useState(!1),u=r.filter(e=>e.id!==a&&e.enabled);return i.jsx(Uh,{open:e,onOpenChange:t,children:i.jsxs(Bh,{className:"sm:max-w-md",children:[i.jsx(Hh,{children:i.jsx(Kh,{children:""})}),i.jsx("div",{className:"py-4",children:0===u.length?i.jsx("div",{className:"text-center py-4 text-gray-500",children:""}):i.jsx(jb,{value:o,onValueChange:l,className:"space-y-3",children:u.map(e=>i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(Nb,{value:e.id,id:e.id}),i.jsxs(Vx,{htmlFor:e.id,className:"flex-1",children:[i.jsx("div",{className:"font-medium",children:e.name}),i.jsx("div",{className:"text-sm text-gray-500",children:e.code})]})]},e.id))})}),i.jsxs(Gh,{children:[i.jsx(gu,{variant:"outline",onClick:()=>t(!1),children:""}),i.jsx(gu,{onClick:async()=>{if(o){d(!0);try{await s(o),t(!1),l("")}finally{d(!1)}}},disabled:!o||c||0===u.length,className:"bg-blue-600 hover:bg-blue-700",children:c?"...":""})]})]})})},Sb=({queueToTransfer:e,transferDialogOpen:t,onOpenChange:s,servicePoints:r,queueTypes:n,onTransfer:a})=>{if(!a||!e)return null;return i.jsx(_b,{open:t,onOpenChange:s,onTransfer:async t=>{e.service_point_id&&await a(e.id,e.service_point_id,t)},servicePoints:r,currentServicePointId:e.service_point_id||""})},kb=Qa("useQueueRealtime"),Cb=(e={})=>{const{onQueueChange:t,servicePointId:s,channelName:r="queue-realtime",enabled:a=!0,debounceMs:i=500}=e,o=n.useRef(null),l=n.useRef(t),c=n.useRef(null);n.useEffect(()=>{l.current=t},[t]);const d=n.useCallback(e=>{kb.debug(`Queue change detected on channel ${r}:`,e),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{l.current&&(kb.debug(`Executing debounced queue change for channel ${r}`),l.current())},i)},[r,i]);n.useEffect(()=>{if(!a)return void kb.debug(`Real-time subscription disabled for channel: ${r}`);o.current&&(kb.debug(`Cleaning up existing channel: ${r}`),qa.removeChannel(o.current),o.current=null),kb.debug(`Setting up real-time subscription for channel: ${r}`);let e=qa.channel(r);return s?(e=e.on("postgres_changes",{event:"*",schema:"public",table:"queues",filter:`service_point_id=eq.${s}`},d),kb.debug(`Subscribed to queue changes for service point: ${s}`)):(e=e.on("postgres_changes",{event:"*",schema:"public",table:"queues"},d),kb.debug("Subscribed to all queue changes")),e.subscribe(e=>{kb.debug(`Channel ${r} subscription status:`,e),"SUBSCRIBED"===e?kb.info(`Successfully subscribed to channel: ${r}`):"CHANNEL_ERROR"===e&&kb.error(`Channel error for ${r}`)}),o.current=e,()=>{c.current&&(clearTimeout(c.current),c.current=null),o.current&&(kb.debug(`Cleaning up real-time subscription for channel: ${r}`),qa.removeChannel(o.current),o.current=null)}},[s,r,a,d]);return{cleanup:n.useCallback(()=>{c.current&&(clearTimeout(c.current),c.current=null),o.current&&(kb.debug(`Manual cleanup for channel: ${r}`),qa.removeChannel(o.current),o.current=null)},[r])}},Tb=Qa("useQueueManagement"),Eb=()=>{const{waitingQueues:e,activeQueues:t,completedQueues:s,skippedQueues:r,patients:o,queueTypes:l,selectedServicePoint:c,servicePoints:u,isCancellingAll:h,handleRecallQueue:m,handleCallQueue:p,handleTransferQueue:f,handleHoldQueue:g,handleReturnToWaiting:x,handleCancelAllQueues:y,updateQueueStatus:v,getIntelligentServicePointSuggestion:b}=(()=>{const{queues:e,allQueues:t,updateQueueStatus:s,callQueue:r,recallQueue:i,sortQueues:o,transferQueueToServicePoint:l,putQueueOnHold:c,returnSkippedQueueToWaiting:d,fetchQueues:u}=yh(),{patients:h}=Ha(),{queueTypes:m}=dx(),{selectedServicePoint:p,setSelectedServicePoint:f,servicePoints:g}=Ba(),{mappings:x}=Uv(),[y,v]=n.useState([]),[b,w]=n.useState([]),[j,N]=n.useState([]),[_,S]=n.useState([]),[k,C]=n.useState(!1);Cb({onQueueChange:n.useCallback(()=>{Tb.debug("Queue management detected real-time change, refreshing"),u(!0)},[u]),channelName:"queue-management",enabled:!0,debounceMs:150});const T=n.useMemo(()=>{if(Tb.debug("Processing mappings for service point capabilities:",x),0===x.length)return Tb.debug("No mappings found, returning empty capabilities"),[];const e={};x.forEach(t=>{e[t.service_point_id]||(e[t.service_point_id]=[]),e[t.service_point_id].push(t.queue_type_id)});const t=Object.entries(e).map(([e,t])=>({servicePointId:e,queueTypeIds:t}));return Tb.debug("Service point capabilities processed:",t),t},[x]),E=n.useCallback(e=>{if(e.service_point_id)return g.find(t=>t.id===e.service_point_id);const t=m.find(t=>t.code===e.type);if(!t)return Tb.warn(`Queue type not found for queue ${e.id}: ${e.type}`),g.find(e=>e.enabled)||null;const s=T.filter(e=>e.queueTypeIds.includes(t.id)).map(e=>g.find(t=>t.id===e.servicePointId)).filter(Boolean);return 0===s.length?(Tb.warn(`No compatible service points found for queue type ${t.code}, suggesting fallback`),g.find(e=>e.enabled)||null):s[0]||null},[g,m,T]);n.useEffect(()=>{if(Tb.debug("useEffect for queue filtering triggered"),!t)return void Tb.debug("No queues available, skipping update");const e=t.filter(e=>"WAITING"===e.status),s=t.filter(e=>"ACTIVE"===e.status),r=t.filter(e=>"COMPLETED"===e.status),n=t.filter(e=>"SKIPPED"===e.status),a=e.filter(e=>e.service_point_id),i=e.filter(e=>!e.service_point_id);if(Tb.debug("Showing all queues (no service point filtering):",{totalWaiting:e.length,assignedWaiting:a.length,unassignedWaiting:i.length,totalActive:s.length,totalCompleted:r.length,totalSkipped:n.length}),i.length>0&&Tb.info(`Found ${i.length} unassigned waiting queues`),o){const t=o(e,T);Tb.debug("Sorted all waiting queues:",{originalCount:e.length,sortedCount:t.length}),v(t)}else v(e);w(s),N(r),S(n)},[t,o,T]);const I=n.useCallback(t=>{i(t);const s=null==e?void 0:e.find(e=>e.id===t);if(s){const e=h.find(e=>e.id===s.patient_id);e?a.info(` ${s.number} - ${e.name}`):a.info(` ${s.number}`)}},[i,e,h]),P=n.useCallback(async(t,s)=>{const n=null==e?void 0:e.find(e=>e.id===t);if(!n)return a.error(""),null;let i=s;if(!i&&!n.service_point_id){const e=E(n);e&&(i=e.id,Tb.info(`Auto-assigning queue ${n.id} to suggested service point ${e.code}`))}const o=await r(t,i);if(o){const e=g.find(e=>e.id===i);a.success(` ${n.number} ${(null==e?void 0:e.name)||""}`)}return o},[e,g,E,r]),O=n.useCallback(async(e,t,s,r,n)=>{try{return!!(await l(e,t,s,r,n))&&(Tb.info("Queue transfer completed, triggering algorithm recalculation"),a.success(" "),!0)}catch(i){return Tb.error("Error in transfer queue:",i),a.error(""),!1}},[l]),A=n.useCallback(async(t,s,r)=>{try{if(await c(t,s,r)){const s=null==e?void 0:e.find(e=>e.id===t);return a.success(` ${(null==s?void 0:s.number)||""} `),!0}return!1}catch(n){return Tb.error("Error holding queue:",n),a.error(""),!1}},[c,e]),D=n.useCallback(async t=>{try{if(await d(t)){const s=null==e?void 0:e.find(e=>e.id===t);return a.success(` ${(null==s?void 0:s.number)||""} `),!0}return!1}catch(s){return Tb.error("Error returning queue to waiting:",s),a.error(""),!1}},[d,e]),M=n.useCallback(e=>{const t=g.find(t=>t.id===e);t&&(Tb.debug("Service point changed to:",t),f(t))},[g,f]),q=n.useCallback(async()=>{if(0===y.length)return void a.info("");C(!0),Tb.info(`Starting to cancel ${y.length} waiting queues`);let e=0,t=0;try{for(const n of y)try{await s(n.id,"CANCELLED")?e++:t++}catch(r){Tb.error(`Failed to cancel queue ${n.id}:`,r),t++}e===y.length?a.success(` ${e} `):e>0?a.warning(` ${e}  ${y.length}  (${t} )`):a.error(""),Tb.info(`Cancel all queues completed: ${e} success, ${t} failed`)}catch(r){Tb.error("Error during cancel all queues operation:",r),a.error("")}finally{C(!1)}},[y,s]);return{waitingQueues:y,activeQueues:b,completedQueues:j,skippedQueues:_,patients:h,queueTypes:m,selectedServicePoint:p,servicePoints:g,servicePointCapabilities:T,isCancellingAll:k,handleRecallQueue:I,handleCallQueue:P,handleTransferQueue:O,handleHoldQueue:A,handleReturnToWaiting:D,handleServicePointChange:M,handleCancelAllQueues:q,updateQueueStatus:s,getIntelligentServicePointSuggestion:E}})(),[w,j]=d.useState(!1),[N,_]=d.useState(null),[S,k]=d.useState(!1),[C,T]=d.useState(null);return Cb({onQueueChange:d.useCallback(()=>{window.location.reload()},[]),channelName:"queue-management-realtime",enabled:!0,debounceMs:200}),i.jsxs("div",{className:"h-full flex flex-col bg-gray-50",children:[i.jsx("div",{className:"bg-white border-b shadow-sm",children:i.jsxs("div",{className:"px-6 py-4",children:[i.jsx("div",{className:"flex items-center justify-between mb-2",children:i.jsx(Gv,{waitingQueuesCount:e.length,onCancelAllQueues:y,isCancellingAll:h})}),i.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),i.jsx("span",{children:""})]}),i.jsx("span",{className:"text-gray-400",children:""}),i.jsx("span",{children:""})]})]})}),i.jsx("div",{className:"flex-1 overflow-hidden",children:i.jsx(Jv,{waitingQueues:e,activeQueues:t,completedQueues:s,skippedQueues:r,patients:o,queueTypes:l,onUpdateStatus:v,onCallQueue:p,onRecallQueue:m,onTransferQueue:f,onHoldQueue:g,onReturnToWaiting:x,onViewPatientInfo:e=>{const t=o.find(t=>t.id===e);t&&(_(t),j(!0))},selectedServicePoint:c,servicePoints:u,getIntelligentServicePointSuggestion:b,onTransferQueueClick:e=>{const s=t.find(t=>t.id===e);s&&(T(s),k(!0))}})}),i.jsx(Hy,{open:w,onOpenChange:j,patient:N,mode:"view",showCheckNotes:!1}),i.jsx(Sb,{queueToTransfer:C,transferDialogOpen:S,onOpenChange:k,servicePoints:u,queueTypes:l,onTransfer:f})]})},Ib=()=>i.jsx(Eb,{}),Pb=({activeQueues:e,findPatient:t,findServicePoint:s})=>{const r=n.useRef(new Map),a=n.useRef([]),o=n.useRef(new Set),l=n.useRef(!1),c=e=>{const r=t(e.patient_id);!r||r.name;const n=s(e.service_point_id??null),a=n?n.name:"";return[` ${$u(e.type,e.number)}`,a?` ${a}`:""].filter(Boolean)};return n.useEffect(()=>{const t=e.filter(e=>!!e.called_at).filter(e=>r.current.get(e.id)!==e.called_at);if(0!==t.length){t.sort((e,t)=>e.number-t.number);for(const e of t){const t=`${e.id}:${e.called_at}`;e.called_at&&!o.current.has(t)&&(o.current.add(t),a.current.push({id:e.id,called_at:e.called_at,chunks:c(e)}))}(async()=>{if(!l.current){l.current=!0;try{for(;a.current.length>0;){const t=a.current.shift();try{const r=e.find(e=>e.id===t.id);if(r){const e=s(r.service_point_id??null);await Uu(r.number,e||{name:" "},r.type)}}finally{r.current.set(t.id,t.called_at),await new Promise(e=>setTimeout(e,250))}}}finally{l.current=!1}}})()}},[e,t,s]),n.useEffect(()=>()=>{Du()},[]),i.jsxs("div",{className:"lg:col-span-12 space-y-6",children:[i.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:""}),0===e.length?i.jsx(Fi,{className:"bg-white border border-gray-200",children:i.jsx(zi,{className:"p-8 flex flex-col items-center justify-center min-h-[200px]",children:i.jsx("p",{className:"text-gray-500 text-lg",children:""})})}):i.jsx("div",{className:"space-y-4",children:e.map(e=>{const r=t(e.patient_id);!r||r.name;const n=s(e.service_point_id),a=n?n.name:"";return i.jsx(Fi,{className:"bg-white border-2 border-pharmacy-200 shadow-lg animate-pulse-gentle",children:i.jsx(zi,{className:"p-8",children:i.jsxs("div",{className:"flex flex-col items-center text-center",children:[i.jsx("div",{className:"text-sm font-medium text-pharmacy-700 mb-1",children:""}),i.jsx("div",{className:"queue-number text-8xl font-bold text-pharmacy-600 mb-4",children:$u(e.type,e.number)}),i.jsx("div",{className:"text-sm text-gray-500",children:a})]})})},e.id)})})]})},Ob=({waitingQueues:e,findPatient:t})=>i.jsxs("div",{className:"lg:col-span-6 space-y-6",children:[i.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:""}),0===e.length?i.jsx(Fi,{className:"bg-white border border-gray-200",children:i.jsx(zi,{className:"p-6 flex items-center justify-center min-h-[200px]",children:i.jsx("p",{className:"text-gray-500",children:""})})}):i.jsx(Fi,{className:"bg-white border border-gray-200",children:i.jsx(zi,{className:"p-0",children:i.jsx("div",{className:"divide-y divide-gray-100",children:e.map((e,s)=>{const r=t(e.patient_id);return!r||r.name,i.jsx("div",{className:"p-4 flex items-center justify-between "+(0===s?"bg-blue-50":""),children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center mr-3 "+(0===s?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:$u(e.type,e.number)}),i.jsx("div",{className:"text-sm",children:i.jsxs("div",{className:"text-xs text-gray-500",children:[" ",5*(s+1)," "]})})]})},e.id)})})})})]}),Ab=({completedQueues:e,findPatient:t})=>i.jsxs("div",{className:"lg:col-span-6 space-y-6",children:[i.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:""}),i.jsx(Fi,{className:"bg-white border border-gray-200",children:i.jsx(zi,{className:"p-0",children:i.jsx("div",{className:"divide-y divide-gray-100",children:0===e.length?i.jsx("div",{className:"p-6 flex items-center justify-center min-h-[200px]",children:i.jsx("p",{className:"text-gray-500",children:""})}):e.map(e=>{const s=t(e.patient_id);return!s||s.name,i.jsx("div",{className:"p-4 flex items-center justify-between",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 text-gray-700 flex items-center justify-center mr-3",children:$u(e.type,e.number)}),i.jsx("div",{className:"text-sm",children:i.jsxs("div",{className:"text-xs text-gray-500",children:[""," ",e.completed_at&&new Date(e.completed_at).toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit",hour12:!1})]})})]})},e.id)})})})})]}),Db=({activeQueues:e,waitingQueues:t,completedQueues:s,findPatient:r,findServicePoint:n})=>i.jsx("main",{className:"container mx-auto p-6",children:i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[i.jsx(Pb,{activeQueues:e,findPatient:r,findServicePoint:n}),i.jsx(Ob,{waitingQueues:t,findPatient:r}),i.jsx(Ab,{completedQueues:s,findPatient:r})]})}),Mb=Qa("QueueBoard"),qb="ACTIVE",Rb="WAITING",$b="COMPLETED",Lb=()=>{Mb.debug("Rendering QueueBoardContainer");const{getQueuesByStatus:e,sortQueues:t}=yh(),{patients:s}=Ha(),{servicePoints:r}=Wa(),[o,l]=n.useState([]),[c,d]=n.useState([]),[u,h]=n.useState([]);n.useEffect(()=>{const s=async()=>{try{const s=await e(qb);l(s);const r=await e(Rb),n=t(r);d(n.slice(0,5));const a=(await e($b)).filter(e=>Su(e.completed_at,e.queue_date));h(a.sort((e,t)=>new Date(t.completed_at||t.updated_at).getTime()-new Date(e.completed_at||e.updated_at).getTime()).slice(0,5)),Mb.info(`Fetched queues - Active: ${s.length}, Waiting: ${r.length}, Completed today: ${a.length}`)}catch(s){Mb.error("Error fetching queues:",s),a.error("")}};s();const r=qa.channel("queue-changes").on("postgres_changes",{event:"*",schema:"public",table:"queues"},e=>{Mb.debug("Queue change detected:",e),s()}).subscribe(),n=setInterval(s,3e4);return()=>{clearInterval(n),qa.removeChannel(r)}},[e,t]);return i.jsx(Db,{activeQueues:o,waitingQueues:c,completedQueues:u,findPatient:e=>s.find(t=>t.id===e),findServicePoint:e=>e?r.find(t=>t.id===e):null})},Qb=({currentTime:e,soundEnabled:t,setSoundEnabled:s,title:r})=>{return n.useEffect(()=>{const e=localStorage.getItem("queue_voice_enabled");null!==e&&s("true"===e)},[s]),i.jsx("header",{className:"bg-white border-b border-gray-200 shadow-sm",children:i.jsx("div",{className:"container mx-auto p-4",children:i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("div",{className:"flex items-center",children:i.jsx("h1",{className:"text-2xl font-bold text-pharmacy-800",children:r})}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-3xl font-bold text-pharmacy-700",children:(o=e,o.toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}))}),i.jsx("div",{className:"text-sm text-gray-500",children:(e=>e.toLocaleDateString("th-TH",{weekday:"long",year:"numeric",month:"long",day:"numeric"}))(e)})]}),i.jsx(gu,{variant:"ghost",size:"icon",onClick:()=>{const e=!t;s(e),localStorage.setItem("queue_voice_enabled",String(e)),a.info(e?"":"")},className:"ml-2",children:t?i.jsx(El,{className:"h-5 w-5 text-pharmacy-600"}):i.jsx(Il,{className:"h-5 w-5 text-gray-400"})})]})]})})});var o},Fb=({algorithmName:e})=>i.jsx("div",{className:"bg-white shadow-md py-2",children:i.jsx("div",{className:"container mx-auto px-6",children:i.jsx("p",{className:"text-center text-sm text-gray-600",children:i.jsx("span",{className:"font-semibold",children:e})})})}),Ub=()=>{const[e,t]=n.useState({hospital_name:"",hospital_address:" 7    44130",hospital_phone:"",hospital_website:""});return n.useEffect(()=>{(async()=>{try{const{data:s,error:r}=await qa.from("settings").select("key, value").eq("category","general").in("key",["hospital_name","hospital_address","hospital_phone","hospital_website"]);if(r)return;if(s&&s.length>0){const r={};s.forEach(t=>{t.key in e&&(r[t.key]=t.value)}),t(e=>({...e,...r}))}}catch(s){}})()},[]),i.jsxs("footer",{className:"mt-8 p-6 bg-white rounded-lg border border-gray-200 text-center",children:[i.jsx("h3",{className:"text-xl font-bold text-pharmacy-800 mb-2",children:e.hospital_name}),i.jsx("p",{className:"text-gray-600",children:e.hospital_address}),(e.hospital_phone||e.hospital_website)&&i.jsxs("p",{className:"text-gray-600 mt-1",children:[e.hospital_phone&&`. ${e.hospital_phone}`,e.hospital_phone&&e.hospital_website&&" | ",e.hospital_website&&`: ${e.hospital_website}`]})]})},Wb=()=>{const[e,t]=n.useState(new Date),[s,r]=n.useState(!0),[a,o]=n.useState(ph.FIFO);n.useEffect(()=>{const e=setInterval(()=>{t(new Date)},1e3);return()=>clearInterval(e)},[]),n.useEffect(()=>{const e=localStorage.getItem("queue_algorithm");e&&o(e)},[]);return i.jsxs("div",{className:"min-h-screen bg-pharmacy-50 flex flex-col",children:[i.jsx(Qb,{currentTime:e,soundEnabled:s,setSoundEnabled:r,title:""}),i.jsx(Fb,{algorithmName:(()=>{switch(a){case ph.FIFO:return"First In, First Out (FIFO)";case ph.PRIORITY:return" (Priority Queue)";case ph.MULTILEVEL:return" (Multilevel Queue)";case ph.MULTILEVEL_FEEDBACK:return" (Multilevel Feedback)";default:return""}})()}),i.jsx("div",{className:"flex-1",children:i.jsx(Lb,{})}),i.jsx("div",{className:"mt-auto",children:i.jsx(Ub,{})})]})},Vb=Qa("useInsQueueCore"),zb=Qa("servicePointInsUtils"),Bb=Qa("useInsQueueCoreActions"),Hb=(e,t,s)=>{const{sendSmsToNextQueueIns:r}=ih();return{callQueue:n.useCallback(async(n,i)=>{try{const l=e.find(e=>e.id===n);if(!l)return a.error(" INS "),null;let c=i;!c&&l.service_point_id&&(c=l.service_point_id);const d={status:"ACTIVE",called_at:(new Date).toISOString()};c&&(d.service_point_id=c);const{data:u,error:h}=await qa.from("queues_ins").update(d).eq("id",n).select().single();if(h)return Bb.error("Error calling INS queue:",h),a.error(" INS "),null;if(u){if(t(u),s){const e=c?await(async e=>{try{const{data:t,error:s}=await qa.from("service_points_ins").select("*").eq("id",e).single();return s?(zb.error("Error fetching INS service point:",s),null):t}catch(h){return zb.error("Error in getServicePointInsById:",h),null}})(c):null;await Uu(l.number,e||{code:"",name:" "},l.type)}try{await r()}catch(o){Bb.error("SMS notification error (non-blocking):",o)}return a.success(` INS  ${l.number} `),u}return null}catch(l){return Bb.error("Error in callQueue INS:",l),a.error(" INS"),null}},[e,t,s,r]),returnSkippedQueueToWaiting:n.useCallback(async e=>{try{const{data:s,error:r}=await qa.from("queues_ins").update({status:"WAITING",skipped_at:null}).eq("id",e).select().single();return r?(Bb.error("Error returning skipped INS queue to waiting:",r),a.error(" INS "),null):s?(t(s),a.success(" INS "),s):null}catch(s){return Bb.error("Error in returnSkippedQueueToWaiting INS:",s),a.error(" INS "),null}},[t])}},Gb=Qa("useInsQueueTransferActions"),Kb=Qa("useInsServicePointActions"),Yb=Qa("useInsQueueActions"),Jb=(e,t,s,r,i,o)=>{const{callQueue:l,returnSkippedQueueToWaiting:c}=Hb(e,s,o),{transferQueueToServicePoint:d,putQueueOnHold:u}=(e=>({transferQueueToServicePoint:n.useCallback(async(t,s,r,n,i)=>{try{const s={service_point_id:r,transferred_at:(new Date).toISOString()};i&&(s.type=i);const{data:n,error:o}=await qa.from("queues_ins").update(s).eq("id",t).select().single();return o?(Gb.error("Error transferring INS queue:",o),a.error(" INS "),null):n?(e(n),a.success(" INS "),n):null}catch(o){return Gb.error("Error in transferQueueToServicePoint INS:",o),a.error(" INS"),null}},[e]),putQueueOnHold:n.useCallback(async(t,s,r)=>{try{const s={status:"WAITING",paused_at:(new Date).toISOString()},{data:r,error:n}=await qa.from("queues_ins").update(s).eq("id",t).select().single();return n?(Gb.error("Error putting INS queue on hold:",n),a.error(" INS "),null):r?(e(r),a.success(" INS "),r):null}catch(n){return Gb.error("Error in putQueueOnHold INS:",n),a.error(" INS"),null}},[e])}))(s),{getIntelligentServicePointSuggestion:h,getNextQueueToCall:m}=(e=>({getIntelligentServicePointSuggestion:n.useCallback(async e=>{try{const{data:e,error:t}=await qa.from("service_points_ins").select("*").eq("enabled",!0);return t?(Kb.error("Error fetching INS service points:",t),null):e&&e.length>0?e[0]:null}catch(t){return Kb.error("Error in getIntelligentServicePointSuggestion INS:",t),null}},[]),getNextQueueToCall:n.useCallback(async t=>{try{const s=e.filter(e=>"WAITING"===e.status&&(e.service_point_id===t||!e.service_point_id));return 0===s.length?null:s[0]||null}catch(s){return Kb.error("Error getting next INS queue:",s),null}},[e])}))(e);return{callQueue:n.useCallback(async(t,s)=>{try{const r=e.find(e=>e.id===t);if(!r)return a.error(" INS "),null;let n=s;if(n||r.service_point_id)r.service_point_id&&(n=r.service_point_id);else{const e=await h(r.type);e&&(n=e.id)}return await l(t,n)}catch(r){return Yb.error("Error in enhanced callQueue INS:",r),a.error(" INS"),null}},[e,l,h]),getNextQueueToCall:m,transferQueueToServicePoint:d,putQueueOnHold:u,returnSkippedQueueToWaiting:c,getIntelligentServicePointSuggestion:h}},Zb=Qa("useInsQueues"),Xb=()=>{Zb.debug("INS Queues Hook initialized");const{queues:e,allQueues:t,loading:s,error:r,fetchQueues:i,addQueue:o,updateQueueStatus:d,removeQueue:u,getQueuesByStatus:h,updateQueueInState:m,allQueuesNofilter:p}=(()=>{const[e,t]=n.useState(!1),[s,r]=n.useState(null),i=l(),{data:o=[],isLoading:d}=c({queryKey:["queues_ins"],queryFn:async()=>{const{data:e,error:t}=await qa.from("queues_ins").select("*").eq("queue_date",Nu()).order("created_at",{ascending:!0});if(t)throw Vb.error("Error fetching INS queues:",t),t;return e||[]},refetchInterval:5e3}),{data:u=[]}=c({queryKey:["allQueuesInsNofilter"],queryFn:async()=>{const{data:e,error:t}=await qa.from("queues_ins").select("*").order("created_at",{ascending:!0});if(t)throw Vb.error("Error fetching all INS queues:",t),t;return e||[]},refetchInterval:5e3}),{data:h=[]}=c({queryKey:["queues_ins_all"],queryFn:async()=>{const{data:e,error:t}=await qa.from("queues_ins").select("*").eq("queue_date",Nu()).order("created_at",{ascending:!0});if(t)throw Vb.error("Error fetching all INS queues:",t),t;return e||[]},refetchInterval:5e3}),m=n.useCallback(async(e=!1)=>{t(!0);try{await Promise.all([i.invalidateQueries({queryKey:["queues_ins"]}),i.invalidateQueries({queryKey:["queues_ins_all"]})]),e&&await Promise.all([i.refetchQueries({queryKey:["queues_ins"]}),i.refetchQueries({queryKey:["queues_ins_all"]})])}catch(s){Vb.error("Error fetching INS queues:",s),r("Failed to fetch INS queues")}finally{t(!1)}},[i]),p=n.useCallback(async e=>{try{const t={number:e.number,type:e.type||"GENERAL",status:e.status||"WAITING",service_point_id:e.service_point_id,phone_number:e.phone_number,ID_card:e.ID_card,queue_date:e.queue_date||Nu()},{data:s,error:r}=await qa.from("queues_ins").insert(t).select().single();return r?(Vb.error("Error adding INS queue:",r),a.error(" INS "),null):s?(await m(),a.success(" INS "),s):null}catch(t){return Vb.error("Error in addQueue INS:",t),a.error(" INS"),null}},[m]),f=n.useCallback(async(e,t)=>{try{const s={status:t};"ACTIVE"===t?s.called_at=(new Date).toISOString():"COMPLETED"===t?s.completed_at=(new Date).toISOString():"SKIPPED"===t?s.skipped_at=(new Date).toISOString():"CANCELLED"===t&&(s.cancelled_at=(new Date).toISOString());const{data:r,error:n}=await qa.from("queues_ins").update(s).eq("id",e).select().single();return n?(Vb.error("Error updating INS queue status:",n),a.error(" INS "),null):r?(await m(),r):null}catch(s){return Vb.error("Error in updateQueueStatus INS:",s),a.error(" INS"),null}},[m]),g=n.useCallback(async e=>{try{const{error:t}=await qa.from("queues_ins").delete().eq("id",e);return t?(Vb.error("Error removing INS queue:",t),a.error(" INS "),!1):(await m(),a.success(" INS "),!0)}catch(t){return Vb.error("Error in removeQueue INS:",t),a.error(" INS"),!1}},[m]),x=n.useCallback(e=>{i.setQueryData(["queues_ins"],(t=[])=>t.map(t=>t.id===e.id?e:t))},[i]),y=n.useCallback(e=>o.filter(t=>t.status===e),[o]);return n.useEffect(()=>{t(!!d)},[d]),{queues:o,loading:e||d,error:s,fetchQueues:m,addQueue:p,updateQueueStatus:f,removeQueue:g,getQueuesByStatus:y,updateQueueInState:x,allQueues:h,allQueuesNofilter:u}})(),{voiceEnabled:f,setVoiceEnabled:g,counterName:x,setCounterName:y,updateQueueSettings:v,recallQueue:b,callQueue:w,getNextQueueToCall:j,transferQueueToServicePoint:N,putQueueOnHold:_,returnSkippedQueueToWaiting:S}=((e,t,s)=>{const{voiceEnabled:r,setVoiceEnabled:a,counterName:i,setCounterName:o,updateQueueSettings:l,recallQueue:c}=hh(),d=n.useCallback(t=>c(t,t=>e.find(e=>e.id===t)),[e,c]),{callQueue:u,getNextQueueToCall:h,transferQueueToServicePoint:m,putQueueOnHold:p,returnSkippedQueueToWaiting:f}=Jb(e,0,s,0,0,r);return{voiceEnabled:r,setVoiceEnabled:a,counterName:i,setCounterName:o,updateQueueSettings:l,recallQueue:d,callQueue:u,getNextQueueToCall:h,transferQueueToServicePoint:m,putQueueOnHold:p,returnSkippedQueueToWaiting:f}})(e,0,m);return{queues:e,allQueues:t,allQueuesNofilter:p,loading:s,error:r,fetchQueues:i,addQueue:o,updateQueueStatus:d,removeQueue:u,getQueuesByStatus:h,callQueue:w,recallQueue:b,voiceEnabled:f,setVoiceEnabled:g,counterName:x,setCounterName:y,updateQueueSettings:v,getNextQueueToCall:j,transferQueueToServicePoint:N,putQueueOnHold:_,returnSkippedQueueToWaiting:S}},ew=()=>{const[e,t]=n.useState([]),[s,r]=n.useState(null),[a,i]=n.useState(!0),[o,l]=n.useState(null);return n.useEffect(()=>{(async()=>{try{i(!0);const{data:e,error:n}=await qa.from("service_points_ins").select("*").eq("enabled",!0).order("name",{ascending:!0});if(n)throw new Error(n.message);t(e||[]),e&&e.length>0&&!s&&r(e[0])}catch(e){l(e)}finally{i(!1)}})()},[]),{servicePoints:e,selectedServicePoint:s,setSelectedServicePoint:r,loading:a,error:o}},tw=({activeQueues:e,findServicePoint:t})=>{const s=n.useRef(new Map),r=n.useRef([]),a=n.useRef(new Set),o=n.useRef(!1),l=e=>{const s=t(e.service_point_id??null),r=s?s.name:"";return[` ${Zu(e.type,e.number)}`,r?` ${r}`:""].filter(Boolean)};return n.useEffect(()=>{const n=e.filter(e=>!!e.called_at).filter(e=>s.current.get(e.id)!==e.called_at);if(0!==n.length){n.sort((e,t)=>e.number-t.number);for(const e of n){const t=`${e.id}:${e.called_at}`;e.called_at&&!a.current.has(t)&&(a.current.add(t),r.current.push({id:e.id,called_at:e.called_at,chunks:l(e)}))}(async()=>{if(!o.current){o.current=!0;try{for(;r.current.length>0;){const n=r.current.shift();try{const s=e.find(e=>e.id===n.id);if(s){const e=t(s.service_point_id??null);await Uu(s.number,e||{name:" "},s.type)}}finally{s.current.set(n.id,n.called_at),await new Promise(e=>setTimeout(e,250))}}}finally{o.current=!1}}})()}},[e,t]),n.useEffect(()=>()=>{Du()},[]),i.jsxs("div",{className:"lg:col-span-12 space-y-6",children:[i.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:""}),0===e.length?i.jsx(Fi,{className:"bg-white border border-gray-200",children:i.jsx(zi,{className:"p-8 flex flex-col items-center justify-center min-h-[200px]",children:i.jsx("p",{className:"text-gray-500 text-lg",children:""})})}):i.jsx("div",{className:"space-y-4",children:e.map(e=>{const s=t(e.service_point_id),r=s?s.name:"";return i.jsx(Fi,{className:"bg-white border-2 border-pharmacy-200 shadow-lg animate-pulse-gentle",children:i.jsx(zi,{className:"p-8",children:i.jsxs("div",{className:"flex flex-col items-center text-center",children:[i.jsx("div",{className:"text-sm font-medium text-pharmacy-700 mb-1",children:""}),i.jsx("div",{className:"queue-number text-8xl font-bold text-pharmacy-600 mb-4",children:Zu(e.type,e.number)}),i.jsx("div",{className:"text-sm text-gray-500",children:r})]})})},e.id)})})]})},sw=({waitingQueues:e})=>i.jsxs("div",{className:"lg:col-span-6 space-y-6",children:[i.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:""}),0===e.length?i.jsx(Fi,{className:"bg-white border border-gray-200",children:i.jsx(zi,{className:"p-6 flex items-center justify-center min-h-[200px]",children:i.jsx("p",{className:"text-gray-500",children:""})})}):i.jsx(Fi,{className:"bg-white border border-gray-200",children:i.jsx(zi,{className:"p-0",children:i.jsx("div",{className:"divide-y divide-gray-100",children:e.map((e,t)=>i.jsx("div",{className:"p-4 flex items-center justify-between "+(0===t?"bg-blue-50":""),children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center mr-3 "+(0===t?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:Zu(e.type,e.number)}),i.jsx("div",{className:"text-sm",children:i.jsxs("div",{className:"text-xs text-gray-500",children:[" ",5*(t+1)," "]})})]})},e.id))})})})]}),rw=({completedQueues:e})=>i.jsxs("div",{className:"lg:col-span-6 space-y-6",children:[i.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:""}),i.jsx(Fi,{className:"bg-white border border-gray-200",children:i.jsx(zi,{className:"p-0",children:i.jsx("div",{className:"divide-y divide-gray-100",children:0===e.length?i.jsx("div",{className:"p-6 flex items-center justify-center min-h-[200px]",children:i.jsx("p",{className:"text-gray-500",children:""})}):e.map(e=>i.jsx("div",{className:"p-4 flex items-center justify-between",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 text-gray-700 flex items-center justify-center mr-3",children:Zu(e.type,e.number)}),i.jsx("div",{className:"text-sm",children:i.jsxs("div",{className:"text-xs text-gray-500",children:[""," ",e.completed_at&&new Date(e.completed_at).toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit",hour12:!1})]})})]})},e.id))})})})]}),nw=({activeQueues:e,waitingQueues:t,completedQueues:s,findServicePoint:r})=>i.jsx("main",{className:"container mx-auto p-6",children:i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[i.jsx(tw,{activeQueues:e,findServicePoint:r}),i.jsx(sw,{waitingQueues:t}),i.jsx(rw,{completedQueues:s})]})}),aw=Qa("QueueInsBoard"),iw="ACTIVE",ow="WAITING",lw="COMPLETED",cw=()=>{aw.debug("Rendering QueueInsBoardContainer");const{getQueuesByStatus:e}=Xb(),{servicePoints:t}=ew(),[s,r]=n.useState([]),[o,l]=n.useState([]),[c,d]=n.useState([]);n.useEffect(()=>{let t=!0,s=!1;const n=async()=>{if(!s&&t){s=!0;try{const s=await e(iw);t&&r(s);const n=await e(ow);t&&l(n.slice(0,5));const a=await e(lw);if(t){const e=a.filter(e=>Su(e.completed_at,e.queue_date));d(e.sort((e,t)=>new Date(t.completed_at||t.updated_at).getTime()-new Date(e.completed_at||e.updated_at).getTime()).slice(0,5)),aw.info(`Fetched INS queues - Active: ${s.length}, Waiting: ${n.length}, Completed today: ${e.length}`)}}catch(n){t&&(aw.error("Error fetching INS queues:",n),a.error(" INS "))}finally{s=!1}}},i=setTimeout(()=>{n()},100);let o=null;const c=qa.channel("queue-changes").on("postgres_changes",{event:"*",schema:"public",table:"queues_ins"},e=>{aw.debug("INS Queue change detected:",e),o&&clearTimeout(o),o=setTimeout(()=>{n()},500)}).subscribe(e=>{aw.debug(`Subscription status: ${e}`)}),u=setInterval(()=>{s||n()},3e4);return()=>{t=!1,clearTimeout(i),o&&clearTimeout(o),clearInterval(u),qa.removeChannel(c)}},[e]);return i.jsx(nw,{activeQueues:s,waitingQueues:o,completedQueues:c,findServicePoint:e=>e?t.find(t=>t.id===e):null})},dw=()=>{const[e,t]=n.useState(new Date),[s,r]=n.useState(!0);return n.useEffect(()=>{const e=setInterval(()=>{t(new Date)},1e3);return()=>clearInterval(e)},[]),i.jsxs("div",{className:"min-h-screen bg-pharmacy-50 flex flex-col",children:[i.jsx(Qb,{currentTime:e,soundEnabled:s,setSoundEnabled:r,title:""}),i.jsx("div",{className:"flex-1",children:i.jsx(cw,{})}),i.jsx("div",{className:"mt-auto",children:i.jsx(Ub,{})})]})},uw=()=>{const[e,t]=n.useState(new Date),[s,r]=n.useState(!0),[a,o]=n.useState(ph.FIFO);return n.useEffect(()=>{const e=setInterval(()=>{t(new Date)},1e3);return()=>clearInterval(e)},[]),n.useEffect(()=>{const e=localStorage.getItem("queue_algorithm");e&&o(e)},[]),i.jsxs("div",{className:"min-h-screen bg-pharmacy-50 flex flex-col",children:[i.jsx(Qb,{currentTime:e,soundEnabled:s,setSoundEnabled:r,title:""}),i.jsxs("div",{className:"flex flex-col md:flex-row flex-1 w-full",children:[i.jsx("div",{className:"w-full md:w-1/2 p-2",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 h-full",children:[i.jsx("h2",{className:"text-xl font-semibold text-center mb-4 text-pharmacy-700",children:""}),i.jsx("div",{className:"h-[calc(100%-2rem)] overflow-auto",children:i.jsx(cw,{})})]})}),i.jsx("div",{className:"w-full md:w-1/2 border-r border-gray-200 p-2",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 h-full",children:[i.jsx("h2",{className:"text-xl font-semibold text-center mb-4 text-pharmacy-700",children:""}),i.jsx("div",{className:"h-[calc(100%-2rem)] overflow-auto",children:i.jsx(Lb,{})})]})})]}),i.jsx("div",{className:"mt-auto",children:i.jsx(Ub,{})})]})},hw=Qa("SettingsTabs"),mw=({children:e})=>(hw.debug("Rendering settings tabs"),i.jsxs(Oh,{defaultValue:"general",className:"w-full",children:[i.jsxs(Ah,{className:"grid grid-cols-4 mb-8",children:[i.jsx(Dh,{value:"general",children:""}),i.jsx(Dh,{value:"queue",children:""}),i.jsx(Dh,{value:"sms",children:"SMS"}),i.jsx(Dh,{value:"line",children:"LINE"})]}),e]})),pw=()=>i.jsx("div",{className:"flex justify-between items-center mb-6",children:i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:""}),i.jsx("p",{className:"text-gray-500",children:""})]})}),fw=()=>i.jsx("div",{className:"flex items-center justify-center h-96",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin w-10 h-10 border-4 border-gray-300 border-t-pharmacy-600 rounded-full mx-auto mb-4"}),i.jsx("p",{className:"text-gray-600",children:"..."})]})}),gw=({form:e})=>{const{updateMultipleSettings:t}=bx(),s=async s=>{try{e.setValue("queue_algorithm",s);await t({queue_algorithm:s})?(localStorage.setItem("queue_algorithm",s),a.success("")):(a.error(""),e.setValue("queue_algorithm",e.getValues("queue_algorithm")))}catch(r){a.error(""),e.setValue("queue_algorithm",e.getValues("queue_algorithm"))}};return i.jsx("div",{className:"space-y-6",children:i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-1 gap-6",children:i.jsx(pv,{control:e.control,name:"queue_algorithm",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsxs(Jh,{onValueChange:s,value:e.value,children:[i.jsx(vv,{children:i.jsx(Xh,{className:"w-full",children:i.jsx(Zh,{placeholder:""})})}),i.jsx(sm,{children:tx.map(e=>i.jsx(rm,{value:e.value,children:i.jsxs("div",{children:[i.jsx("div",{children:e.label}),i.jsx("div",{className:"text-xs text-gray-500",children:e.description})]})},e.value))})]}),i.jsx(bv,{children:"  ()"}),i.jsx(wv,{})]})})})})},xw=({children:e})=>i.jsx("div",{className:"p-4 border rounded-lg bg-white shadow-sm",children:e}),yw=({queueType:e,onEditQueueType:t,onRemoveQueueType:s,onDuplicateQueueType:r,isProcessing:n})=>{return i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"flex flex-col space-y-2",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"font-medium text-lg",children:e.name}),i.jsx(Lh,{variant:"outline",className:"ml-2",children:e.code})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsxs(gu,{variant:"ghost",size:"icon",onClick:r,disabled:n,children:[i.jsx(No,{className:"h-4 w-4"}),i.jsx("span",{className:"sr-only",children:"Duplicate"})]}),i.jsxs(gu,{variant:"ghost",size:"icon",onClick:t,disabled:n,children:[i.jsx(Jo,{className:"h-4 w-4"}),i.jsx("span",{className:"sr-only",children:"Edit"})]}),i.jsxs(gu,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-700",onClick:s,disabled:n,children:[i.jsx(wl,{className:"h-4 w-4"}),i.jsx("span",{className:"sr-only",children:"Delete"})]})]})]})}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium text-gray-700",children:"Prefix:"})," ",e.prefix]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium text-gray-700",children:":"})," ",(a=ox(e.format),{0:" (0-9)","00":" (00-99)","000":" (000-999)"}[a]||a)]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium text-gray-700",children:":"})," ",e.purpose]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm pt-1 border-t border-gray-100",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium text-gray-700",children:":"})," ",(e=>{if(!e)return"First In, First Out (FIFO)";const t=tx.find(t=>t.value===e);return t?t.label:"First In, First Out (FIFO)"})(e.algorithm)]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium text-gray-700",children:":"}),i.jsx(Lh,{className:`ml-2 ${(e=>{const t=e||5;return t>=8?"bg-red-100 text-red-800":t>=4?"bg-amber-100 text-amber-800":"bg-blue-100 text-blue-800"})(e.priority)}`,children:(e=>{const t=e||5;return t>=8?"":t>=4?"":""})(e.priority)})]})]})]});var a},vw=({index:e,format:t,formatOptions:s,onChange:r})=>i.jsx("div",{className:"space-y-2",children:s.map(s=>i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{type:"radio",id:`queueType_${e}_format_${s.value}`,name:`queueType_${e}_format`,className:"mr-2",checked:t===s.value,onChange:()=>r(s.value)}),i.jsxs("label",{htmlFor:`queueType_${e}_format_${s.value}`,className:"text-sm",children:[s.label,i.jsxs("div",{className:"text-xs text-gray-500",children:[": ",s.example]})]})]},s.value))}),bw=n.forwardRef(({className:e,...t},s)=>i.jsxs(qe,{ref:s,className:Qi("relative flex w-full touch-none select-none items-center",e),...t,children:[i.jsx(Re,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:i.jsx($e,{className:"absolute h-full bg-primary"})}),i.jsx(Le,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));bw.displayName=qe.displayName;const ww=({queueType:e,index:t,formatOptions:s,onSaveQueueType:r,onCancelEdit:n,onQueueTypeChange:a,isProcessing:o})=>i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:`queueType_${t}_code`,children:""}),i.jsx(Ux,{id:`queueType_${t}_code`,value:e.code,onChange:e=>a(t,"code",e.target.value),placeholder:" GENERAL, PRIORITY"})]}),i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:`queueType_${t}_name`,children:""}),i.jsx(Ux,{id:`queueType_${t}_name`,value:e.name,onChange:e=>a(t,"name",e.target.value),placeholder:" , "})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:`queueType_${t}_prefix`,children:"Prefix"}),i.jsx(Ux,{id:`queueType_${t}_prefix`,value:e.prefix,onChange:e=>a(t,"prefix",e.target.value),placeholder:" A, B, C"})]}),i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:`queueType_${t}_purpose`,children:""}),i.jsx(Ux,{id:`queueType_${t}_purpose`,value:e.purpose,onChange:e=>a(t,"purpose",e.target.value),placeholder:" , "})]})]}),i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:`queueType_${t}_format`,children:""}),i.jsx(vw,{index:t,format:ox(e.format),formatOptions:s,onChange:e=>a(t,"format",e)})]}),i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:`queueType_${t}_algorithm`,children:""}),i.jsxs(Jh,{value:e.algorithm||"FIFO",onValueChange:e=>a(t,"algorithm",e),children:[i.jsx(Xh,{id:`queueType_${t}_algorithm`,className:"w-full",children:i.jsx(Zh,{placeholder:""})}),i.jsx(sm,{children:tx.map(e=>i.jsx(rm,{value:e.value,children:i.jsxs("div",{children:[i.jsx("div",{children:e.label}),i.jsx("div",{className:"text-xs text-gray-500",children:e.description})]})},e.value))})]})]}),i.jsxs("div",{children:[i.jsx("div",{className:"flex justify-between",children:i.jsxs(Vx,{htmlFor:`queueType_${t}_priority`,children:[" (",e.priority||5,"/10)"]})}),i.jsx(bw,{id:`queueType_${t}_priority`,min:1,max:10,step:1,value:[e.priority||5],onValueChange:([e])=>a(t,"priority",e),className:"py-4"}),i.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[i.jsx("span",{children:""}),i.jsx("span",{children:""}),i.jsx("span",{children:""})]})]}),i.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[i.jsxs(gu,{variant:"outline",size:"sm",onClick:n,disabled:o,children:[i.jsx(Pl,{className:"h-4 w-4 mr-1"}),""]}),i.jsxs(gu,{size:"sm",className:"bg-pharmacy-600 hover:bg-pharmacy-700",onClick:r,disabled:o,children:[i.jsx(lo,{className:"h-4 w-4 mr-1"}),""]})]})]}),jw=n.forwardRef(({className:e,...t},s)=>i.jsx(Qe,{className:Qi("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...t,ref:s,children:i.jsx(Fe,{className:Qi("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));jw.displayName=Qe.displayName;const Nw=({open:e,onOpenChange:t,queueType:s,formatOptions:r,onSave:a})=>{const[o,l]=n.useState({id:"",code:"",name:"",prefix:"",purpose:"",format:"0",enabled:!0,algorithm:ph.FIFO,priority:5}),c=!!s;n.useEffect(()=>{l(s||{id:gx(),code:"",name:"",prefix:"",purpose:"",format:"0",enabled:!0,algorithm:ph.FIFO,priority:5})},[s,e]);const d=(e,t)=>{l(s=>({...s,[e]:t}))};return i.jsx(Uh,{open:e,onOpenChange:t,children:i.jsxs(Bh,{className:"sm:max-w-[425px]",children:[i.jsxs(Hh,{children:[i.jsx(Kh,{children:c?"":""}),i.jsx(Yh,{children:""})]}),i.jsxs("div",{className:"grid gap-4 py-4",children:[i.jsxs("div",{className:"grid gap-2",children:[i.jsx(Vx,{htmlFor:"code",children:""}),i.jsx(Ux,{id:"code",value:o.code,onChange:e=>d("code",e.target.value),placeholder:" GENERAL, PRIORITY"})]}),i.jsxs("div",{className:"grid gap-2",children:[i.jsx(Vx,{htmlFor:"name",children:""}),i.jsx(Ux,{id:"name",value:o.name,onChange:e=>d("name",e.target.value),placeholder:" , "})]}),i.jsxs("div",{className:"grid gap-2",children:[i.jsx(Vx,{htmlFor:"prefix",children:""}),i.jsx(Ux,{id:"prefix",value:o.prefix,onChange:e=>d("prefix",e.target.value),placeholder:" A, B, P"})]}),i.jsxs("div",{className:"grid gap-2",children:[i.jsx(Vx,{htmlFor:"purpose",children:""}),i.jsx(Ux,{id:"purpose",value:o.purpose||"",onChange:e=>d("purpose",e.target.value),placeholder:" "})]}),i.jsxs("div",{className:"grid gap-2",children:[i.jsx(Vx,{htmlFor:"format",children:""}),i.jsxs(Jh,{value:o.format,onValueChange:e=>d("format",e),children:[i.jsx(Xh,{children:i.jsx(Zh,{})}),i.jsx(sm,{children:r.map(e=>i.jsx(rm,{value:e.value,children:e.label},e.value))})]})]}),i.jsxs("div",{className:"grid gap-2",children:[i.jsx(Vx,{htmlFor:"algorithm",children:""}),i.jsxs(Jh,{value:o.algorithm,onValueChange:e=>d("algorithm",e),children:[i.jsx(Xh,{children:i.jsx(Zh,{})}),i.jsx(sm,{children:tx.map(e=>i.jsx(rm,{value:e.value,children:e.label},e.value))})]})]}),i.jsxs("div",{className:"grid gap-2",children:[i.jsx(Vx,{htmlFor:"priority",children:" (1-10)"}),i.jsx(Ux,{id:"priority",type:"number",min:"1",max:"10",value:o.priority,onChange:e=>d("priority",parseInt(e.target.value)||5)})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(jw,{id:"enabled",checked:o.enabled,onCheckedChange:e=>d("enabled",e)}),i.jsx(Vx,{htmlFor:"enabled",children:""})]})]}),i.jsxs(Gh,{children:[i.jsx(gu,{variant:"outline",onClick:()=>t(!1),children:""}),i.jsx(gu,{onClick:()=>{o.code&&o.name&&o.prefix&&(a(o),t(!1))},children:c?"":""})]})]})})},_w=({queueTypes:e,editingQueueType:t,formatOptions:s,onAddQueueType:r,onRemoveQueueType:o,onEditQueueType:l,onSaveQueueType:c,onCancelEdit:d,onDuplicateQueueType:u,onQueueTypeChange:h})=>{const[m,p]=n.useState(!1),[f,g]=n.useState(!1),[x,y]=n.useState(null),{queueTypes:v,saveQueueType:b,deleteQueueType:w,fetchQueueTypes:j}=ax(),N=v.length>0?v:e;return i.jsxs(i.Fragment,{children:[i.jsxs(Fi,{children:[i.jsxs(Ui,{children:[i.jsx(Wi,{children:""}),i.jsx(Vi,{children:""})]}),i.jsxs(zi,{className:"space-y-4",children:[i.jsx("div",{className:"grid gap-4",children:N.filter(e=>"INS"!==e.purpose).map((e,r)=>i.jsx(xw,{children:t===e.id?i.jsx(ww,{queueType:e,index:r,formatOptions:s,onQueueTypeChange:h,onSaveQueueType:()=>(async e=>{try{p(!0);const t=N[e];await b(t)&&(c(e),a.success(` ${t.name} `))}catch(t){a.error("")}finally{p(!1)}})(r),onCancelEdit:()=>d(r),isProcessing:m}):i.jsx(yw,{queueType:e,onEditQueueType:()=>(e=>{y(e),g(!0)})(e),onRemoveQueueType:()=>(async e=>{try{const t=N[e];t.id&&"NEW"!==t.id?(p(!0),await w(t.id)&&a.success(` ${t.name} `)):o(e)}catch(t){a.error("")}finally{p(!1)}})(r),onDuplicateQueueType:()=>(async e=>{try{const t=N[e],s={...t,id:crypto.randomUUID(),code:`${t.code}_COPY`,name:`${t.name} ()`};await b(s)&&(await j(),a.success(` ${t.name} `))}catch(t){a.error("")}})(r),isProcessing:m})},e.id||r))}),i.jsxs(gu,{variant:"outline",className:"w-full",onClick:()=>{y(null),g(!0)},disabled:m,children:[i.jsx(sl,{className:"h-4 w-4 mr-2"}),""]})]})]}),i.jsx(Nw,{open:f,onOpenChange:g,queueType:x,formatOptions:s,onSave:async e=>{try{p(!0);await b(e)&&(await j(),a.success(` ${e.name} `),g(!1))}catch(t){a.error("")}finally{p(!1)}}})]})},Sw=({form:e,editingQueueType:t,setEditingQueueType:s,newQueueType:r,setNewQueueType:n,formatOptions:a,handleAddQueueType:o,handleRemoveQueueType:l,handleEditQueueType:c,handleSaveQueueType:d,handleCancelEdit:u,handleDuplicateQueueType:h,handleQueueTypeChange:m})=>{const p=e.watch("queue_types");return i.jsx(i.Fragment,{children:i.jsxs(Fi,{children:[i.jsxs(Ui,{children:[i.jsx(Wi,{children:""}),i.jsx(Vi,{children:""})]}),i.jsxs(zi,{className:"space-y-6",children:[i.jsx(gw,{form:e}),i.jsx(_w,{queueTypes:p,editingQueueType:t,formatOptions:a,onAddQueueType:o,onRemoveQueueType:l,onEditQueueType:c,onSaveQueueType:d,onCancelEdit:u,onDuplicateQueueType:h,onQueueTypeChange:m})]})]})})},kw=({form:e})=>{const{updateMultipleSettings:t}=nx("general");return i.jsxs(Fi,{children:[i.jsxs(Ui,{children:[i.jsx(Wi,{children:""}),i.jsx(Vi,{children:""})]}),i.jsxs(zi,{className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsx(pv,{control:e.control,name:"hospital_name",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsxs("div",{className:"relative",children:[i.jsx(so,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),i.jsx(Ux,{className:"pl-10",...e})]})}),i.jsx(wv,{})]})}),i.jsx(pv,{control:e.control,name:"pharmacy_name",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsxs("div",{className:"relative",children:[i.jsx(so,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),i.jsx(Ux,{className:"pl-10",...e})]})}),i.jsx(wv,{})]})})]}),i.jsx(pv,{control:e.control,name:"hospital_address",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(zx,{...e})}),i.jsx(wv,{})]})}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsx(pv,{control:e.control,name:"hospital_phone",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsxs("div",{className:"relative",children:[i.jsx(el,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),i.jsx(Ux,{className:"pl-10",...e})]})}),i.jsx(wv,{})]})}),i.jsx(pv,{control:e.control,name:"hospital_website",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsxs("div",{className:"relative",children:[i.jsx(To,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),i.jsx(Ux,{className:"pl-10",...e})]})}),i.jsx(wv,{})]})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsx(pv,{control:e.control,name:"pharmacy_phone",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsxs("div",{className:"relative",children:[i.jsx(el,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),i.jsx(Ux,{className:"pl-10",...e})]})}),i.jsx(wv,{})]})}),i.jsx(pv,{control:e.control,name:"pharmacy_email",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsxs("div",{className:"relative",children:[i.jsx(Fo,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),i.jsx(Ux,{className:"pl-10",...e})]})}),i.jsx(wv,{})]})})]}),i.jsx("div",{className:"flex justify-end pt-4",children:i.jsx(gu,{type:"button",onClick:async()=>{const s=e.getValues();try{const e=[{category:"general",key:"hospital_name",value:s.hospital_name},{category:"general",key:"hospital_address",value:s.hospital_address},{category:"general",key:"hospital_phone",value:s.hospital_phone||""},{category:"general",key:"hospital_website",value:s.hospital_website||""},{category:"general",key:"pharmacy_name",value:s.pharmacy_name},{category:"general",key:"pharmacy_phone",value:s.pharmacy_phone||""},{category:"general",key:"pharmacy_email",value:s.pharmacy_email||""}];await t(e,"general")&&a.success("")}catch(r){a.error("")}},className:"bg-pharmacy-600 hover:bg-pharmacy-700",children:""})})]})]})};var[Cw]=se("Tooltip",[ae]),Tw=ae(),Ew="TooltipProvider",Iw=700,Pw="tooltip.open",[Ow,Aw]=Cw(Ew),Dw=e=>{const{__scopeTooltip:t,delayDuration:s=Iw,skipDelayDuration:r=300,disableHoverableContent:a=!1,children:o}=e,l=n.useRef(!0),c=n.useRef(!1),d=n.useRef(0);return n.useEffect(()=>{const e=d.current;return()=>window.clearTimeout(e)},[]),i.jsx(Ow,{scope:t,isOpenDelayedRef:l,delayDuration:s,onOpen:n.useCallback(()=>{window.clearTimeout(d.current),l.current=!1},[]),onClose:n.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(()=>l.current=!0,r)},[r]),isPointerInTransitRef:c,onPointerInTransitChange:n.useCallback(e=>{c.current=e},[]),disableHoverableContent:a,children:o})};Dw.displayName=Ew;var Mw="Tooltip",[qw,Rw]=Cw(Mw),$w=e=>{const{__scopeTooltip:t,children:s,open:r,defaultOpen:a,onOpenChange:o,disableHoverableContent:l,delayDuration:c}=e,d=Aw(Mw,e.__scopeTooltip),u=Tw(t),[h,m]=n.useState(null),p=xe(),f=n.useRef(0),g=l??d.disableHoverableContent,x=c??d.delayDuration,y=n.useRef(!1),[v,b]=fe({prop:r,defaultProp:a??!1,onChange:e=>{e?(d.onOpen(),document.dispatchEvent(new CustomEvent(Pw))):d.onClose(),null==o||o(e)},caller:Mw}),w=n.useMemo(()=>v?y.current?"delayed-open":"instant-open":"closed",[v]),j=n.useCallback(()=>{window.clearTimeout(f.current),f.current=0,y.current=!1,b(!0)},[b]),N=n.useCallback(()=>{window.clearTimeout(f.current),f.current=0,b(!1)},[b]),_=n.useCallback(()=>{window.clearTimeout(f.current),f.current=window.setTimeout(()=>{y.current=!0,b(!0),f.current=0},x)},[x,b]);return n.useEffect(()=>()=>{f.current&&(window.clearTimeout(f.current),f.current=0)},[]),i.jsx(ge,{...u,children:i.jsx(qw,{scope:t,contentId:p,open:v,stateAttribute:w,trigger:h,onTriggerChange:m,onTriggerEnter:n.useCallback(()=>{d.isOpenDelayedRef.current?_():j()},[d.isOpenDelayedRef,_,j]),onTriggerLeave:n.useCallback(()=>{g?N():(window.clearTimeout(f.current),f.current=0)},[N,g]),onOpen:j,onClose:N,disableHoverableContent:g,children:s})})};$w.displayName=Mw;var Lw="TooltipTrigger",Qw=n.forwardRef((e,t)=>{const{__scopeTooltip:s,...r}=e,a=Rw(Lw,s),o=Aw(Lw,s),l=Tw(s),c=n.useRef(null),d=ie(t,c,a.onTriggerChange),u=n.useRef(!1),h=n.useRef(!1),m=n.useCallback(()=>u.current=!1,[]);return n.useEffect(()=>()=>document.removeEventListener("pointerup",m),[m]),i.jsx(ve,{asChild:!0,...l,children:i.jsx(ye.button,{"aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute,...r,ref:d,onPointerMove:de(e.onPointerMove,e=>{"touch"!==e.pointerType&&(h.current||o.isPointerInTransitRef.current||(a.onTriggerEnter(),h.current=!0))}),onPointerLeave:de(e.onPointerLeave,()=>{a.onTriggerLeave(),h.current=!1}),onPointerDown:de(e.onPointerDown,()=>{a.open&&a.onClose(),u.current=!0,document.addEventListener("pointerup",m,{once:!0})}),onFocus:de(e.onFocus,()=>{u.current||a.onOpen()}),onBlur:de(e.onBlur,a.onClose),onClick:de(e.onClick,a.onClose)})})});Qw.displayName=Lw;var[Fw,Uw]=Cw("TooltipPortal",{forceMount:void 0}),Ww="TooltipContent",Vw=n.forwardRef((e,t)=>{const s=Uw(Ww,e.__scopeTooltip),{forceMount:r=s.forceMount,side:n="top",...a}=e,o=Rw(Ww,e.__scopeTooltip);return i.jsx(re,{present:r||o.open,children:o.disableHoverableContent?i.jsx(Kw,{side:n,...a,ref:t}):i.jsx(zw,{side:n,...a,ref:t})})}),zw=n.forwardRef((e,t)=>{const s=Rw(Ww,e.__scopeTooltip),r=Aw(Ww,e.__scopeTooltip),a=n.useRef(null),o=ie(t,a),[l,c]=n.useState(null),{trigger:d,onClose:u}=s,h=a.current,{onPointerInTransitChange:m}=r,p=n.useCallback(()=>{c(null),m(!1)},[m]),f=n.useCallback((e,t)=>{const s=e.currentTarget,r={x:e.clientX,y:e.clientY},n=function(e,t,s=5){const r=[];switch(t){case"top":r.push({x:e.x-s,y:e.y+s},{x:e.x+s,y:e.y+s});break;case"bottom":r.push({x:e.x-s,y:e.y-s},{x:e.x+s,y:e.y-s});break;case"left":r.push({x:e.x+s,y:e.y-s},{x:e.x+s,y:e.y+s});break;case"right":r.push({x:e.x-s,y:e.y-s},{x:e.x-s,y:e.y+s})}return r}(r,function(e,t){const s=Math.abs(t.top-e.y),r=Math.abs(t.bottom-e.y),n=Math.abs(t.right-e.x),a=Math.abs(t.left-e.x);switch(Math.min(s,r,n,a)){case a:return"left";case n:return"right";case s:return"top";case r:return"bottom";default:throw new Error("unreachable")}}(r,s.getBoundingClientRect())),a=function(e){const t=e.slice();return t.sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0),function(e){if(e.length<=1)return e.slice();const t=[];for(let r=0;r<e.length;r++){const s=e[r];for(;t.length>=2;){const e=t[t.length-1],r=t[t.length-2];if(!((e.x-r.x)*(s.y-r.y)>=(e.y-r.y)*(s.x-r.x)))break;t.pop()}t.push(s)}t.pop();const s=[];for(let r=e.length-1;r>=0;r--){const t=e[r];for(;s.length>=2;){const e=s[s.length-1],r=s[s.length-2];if(!((e.x-r.x)*(t.y-r.y)>=(e.y-r.y)*(t.x-r.x)))break;s.pop()}s.push(t)}return s.pop(),1===t.length&&1===s.length&&t[0].x===s[0].x&&t[0].y===s[0].y?t:t.concat(s)}(t)}([...n,...function(e){const{top:t,right:s,bottom:r,left:n}=e;return[{x:n,y:t},{x:s,y:t},{x:s,y:r},{x:n,y:r}]}(t.getBoundingClientRect())]);c(a),m(!0)},[m]);return n.useEffect(()=>()=>p(),[p]),n.useEffect(()=>{if(d&&h){const e=e=>f(e,h),t=e=>f(e,d);return d.addEventListener("pointerleave",e),h.addEventListener("pointerleave",t),()=>{d.removeEventListener("pointerleave",e),h.removeEventListener("pointerleave",t)}}},[d,h,f,p]),n.useEffect(()=>{if(l){const e=e=>{const t=e.target,s={x:e.clientX,y:e.clientY},r=(null==d?void 0:d.contains(t))||(null==h?void 0:h.contains(t)),n=!function(e,t){const{x:s,y:r}=e;let n=!1;for(let a=0,i=t.length-1;a<t.length;i=a++){const e=t[a],o=t[i],l=e.x,c=e.y,d=o.x,u=o.y;c>r!=u>r&&s<(d-l)*(r-c)/(u-c)+l&&(n=!n)}return n}(s,l);r?p():n&&(p(),u())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[d,h,l,u,p]),i.jsx(Kw,{...e,ref:o})}),[Bw,Hw]=Cw(Mw,{isInside:!1}),Gw=Ue("TooltipContent"),Kw=n.forwardRef((e,t)=>{const{__scopeTooltip:s,children:r,"aria-label":a,onEscapeKeyDown:o,onPointerDownOutside:l,...c}=e,d=Rw(Ww,s),u=Tw(s),{onClose:h}=d;return n.useEffect(()=>(document.addEventListener(Pw,h),()=>document.removeEventListener(Pw,h)),[h]),n.useEffect(()=>{if(d.trigger){const e=e=>{const t=e.target;(null==t?void 0:t.contains(d.trigger))&&h()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[d.trigger,h]),i.jsx(me,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:l,onFocusOutside:e=>e.preventDefault(),onDismiss:h,children:i.jsxs(pe,{"data-state":d.stateAttribute,...u,...c,ref:t,style:{...c.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[i.jsx(Gw,{children:r}),i.jsx(Bw,{scope:s,isInside:!0,children:i.jsx(We,{id:d.contentId,role:"tooltip",children:a||r})})]})})});Vw.displayName=Ww;var Yw="TooltipArrow";n.forwardRef((e,t)=>{const{__scopeTooltip:s,...r}=e,n=Tw(s);return Hw(Yw,s).isInside?null:i.jsx(be,{...n,...r,ref:t})}).displayName=Yw;var Jw=Vw;const Zw=Dw,Xw=$w,ej=Qw,tj=n.forwardRef(({className:e,sideOffset:t=4,...s},r)=>i.jsx(Jw,{ref:r,sideOffset:t,className:Qi("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s}));tj.displayName=Jw.displayName;const sj=({lineSettings:e,isEditing:t,handleChange:s,errors:r={}})=>i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"text-lg font-medium",children:"LINE Messaging API Settings"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx(yv,{children:"Channel ID (Messaging API)"}),i.jsx(Zw,{children:i.jsxs(Xw,{children:[i.jsx(ej,{asChild:!0,children:i.jsx(fo,{className:"h-4 w-4 text-gray-400 ml-2 cursor-help"})}),i.jsx(tj,{children:i.jsx("p",{className:"w-56 text-xs",children:"Channel ID  LINE Developer Console  Channel  Messaging API"})})]})})]}),i.jsx(Ux,{value:e.channelId,onChange:e=>s("channelId",e.target.value),disabled:!t,className:t?r.channelId?"border-red-500":"":"bg-gray-50"}),t&&r.channelId&&i.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.channelId})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx(yv,{children:"Channel Secret (Messaging API)"}),i.jsx(Zw,{children:i.jsxs(Xw,{children:[i.jsx(ej,{asChild:!0,children:i.jsx(fo,{className:"h-4 w-4 text-gray-400 ml-2 cursor-help"})}),i.jsx(tj,{children:i.jsx("p",{className:"w-56 text-xs",children:"Channel Secret  LINE Developer Console  Basic settings  Messaging API"})})]})})]}),i.jsx(Ux,{value:t?e.channelSecret:"",onChange:e=>s("channelSecret",e.target.value),type:t?"text":"password",disabled:!t,className:t?r.channelSecret?"border-red-500":"":"bg-gray-50"}),t&&r.channelSecret&&i.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.channelSecret})]})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx(yv,{children:"Access Token (Messaging API)"}),i.jsx(Zw,{children:i.jsxs(Xw,{children:[i.jsx(ej,{asChild:!0,children:i.jsx(fo,{className:"h-4 w-4 text-gray-400 ml-2 cursor-help"})}),i.jsx(tj,{children:i.jsx("p",{className:"w-72 text-xs",children:'Access Token (long-lived)  LINE Official Account Manager  Settings > Messaging API  "Channel access token"'})})]})})]}),i.jsx(Ux,{value:t?e.accessToken:"",onChange:e=>s("accessToken",e.target.value),type:t?"text":"password",disabled:!t,className:t?r.accessToken?"border-red-500":"":"bg-gray-50"}),t&&r.accessToken&&i.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.accessToken})]})]}),i.jsxs("div",{className:"space-y-4 border-t pt-4",children:[i.jsx("h3",{className:"text-lg font-medium",children:"LINE Login Settings"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx(yv,{children:"Login Channel ID"}),i.jsx(Zw,{children:i.jsxs(Xw,{children:[i.jsx(ej,{asChild:!0,children:i.jsx(fo,{className:"h-4 w-4 text-gray-400 ml-2 cursor-help"})}),i.jsx(tj,{children:i.jsx("p",{className:"w-56 text-xs",children:"Channel ID  LINE Login ( Messaging API)"})})]})})]}),i.jsx(Ux,{value:e.loginChannelId||"",onChange:e=>s("loginChannelId",e.target.value),disabled:!t,className:t?r.loginChannelId?"border-red-500":"":"bg-gray-50"}),t&&r.loginChannelId&&i.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.loginChannelId})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx(yv,{children:"Login Channel Secret"}),i.jsx(Zw,{children:i.jsxs(Xw,{children:[i.jsx(ej,{asChild:!0,children:i.jsx(fo,{className:"h-4 w-4 text-gray-400 ml-2 cursor-help"})}),i.jsx(tj,{children:i.jsx("p",{className:"w-56 text-xs",children:"Channel Secret  LINE Login"})})]})})]}),i.jsx(Ux,{value:t?e.loginChannelSecret||"":"",onChange:e=>s("loginChannelSecret",e.target.value),type:t?"text":"password",disabled:!t,className:t?r.loginChannelSecret?"border-red-500":"":"bg-gray-50"}),t&&r.loginChannelSecret&&i.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.loginChannelSecret})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(yv,{children:"Callback URL"}),i.jsx(Ux,{value:e.callbackUrl||"",onChange:e=>s("callbackUrl",e.target.value),disabled:!t,className:t?r.callbackUrl?"border-red-500":"":"bg-gray-50"}),t&&r.callbackUrl&&i.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.callbackUrl})]}),i.jsxs("div",{children:[i.jsx(yv,{children:"LIFF ID"}),i.jsx(Ux,{value:e.liffId||"",onChange:e=>s("liffId",e.target.value),disabled:!t,className:t?"":"bg-gray-50"})]})]})]})]}),rj=({isEditing:e,isTesting:t,handleEdit:s,handleSave:r,handleCancel:n,handleTestConnection:a,isFormValid:o=!0})=>i.jsx("div",{className:"flex justify-center pt-2 space-x-2",children:e?i.jsxs(i.Fragment,{children:[i.jsx(gu,{variant:"outline",onClick:n,children:""}),i.jsxs(gu,{onClick:r,className:"bg-green-600 hover:bg-green-700",disabled:!o,children:[i.jsx(ll,{className:"w-4 h-4 mr-2"}),""]})]}):i.jsx(i.Fragment,{children:i.jsx(gu,{variant:"outline",onClick:s,children:""})})}),nj=()=>i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"w-24 h-24 mx-auto bg-green-100 rounded-xl flex items-center justify-center",children:i.jsx(To,{className:"h-12 w-12 text-green-600"})}),i.jsx("h3",{className:"mt-4 text-lg font-medium",children:"LINE Official Account"}),i.jsx("p",{className:"text-sm text-gray-500 mt-1",children:" LINE "})]}),aj=(e,t,s,r,i,o,l,c,d)=>{const{handleEdit:u,handleSave:h,handleCancel:m}=((e,t,s,r,i,o,l)=>({handleEdit:n.useCallback(()=>{s(!0),l({})},[s,l]),handleSave:n.useCallback(()=>{o()?(s(!1),localStorage.setItem("lineSettings",JSON.stringify(e)),localStorage.setItem("ttsConfig",JSON.stringify(t)),a.success(" LINE Official Account ")):a.error("")},[o,e,t,s]),handleCancel:n.useCallback(()=>{const e=localStorage.getItem("lineSettings");e&&r(JSON.parse(e));const t=localStorage.getItem("ttsConfig");t&&i(JSON.parse(t)),s(!1),l({})},[s,r,i,l])}))(e,t,s,o,l,c,d),{handleTestConnection:p}=((e,t,s)=>({handleTestConnection:n.useCallback(async()=>{if(s()){t(!0);try{await new Promise(e=>setTimeout(e,1500));const t=/^\d{5,}$/.test(e.channelId),s=e.channelSecret.length>=20,r=e.accessToken.length>=30;t&&s&&r?a.success(" LINE Official Account "):a.error(" LINE Official Account  ")}catch(r){a.error("")}finally{t(!1)}}else a.error("")},[s,e,t])}))(e,r,c),{handleTestMessage:f}=((e,t)=>({handleTestMessage:n.useCallback(async s=>{t(!0);try{let t,r;switch(await new Promise(e=>setTimeout(e,1e3)),s){case"welcome":t=e.welcomeMessage,r=t;break;case"queueReceived":t=e.queueReceivedMessage.replace("{queueNumber}","A001").replace("{queueType}","").replace("{estimatedWaitTime}","15"),r=": "+t;break;case"queueCalled":t=e.queueCalledMessage.replace("{patientName}","").replace("{counter}","2").replace("{queueNumber}","A001"),r=": "+t;break;default:r=""}a.success(`\n${r}`,{duration:4e3})}catch(r){a.error("")}finally{t(!1)}},[e,t])}))(e,i);return n.useMemo(()=>({handleEdit:u,handleSave:h,handleCancel:m,handleTestConnection:p,handleTestMessage:f}),[u,h,m,p,f])},ij=()=>{const[e,t]=n.useState(!1),s=(()=>{const e={channelId:"",channelSecret:"",accessToken:"",loginChannelId:"",loginChannelSecret:"",callbackUrl:"https://subdis-th-que.netlify.app/auth/line/callback",liffId:"",welcomeMessage:" ",queueReceivedMessage:" {queueNumber} : {queueType}\n: {estimatedWaitTime} ",queueCalledMessage:" {patientName}\n!  {counter}\n: {queueNumber}"},t={enabled:!0,volume:1,rate:1,language:"th-TH"},[s,r]=n.useState(!1),[a,i]=n.useState(!1),[o,l]=n.useState(!1),[c,d]=n.useState(e),[u,h]=n.useState(t),m=n.useCallback((e,t)=>{d(s=>({...s,[e]:t}))},[]),p=n.useCallback((e,t)=>{h(s=>({...s,[e]:t}))},[]);return n.useEffect(()=>{const e=localStorage.getItem("lineSettings");if(e)try{const t=JSON.parse(e);t.channelId&&t.channelSecret&&t.accessToken&&d(t)}catch(s){}const t=localStorage.getItem("ttsConfig");if(t)try{h(JSON.parse(t))}catch(s){}},[]),n.useMemo(()=>({defaultSettings:e,defaultTtsConfig:t,isEditing:s,setIsEditing:r,isTesting:a,setIsTesting:i,isTestingMessage:o,setIsTestingMessage:l,lineSettings:c,setLineSettings:d,ttsConfig:u,setTtsConfig:h,handleChange:m,handleTtsConfigChange:p}),[s,a,o,c,u,m,p])})(),{isEditing:r,setIsEditing:a,isTesting:i,setIsTesting:o,isTestingMessage:l,setIsTestingMessage:c,lineSettings:d,setLineSettings:u,ttsConfig:h,setTtsConfig:m,handleChange:p,handleTtsConfigChange:f}=s,{errors:g,validation:x,validateSettings:y,setErrors:v}=((e,t)=>{const[s,r]=n.useState({}),[a,i]=n.useState({channelId:!0,channelSecret:!0,accessToken:!0,loginChannelId:!0,loginChannelSecret:!0,isFormValid:!0}),o=n.useCallback(()=>{const t={};let s={channelId:!0,channelSecret:!0,accessToken:!0,loginChannelId:!0,loginChannelSecret:!0,isFormValid:!0};return/^\d{5,}$/.test(e.channelId)||(t.channelId="Channel ID  5 ",s.channelId=!1,s.isFormValid=!1),e.channelSecret.length<20&&(t.channelSecret="Channel Secret  20 ",s.channelSecret=!1,s.isFormValid=!1),e.accessToken.length<30&&(t.accessToken="Access Token  30 ",s.accessToken=!1,s.isFormValid=!1),e.loginChannelId&&!/^\d{5,}$/.test(e.loginChannelId)&&(t.loginChannelId="Login Channel ID  5 ",s.loginChannelId=!1,s.isFormValid=!1),e.loginChannelSecret&&e.loginChannelSecret.length<20&&(t.loginChannelSecret="Login Channel Secret  20 ",s.loginChannelSecret=!1,s.isFormValid=!1),r(t),i(s),s.isFormValid},[e]);return n.useEffect(()=>{t&&o()},[e,t,o]),n.useMemo(()=>({errors:s,validation:a,validateSettings:o,setErrors:r}),[s,a,o])})(d,r),{handleEdit:b,handleSave:w,handleCancel:j,handleTestConnection:N,handleTestMessage:_}=aj(d,h,a,o,c,u,m,y,v);return n.useEffect(()=>{e||t(!0)},[e]),n.useMemo(()=>({isEditing:r,isTesting:i,isTestingMessage:l,lineSettings:d,ttsConfig:h,errors:g,validation:x,handleEdit:b,handleSave:w,handleCancel:j,handleTestConnection:N,handleTestMessage:_,handleChange:p,handleTtsConfigChange:f}),[r,i,l,d,h,g,x,b,w,j,N,_,p,f])},oj=({lineSettings:e,isEditing:t,handleChange:s,handleTestMessage:r,isTesting:n=!1})=>i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"rounded-lg border p-4",children:[i.jsx("div",{className:"flex justify-between items-center mb-2",children:i.jsx("h4",{className:"text-sm font-medium",children:""})}),i.jsx(zx,{value:e.welcomeMessage,onChange:e=>s("welcomeMessage",e.target.value),className:"resize-none",disabled:!t})]}),i.jsxs("div",{className:"rounded-lg border p-4",children:[i.jsx("div",{className:"flex justify-between items-center mb-2",children:i.jsx("h4",{className:"text-sm font-medium",children:""})}),i.jsx(zx,{value:e.queueReceivedMessage,onChange:e=>s("queueReceivedMessage",e.target.value),className:"resize-none",disabled:!t}),i.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[": ","{queueNumber}",", ","{queueType}",", ","{estimatedWaitTime}"]})]}),i.jsxs("div",{className:"rounded-lg border p-4",children:[i.jsx("div",{className:"flex justify-between items-center mb-2",children:i.jsx("h4",{className:"text-sm font-medium",children:""})}),i.jsx(zx,{value:e.queueCalledMessage,onChange:e=>s("queueCalledMessage",e.target.value),className:"resize-none",disabled:!t}),i.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[": ","{patientName}",", ","{counter}",", ","{queueNumber}"]})]})]}),lj=()=>{const{lineSettings:e,loading:t}=(()=>{const[e,t]=n.useState(null),[s,r]=n.useState(null),[i,o]=n.useState(!0),[l,c]=n.useState(null),d=async()=>{try{o(!0),c(null);const{data:e,error:s}=await qa.from("line_settings").select("*").limit(1).single();if(s&&"PGRST116"!==s.code)throw s;if(e){const s={channelId:e.channel_id,channelSecret:e.channel_secret,accessToken:e.access_token,loginChannelId:e.login_channel_id,loginChannelSecret:e.login_channel_secret,callbackUrl:e.callback_url,liffId:e.liff_id,welcomeMessage:e.welcome_message,queueReceivedMessage:e.queue_received_message,queueCalledMessage:e.queue_called_message};t(s),r(e.tts_config),localStorage.setItem("lineSettings",JSON.stringify(s)),localStorage.setItem("ttsConfig",JSON.stringify(e.tts_config))}else u()}catch(e){c(e.message||"Failed to fetch LINE settings"),u()}finally{o(!1)}},u=()=>{try{const e=localStorage.getItem("lineSettings"),s=localStorage.getItem("ttsConfig");e&&t(JSON.parse(e)),s&&r(JSON.parse(s)),(e||s)&&a.info(" LINE ")}catch(e){}},h=async()=>{try{const{data:e}=await qa.from("line_settings").select("id").limit(1).single();return(null==e?void 0:e.id)||null}catch{return null}};return n.useEffect(()=>{d();const e=qa.channel("line-settings-changes").on("postgres_changes",{event:"*",schema:"public",table:"line_settings"},e=>{d()}).subscribe();return()=>{qa.removeChannel(e)}},[]),{lineSettings:e,ttsConfig:s,loading:i,error:l,fetchLineSettings:d,saveLineSettings:async(e,s)=>{try{t(e),r(s),localStorage.setItem("lineSettings",JSON.stringify(e)),localStorage.setItem("ttsConfig",JSON.stringify(s));const{error:n}=await qa.from("line_settings").upsert({id:await h(),channel_id:e.channelId,channel_secret:e.channelSecret,access_token:e.accessToken,login_channel_id:e.loginChannelId,login_channel_secret:e.loginChannelSecret,callback_url:e.callbackUrl,liff_id:e.liffId,welcome_message:e.welcomeMessage,queue_received_message:e.queueReceivedMessage,queue_called_message:e.queueCalledMessage,tts_config:s});if(n)throw n;return a.success(" LINE Official Account "),!0}catch(n){return a.error(" LINE "),!1}}}})(),s=ij(),{isEditing:r,isTesting:o,isTestingMessage:l,lineSettings:c,ttsConfig:d,errors:u,validation:h,handleEdit:m,handleSave:p,handleCancel:f,handleTestConnection:g,handleTestMessage:x,handleChange:y,handleTtsConfigChange:v}=s;if(t)return i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-gray-300 border-t-pharmacy-600 rounded-full mx-auto mb-4"}),i.jsx("p",{className:"text-gray-600",children:" LINE..."})]})});const b=e||c||{channelId:"",channelSecret:"",accessToken:"",loginChannelId:"",loginChannelSecret:"",callbackUrl:"https://subdis-th-que.netlify.app/auth/line/callback",liffId:"",welcomeMessage:" ",queueReceivedMessage:" {queueNumber} : {queueType}\n: {estimatedWaitTime} ",queueCalledMessage:" {patientName}\n!  {counter}\n: {queueNumber}"};return i.jsx(i.Fragment,{children:i.jsxs(Fi,{children:[i.jsxs(Ui,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsxs("div",{className:"space-y-1",children:[i.jsx(Wi,{children:"LINE Official Account"}),i.jsx(Vi,{children:" LINE Official Account "})]}),i.jsx(nj,{})]}),i.jsxs(zi,{className:"space-y-4 pt-4",children:[i.jsx(sj,{lineSettings:b,isEditing:r,handleChange:y,errors:u}),i.jsx(oj,{lineSettings:b,isEditing:r,handleChange:y,handleTestMessage:x,isTesting:l}),i.jsx(rj,{isEditing:r,isTesting:o,handleEdit:m,handleSave:p,handleCancel:f,handleTestConnection:g,isFormValid:h.isFormValid})]})]})})},cj=({formData:e,onInputChange:t})=>i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"sms-enabled",className:"text-base font-medium",children:" SMS"}),i.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"/ SMS "})]}),i.jsx(jw,{id:"sms-enabled",checked:e.enabled,onCheckedChange:e=>t("enabled",e)})]}),i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"api-key",children:"API Key"}),i.jsx(Ux,{id:"api-key",type:"password",value:e.api_key,onChange:e=>t("api_key",e.target.value),placeholder:"w9HyjAvAO54eaBywKvzRfOA18zkJaa"}),i.jsx("p",{className:"text-sm text-gray-500 mt-2",children:" API Key  Thai Bulk SMS"})]}),i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"secret",children:"Secret"}),i.jsx(Ux,{id:"secret",type:"password",value:e.secret,onChange:e=>t("secret",e.target.value),placeholder:"JOLXUh5jOq4YmsEmAUCuFsGTZm9ber"}),i.jsx("p",{className:"text-sm text-gray-500 mt-2",children:" Secret  Thai Bulk SMS"})]}),i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"sender-name",children:""}),i.jsx(Ux,{id:"sender-name",value:e.sender_name,onChange:e=>t("sender_name",e.target.value),placeholder:" SMS"})]}),i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"message-template",children:""}),i.jsx(zx,{id:"message-template",value:e.message_template,onChange:e=>t("message_template",e.target.value),placeholder:"",rows:3}),i.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[" ","{queueNumber}"," "]})]}),i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"message-template-ins",children:""}),i.jsx(zx,{id:"message-template-ins",value:e.message_template_ins,onChange:e=>t("message_template_ins",e.target.value),placeholder:"",rows:3}),i.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[" ","{queueNumber}"," "]})]}),i.jsxs("div",{className:"border-t pt-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"appointment-reminders-enabled",className:"text-base font-medium",children:" SMS "}),i.jsx("p",{className:"text-sm text-gray-500 mt-1",children:" SMS  17:00 ."})]}),i.jsx(jw,{id:"appointment-reminders-enabled",checked:e.appointment_reminders_enabled,onCheckedChange:e=>t("appointment_reminders_enabled",e)})]}),i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"appointment-reminder-template",children:""}),i.jsx(zx,{id:"appointment-reminder-template",value:e.appointment_reminder_template,onChange:e=>t("appointment_reminder_template",e.target.value),placeholder:"",rows:4}),i.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[" ","{patientName}"," , ","{appointmentDate}"," ",", ","{appointmentTime}"," , "," ","{purpose}"," "]})]})]})]}),dj=Qa("appointmentReminder"),uj=({enabled:e,messageTemplate:t})=>{const[s,r]=n.useState(!1),[o,l]=n.useState(""),[c,d]=n.useState(!1);return i.jsxs("div",{className:"border-t pt-4 space-y-4",children:[i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"test-phone",children:" SMS "}),i.jsxs("div",{className:"flex gap-2 mt-2",children:[i.jsx(Ux,{id:"test-phone",value:o,onChange:e=>l(e.target.value),placeholder:"  0644255591",className:"flex-1"}),i.jsxs(gu,{onClick:async()=>{if(o.trim()){r(!0);try{const e=t.replace("{queueNumber}","999"),{data:s,error:r}=await qa.functions.invoke("send-sms-notification",{body:{phoneNumber:o,message:e,queueNumber:"999",patientName:""}});if(r)throw r;a.success(" SMS ")}catch(e){a.error(` SMS: ${e.message}`)}finally{r(!1)}}else a.error("")},disabled:s||!e,variant:"outline",children:[i.jsx(dl,{className:"w-4 h-4 mr-2"}),s?"...":""]})]})]}),i.jsxs("div",{children:[i.jsx(Vx,{children:" SMS "}),i.jsx("div",{className:"flex gap-2 mt-2",children:i.jsxs(gu,{onClick:async()=>{d(!0);try{const e=await(async()=>{try{dj.info("Manually triggering appointment reminder SMS...");const{data:e,error:t}=await qa.functions.invoke("appointment-reminder-sms",{body:{manual_trigger:!0}});if(t)throw dj.error("Error invoking appointment reminder function:",t),t;return dj.info("Appointment reminder response:",e),e&&e.success?{success:!0,message:e.message||" SMS ",sent:e.sent||0}:{success:!1,message:(null==e?void 0:e.message)||" SMS ",sent:0}}catch(e){return dj.error("Error sending appointment reminders:",e),{success:!1,message:`: ${e.message}`,sent:0}}})();e.success?a.success(`${e.message} ( ${e.sent} )`):a.error(e.message)}catch(e){a.error(` SMS : ${e.message}`)}finally{d(!1)}},disabled:c||!e,variant:"outline",className:"flex-1",children:[i.jsx(ao,{className:"w-4 h-4 mr-2"}),c?"...":" SMS "]})}),i.jsx("p",{className:"text-sm text-gray-500 mt-2",children:" SMS "})]})]})},hj=()=>{const{settings:e,updateMultipleSettings:t,loading:s}=nx("sms"),[r,o]=n.useState({enabled:!1,api_key:"",secret:"",sender_name:"SubdisTH",message_template:"  {queueNumber}",message_template_ins:"  {queueNumber}{servicePoint}",appointment_reminder_template:":  {patientName}  {purpose}  {appointmentDate}  {appointmentTime} . ",appointment_reminders_enabled:!0}),[l,c]=n.useState(!1);n.useEffect(()=>{if(e&&Array.isArray(e)){const t={...r};e.forEach(e=>{if("enabled"===e.key||"appointment_reminders_enabled"===e.key)t[e.key]="true"===e.value||!0===e.value;else if(e.key in t){const s="string"==typeof e.value&&e.value.startsWith('"')?JSON.parse(e.value):e.value;t[e.key]=s}}),o(t)}},[e]);return s?i.jsx("div",{children:" SMS..."}):i.jsx("div",{className:"space-y-6",children:i.jsxs(Fi,{children:[i.jsxs(Ui,{children:[i.jsx(Wi,{children:" SMS"}),i.jsx("p",{className:"text-sm text-gray-600",children:" SMS   17:00 ."})]}),i.jsxs(zi,{className:"space-y-6",children:[i.jsx(cj,{formData:r,onInputChange:(e,t)=>{o(s=>({...s,[e]:t}))}}),i.jsx(uj,{enabled:r.enabled,messageTemplate:r.message_template}),i.jsx("div",{className:"flex justify-end",children:i.jsx(gu,{onClick:async()=>{c(!0);try{const e={enabled:r.enabled.toString(),api_key:JSON.stringify(r.api_key),secret:JSON.stringify(r.secret),sender_name:JSON.stringify(r.sender_name),message_template:JSON.stringify(r.message_template),message_template_ins:JSON.stringify(r.message_template_ins),appointment_reminder_template:JSON.stringify(r.appointment_reminder_template),appointment_reminders_enabled:r.appointment_reminders_enabled.toString()};await t(e,"sms"),a.success(" SMS  ()")}catch(e){a.error("")}finally{c(!1)}},disabled:l,children:l?"...":""})})]})]})})},mj=({isSubmitting:e})=>i.jsx("div",{className:"flex justify-end mt-6"}),pj=({formData:e,onCancel:t,onSave:s,onChange:r})=>i.jsxs("div",{className:"space-y-4 p-4 border rounded-md bg-gray-50",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"code",children:""}),i.jsx(Ux,{id:"code",value:e.code,onChange:e=>r("code",e.target.value),placeholder:"  SP01"})]}),i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"name",children:""}),i.jsx(Ux,{id:"name",value:e.name,onChange:e=>r("name",e.target.value),placeholder:""})]})]}),i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"location",children:" ()"}),i.jsx(Ux,{id:"location",value:e.location,onChange:e=>r("location",e.target.value),placeholder:""})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(jw,{id:"enabled",checked:e.enabled,onCheckedChange:e=>r("enabled",e)}),i.jsx(Vx,{htmlFor:"enabled",children:""})]}),i.jsxs("div",{className:"flex justify-end space-x-2",children:[i.jsxs(gu,{type:"button",variant:"outline",onClick:t,children:[i.jsx(Pl,{className:"h-4 w-4 mr-2"}),""]}),i.jsxs(gu,{type:"button",onClick:s,children:[i.jsx(ll,{className:"h-4 w-4 mr-2"}),""]})]})]}),fj=({servicePoint:e,onDelete:t})=>i.jsxs(Zy,{children:[i.jsx(Xy,{asChild:!0,children:i.jsx(gu,{variant:"ghost",size:"sm",children:i.jsx(bl,{className:"h-4 w-4 text-red-500"})})}),i.jsxs(sv,{children:[i.jsxs(rv,{children:[i.jsx(av,{children:""}),i.jsxs(iv,{children:[" ",e.name," (",e.code,") ? "]})]}),i.jsxs(nv,{children:[i.jsx(lv,{children:""}),i.jsx(ov,{onClick:()=>t(e.id),children:""})]})]})]}),gj=({servicePoint:e,onEdit:t,onDelete:s})=>i.jsxs("div",{className:"flex items-center justify-between border-b py-4 last:border-0",children:[i.jsxs("div",{className:"space-y-1",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("span",{className:"font-medium",children:e.code}),!e.enabled&&i.jsx("span",{className:"ml-2 text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded",children:""})]}),i.jsx("div",{className:"text-sm text-gray-500",children:e.name}),e.location&&i.jsx("div",{className:"text-xs text-gray-400",children:e.location})]}),i.jsxs("div",{className:"flex space-x-2",children:[i.jsx(gu,{variant:"ghost",size:"sm",onClick:()=>t(e),children:i.jsx(Jo,{className:"h-4 w-4"})}),i.jsx(fj,{servicePoint:e,onDelete:s})]})]}),xj=({className:e})=>{const{servicePoints:t,loading:s,saveServicePoint:r,deleteServicePoint:o}=Wa(),[l,c]=n.useState(null),[d,u]=n.useState(!1),[h,m]=n.useState({code:"",name:"",location:"",enabled:!0}),p=e=>{m({id:e.id,code:e.code,name:e.name,location:e.location||"",enabled:e.enabled}),c(e.id),u(!1)},f=()=>{c(null),u(!1)},g=(e,t)=>{m(s=>({...s,[e]:t}))},x=async()=>{try{if(!h.code||!h.name)return void a.error("");await r(h),c(null),u(!1),a.success("")}catch(e){}},y=async e=>{try{await o(e)}catch(t){}};return i.jsxs(Fi,{className:e,children:[i.jsx(Ui,{children:i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("div",{children:i.jsx(Wi,{children:""})}),i.jsxs(gu,{onClick:()=>{m({code:"",name:"",location:"",enabled:!0}),c(null),u(!0)},disabled:d,children:[i.jsx(sl,{className:"h-4 w-4 mr-2"})," "]})]})}),i.jsxs(zi,{children:[d&&i.jsx(pj,{formData:h,onCancel:f,onSave:x,onChange:g}),i.jsx("div",{className:"mt-4",children:s?i.jsx("div",{className:"text-center py-4",children:"..."}):0===t.length?i.jsx("div",{className:"text-center py-4 text-gray-500",children:""}):t.map(e=>i.jsx("div",{children:l===e.id?i.jsx(pj,{formData:h,onCancel:f,onSave:x,onChange:g}):i.jsx(gj,{servicePoint:e,onEdit:p,onDelete:y})},e.id))})]})]})};var yj="horizontal",vj=["horizontal","vertical"],bj=n.forwardRef((e,t)=>{const{decorative:s,orientation:r=yj,...n}=e,a=function(e){return vj.includes(e)}(r)?r:yj,o=s?{role:"none"}:{"aria-orientation":"vertical"===a?a:void 0,role:"separator"};return i.jsx(ye.div,{"data-orientation":a,...o,...n,ref:t})});bj.displayName="Separator";var wj=bj;const jj=n.forwardRef(({className:e,orientation:t="horizontal",decorative:s=!0,...r},n)=>i.jsx(wj,{ref:n,decorative:s,orientation:t,className:Qi("shrink-0 bg-border","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",e),...r}));jj.displayName=wj.displayName;const Nj=({className:e})=>{const{servicePoints:t,loading:s}=Wa(),{queueTypes:r,loading:o}=ax(),[l,c]=n.useState(""),{mappings:d,loading:u,deletingId:h,addMapping:m,removeMapping:p,fetchMappings:f,error:g}=Uv(l),[x,y]=n.useState([]),[v,b]=n.useState(""),[w,j]=n.useState(!1);n.useEffect(()=>{t.length>0&&!l&&c(t[0].id)},[t,l]),n.useEffect(()=>{if(r&&d){const e=d.map(e=>e.queue_type_id),t=r.filter(e=>"INS"!==e.purpose).filter(t=>t.enabled&&!e.includes(t.id)).map(e=>e);y(t),v&&!t.some(e=>e.id===v)&&b("")}},[r,d,v]);const N=t.find(e=>e.id===l),_=s||o||u;return i.jsxs(Fi,{className:e,children:[i.jsxs(Ui,{children:[i.jsx(Wi,{children:""}),i.jsx(Vi,{children:""})]}),i.jsxs(zi,{children:[g&&i.jsxs(Im,{variant:"destructive",className:"mb-4",children:[i.jsx(fo,{className:"h-4 w-4"}),i.jsxs(Pm,{children:[": ",g]})]}),_?i.jsxs("div",{className:"flex items-center justify-center py-8",children:[i.jsx(Lo,{className:"h-6 w-6 animate-spin mr-2"}),"..."]}):i.jsx(i.Fragment,{children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium",children:""}),i.jsxs(Jh,{value:l,onValueChange:e=>{c(e),b("")},children:[i.jsx(Xh,{children:i.jsx(Zh,{placeholder:""})}),i.jsx(sm,{children:t.map(e=>i.jsxs(rm,{value:e.id,children:[e.code," - ",e.name]},e.id))})]})]}),N&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"bg-gray-50 p-4 rounded-md",children:[i.jsxs("h3",{className:"font-medium mb-2",children:[" ",N.name]}),i.jsxs("div",{className:"flex gap-4 items-end mb-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("label",{className:"text-sm font-medium",children:""}),0===x.length?i.jsx("div",{className:"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm text-muted-foreground",children:""}):i.jsxs(Jh,{value:v,onValueChange:e=>{b(e)},children:[i.jsx(Xh,{children:i.jsx(Zh,{placeholder:""})}),i.jsx(sm,{children:x.map(e=>i.jsxs(rm,{value:e.id,children:[e.name," - ",e.purpose||""]},e.id))})]})]}),i.jsxs(gu,{onClick:async()=>{if(l&&v)try{j(!0);await m(l,v)?(b(""),a.success(""),await f()):a.error("")}catch(e){const t=(null==e?void 0:e.message)||"";a.error(t),"42501"===(null==e?void 0:e.code)&&a.error(" ")}finally{j(!1)}},disabled:!v||0===x.length||w,children:[w?i.jsx(Lo,{className:"h-4 w-4 animate-spin mr-2"}):i.jsx(yo,{className:"h-4 w-4 mr-2"}),""]})]}),i.jsx(jj,{className:"my-4"}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("h4",{className:"text-sm font-medium",children:""}),0===d.length?i.jsx("div",{className:"text-sm text-gray-500 p-2",children:""}):i.jsx("div",{className:"space-y-2",children:d.map(e=>{const t=r.find(t=>t.id===e.queue_type_id),s=h===e.id;return i.jsxs("div",{className:"flex items-center justify-between bg-white p-2 rounded border",children:[i.jsx("div",{className:"flex items-center",children:t&&i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"ml-2",children:t.name}),t.purpose&&i.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["- ",t.purpose]})]})}),i.jsx(gu,{variant:"ghost",size:"sm",onClick:()=>(async e=>{try{await p(e)?(a.success(""),await f()):a.error("")}catch(t){const e=(null==t?void 0:t.message)||"";a.error(e)}})(e.id),disabled:s,children:s?i.jsx(Lo,{className:"h-4 w-4 animate-spin"}):i.jsx(bo,{className:"h-4 w-4 text-red-500"})})]},e.id)})})]})]})})]})})]})]})},_j=Qa("useServicePointsIns"),Sj=({formData:e,onCancel:t,onSave:s,onChange:r})=>i.jsxs("div",{className:"space-y-4 p-4 border rounded-md bg-gray-50",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"code",children:""}),i.jsx(Ux,{id:"code",value:e.code,onChange:e=>r("code",e.target.value),placeholder:"  INS01"})]}),i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"name",children:""}),i.jsx(Ux,{id:"name",value:e.name,onChange:e=>r("name",e.target.value),placeholder:""})]})]}),i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"location",children:" ()"}),i.jsx(Ux,{id:"location",value:e.location,onChange:e=>r("location",e.target.value),placeholder:""})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(jw,{id:"enabled",checked:e.enabled,onCheckedChange:e=>r("enabled",e)}),i.jsx(Vx,{htmlFor:"enabled",children:""})]}),i.jsxs("div",{className:"flex justify-end space-x-2",children:[i.jsxs(gu,{type:"button",variant:"outline",onClick:t,children:[i.jsx(Pl,{className:"h-4 w-4 mr-2"}),""]}),i.jsxs(gu,{type:"button",onClick:s,children:[i.jsx(ll,{className:"h-4 w-4 mr-2"}),""]})]})]}),kj=({servicePoint:e,onDelete:t})=>i.jsxs(Zy,{children:[i.jsx(Xy,{asChild:!0,children:i.jsx(gu,{variant:"ghost",size:"sm",children:i.jsx(bl,{className:"h-4 w-4 text-red-500"})})}),i.jsxs(sv,{children:[i.jsxs(rv,{children:[i.jsx(av,{children:" INS"}),i.jsxs(iv,{children:[" INS ",e.name," (",e.code,") ? "]})]}),i.jsxs(nv,{children:[i.jsx(lv,{children:""}),i.jsx(ov,{onClick:()=>t(e.id),children:""})]})]})]}),Cj=({servicePoint:e,onEdit:t,onDelete:s})=>i.jsxs("div",{className:"flex items-center justify-between border-b py-4 last:border-0",children:[i.jsxs("div",{className:"space-y-1",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("span",{className:"font-medium",children:e.code}),!e.enabled&&i.jsx("span",{className:"ml-2 text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded",children:""})]}),i.jsx("div",{className:"text-sm text-gray-500",children:e.name}),e.location&&i.jsx("div",{className:"text-xs text-gray-400",children:e.location})]}),i.jsxs("div",{className:"flex space-x-2",children:[i.jsx(gu,{variant:"ghost",size:"sm",onClick:()=>t(e),children:i.jsx(Jo,{className:"h-4 w-4"})}),i.jsx(kj,{servicePoint:e,onDelete:s})]})]}),Tj=({className:e})=>{const{servicePointsIns:t,loading:s,saveServicePointIns:r,deleteServicePointIns:o}=(()=>{const[e,t]=n.useState([]),[s,r]=n.useState(!0),[i,o]=n.useState(null),l=async()=>{try{r(!0),o(null);const{data:e,error:s}=await qa.from("service_points_ins").select("*").order("code",{ascending:!0});if(s)throw s;t(e||[]),_j.debug(`Fetched ${(null==e?void 0:e.length)||0} INS service points`)}catch(e){_j.error("Error fetching INS service points:",e),o(e.message||"Failed to fetch INS service points"),a.error(" INS ")}finally{r(!1)}};return n.useEffect(()=>{l()},[]),{servicePointsIns:e,loading:s,error:i,fetchServicePointsIns:l,saveServicePointIns:async e=>{try{if(!(e.id||e.code&&e.name))throw new Error("Service point code and name are required");const{data:t,error:s}=await qa.from("service_points_ins").upsert({id:e.id||void 0,code:e.code||"",name:e.name||"",location:e.location,enabled:void 0===e.enabled||e.enabled}).select();if(s)throw s;if(!t||0===t.length)throw new Error("No data returned after saving INS service point");return await l(),t[0]}catch(t){throw _j.error("Error saving INS service point:",t),a.error(" INS "),t}},deleteServicePointIns:async e=>{try{const{error:s}=await qa.from("service_points_ins").delete().eq("id",e);if(s)throw s;return t(t=>t.filter(t=>t.id!==e)),a.success(" INS "),!0}catch(s){return _j.error("Error deleting INS service point:",s),a.error(" INS "),!1}}}})(),[l,c]=n.useState(null),[d,u]=n.useState(!1),[h,m]=n.useState({code:"",name:"",location:"",enabled:!0}),p=e=>{m({id:e.id,code:e.code,name:e.name,location:e.location||"",enabled:e.enabled}),c(e.id),u(!1)},f=()=>{c(null),u(!1)},g=(e,t)=>{m(s=>({...s,[e]:t}))},x=async()=>{try{if(!h.code||!h.name)return void a.error(" INS");await r(h),c(null),u(!1),a.success(" INS ")}catch(e){}},y=async e=>{try{await o(e)}catch(t){}};return i.jsxs(Fi,{className:e,children:[i.jsx(Ui,{children:i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("div",{children:i.jsx(Wi,{children:""})}),i.jsxs(gu,{onClick:()=>{m({code:"",name:"",location:"",enabled:!0}),c(null),u(!0)},disabled:d,children:[i.jsx(sl,{className:"h-4 w-4 mr-2"})," "]})]})}),i.jsxs(zi,{children:[d&&i.jsx(Sj,{formData:h,onCancel:f,onSave:x,onChange:g}),i.jsx("div",{className:"mt-4",children:s?i.jsx("div",{className:"text-center py-4",children:"..."}):0===t.length?i.jsx("div",{className:"text-center py-4 text-gray-500",children:""}):t.map(e=>i.jsx("div",{children:l===e.id?i.jsx(Sj,{formData:h,onCancel:f,onSave:x,onChange:g}):i.jsx(Cj,{servicePoint:e,onEdit:p,onDelete:y})},e.id))})]})]})},Ej=[{value:"0",label:" -  3, 12, 78",example:"1, 2, 3..."},{value:"00",label:" -  01, 12, 99",example:"01, 02, 03..."},{value:"000",label:" -  001, 012, 123",example:"001, 002, 003..."}],Ij=()=>{const{settings:e,onSubmit:t,isSubmitting:s}=bx();return e.form?i.jsxs(hv,{...e.form,children:[i.jsxs(Mh,{value:"general",className:"space-y-6",children:[i.jsx(kw,{form:e.form}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[i.jsx(xj,{}),i.jsx(Nj,{}),i.jsx(Tj,{})]})]}),i.jsx(Mh,{value:"queue",className:"space-y-6",children:i.jsxs("form",{onSubmit:e.form.handleSubmit(t),className:"space-y-6",children:[i.jsx(Sw,{form:e.form,editingQueueType:e.editingQueueType,setEditingQueueType:e.setEditingQueueType,newQueueType:e.newQueueType,setNewQueueType:e.setNewQueueType,handleAddQueueType:e.handleAddQueueType,handleRemoveQueueType:e.handleRemoveQueueType,handleEditQueueType:e.handleEditQueueType,handleSaveQueueType:e.handleSaveQueueType,handleCancelEdit:e.handleCancelEdit,handleDuplicateQueueType:e.handleDuplicateQueueType,handleQueueTypeChange:e.handleQueueTypeChange,formatOptions:Ej}),i.jsx(mj,{isSubmitting:s})]})}),i.jsx(Mh,{value:"sms",className:"space-y-6",children:i.jsx(hj,{})}),i.jsx(Mh,{value:"line",className:"space-y-6",children:i.jsx(lj,{})})]}):i.jsx("div",{children:"Loading settings form..."})},Pj=()=>{const e=bx();if(!e)return i.jsx(fw,{});const{loading:t,loadingQueueTypes:s}=e;return t||s?i.jsx(fw,{}):i.jsxs("div",{className:"p-6",children:[i.jsx("div",{className:"flex items-center justify-between mb-6",children:i.jsx(pw,{})}),i.jsx(mw,{children:i.jsx(Ij,{})})]})},Oj=()=>i.jsx(vx,{children:i.jsx(Pj,{})}),Aj=()=>i.jsxs("div",{className:"mb-6",children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:""}),i.jsx("p",{className:"text-gray-500",children:""})]}),Dj=({avgWaitTime:e,avgServiceTime:t,totalCompletedQueues:s,className:r,insAvgWaitTime:n=0,insAvgServiceTime:a=0,totalCompletedInsQueues:o=0})=>i.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-3 gap-4 ${r}`,children:[i.jsx(Fi,{children:i.jsxs(zi,{className:"p-6",children:[i.jsx("div",{className:"flex justify-between items-start mb-4",children:i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:" ()"}),i.jsx("p",{className:"text-xs text-gray-400",children:""})]})}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"flex flex-col items-center gap-3 p-4 border border-gray-200 rounded-lg min-w-0",children:[i.jsx("div",{className:"bg-blue-100 p-2 rounded-full flex-shrink-0",children:i.jsx(tl,{className:"w-5 h-5 text-blue-600"})}),i.jsxs("div",{className:"text-center w-full",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:""}),i.jsxs("p",{className:"text-2xl font-bold text-blue-600 whitespace-nowrap",children:[Math.round(e)," "]})]})]}),i.jsxs("div",{className:"flex flex-col items-center gap-3 p-4 border border-gray-200 rounded-lg min-w-0",children:[i.jsx("div",{className:"bg-purple-100 p-2 rounded-full flex-shrink-0",children:i.jsx(xl,{className:"w-5 h-5 text-purple-600"})}),i.jsxs("div",{className:"text-center w-full",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:""}),i.jsxs("p",{className:"text-2xl font-bold text-purple-600 whitespace-nowrap",children:[Math.round(n)," "]})]})]})]}),i.jsx("div",{className:"mt-4 text-xs text-gray-500",children:""})]})}),i.jsx(Fi,{children:i.jsxs(zi,{className:"p-6",children:[i.jsx("div",{className:"flex justify-between items-start mb-4",children:i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:" ()"}),i.jsx("p",{className:"text-xs text-gray-400",children:""})]})}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"flex flex-col items-center gap-3 p-4 border border-gray-200 rounded-lg min-w-0",children:[i.jsx("div",{className:"bg-blue-100 p-2 rounded-full flex-shrink-0",children:i.jsx(tl,{className:"w-5 h-5 text-blue-600"})}),i.jsxs("div",{className:"text-center w-full",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:""}),i.jsxs("p",{className:"text-2xl font-bold text-blue-600 whitespace-nowrap",children:[Math.round(t)," "]})]})]}),i.jsxs("div",{className:"flex flex-col items-center gap-3 p-4 border border-gray-200 rounded-lg min-w-0",children:[i.jsx("div",{className:"bg-purple-100 p-2 rounded-full flex-shrink-0",children:i.jsx(xl,{className:"w-5 h-5 text-purple-600"})}),i.jsxs("div",{className:"text-center w-full",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:""}),i.jsxs("p",{className:"text-2xl font-bold text-purple-600 whitespace-nowrap",children:[Math.round(a)," "]})]})]})]}),i.jsx("div",{className:"mt-4 text-xs text-gray-500",children:""})]})}),i.jsx(Fi,{children:i.jsxs(zi,{className:"p-6",children:[i.jsx("div",{className:"flex justify-between items-start mb-4",children:i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-600",children:" ()"}),i.jsx("p",{className:"text-xs text-gray-400",children:""})]})}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"flex flex-col items-center gap-3 p-4 border border-gray-200 rounded-lg min-w-0",children:[i.jsx("div",{className:"bg-blue-100 p-2 rounded-full flex-shrink-0",children:i.jsx(tl,{className:"w-5 h-5 text-blue-600"})}),i.jsxs("div",{className:"text-center w-full",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:""}),i.jsx("p",{className:"text-2xl font-bold text-blue-600 whitespace-nowrap",children:s})]})]}),i.jsxs("div",{className:"flex flex-col items-center gap-3 p-4 border border-gray-200 rounded-lg min-w-0",children:[i.jsx("div",{className:"bg-purple-100 p-2 rounded-full flex-shrink-0",children:i.jsx(xl,{className:"w-5 h-5 text-purple-600"})}),i.jsxs("div",{className:"text-center w-full",children:[i.jsx("p",{className:"text-xs text-gray-600 mb-1",children:""}),i.jsx("p",{className:"text-2xl font-bold text-purple-600 whitespace-nowrap",children:o})]})]})]}),i.jsx("div",{className:"mt-4 text-xs text-gray-500",children:""})]})})]}),Mj=({realData:e,simulationData:t,isSimulationMode:s})=>{const r=e.completedQueues>0?e:{avgWaitTime:8,completedQueues:15,throughput:3};r.avgWaitTime,t.avgWaitTime,r.completedQueues,t.completedQueues,r.throughput,t.throughput;(()=>{const e=t.avgWaitTime-r.avgWaitTime,s=t.throughput-r.throughput;return Math.abs(e)<2&&Math.abs(s)<2?{status:"similar",message:"",icon:Ji}:e<0&&s>0?{status:"better",message:"",icon:Nl}:{status:"different",message:"",icon:jl}})().icon},qj=Qa("DataComparison"),Rj=({queues:e,sortQueues:t})=>{const[s,r]=n.useState([]),[a,o]=n.useState([]),[l,c]=n.useState([]),[d,u]=n.useState([]),[h,m]=n.useState([]),[p,f]=n.useState([]),[g,x]=n.useState([]),[y,v]=n.useState([]),[b,w]=n.useState([]),{simulationMetrics:j}=Eh(),{realData:N,simulationData:_,hasSimulationData:S,hasRealData:k}=(()=>{const[e,t]=n.useState({avgWaitTime:0,completedQueues:0,throughput:0,totalQueues:0,label:""}),[s,r]=n.useState({avgWaitTime:0,completedQueues:0,throughput:0,totalQueues:0,label:""}),[a,i]=n.useState(!1),o=n.useCallback(async()=>{try{qj.info(" Fetching real queue data...");const e=new Date;e.setDate(e.getDate()-7);const{data:s,error:r}=await qa.from("queues").select("*").or("notes.is.null,notes.not.like.%%").eq("status","COMPLETED").gte("created_at",e.toISOString()).order("created_at",{ascending:!1}).limit(100);if(r)return void qj.error(" Error fetching real data:",r);if(s&&s.length>0){const e=s.reduce((e,t)=>{if(t.called_at&&t.created_at){const s=(new Date(t.called_at).getTime()-new Date(t.created_at).getTime())/6e4;return e+Math.max(0,s)}return e},0)/s.length,r=s.length;t({avgWaitTime:Math.round(e),completedQueues:s.length,throughput:Math.round(r/10),totalQueues:s.length,label:""}),qj.info(` Real data loaded: ${s.length} queues, avg wait: ${Math.round(e)} min`)}}catch(e){qj.error(" Error in fetchRealData:",e)}},[]),l=n.useCallback(async()=>{try{qj.info(" Fetching simulation queue data...");const{data:e,error:t}=await qa.from("queues").select("*").like("notes","%%").eq("status","COMPLETED").order("created_at",{ascending:!1}).limit(100);if(t)return void qj.error(" Error fetching simulation data:",t);if(e&&e.length>0){const t=e.reduce((e,t)=>{if(t.called_at&&t.created_at){const s=(new Date(t.called_at).getTime()-new Date(t.created_at).getTime())/6e4;return e+Math.max(0,s)}return e},0)/e.length,s=e.length;r({avgWaitTime:Math.round(t),completedQueues:e.length,throughput:Math.round(s/10),totalQueues:e.length,label:""}),qj.info(` Simulation data loaded: ${e.length} queues, avg wait: ${Math.round(t)} min`)}}catch(e){qj.error(" Error in fetchSimulationData:",e)}},[]),c=n.useCallback(async()=>{i(!0);try{await Promise.all([o(),l()])}finally{i(!1)}},[o,l]);n.useEffect(()=>{c()},[c]);const d=s.totalQueues>0,u=e.totalQueues>0;return{realData:e,simulationData:s,loading:a,refreshData:c,hasSimulationData:d,hasRealData:u}})(),{isSimulationMode:C}=(()=>{const[e,t]=n.useState(()=>Ch());return n.useEffect(()=>kh(t),[]),{isSimulationMode:e,setSimulationMode:n.useCallback(e=>{Sh(e)},[])}})(),T=C||j.isSimulationMode,E=j?{avgWaitTime:j.avgWaitTime,avgServiceTime:j.avgServiceTime,totalCompletedQueues:j.completedQueues,avgWaitTimeToday:j.avgWaitTimeToday,avgServiceTimeToday:j.avgServiceTimeToday}:{avgWaitTime:0,avgServiceTime:0,totalCompletedQueues:0,avgWaitTimeToday:0,avgServiceTimeToday:0},[I,P]=n.useState({avgWaitTime:0,avgServiceTime:0,totalCompletedQueues:0,avgWaitTimeToday:0,avgServiceTimeToday:0});return n.useEffect(()=>{const e=async()=>{try{const{data:e,error:t}=await qa.from("queues_ins").select("*").eq("queue_date",Nu()).order("created_at",{ascending:!0});if(t)throw t;if(e){m(e);const t=e.filter(e=>"WAITING"===e.status),s=e.filter(e=>"ACTIVE"===e.status),r=e.filter(e=>"COMPLETED"===e.status),n=e.filter(e=>"SKIPPED"===e.status);f(t),x(s),v(r),w(n)}const{data:s,error:r}=await qa.from("queues_ins").select("created_at, called_at, completed_at").eq("status","COMPLETED").not("called_at","is",null).not("completed_at","is",null).order("created_at",{ascending:!0});if(r)throw r;if(s&&s.length>0){let e=0,t=0;s.forEach(s=>{if(s.created_at&&s.called_at){const t=new Date(s.called_at).getTime()-new Date(s.created_at).getTime();e+=t/1e3/60}if(s.called_at&&s.completed_at){const e=new Date(s.completed_at).getTime()-new Date(s.called_at).getTime();t+=e/1e3/60}});const r=e/s.length,n=t/s.length;P({avgWaitTime:r,avgServiceTime:n,totalCompletedQueues:s.length,avgWaitTimeToday:0,avgServiceTimeToday:0})}else P({avgWaitTime:0,avgServiceTime:0,totalCompletedQueues:0,avgWaitTimeToday:0,avgServiceTimeToday:0})}catch(e){}};e();const t=qa.channel("queues_ins_changes").on("postgres_changes",{event:"*",schema:"public",table:"queues_ins"},()=>{e()}).subscribe();return()=>{qa.removeChannel(t)}},[]),n.useEffect(()=>{if(e){const s=e.filter(e=>"WAITING"===e.status),n=e.filter(e=>"ACTIVE"===e.status),a=e.filter(e=>"COMPLETED"===e.status),i=e.filter(e=>"SKIPPED"===e.status);r(t(s)),o(n),c(a),u(i)}},[e,t]),n.useEffect(()=>{},[]),i.jsxs(i.Fragment,{children:[(k||S)&&i.jsx(Mj,{realData:N,simulationData:_,isSimulationMode:T}),i.jsx(uu,{waitingQueues:s,activeQueues:a,completedQueues:l,queues:e,avgWaitTime:E.avgWaitTime,avgServiceTime:E.avgServiceTime,avgWaitTimeToday:E.avgWaitTimeToday,avgServiceTimeToday:E.avgServiceTimeToday,isSimulationMode:T,insQueues:h,waitingInsQueues:p,activeInsQueues:g,completedInsQueues:y,insAvgWaitTime:I.avgWaitTime,insAvgServiceTime:I.avgServiceTime,insAvgWaitTimeToday:I.avgWaitTimeToday,insAvgServiceTimeToday:I.avgServiceTimeToday}),i.jsxs(Fi,{className:"mb-6",children:[i.jsxs(Ui,{children:[i.jsx(Wi,{children:T?"":""}),i.jsx("p",{className:"text-sm text-muted-foreground",children:T?"":""})]}),i.jsx(zi,{children:i.jsx(Dj,{avgWaitTime:E.avgWaitTime,avgServiceTime:E.avgServiceTime,totalCompletedQueues:E.totalCompletedQueues,insAvgWaitTime:I.avgWaitTime,insAvgServiceTime:I.avgServiceTime,totalCompletedInsQueues:I.totalCompletedQueues})})]}),i.jsx(Rx,{completedQueues:l,waitingQueues:s,activeQueues:a,skippedQueues:d,completedInsQueues:y,waitingInsQueues:p,activeInsQueues:g,skippedInsQueues:b,className:"mb-6"})]})},$j=()=>{const{sortQueues:e,queues:t}=yh();return i.jsx("div",{className:"p-3 md:p-6 min-h-screen bg-background",children:i.jsx(Z,{dir:"ltr",children:i.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[i.jsx(Aj,{}),i.jsx(Rj,{queues:t,sortQueues:t=>e?e(t):t})]})})})},Lj=()=>({getAppointmentsByDateRange:n.useMemo(()=>(e,t,s)=>{try{return t&&s?e.filter(e=>{try{return function(e,t){const s=+Ol(e),[r,n]=[+Ol(t.start),+Ol(t.end)].sort((e,t)=>e-t);return s>=r&&s<=n}(Kd(e.date),{start:t,end:s})}catch(r){return!1}}):e}catch(r){return a.error(""),[]}},[])}),Qj=()=>{const{appointments:e,setAppointments:t,loading:s,error:r,fetchAppointments:i}=(()=>{const[e,t]=n.useState([]),[s,r]=n.useState(!0),[i,o]=n.useState(null),l=async()=>{try{r(!0),o(null);const{data:e,error:s}=await qa.from("appointments").select("*").order("date",{ascending:!0});if(s)throw s;t((e||[]).map(e=>({...e,status:e.status})))}catch(e){o(e.message||"Failed to fetch appointments"),a.error("")}finally{r(!1)}};return n.useEffect(()=>{l()},[]),{appointments:e,setAppointments:t,loading:s,error:i,fetchAppointments:l}})(),{addAppointment:o,updateAppointment:l,deleteAppointment:c}=(e=>({addAppointment:async t=>{try{if(!t.patient_id||!t.date||!t.purpose)throw new Error("Missing required appointment data");const{data:s,error:r}=await qa.from("appointments").insert([{patient_id:t.patient_id,date:t.date,purpose:t.purpose,notes:t.notes,status:t.status||"SCHEDULED"}]).select();if(r)throw r;if(s&&s.length>0){const t={...s[0],status:s[0].status};return e(e=>[...e,t].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())),a.success(""),t}return null}catch(s){return a.error(""),null}},updateAppointment:async(t,s)=>{try{const{data:r,error:n}=await qa.from("appointments").update({...s,updated_at:(new Date).toISOString()}).eq("id",t).select();if(n)throw n;if(r&&r.length>0){const s={...r[0],status:r[0].status};return e(e=>e.map(e=>e.id===t?s:e)),a.success(""),s}return null}catch(r){return a.error(""),null}},deleteAppointment:async t=>{try{const{error:s}=await qa.from("appointments").delete().eq("id",t);if(s)throw s;return e(e=>e.filter(e=>e.id!==t)),a.success(""),!0}catch(s){return a.error(""),!1}}}))(t),{getAppointmentsByDateRange:d}=Lj();return{appointments:e,loading:s,error:r,fetchAppointments:i,addAppointment:o,updateAppointment:l,deleteAppointment:c,getAppointmentsByDateRange:d}},Fj=Gg({patient_id:Wg().min(1,{message:""}),date:Wg().min(1,{message:""}),time:Wg().min(1,{message:""}),purpose:Wg().min(1,{message:""}),notes:Wg().optional()}),Uj=({onPatientSelect:e,selectedPatientId:t})=>{const[s,r]=d.useState(""),[n,a]=d.useState([]),{findPatientByPhone:o,searchPatients:l}=Ha();return d.useEffect(()=>{},[t]),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx(Vx,{children:""}),i.jsx(Ux,{placeholder:"//",value:s,onChange:e=>r(e.target.value)})]}),i.jsx("div",{className:"flex items-end",children:i.jsx(gu,{type:"button",variant:"outline",onClick:async()=>{if(s){const e=await l(s);a(e)}},children:i.jsx(cl,{className:"h-4 w-4"})})})]}),n.length>0&&i.jsx("div",{className:"border rounded-md p-2 space-y-2",children:n.map(s=>i.jsxs("div",{className:"p-2 rounded hover:bg-gray-100 cursor-pointer "+(t===s.id?"bg-gray-100":""),onClick:()=>e(s),children:[i.jsx("div",{className:"font-medium",children:s.name}),i.jsx("div",{className:"text-sm text-gray-500",children:s.phone})]},s.id))})]})},Wj=({form:e,onPatientSelect:t})=>i.jsx(pv,{control:e.control,name:"patient_id",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(Uj,{onPatientSelect:t,selectedPatientId:e.value}),i.jsx(wv,{})]})}),Vj=({form:e,dateField:t="date",timeField:s="time"})=>i.jsxs(i.Fragment,{children:[i.jsx(pv,{control:e.control,name:t,render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{type:"date",...e})}),i.jsx(wv,{})]})}),i.jsx(pv,{control:e.control,name:s,render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{type:"time",...e})}),i.jsx(wv,{})]})})]}),zj=({form:e})=>i.jsx(Vj,{form:e}),Bj=({form:e})=>i.jsxs(i.Fragment,{children:[i.jsx(pv,{control:e.control,name:"purpose",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{...e})}),i.jsx(wv,{})]})}),i.jsx(pv,{control:e.control,name:"notes",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(zx,{...e})}),i.jsx(wv,{})]})})]}),Hj=({onSubmit:e,onCancel:t})=>{const s=sf({resolver:hf(Fj),defaultValues:{patient_id:"",date:"",time:"",purpose:"",notes:""}});return i.jsx(hv,{...s,children:i.jsxs("form",{onSubmit:s.handleSubmit(e),className:"space-y-4",children:[i.jsx(Wj,{form:s,onPatientSelect:e=>{s.setValue("patient_id",e.id)}}),i.jsx(zj,{form:s}),i.jsx(Bj,{form:s}),i.jsxs(Gh,{children:[i.jsx(gu,{type:"button",variant:"outline",onClick:t,children:""}),i.jsx(gu,{type:"submit",children:""})]})]})})},Gj=({open:e,onOpenChange:t})=>{const{addAppointment:s}=Qj();return i.jsx(Uh,{open:e,onOpenChange:t,children:i.jsxs(Bh,{className:"sm:max-w-[500px]",children:[i.jsx(Hh,{children:i.jsx(Kh,{children:""})}),i.jsx(Hj,{onSubmit:async e=>{const{date:r,time:n,...a}=e,i=new Date(`${r}T${n}`);await s({...a,date:i.toISOString(),status:"SCHEDULED"})&&t(!1)},onCancel:()=>t(!1)})]})})},Kj=Gg({date:Wg().min(1,{message:""}),startTime:Wg().min(1,{message:""}),duration:Vg().min(5,{message:" 5 "}).max(60,{message:" 60 "}).default(15),purpose:Wg().min(1,{message:""}),notes:Wg().optional()}),Yj=({selectedPatients:e,onAddPatient:t,onRemovePatient:s,onMovePatient:r,onSortByDistance:a,searchTerm:o,onSearchTermChange:l,onSearch:c,searchResults:d})=>{const[u,h]=n.useState(null),m=e.length>1&&e.every(e=>null!==e.distance_from_hospital&&void 0!==e.distance_from_hospital);return i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(Vx,{children:""}),i.jsxs("div",{className:"flex gap-2 mt-1",children:[i.jsx(Ux,{placeholder:"  ...",value:o,onChange:e=>l(e.target.value)}),i.jsx(gu,{type:"button",variant:"outline",onClick:c,children:i.jsx(cl,{className:"h-4 w-4"})})]})]}),d.length>0&&i.jsxs("div",{className:"border rounded-md p-2 max-h-60 overflow-y-auto",children:[i.jsx("div",{className:"text-sm font-medium mb-2",children:""}),d.map(e=>i.jsxs("div",{className:"p-2 hover:bg-gray-100 flex justify-between items-center rounded-md",children:[i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:e.name}),i.jsx("div",{className:"text-sm text-gray-500",children:e.phone}),e.distance_from_hospital&&i.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1 mt-1",children:[i.jsx(Go,{className:"h-3 w-3"}),e.distance_from_hospital," ."]})]}),i.jsx(gu,{type:"button",size:"sm",onClick:()=>t(e),children:""})]},e.id))]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex justify-between items-center mb-1",children:[i.jsxs(Vx,{children:[" (",e.length,")"]}),i.jsxs("div",{className:"flex items-center gap-2",children:[e.length>1&&i.jsxs(gu,{type:"button",variant:"outline",size:"sm",onClick:a,disabled:!m,title:m?void 0:" ()",className:"text-xs",children:[i.jsx(to,{className:"h-3 w-3 mr-1"}),""]}),e.length>0&&i.jsx("span",{className:"text-xs text-gray-500",children:" (drag & drop )"})]})]}),e.length>0?i.jsx("div",{className:"border rounded-md p-2 max-h-60 overflow-y-auto",children:e.map((e,t)=>i.jsxs("div",{draggable:!0,onDragStart:()=>(e=>{h(e)})(t),onDragOver:e=>((e,t)=>{e.preventDefault(),null!==u&&u!==t&&(r(u,t),h(t))})(e,t),className:"flex items-center justify-between p-2 hover:bg-gray-50 border-b last:border-b-0",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("div",{className:"cursor-grab",children:i.jsx(Eo,{className:"h-4 w-4 text-gray-400"})}),i.jsxs("div",{children:[i.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.name,i.jsx(Lh,{variant:"outline",children:t+1})]}),i.jsx("div",{className:"text-sm text-gray-500",children:e.phone}),e.distance_from_hospital&&i.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1 mt-1",children:[i.jsx(Go,{className:"h-3 w-3"}),e.distance_from_hospital," ."]})]})]}),i.jsx(gu,{type:"button",variant:"ghost",size:"sm",onClick:()=>s(e.id),className:"text-red-500",children:i.jsx(Pl,{className:"h-4 w-4"})})]},e.id))}):i.jsx("div",{className:"border rounded-md p-6 text-center text-gray-500",children:""})]})]})},Jj=({form:e})=>i.jsxs("div",{className:"space-y-4",children:[i.jsx(pv,{control:e.control,name:"date",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{type:"date",...e})}),i.jsx(wv,{})]})}),i.jsxs("div",{className:"flex gap-4",children:[i.jsx("div",{className:"flex-1",children:i.jsx(pv,{control:e.control,name:"startTime",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{type:"time",...e})}),i.jsx(wv,{})]})})}),i.jsx("div",{className:"flex-1",children:i.jsx(pv,{control:e.control,name:"duration",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:" ()"}),i.jsx(vv,{children:i.jsx(Ux,{type:"number",...e,onChange:t=>e.onChange(parseInt(t.target.value)||15),min:5,max:60})}),i.jsx(wv,{})]})})})]}),i.jsx(pv,{control:e.control,name:"purpose",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{...e})}),i.jsx(wv,{})]})}),i.jsx(pv,{control:e.control,name:"notes",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(zx,{...e,placeholder:" ()",className:"min-h-[100px]"})}),i.jsx(wv,{})]})})]}),Zj=({patients:e,date:t,startTime:s,duration:r,onTimeSlotsChange:a})=>{const[o,l]=n.useState([]);n.useEffect(()=>{if(e.length>0&&t&&s){const e=c();a(e)}},[e,t,s,r]);const c=()=>{try{const t="HH:mm";let n=zd(s,t,new Date);const a=e.map((e,s)=>{s>0&&(n=new Date(n.getTime()+6e4*(r+5)));const a=zc(n,t),i=zc(n,"HH:mm .",{locale:cu});return{patientId:e.id,time:a,formattedTime:i}});return l(a),a.map(e=>({patientId:e.patientId,time:e.time}))}catch(t){return[]}};return 0!==e.length&&t&&s?i.jsxs("div",{className:"space-y-2",children:[i.jsx("h3",{className:"text-sm font-medium",children:""}),i.jsx("div",{className:"border rounded-md",children:i.jsxs(Zx,{children:[i.jsx(Xx,{children:i.jsxs(ty,{children:[i.jsx(sy,{className:"w-12",children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""})]})}),i.jsx(ey,{children:o.map((t,s)=>{const r=e.find(e=>e.id===t.patientId);return i.jsxs(ty,{children:[i.jsx(ry,{children:s+1}),i.jsx(ry,{children:(null==r?void 0:r.name)||""}),i.jsx(ry,{children:t.formattedTime})]},t.patientId)})})]})}),i.jsxs("div",{className:"text-xs text-gray-500",children:["*  ",r,"  1   5 "]})]}):null};var Xj="Progress",[eN]=se(Xj),[tN,sN]=eN(Xj),rN=n.forwardRef((e,t)=>{const{__scopeProgress:s,value:r=null,max:n,getValueLabel:a=iN,...o}=e;(n||0===n)&&cN(n);const l=cN(n)?n:100;null!==r&&dN(r,l);const c=dN(r,l)?r:null,d=lN(c)?a(c,l):void 0;return i.jsx(tN,{scope:s,value:c,max:l,children:i.jsx(ye.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":lN(c)?c:void 0,"aria-valuetext":d,role:"progressbar","data-state":oN(c,l),"data-value":c??void 0,"data-max":l,...o,ref:t})})});rN.displayName=Xj;var nN="ProgressIndicator",aN=n.forwardRef((e,t)=>{const{__scopeProgress:s,...r}=e,n=sN(nN,s);return i.jsx(ye.div,{"data-state":oN(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...r,ref:t})});function iN(e,t){return`${Math.round(e/t*100)}%`}function oN(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function lN(e){return"number"==typeof e}function cN(e){return lN(e)&&!isNaN(e)&&e>0}function dN(e,t){return lN(e)&&!isNaN(e)&&e<=t&&e>=0}aN.displayName=nN;var uN=rN,hN=aN;const mN=n.forwardRef(({className:e,value:t,...s},r)=>i.jsx(uN,{ref:r,className:Qi("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...s,children:i.jsx(hN,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));mN.displayName=uN.displayName;const pN=({patients:e,date:t,timeSlots:s,purpose:r,notes:n,isProcessing:a,progress:o})=>{const l=t?zc(new Date(t),"dd MMMM yyyy",{locale:cu}):"";return i.jsx("div",{className:"space-y-4",children:i.jsxs(Fi,{children:[i.jsxs(Ui,{children:[i.jsx(Wi,{children:""}),i.jsx(Vi,{children:""})]}),i.jsxs(zi,{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold",children:""}),i.jsx("div",{children:l})]}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold",children:""}),i.jsx("div",{children:(()=>{var e,t;if(0===s.length)return"";return`${(null==(e=s[0])?void 0:e.time)||""} - ${(null==(t=s[s.length-1])?void 0:t.time)||""}`})()})]}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold",children:""}),i.jsx("div",{children:r})]}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold",children:""}),i.jsxs("div",{children:[e.length," "]})]})]}),n&&i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold",children:""}),i.jsx("div",{className:"text-sm",children:n})]}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm font-semibold mb-2",children:""}),i.jsx("div",{className:"border rounded-md divide-y max-h-60 overflow-y-auto",children:e.map((e,t)=>{const r=s.find(t=>t.patientId===e.id);return i.jsxs("div",{className:"p-2 flex justify-between",children:[i.jsxs("div",{children:[t+1,". ",e.name]}),i.jsx("div",{className:"text-gray-500",children:(null==r?void 0:r.time)||"-"})]},e.id)})})]}),a&&i.jsxs("div",{className:"space-y-1",children:[i.jsxs("div",{className:"text-sm flex justify-between",children:[i.jsx("span",{children:"..."}),i.jsxs("span",{children:[o,"%"]})]}),i.jsx(mN,{value:o,className:"h-2"})]})]})]})})},fN=()=>({toast:e=>{}}),gN=({onCancel:e,onSuccess:t})=>{const[s,r]=n.useState("patients"),[a,o]=n.useState([]),{selectedPatients:l,searchTerm:c,setSearchTerm:d,searchResults:u,handleSearch:h,addPatient:m,removePatient:p,reorderPatients:f,sortByDistance:g,clearSelection:x}=(()=>{const[e,t]=n.useState([]),[s,r]=n.useState(""),[a,i]=n.useState([]),{searchPatients:o}=Ha();return{selectedPatients:e,setSelectedPatients:t,searchTerm:s,setSearchTerm:r,searchResults:a,handleSearch:async()=>{if(s){const t=(await o(s)).filter(t=>!e.some(e=>e.id===t.id));i(t)}else i([])},addPatient:s=>{e.some(e=>e.id===s.id)||(t([...e,s]),i(a.filter(e=>e.id!==s.id)))},removePatient:s=>{t(e.filter(e=>e.id!==s))},reorderPatients:(s,r)=>{const n=Array.from(e),[a]=n.splice(s,1);n.splice(r,0,a),t(n)},sortByDistance:()=>{const s=[...e].sort((e,t)=>(e.distance_from_hospital||999999)-(t.distance_from_hospital||999999));t(s)},clearSelection:()=>{t([]),i([]),r("")}}})(),{createBatchAppointments:y,loading:v,progress:b}=(()=>{const[e,t]=n.useState(!1),[s,r]=n.useState(0),{toast:a}=fN();return{createBatchAppointments:async e=>{const{date:s,patientSlots:n,purpose:i,notes:o}=e;try{t(!0),r(0);const e=n.length,l=[];for(let t=0;t<n.length;t++){const{patientId:a,time:c}=n[t],d=new Date(`${s}T${c}`),{data:u,error:h}=await qa.from("appointments").insert([{patient_id:a,date:d.toISOString(),purpose:i,notes:o,status:"SCHEDULED"}]).select();if(h)throw h;u&&u.length>0&&l.push(u[0]),r(Math.floor((t+1)/e*100))}return a({title:"",description:` ${l.length} `}),l}catch(l){return a({title:"",description:" ",variant:"destructive"}),null}finally{t(!1),r(0)}},loading:e,progress:s}})(),w=sf({resolver:hf(Kj),defaultValues:{date:"",startTime:"",duration:15,purpose:"",notes:""}}),j=e=>{r(e)},N=l.length>0,_=N&&w.formState.isValid;return n.useEffect(()=>()=>{x(),w.reset()},[]),i.jsx(hv,{...w,children:i.jsx("form",{onSubmit:w.handleSubmit(async e=>{if(0===l.length||0===a.length)return;await y({date:e.date,patientSlots:a,purpose:e.purpose,notes:e.notes})&&t()}),className:"space-y-6",children:i.jsxs(Oh,{value:s,onValueChange:r,children:[i.jsxs(Ah,{className:"grid grid-cols-3",children:[i.jsx(Dh,{value:"patients",children:""}),i.jsx(Dh,{value:"details",disabled:!N,children:""}),i.jsx(Dh,{value:"review",disabled:!_,children:""})]}),i.jsxs("div",{className:"mt-6",children:[i.jsx(Mh,{value:"patients",className:"space-y-4",children:i.jsxs("div",{className:"flex flex-col max-h-[80vh]",children:[i.jsx("div",{className:"space-y-4 overflow-y-auto pr-2 flex-1",children:i.jsx(Yj,{selectedPatients:l,onAddPatient:m,onRemovePatient:p,onMovePatient:f,onSortByDistance:g,searchTerm:c,onSearchTermChange:d,onSearch:h,searchResults:u})}),i.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[i.jsx(gu,{type:"button",variant:"outline",onClick:e,children:""}),i.jsxs(gu,{type:"button",onClick:()=>{N&&j("details")},disabled:!N,children:[" ",i.jsx(eo,{className:"ml-1 h-4 w-4"})]})]})]})}),i.jsx(Mh,{value:"details",className:"space-y-4",children:i.jsxs("div",{className:"flex flex-col max-h-[80vh]",children:[i.jsxs("div",{className:"space-y-4 overflow-y-auto pr-2 flex-1",children:[i.jsx(Jj,{form:w}),l.length>0&&i.jsx(Zj,{patients:l,date:w.watch("date"),startTime:w.watch("startTime"),duration:w.watch("duration"),onTimeSlotsChange:e=>{o(e)}})]}),i.jsxs("div",{className:"flex justify-between mt-4 pt-2",children:[i.jsxs(gu,{type:"button",variant:"outline",onClick:()=>j("patients"),children:[i.jsx(Zi,{className:"mr-1 h-4 w-4"})," "]}),i.jsxs(gu,{type:"button",onClick:()=>{_&&j("review")},disabled:!w.formState.isValid,children:[" ",i.jsx(eo,{className:"ml-1 h-4 w-4"})]})]})]})}),i.jsx(Mh,{value:"review",children:i.jsxs("div",{className:"flex flex-col max-h-[80vh]",children:[i.jsx("div",{className:"space-y-4 overflow-y-auto pr-2 flex-1",children:i.jsx(pN,{patients:l,date:w.watch("date"),timeSlots:a,purpose:w.watch("purpose"),notes:w.watch("notes"),isProcessing:v,progress:b})}),i.jsxs("div",{className:"flex justify-between mt-4",children:[i.jsxs(gu,{type:"button",variant:"outline",onClick:()=>j("details"),children:[i.jsx(Zi,{className:"mr-1 h-4 w-4"})," "]}),i.jsxs(gu,{type:"submit",disabled:v||0===l.length,children:[i.jsx(lo,{className:"mr-1 h-4 w-4"})," "]})]})]})})]})]})})})},xN=({open:e,onOpenChange:t,onAppointmentsCreated:s})=>i.jsx(Uh,{open:e,onOpenChange:t,children:i.jsxs(Bh,{className:"sm:max-w-[700px]",children:[i.jsx(Hh,{children:i.jsx(Kh,{children:""})}),i.jsx(gN,{onCancel:()=>{t(!1)},onSuccess:()=>{s&&s(),t(!1)}})]})}),yN=({onAppointmentsRefresh:e})=>{const[t,s]=n.useState(!1),[r,a]=n.useState(!1);return i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:""}),i.jsx("p",{className:"text-gray-500",children:""})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs(gu,{variant:"outline",className:"border-pharmacy-600 text-pharmacy-600 hover:bg-pharmacy-50",onClick:()=>a(!0),children:[i.jsx(Tl,{className:"w-4 h-4 mr-2"}),""]}),i.jsxs(gu,{className:"bg-pharmacy-600 hover:bg-pharmacy-700 text-white",onClick:()=>s(!0),children:[i.jsx(sl,{className:"w-4 h-4 mr-2"}),""]})]}),i.jsx(Gj,{open:t,onOpenChange:s}),i.jsx(xN,{open:r,onOpenChange:a,onAppointmentsCreated:()=>{e&&e()}})]})},vN=({todayCount:e,tomorrowCount:t,totalCount:s,upcomingCount:r})=>{const n=new Date,a=new Date(n);return a.setDate(a.getDate()+1),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[i.jsx(Fi,{className:"dashboard-card",children:i.jsxs(zi,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:""}),i.jsx("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:e})]}),i.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:i.jsx(ao,{className:"w-6 h-6 text-green-600"})})]}),i.jsx("div",{className:"mt-4",children:i.jsxs("div",{className:"text-xs text-gray-500",children:[" ",zc(n,"dd MMMM yyyy",{locale:cu})]})})]})}),i.jsx(Fi,{className:"dashboard-card",children:i.jsxs(zi,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:""}),i.jsx("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:t})]}),i.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:i.jsx(jo,{className:"w-6 h-6 text-blue-600"})})]}),i.jsx("div",{className:"mt-4",children:i.jsxs("div",{className:"text-xs text-gray-500",children:[" ",zc(a,"dd MMMM yyyy",{locale:cu})]})})]})}),i.jsx(Fi,{className:"dashboard-card",children:i.jsxs(zi,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:""}),i.jsx("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:s})]}),i.jsx("div",{className:"bg-purple-100 p-3 rounded-full",children:i.jsx(Tl,{className:"w-6 h-6 text-purple-600"})})]}),i.jsx("div",{className:"mt-4",children:i.jsxs("div",{className:"text-xs text-gray-500",children:[" ",i.jsx("span",{className:"font-medium text-purple-600",children:r})," "]})})]})})]})};var bN=function(){return bN=Object.assign||function(e){for(var t,s=1,r=arguments.length;s<r;s++)for(var n in t=arguments[s])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},bN.apply(this,arguments)};function wN(e,t,s){for(var r,n=0,a=t.length;n<a;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}function jN(e){return"multiple"===e.mode}function NN(e){return"range"===e.mode}function _N(e){return"single"===e.mode}"function"==typeof SuppressedError&&SuppressedError;var SN={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};var kN=Object.freeze({__proto__:null,formatCaption:function(e,t){return zc(e,"LLLL y",t)},formatDay:function(e,t){return zc(e,"d",t)},formatMonthCaption:function(e,t){return zc(e,"LLLL",t)},formatWeekNumber:function(e){return"".concat(e)},formatWeekdayName:function(e,t){return zc(e,"cccccc",t)},formatYearCaption:function(e,t){return zc(e,"yyyy",t)}}),CN=Object.freeze({__proto__:null,labelDay:function(e,t,s){return zc(e,"do MMMM (EEEE)",s)},labelMonthDropdown:function(){return"Month: "},labelNext:function(){return"Go to next month"},labelPrevious:function(){return"Go to previous month"},labelWeekNumber:function(e){return"Week n. ".concat(e)},labelWeekday:function(e,t){return zc(e,"cccc",t)},labelYearDropdown:function(){return"Year: "}});var TN=n.createContext(void 0);function EN(e){var t,s,r=e.initialProps,n={captionLayout:"buttons",classNames:SN,formatters:kN,labels:CN,locale:fc,modifiersClassNames:{},modifiers:{},numberOfMonths:1,styles:{},today:new Date,mode:"default"},a=function(e){var t=e.fromYear,s=e.toYear,r=e.fromMonth,n=e.toMonth,a=e.fromDate,i=e.toDate;return r?a=nc(r):t&&(a=new Date(t,0,1)),n?i=tc(n):s&&(i=new Date(s,11,31)),{fromDate:a?zl(a):void 0,toDate:i?zl(i):void 0}}(r),o=a.fromDate,l=a.toDate,c=null!==(t=r.captionLayout)&&void 0!==t?t:n.captionLayout;"buttons"===c||o&&l||(c="buttons"),(_N(r)||jN(r)||NN(r))&&(s=r.onSelect);var d=bN(bN(bN({},n),r),{captionLayout:c,classNames:bN(bN({},n.classNames),r.classNames),components:bN({},r.components),formatters:bN(bN({},n.formatters),r.formatters),fromDate:o,labels:bN(bN({},n.labels),r.labels),mode:r.mode||n.mode,modifiers:bN(bN({},n.modifiers),r.modifiers),modifiersClassNames:bN(bN({},n.modifiersClassNames),r.modifiersClassNames),onSelect:s,styles:bN(bN({},n.styles),r.styles),toDate:l});return i.jsx(TN.Provider,{value:d,children:e.children})}function IN(){var e=n.useContext(TN);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function PN(e){var t=IN(),s=t.locale,r=t.classNames,n=t.styles,a=t.formatters.formatCaption;return i.jsx("div",{className:r.caption_label,style:n.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:a(e.displayMonth,{locale:s})})}function ON(e){return i.jsx("svg",bN({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:i.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function AN(e){var t,s,r=e.onChange,n=e.value,a=e.children,o=e.caption,l=e.className,c=e.style,d=IN(),u=null!==(s=null===(t=d.components)||void 0===t?void 0:t.IconDropdown)&&void 0!==s?s:ON;return i.jsxs("div",{className:l,style:c,children:[i.jsx("span",{className:d.classNames.vhidden,children:e["aria-label"]}),i.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:d.classNames.dropdown,style:d.styles.dropdown,value:n,onChange:r,children:a}),i.jsxs("div",{className:d.classNames.caption_label,style:d.styles.caption_label,"aria-hidden":"true",children:[o,i.jsx(u,{className:d.classNames.dropdown_icon,style:d.styles.dropdown_icon})]})]})}function DN(e){var t,s=IN(),r=s.fromDate,n=s.toDate,a=s.styles,o=s.locale,l=s.formatters.formatMonthCaption,c=s.classNames,d=s.components,u=s.labels.labelMonthDropdown;if(!r)return i.jsx(i.Fragment,{});if(!n)return i.jsx(i.Fragment,{});var h=[];if(function(e,t){const s=Ol(e),r=Ol(t);return s.getFullYear()===r.getFullYear()}(r,n))for(var m=nc(r),p=r.getMonth();p<=n.getMonth();p++)h.push(nu(m,p));else for(m=nc(new Date),p=0;p<=11;p++)h.push(nu(m,p));var f=null!==(t=null==d?void 0:d.Dropdown)&&void 0!==t?t:AN;return i.jsx(f,{name:"months","aria-label":u(),className:c.dropdown_month,style:a.dropdown_month,onChange:function(t){var s=Number(t.target.value),r=nu(nc(e.displayMonth),s);e.onChange(r)},value:e.displayMonth.getMonth(),caption:l(e.displayMonth,{locale:o}),children:h.map(function(e){return i.jsx("option",{value:e.getMonth(),children:l(e,{locale:o})},e.getMonth())})})}function MN(e){var t,s=e.displayMonth,r=IN(),n=r.fromDate,a=r.toDate,o=r.locale,l=r.styles,c=r.classNames,d=r.components,u=r.formatters.formatYearCaption,h=r.labels.labelYearDropdown,m=[];if(!n)return i.jsx(i.Fragment,{});if(!a)return i.jsx(i.Fragment,{});for(var p=n.getFullYear(),f=a.getFullYear(),g=p;g<=f;g++)m.push(au(ac(new Date),g));var x=null!==(t=null==d?void 0:d.Dropdown)&&void 0!==t?t:AN;return i.jsx(x,{name:"years","aria-label":h(),className:c.dropdown_year,style:l.dropdown_year,onChange:function(t){var r=au(nc(s),Number(t.target.value));e.onChange(r)},value:s.getFullYear(),caption:u(s,{locale:o}),children:m.map(function(e){return i.jsx("option",{value:e.getFullYear(),children:u(e,{locale:o})},e.getFullYear())})})}function qN(){var e=IN(),t=function(e){var t=e.month,s=e.defaultMonth,r=e.today,n=t||s||r||new Date,a=e.toDate,i=e.fromDate,o=e.numberOfMonths,l=void 0===o?1:o;return a&&Xl(a,n)<0&&(n=Ml(a,-1*(l-1))),i&&Xl(n,i)<0&&(n=i),nc(n)}(e),s=function(e,t){var s=n.useState(e),r=s[0];return[void 0===t?r:t,s[1]]}(t,e.month),r=s[0],a=s[1];return[r,function(t){var s;if(!e.disableNavigation){var r=nc(t);a(r),null===(s=e.onMonthChange)||void 0===s||s.call(e,r)}}]}var RN=n.createContext(void 0);function $N(e){var t=IN(),s=qN(),r=s[0],n=s[1],a=function(e,t){for(var s=t.reverseMonths,r=t.numberOfMonths,n=nc(e),a=Xl(nc(Ml(n,r)),n),i=[],o=0;o<a;o++){var l=Ml(n,o);i.push(l)}return s&&(i=i.reverse()),i}(r,t),o=function(e,t){if(!t.disableNavigation){var s=t.toDate,r=t.pagedNavigation,n=t.numberOfMonths,a=void 0===n?1:n,i=r?a:1,o=nc(e);if(!s)return Ml(o,i);if(!(Xl(s,e)<a))return Ml(o,i)}}(r,t),l=function(e,t){if(!t.disableNavigation){var s=t.fromDate,r=t.pagedNavigation,n=t.numberOfMonths,a=r?void 0===n?1:n:1,i=nc(e);if(!s)return Ml(i,-a);if(!(Xl(i,s)<=0))return Ml(i,-a)}}(r,t),c=function(e){return a.some(function(t){return Hd(e,t)})},d={currentMonth:r,displayMonths:a,goToMonth:n,goToDate:function(e,s){c(e)||(s&&Yc(e,s)?n(Ml(e,1+-1*t.numberOfMonths)):n(e))},previousMonth:l,nextMonth:o,isDateDisplayed:c};return i.jsx(RN.Provider,{value:d,children:e.children})}function LN(){var e=n.useContext(RN);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function QN(e){var t,s=IN(),r=s.classNames,n=s.styles,a=s.components,o=LN().goToMonth,l=function(t){o(Ml(t,e.displayIndex?-e.displayIndex:0))},c=null!==(t=null==a?void 0:a.CaptionLabel)&&void 0!==t?t:PN,d=i.jsx(c,{id:e.id,displayMonth:e.displayMonth});return i.jsxs("div",{className:r.caption_dropdowns,style:n.caption_dropdowns,children:[i.jsx("div",{className:r.vhidden,children:d}),i.jsx(DN,{onChange:l,displayMonth:e.displayMonth}),i.jsx(MN,{onChange:l,displayMonth:e.displayMonth})]})}function FN(e){return i.jsx("svg",bN({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:i.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function UN(e){return i.jsx("svg",bN({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:i.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var WN=n.forwardRef(function(e,t){var s=IN(),r=s.classNames,n=s.styles,a=[r.button_reset,r.button];e.className&&a.push(e.className);var o=a.join(" "),l=bN(bN({},n.button_reset),n.button);return e.style&&Object.assign(l,e.style),i.jsx("button",bN({},e,{ref:t,type:"button",className:o,style:l}))});function VN(e){var t,s,r=IN(),n=r.dir,a=r.locale,o=r.classNames,l=r.styles,c=r.labels,d=c.labelPrevious,u=c.labelNext,h=r.components;if(!e.nextMonth&&!e.previousMonth)return i.jsx(i.Fragment,{});var m=d(e.previousMonth,{locale:a}),p=[o.nav_button,o.nav_button_previous].join(" "),f=u(e.nextMonth,{locale:a}),g=[o.nav_button,o.nav_button_next].join(" "),x=null!==(t=null==h?void 0:h.IconRight)&&void 0!==t?t:UN,y=null!==(s=null==h?void 0:h.IconLeft)&&void 0!==s?s:FN;return i.jsxs("div",{className:o.nav,style:l.nav,children:[!e.hidePrevious&&i.jsx(WN,{name:"previous-month","aria-label":m,className:p,style:l.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:"rtl"===n?i.jsx(x,{className:o.nav_icon,style:l.nav_icon}):i.jsx(y,{className:o.nav_icon,style:l.nav_icon})}),!e.hideNext&&i.jsx(WN,{name:"next-month","aria-label":f,className:g,style:l.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:"rtl"===n?i.jsx(y,{className:o.nav_icon,style:l.nav_icon}):i.jsx(x,{className:o.nav_icon,style:l.nav_icon})})]})}function zN(e){var t=IN().numberOfMonths,s=LN(),r=s.previousMonth,n=s.nextMonth,a=s.goToMonth,o=s.displayMonths,l=o.findIndex(function(t){return Hd(e.displayMonth,t)}),c=0===l,d=l===o.length-1,u=t>1&&(c||!d),h=t>1&&(d||!c);return i.jsx(VN,{displayMonth:e.displayMonth,hideNext:u,hidePrevious:h,nextMonth:n,previousMonth:r,onPreviousClick:function(){r&&a(r)},onNextClick:function(){n&&a(n)}})}function BN(e){var t,s,r=IN(),n=r.classNames,a=r.disableNavigation,o=r.styles,l=r.captionLayout,c=r.components,d=null!==(t=null==c?void 0:c.CaptionLabel)&&void 0!==t?t:PN;return s=a?i.jsx(d,{id:e.id,displayMonth:e.displayMonth}):"dropdown"===l?i.jsx(QN,{displayMonth:e.displayMonth,id:e.id}):"dropdown-buttons"===l?i.jsxs(i.Fragment,{children:[i.jsx(QN,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),i.jsx(zN,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):i.jsxs(i.Fragment,{children:[i.jsx(d,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),i.jsx(zN,{displayMonth:e.displayMonth,id:e.id})]}),i.jsx("div",{className:n.caption,style:o.caption,children:s})}function HN(e){var t=IN(),s=t.footer,r=t.styles,n=t.classNames.tfoot;return s?i.jsx("tfoot",{className:n,style:r.tfoot,children:i.jsx("tr",{children:i.jsx("td",{colSpan:8,children:s})})}):i.jsx(i.Fragment,{})}function GN(){var e=IN(),t=e.classNames,s=e.styles,r=e.showWeekNumber,n=e.locale,a=e.weekStartsOn,o=e.ISOWeek,l=e.formatters.formatWeekdayName,c=e.labels.labelWeekday,d=function(e,t,s){for(var r=s?Wl(new Date):Ul(new Date,{locale:e,weekStartsOn:t}),n=[],a=0;a<7;a++){var i=Dl(r,a);n.push(i)}return n}(n,a,o);return i.jsxs("tr",{style:s.head_row,className:t.head_row,children:[r&&i.jsx("td",{style:s.head_cell,className:t.head_cell}),d.map(function(e,r){return i.jsx("th",{scope:"col",className:t.head_cell,style:s.head_cell,"aria-label":c(e,{locale:n}),children:l(e,{locale:n})},r)})]})}function KN(){var e,t=IN(),s=t.classNames,r=t.styles,n=t.components,a=null!==(e=null==n?void 0:n.HeadRow)&&void 0!==e?e:GN;return i.jsx("thead",{style:r.head,className:s.head,children:i.jsx(a,{})})}function YN(e){var t=IN(),s=t.locale,r=t.formatters.formatDay;return i.jsx(i.Fragment,{children:r(e.date,{locale:s})})}var JN=n.createContext(void 0);function ZN(e){if(!jN(e.initialProps)){return i.jsx(JN.Provider,{value:{selected:void 0,modifiers:{disabled:[]}},children:e.children})}return i.jsx(XN,{initialProps:e.initialProps,children:e.children})}function XN(e){var t=e.initialProps,s=e.children,r=t.selected,n=t.min,a=t.max,o={disabled:[]};r&&o.disabled.push(function(e){var t=a&&r.length>a-1,s=r.some(function(t){return Jl(t,e)});return Boolean(t&&!s)});var l={selected:r,onDayClick:function(e,s,i){var o,l;if((null===(o=t.onDayClick)||void 0===o||o.call(t,e,s,i),!Boolean(s.selected&&n&&(null==r?void 0:r.length)===n))&&!Boolean(!s.selected&&a&&(null==r?void 0:r.length)===a)){var c=r?wN([],r):[];if(s.selected){var d=c.findIndex(function(t){return Jl(e,t)});c.splice(d,1)}else c.push(e);null===(l=t.onSelect)||void 0===l||l.call(t,c,e,s,i)}},modifiers:o};return i.jsx(JN.Provider,{value:l,children:s})}function e_(){var e=n.useContext(JN);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}var t_,s_,r_=n.createContext(void 0);function n_(e){if(!NN(e.initialProps)){return i.jsx(r_.Provider,{value:{selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}},children:e.children})}return i.jsx(a_,{initialProps:e.initialProps,children:e.children})}function a_(e){var t=e.initialProps,s=e.children,r=t.selected,n=r||{},a=n.from,o=n.to,l=t.min,c=t.max,d={range_start:[],range_end:[],range_middle:[],disabled:[]};if(a?(d.range_start=[a],o?(d.range_end=[o],Jl(a,o)||(d.range_middle=[{after:a,before:o}])):d.range_end=[a]):o&&(d.range_start=[o],d.range_end=[o]),l&&(a&&!o&&d.disabled.push({after:Gd(a,l-1),before:Dl(a,l-1)}),a&&o&&d.disabled.push({after:a,before:Dl(a,l-1)}),!a&&o&&d.disabled.push({after:Gd(o,l-1),before:Dl(o,l-1)})),c){if(a&&!o&&(d.disabled.push({before:Dl(a,1-c)}),d.disabled.push({after:Dl(a,c-1)})),a&&o){var u=c-(Hl(o,a)+1);d.disabled.push({before:Gd(a,u)}),d.disabled.push({after:Dl(o,u)})}!a&&o&&(d.disabled.push({before:Dl(o,1-c)}),d.disabled.push({after:Dl(o,c-1)}))}return i.jsx(r_.Provider,{value:{selected:r,onDayClick:function(e,s,n){var a,i;null===(a=t.onDayClick)||void 0===a||a.call(t,e,s,n);var o=function(e,t){var s=t||{},r=s.from,n=s.to;if(r&&n){if(Jl(n,e)&&Jl(r,e))return;if(Jl(n,e))return{from:n,to:void 0};if(Jl(r,e))return;return Kc(r,e)?{from:e,to:n}:{from:r,to:e}}return n?Kc(e,n)?{from:n,to:e}:{from:e,to:n}:r?Yc(e,r)?{from:e,to:r}:{from:r,to:e}:{from:e,to:void 0}}(e,r);null===(i=t.onSelect)||void 0===i||i.call(t,o,e,s,n)},modifiers:d},children:s})}function i_(){var e=n.useContext(r_);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function o_(e){return Array.isArray(e)?wN([],e):void 0!==e?[e]:[]}(s_=t_||(t_={})).Outside="outside",s_.Disabled="disabled",s_.Selected="selected",s_.Hidden="hidden",s_.Today="today",s_.RangeStart="range_start",s_.RangeEnd="range_end",s_.RangeMiddle="range_middle";var l_=t_.Selected,c_=t_.Disabled,d_=t_.Hidden,u_=t_.Today,h_=t_.RangeEnd,m_=t_.RangeMiddle,p_=t_.RangeStart,f_=t_.Outside;var g_=n.createContext(void 0);function x_(e){var t=IN(),s=function(e,t,s){var r,n=((r={})[l_]=o_(e.selected),r[c_]=o_(e.disabled),r[d_]=o_(e.hidden),r[u_]=[e.today],r[h_]=[],r[m_]=[],r[p_]=[],r[f_]=[],r);return e.fromDate&&n[c_].push({before:e.fromDate}),e.toDate&&n[c_].push({after:e.toDate}),jN(e)?n[c_]=n[c_].concat(t.modifiers[c_]):NN(e)&&(n[c_]=n[c_].concat(s.modifiers[c_]),n[p_]=s.modifiers[p_],n[m_]=s.modifiers[m_],n[h_]=s.modifiers[h_]),n}(t,e_(),i_()),r=function(e){var t={};return Object.entries(e).forEach(function(e){var s=e[0],r=e[1];t[s]=o_(r)}),t}(t.modifiers),n=bN(bN({},s),r);return i.jsx(g_.Provider,{value:n,children:e.children})}function y_(){var e=n.useContext(g_);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function v_(e,t){return t.some(function(t){if("boolean"==typeof t)return t;if(Zl(t))return Jl(e,t);var s,r,n,a,i;if(function(e){return Array.isArray(e)&&e.every(Zl)}(t))return t.includes(e);if(function(e){return Boolean(e&&"object"==typeof e&&"from"in e)}(t))return s=e,a=(r=t).from,i=r.to,a&&i?(Hl(i,a)<0&&(a=(n=[i,a])[0],i=n[1]),Hl(s,a)>=0&&Hl(i,s)>=0):i?Jl(i,s):!!a&&Jl(a,s);if(function(e){return Boolean(e&&"object"==typeof e&&"dayOfWeek"in e)}(t))return t.dayOfWeek.includes(e.getDay());if(function(e){return Boolean(e&&"object"==typeof e&&"before"in e&&"after"in e)}(t)){var o=Hl(t.before,e)>0,l=Hl(t.after,e)<0;return Kc(t.before,t.after)?l&&o:o||l}return function(e){return Boolean(e&&"object"==typeof e&&"after"in e)}(t)?Hl(e,t.after)>0:function(e){return Boolean(e&&"object"==typeof e&&"before"in e)}(t)?Hl(t.before,e)>0:"function"==typeof t&&t(e)})}function b_(e,t,s){var r=Object.keys(t).reduce(function(s,r){var n=t[r];return v_(e,n)&&s.push(r),s},[]),n={};return r.forEach(function(e){return n[e]=!0}),s&&!Hd(e,s)&&(n.outside=!0),n}function w_(e,t){var s=t.moveBy,r=t.direction,n=t.context,a=t.modifiers,i=t.retry,o=void 0===i?{count:0,lastFocused:e}:i,l=n.weekStartsOn,c=n.fromDate,d=n.toDate,u=n.locale,h={day:Dl,week:Gl,month:Ml,year:Kl,startOfWeek:function(e){return n.ISOWeek?Wl(e):Ul(e,{locale:u,weekStartsOn:l})},endOfWeek:function(e){return n.ISOWeek?oc(e):ic(e,{locale:u,weekStartsOn:l})}}[s](e,"after"===r?1:-1);"before"===r&&c?h=function(e){let t;return e.forEach(function(e){const s=Ol(e);(void 0===t||t<s||isNaN(Number(s)))&&(t=s)}),t||new Date(NaN)}([c,h]):"after"===r&&d&&(h=function(e){let t;return e.forEach(e=>{const s=Ol(e);(!t||t>s||isNaN(+s))&&(t=s)}),t||new Date(NaN)}([d,h]));var m=!0;if(a){var p=b_(h,a);m=!p.disabled&&!p.hidden}return m?h:o.count>365?o.lastFocused:w_(h,{moveBy:s,direction:r,context:n,modifiers:a,retry:bN(bN({},o),{count:o.count+1})})}var j_=n.createContext(void 0);function N_(e){var t=LN(),s=y_(),r=n.useState(),a=r[0],o=r[1],l=n.useState(),c=l[0],d=l[1],u=function(e,t){for(var s,r,n=nc(e[0]),a=tc(e[e.length-1]),i=n;i<=a;){var o=b_(i,t);if(o.disabled||o.hidden)i=Dl(i,1);else{if(o.selected)return i;o.today&&!r&&(r=i),s||(s=i),i=Dl(i,1)}}return r||s}(t.displayMonths,s),h=(null!=a?a:c&&t.isDateDisplayed(c))?c:u,m=function(e){o(e)},p=IN(),f=function(e,r){if(a){var n=w_(a,{moveBy:e,direction:r,context:p,modifiers:s});Jl(a,n)||(t.goToDate(n,a),m(n))}},g={focusedDay:a,focusTarget:h,blur:function(){d(a),o(void 0)},focus:m,focusDayAfter:function(){return f("day","after")},focusDayBefore:function(){return f("day","before")},focusWeekAfter:function(){return f("week","after")},focusWeekBefore:function(){return f("week","before")},focusMonthBefore:function(){return f("month","before")},focusMonthAfter:function(){return f("month","after")},focusYearBefore:function(){return f("year","before")},focusYearAfter:function(){return f("year","after")},focusStartOfWeek:function(){return f("startOfWeek","before")},focusEndOfWeek:function(){return f("endOfWeek","after")}};return i.jsx(j_.Provider,{value:g,children:e.children})}function __(){var e=n.useContext(j_);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}var S_=n.createContext(void 0);function k_(e){if(!_N(e.initialProps)){return i.jsx(S_.Provider,{value:{selected:void 0},children:e.children})}return i.jsx(C_,{initialProps:e.initialProps,children:e.children})}function C_(e){var t=e.initialProps,s=e.children,r={selected:t.selected,onDayClick:function(e,s,r){var n,a,i;null===(n=t.onDayClick)||void 0===n||n.call(t,e,s,r),!s.selected||t.required?null===(i=t.onSelect)||void 0===i||i.call(t,e,e,s,r):null===(a=t.onSelect)||void 0===a||a.call(t,void 0,e,s,r)}};return i.jsx(S_.Provider,{value:r,children:s})}function T_(){var e=n.useContext(S_);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function E_(e,t){var s=[e.classNames.day];return Object.keys(t).forEach(function(t){var r=e.modifiersClassNames[t];if(r)s.push(r);else if(function(e){return Object.values(t_).includes(e)}(t)){var n=e.classNames["day_".concat(t)];n&&s.push(n)}}),s}function I_(e,t,s){var r,a,o,l=IN(),c=__(),d=function(e,t){return b_(e,y_(),t)}(e,t),u=function(e,t){var s=IN(),r=T_(),n=e_(),a=i_(),i=__(),o=i.focusDayAfter,l=i.focusDayBefore,c=i.focusWeekAfter,d=i.focusWeekBefore,u=i.blur,h=i.focus,m=i.focusMonthBefore,p=i.focusMonthAfter,f=i.focusYearBefore,g=i.focusYearAfter,x=i.focusStartOfWeek,y=i.focusEndOfWeek;return{onClick:function(i){var o,l,c,d;_N(s)?null===(o=r.onDayClick)||void 0===o||o.call(r,e,t,i):jN(s)?null===(l=n.onDayClick)||void 0===l||l.call(n,e,t,i):NN(s)?null===(c=a.onDayClick)||void 0===c||c.call(a,e,t,i):null===(d=s.onDayClick)||void 0===d||d.call(s,e,t,i)},onFocus:function(r){var n;h(e),null===(n=s.onDayFocus)||void 0===n||n.call(s,e,t,r)},onBlur:function(r){var n;u(),null===(n=s.onDayBlur)||void 0===n||n.call(s,e,t,r)},onKeyDown:function(r){var n;switch(r.key){case"ArrowLeft":r.preventDefault(),r.stopPropagation(),"rtl"===s.dir?o():l();break;case"ArrowRight":r.preventDefault(),r.stopPropagation(),"rtl"===s.dir?l():o();break;case"ArrowDown":r.preventDefault(),r.stopPropagation(),c();break;case"ArrowUp":r.preventDefault(),r.stopPropagation(),d();break;case"PageUp":r.preventDefault(),r.stopPropagation(),r.shiftKey?f():m();break;case"PageDown":r.preventDefault(),r.stopPropagation(),r.shiftKey?g():p();break;case"Home":r.preventDefault(),r.stopPropagation(),x();break;case"End":r.preventDefault(),r.stopPropagation(),y()}null===(n=s.onDayKeyDown)||void 0===n||n.call(s,e,t,r)},onKeyUp:function(r){var n;null===(n=s.onDayKeyUp)||void 0===n||n.call(s,e,t,r)},onMouseEnter:function(r){var n;null===(n=s.onDayMouseEnter)||void 0===n||n.call(s,e,t,r)},onMouseLeave:function(r){var n;null===(n=s.onDayMouseLeave)||void 0===n||n.call(s,e,t,r)},onPointerEnter:function(r){var n;null===(n=s.onDayPointerEnter)||void 0===n||n.call(s,e,t,r)},onPointerLeave:function(r){var n;null===(n=s.onDayPointerLeave)||void 0===n||n.call(s,e,t,r)},onTouchCancel:function(r){var n;null===(n=s.onDayTouchCancel)||void 0===n||n.call(s,e,t,r)},onTouchEnd:function(r){var n;null===(n=s.onDayTouchEnd)||void 0===n||n.call(s,e,t,r)},onTouchMove:function(r){var n;null===(n=s.onDayTouchMove)||void 0===n||n.call(s,e,t,r)},onTouchStart:function(r){var n;null===(n=s.onDayTouchStart)||void 0===n||n.call(s,e,t,r)}}}(e,d),h=function(){var e=IN(),t=T_(),s=e_(),r=i_();return _N(e)?t.selected:jN(e)?s.selected:NN(e)?r.selected:void 0}(),m=Boolean(l.onDayClick||"default"!==l.mode);n.useEffect(function(){var t;d.outside||c.focusedDay&&m&&Jl(c.focusedDay,e)&&(null===(t=s.current)||void 0===t||t.focus())},[c.focusedDay,e,s,m,d.outside]);var p=E_(l,d).join(" "),f=function(e,t){var s=bN({},e.styles.day);return Object.keys(t).forEach(function(t){var r;s=bN(bN({},s),null===(r=e.modifiersStyles)||void 0===r?void 0:r[t])}),s}(l,d),g=Boolean(d.outside&&!l.showOutsideDays||d.hidden),x=null!==(o=null===(a=l.components)||void 0===a?void 0:a.DayContent)&&void 0!==o?o:YN,y={style:f,className:p,children:i.jsx(x,{date:e,displayMonth:t,activeModifiers:d}),role:"gridcell"},v=c.focusTarget&&Jl(c.focusTarget,e)&&!d.outside,b=c.focusedDay&&Jl(c.focusedDay,e),w=bN(bN(bN({},y),((r={disabled:d.disabled,role:"gridcell"})["aria-selected"]=d.selected,r.tabIndex=b||v?0:-1,r)),u);return{isButton:m,isHidden:g,activeModifiers:d,selectedDays:h,buttonProps:w,divProps:y}}function P_(e){var t=n.useRef(null),s=I_(e.date,e.displayMonth,t);return s.isHidden?i.jsx("div",{role:"gridcell"}):s.isButton?i.jsx(WN,bN({name:"day",ref:t},s.buttonProps)):i.jsx("div",bN({},s.divProps))}function O_(e){var t=e.number,s=e.dates,r=IN(),n=r.onWeekNumberClick,a=r.styles,o=r.classNames,l=r.locale,c=r.labels.labelWeekNumber,d=(0,r.formatters.formatWeekNumber)(Number(t),{locale:l});if(!n)return i.jsx("span",{className:o.weeknumber,style:a.weeknumber,children:d});var u=c(Number(t),{locale:l});return i.jsx(WN,{name:"week-number","aria-label":u,className:o.weeknumber,style:a.weeknumber,onClick:function(e){n(t,s,e)},children:d})}function A_(e){var t,s,r,n=IN(),a=n.styles,o=n.classNames,l=n.showWeekNumber,c=n.components,d=null!==(t=null==c?void 0:c.Day)&&void 0!==t?t:P_,u=null!==(s=null==c?void 0:c.WeekNumber)&&void 0!==s?s:O_;return l&&(r=i.jsx("td",{className:o.cell,style:a.cell,children:i.jsx(u,{number:e.weekNumber,dates:e.dates})})),i.jsxs("tr",{className:o.row,style:a.row,children:[r,e.dates.map(function(t){return i.jsx("td",{className:o.cell,style:a.cell,role:"presentation",children:i.jsx(d,{displayMonth:e.displayMonth,date:t})},function(e){return Math.trunc(+Ol(e)/1e3)}(t))})]})}function D_(e,t,s){for(var r=(null==s?void 0:s.ISOWeek)?oc(t):ic(t,s),n=(null==s?void 0:s.ISOWeek)?Wl(e):Ul(e,s),a=Hl(r,n),i=[],o=0;o<=a;o++)i.push(Dl(n,o));return i.reduce(function(e,t){var r=(null==s?void 0:s.ISOWeek)?gc(t):yc(t,s),n=e.find(function(e){return e.weekNumber===r});return n?(n.dates.push(t),e):(e.push({weekNumber:r,dates:[t]}),e)},[])}function M_(e){var t,s,r,n=IN(),a=n.locale,o=n.classNames,l=n.styles,c=n.hideHead,d=n.fixedWeeks,u=n.components,h=n.weekStartsOn,m=n.firstWeekContainsDate,p=n.ISOWeek,f=function(e,t){var s=D_(nc(e),tc(e),t);if(null==t?void 0:t.useFixedWeeks){var r=Gc(e,t);if(r<6){var n=s[s.length-1],a=n.dates[n.dates.length-1],i=Gl(a,6-r),o=D_(Gl(a,1),i,t);s.push.apply(s,o)}}return s}(e.displayMonth,{useFixedWeeks:Boolean(d),ISOWeek:p,locale:a,weekStartsOn:h,firstWeekContainsDate:m}),g=null!==(t=null==u?void 0:u.Head)&&void 0!==t?t:KN,x=null!==(s=null==u?void 0:u.Row)&&void 0!==s?s:A_,y=null!==(r=null==u?void 0:u.Footer)&&void 0!==r?r:HN;return i.jsxs("table",{id:e.id,className:o.table,style:l.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!c&&i.jsx(g,{}),i.jsx("tbody",{className:o.tbody,style:l.tbody,children:f.map(function(t){return i.jsx(x,{displayMonth:e.displayMonth,dates:t.dates,weekNumber:t.weekNumber},t.weekNumber)})}),i.jsx(y,{displayMonth:e.displayMonth})]})}var q_="undefined"!=typeof window&&window.document&&window.document.createElement?n.useLayoutEffect:n.useEffect,R_=!1,$_=0;function L_(){return"react-day-picker-".concat(++$_)}function Q_(e){var t,s,r=IN(),a=r.dir,o=r.classNames,l=r.styles,c=r.components,d=LN().displayMonths,u=function(e){var t,s=null!=e?e:R_?L_():null,r=n.useState(s),a=r[0],i=r[1];return q_(function(){null===a&&i(L_())},[]),n.useEffect(function(){!1===R_&&(R_=!0)},[]),null!==(t=null!=e?e:a)&&void 0!==t?t:void 0}(r.id?"".concat(r.id,"-").concat(e.displayIndex):void 0),h=r.id?"".concat(r.id,"-grid-").concat(e.displayIndex):void 0,m=[o.month],p=l.month,f=0===e.displayIndex,g=e.displayIndex===d.length-1,x=!f&&!g;"rtl"===a&&(g=(t=[f,g])[0],f=t[1]),f&&(m.push(o.caption_start),p=bN(bN({},p),l.caption_start)),g&&(m.push(o.caption_end),p=bN(bN({},p),l.caption_end)),x&&(m.push(o.caption_between),p=bN(bN({},p),l.caption_between));var y=null!==(s=null==c?void 0:c.Caption)&&void 0!==s?s:BN;return i.jsxs("div",{className:m.join(" "),style:p,children:[i.jsx(y,{id:u,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),i.jsx(M_,{id:h,"aria-labelledby":u,displayMonth:e.displayMonth})]},e.displayIndex)}function F_(e){var t=IN(),s=t.classNames,r=t.styles;return i.jsx("div",{className:s.months,style:r.months,children:e.children})}function U_(e){var t,s,r=e.initialProps,a=IN(),o=__(),l=LN(),c=n.useState(!1),d=c[0],u=c[1];n.useEffect(function(){a.initialFocus&&o.focusTarget&&(d||(o.focus(o.focusTarget),u(!0)))},[a.initialFocus,d,o.focus,o.focusTarget,o]);var h=[a.classNames.root,a.className];a.numberOfMonths>1&&h.push(a.classNames.multiple_months),a.showWeekNumber&&h.push(a.classNames.with_weeknumber);var m=bN(bN({},a.styles.root),a.style),p=Object.keys(r).filter(function(e){return e.startsWith("data-")}).reduce(function(e,t){var s;return bN(bN({},e),((s={})[t]=r[t],s))},{}),f=null!==(s=null===(t=r.components)||void 0===t?void 0:t.Months)&&void 0!==s?s:F_;return i.jsx("div",bN({className:h.join(" "),style:m,dir:a.dir,id:a.id,nonce:r.nonce,title:r.title,lang:r.lang},p,{children:i.jsx(f,{children:l.displayMonths.map(function(e,t){return i.jsx(Q_,{displayIndex:t,displayMonth:e},t)})})}))}function W_(e){var t=e.children,s=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(s[r[n]]=e[r[n]])}return s}(e,["children"]);return i.jsx(EN,{initialProps:s,children:i.jsx($N,{children:i.jsx(k_,{initialProps:s,children:i.jsx(ZN,{initialProps:s,children:i.jsx(n_,{initialProps:s,children:i.jsx(x_,{children:i.jsx(N_,{children:t})})})})})})})}function V_(e){return i.jsx(W_,bN({},e,{children:i.jsx(U_,{initialProps:e})}))}function z_({className:e,classNames:t,showOutsideDays:s=!0,...r}){return i.jsx(V_,{showOutsideDays:s,className:Qi("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:Qi(fu({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:Qi(fu({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...e})=>i.jsx(uo,{className:"h-4 w-4"}),IconRight:({...e})=>i.jsx(ho,{className:"h-4 w-4"})},...r})}z_.displayName="Calendar";const B_=({nameSearchTerm:e,setNameSearchTerm:t,phoneSearchTerm:s,setPhoneSearchTerm:r,idcardSearchTerm:a,setIDcardSearchTerm:o,dateRange:l,setDateRange:c,onClearSearch:d,isFiltered:u})=>{const[h,m]=n.useState(!1);let p="";return l.from&&(p=l.to?`${zc(l.from,"d MMM",{locale:cu})} - ${zc(l.to,"d MMM",{locale:cu})}`:zc(l.from,"d MMM",{locale:cu})),i.jsx("div",{className:"mb-4 space-y-2",children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[i.jsxs("div",{className:"relative col-span-2",children:[i.jsx(cl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),i.jsx(Ux,{placeholder:"  ...",className:"pl-10",value:e,onChange:e=>t(e.target.value)})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(Qy,{open:h,onOpenChange:m,children:[i.jsx(Fy,{asChild:!0,children:i.jsxs(gu,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[i.jsx(ao,{className:"mr-2 h-4 w-4"}),p]})}),i.jsx(Uy,{className:"w-auto p-0",align:"start",children:i.jsx(z_,{mode:"range",selected:{from:l.from,to:l.to},onSelect:e=>{c({from:null==e?void 0:e.from,to:null==e?void 0:e.to}),(null==e?void 0:e.to)&&m(!1)},initialFocus:!0,className:"p-3 pointer-events-auto"})})]}),u&&i.jsx(gu,{variant:"ghost",size:"icon",onClick:d,className:"flex-shrink-0",title:"",children:i.jsx(Pl,{className:"h-4 w-4"})})]})]})})},H_=({todayCount:e,tomorrowCount:t,upcomingCount:s,isFiltered:r,filteredCount:n})=>i.jsxs(Ah,{children:[i.jsxs(Dh,{value:"today",disabled:r,children:[" (",e,")"]}),i.jsxs(Dh,{value:"tomorrow",disabled:r,children:[" (",t,")"]}),i.jsxs(Dh,{value:"upcoming",disabled:r,children:[" (",s,")"]}),r&&i.jsxs(Dh,{value:"search-results",children:[" (",n,")"]})]}),G_=et,K_=tt;n.forwardRef(({className:e,inset:t,children:s,...r},n)=>i.jsxs(Ve,{ref:n,className:Qi("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),...r,children:[s,i.jsx(ho,{className:"ml-auto h-4 w-4"})]})).displayName=Ve.displayName;n.forwardRef(({className:e,...t},s)=>i.jsx(ze,{ref:s,className:Qi("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t})).displayName=ze.displayName;const Y_=n.forwardRef(({className:e,sideOffset:t=4,...s},r)=>i.jsx(Be,{children:i.jsx(He,{ref:r,sideOffset:t,className:Qi("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})}));Y_.displayName=He.displayName;const J_=n.forwardRef(({className:e,inset:t,...s},r)=>i.jsx(Ge,{ref:r,className:Qi("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...s}));J_.displayName=Ge.displayName;n.forwardRef(({className:e,children:t,checked:s,...r},n)=>i.jsxs(Ke,{ref:n,className:Qi("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:s,...r,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(Ye,{children:i.jsx(lo,{className:"h-4 w-4"})})}),t]})).displayName=Ke.displayName;n.forwardRef(({className:e,children:t,...s},r)=>i.jsxs(Je,{ref:r,className:Qi("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(Ye,{children:i.jsx(wo,{className:"h-2 w-2 fill-current"})})}),t]})).displayName=Je.displayName;n.forwardRef(({className:e,inset:t,...s},r)=>i.jsx(Ze,{ref:r,className:Qi("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...s})).displayName=Ze.displayName;n.forwardRef(({className:e,...t},s)=>i.jsx(Xe,{ref:s,className:Qi("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=Xe.displayName;const Z_=({appointment:e,getPatientName:t,iconBgColor:s,iconColor:r,onEdit:n,onDelete:a,dropdownKey:o})=>i.jsxs("div",{className:"flex items-center p-4 hover:bg-gray-50",children:[i.jsx("div",{className:`w-14 h-14 flex-shrink-0 rounded-full ${s} flex items-center justify-center ${r} mr-4`,children:i.jsx(ao,{className:"w-6 h-6"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t(e.patient_id)}),i.jsx("p",{className:"text-sm text-gray-500 truncate",children:e.purpose}),i.jsx("p",{className:"text-xs text-gray-400",children:zc(new Date(e.date),"dd MMM yyyy, HH:mm .",{locale:cu})})]}),i.jsx("div",{className:"ml-4",children:i.jsxs(G_,{children:[i.jsx(K_,{asChild:!0,children:i.jsx(gu,{variant:"ghost",size:"sm",children:i.jsx(ho,{className:"h-5 w-5"})})}),i.jsxs(Y_,{align:"end",children:[i.jsxs(J_,{onClick:()=>n(e),children:[i.jsx(gl,{className:"mr-2 h-4 w-4"}),""]}),i.jsxs(J_,{className:"text-red-600",onClick:()=>a(e.id),children:[i.jsx(bl,{className:"mr-2 h-4 w-4"}),""]})]})]},o)})]}),X_=({form:e,onPatientSelect:t})=>i.jsx(pv,{control:e.control,name:"patient_id",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(Uj,{onPatientSelect:t,selectedPatientId:e.value}),i.jsx(wv,{})]})}),eS=({form:e})=>i.jsx(Vj,{form:e}),tS=({form:e})=>i.jsxs(i.Fragment,{children:[i.jsx(pv,{control:e.control,name:"purpose",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{...e})}),i.jsx(wv,{})]})}),i.jsx(pv,{control:e.control,name:"notes",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(zx,{...e})}),i.jsx(wv,{})]})}),i.jsx(pv,{control:e.control,name:"status",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsxs(Jh,{onValueChange:e.onChange,value:e.value,children:[i.jsx(vv,{children:i.jsx(Xh,{children:i.jsx(Zh,{placeholder:""})})}),i.jsxs(sm,{children:[i.jsx(rm,{value:"SCHEDULED",children:""}),i.jsx(rm,{value:"COMPLETED",children:""}),i.jsx(rm,{value:"CANCELLED",children:""})]})]}),i.jsx(wv,{})]})})]}),sS=({form:e})=>i.jsx(pv,{control:e.control,name:"status",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsxs(Jh,{onValueChange:e.onChange,value:e.value,children:[i.jsx(vv,{children:i.jsx(Xh,{children:i.jsx(Zh,{placeholder:""})})}),i.jsxs(sm,{children:[i.jsx(rm,{value:"SCHEDULED",children:""}),i.jsx(rm,{value:"COMPLETED",children:""}),i.jsx(rm,{value:"CANCELLED",children:""})]})]}),i.jsx(wv,{})]})}),rS=({form:e,onSubmit:t,onCancel:s,onPatientSelect:r})=>i.jsx(hv,{...e,children:i.jsxs("form",{onSubmit:e.handleSubmit(t),className:"space-y-4",children:[i.jsx(X_,{form:e,onPatientSelect:r}),i.jsx(eS,{form:e}),i.jsx(tS,{form:e}),i.jsx(sS,{form:e}),i.jsxs(Gh,{children:[i.jsx(gu,{type:"button",variant:"outline",onClick:s,children:""}),i.jsx(gu,{type:"submit",children:""})]})]})}),nS=Gg({patient_id:Wg().min(1,{message:""}),date:Wg().min(1,{message:""}),time:Wg().min(1,{message:""}),purpose:Wg().min(1,{message:""}),notes:Wg().optional(),status:Jg(["SCHEDULED","COMPLETED","CANCELLED"])}),aS=({open:e,onOpenChange:t,appointment:s,patients:r,onSubmit:o})=>{const l=(e=>{const t=sf({resolver:hf(nS),defaultValues:{patient_id:"",date:"",time:"",purpose:"",notes:"",status:"SCHEDULED"}});return n.useEffect(()=>{if(e){const s=new Date(e.date);t.reset({patient_id:e.patient_id,date:zc(s,"yyyy-MM-dd"),time:zc(s,"HH:mm"),purpose:e.purpose,notes:e.notes||"",status:e.status})}},[e,t]),t})(s);return i.jsx(Uh,{open:e,onOpenChange:t,children:i.jsxs(Bh,{className:"sm:max-w-[500px]",children:[i.jsx(Hh,{children:i.jsx(Kh,{children:""})}),i.jsx(rS,{form:l,onSubmit:async e=>{try{await o(e),a.success("")}catch(t){a.error("")}},onCancel:()=>t(!1),onPatientSelect:e=>{l.setValue("patient_id",e.id)}})]})})},iS=({open:e,onOpenChange:t,onConfirm:s})=>i.jsx(Zy,{open:e,onOpenChange:t,children:i.jsxs(sv,{children:[i.jsxs(rv,{children:[i.jsx(av,{children:""}),i.jsx(iv,{children:"? "})]}),i.jsxs(nv,{children:[i.jsx(lv,{children:""}),i.jsx(ov,{className:"bg-red-600 hover:bg-red-700",onClick:s,children:""})]})]})}),oS=({appointments:e,getPatientName:t,emptyMessage:s,iconBgColor:r,iconColor:o})=>{const[l,c]=n.useState(null),[d,u]=n.useState(!1),[h,m]=n.useState(null),[p,f]=n.useState(0),{updateAppointment:g,deleteAppointment:x}=Qj(),{patients:y}=Ha(),v=()=>{u(!1),c(null),f(e=>e+1)},b=e=>{c(e),u(!0)};return i.jsxs(i.Fragment,{children:[i.jsx(Fi,{children:i.jsx(zi,{className:"p-0",children:0===e.length?i.jsx("div",{className:"p-6 text-center text-gray-500",children:s}):i.jsx("div",{className:"divide-y",children:e.map(e=>i.jsx(Z_,{appointment:e,getPatientName:t,iconBgColor:r,iconColor:o,onEdit:b,onDelete:m,dropdownKey:p},e.id))})})}),i.jsx(aS,{open:d,onOpenChange:v,appointment:l,patients:y,onSubmit:async e=>{if(!l)return;const{date:t,time:s,...r}=e,n=new Date(`${t}T${s}`);try{await g(l.id,{...r,date:n.toISOString(),status:r.status})&&(a("",{description:""}),v())}catch(i){a("",{description:" ",style:{backgroundColor:"hsl(var(--destructive))",color:"hsl(var(--destructive-foreground))"}}),v()}}}),i.jsx(iS,{open:!!h,onOpenChange:e=>!e&&m(null),onConfirm:async()=>{if(h)try{await x(h),m(null),a("",{description:""})}catch(e){a("",{description:" ",style:{backgroundColor:"hsl(var(--destructive))",color:"hsl(var(--destructive-foreground))"}})}}})]})},lS=({value:e,appointments:t,getPatientName:s,emptyMessage:r,iconBgColor:n,iconColor:a})=>i.jsx(Mh,{value:e,className:"animate-fade-in",children:i.jsx(oS,{appointments:t,getPatientName:s,emptyMessage:r,iconBgColor:n,iconColor:a})}),cS=({todayAppointments:e,tomorrowAppointments:t,upcomingAppointments:s,nameSearchTerm:r,setNameSearchTerm:n,phoneSearchTerm:a,setPhoneSearchTerm:o,dateRange:l,setDateRange:c,getPatientName:d,filteredAppointments:u,isFiltered:h,onClearSearch:m})=>i.jsxs(Oh,{defaultValue:"today",className:"space-y-4",children:[i.jsx(H_,{todayCount:e.length,tomorrowCount:t.length,upcomingCount:s.length,isFiltered:h,filteredCount:u.length}),i.jsx(B_,{nameSearchTerm:r,setNameSearchTerm:n,phoneSearchTerm:a,setPhoneSearchTerm:o,dateRange:l,setDateRange:c,onClearSearch:m,isFiltered:h}),i.jsx(lS,{value:"today",appointments:e,getPatientName:d,emptyMessage:"",iconBgColor:"bg-green-100",iconColor:"text-green-600"}),i.jsx(lS,{value:"tomorrow",appointments:t,getPatientName:d,emptyMessage:"",iconBgColor:"bg-blue-100",iconColor:"text-blue-600"}),i.jsx(lS,{value:"upcoming",appointments:s,getPatientName:d,emptyMessage:"",iconBgColor:"bg-purple-100",iconColor:"text-purple-600"}),h&&i.jsx(lS,{value:"search-results",appointments:u,getPatientName:d,emptyMessage:"",iconBgColor:"bg-amber-100",iconColor:"text-amber-600"})]}),dS=({appointments:e})=>{const[t,s]=n.useState(new Date),r=e.reduce((e,t)=>{const s=zc(new Date(t.date),"yyyy-MM-dd");return e[s]=(e[s]||0)+1,e},{}),a=t?e.filter(e=>zc(new Date(e.date),"yyyy-MM-dd")===zc(t,"yyyy-MM-dd")):[];return i.jsxs("div",{className:"space-y-4",children:[i.jsx(z_,{mode:"single",selected:t,onSelect:s,locale:cu,className:"pointer-events-auto",classNames:{day_selected:"bg-pharmacy-600 text-white hover:bg-pharmacy-700 focus:bg-pharmacy-700",day_today:"bg-pharmacy-50 text-pharmacy-600"},components:{DayContent:({date:e,activeModifiers:t})=>{const s=zc(e,"yyyy-MM-dd"),n=r[s]||0;return i.jsxs(i.Fragment,{children:[e.getDate(),n>0&&i.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 -mb-1",children:i.jsx("div",{className:Qi("h-1 w-1 rounded-full",t.selected?"bg-white":"bg-pharmacy-600")})})]})}}}),a.length>0&&i.jsxs("div",{className:"pt-2",children:[i.jsxs("h4",{className:"text-sm font-medium mb-2",children:[" ",t&&zc(t,"dd MMMM yyyy",{locale:cu})]}),i.jsx("div",{className:"space-y-2",children:a.map(e=>i.jsx("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded border",children:i.jsxs("div",{children:[i.jsx(Lh,{variant:"outline",className:"mb-1",children:zc(new Date(e.date),"HH:mm .")}),i.jsx("p",{className:"text-sm",children:e.purpose})]})},e.id))})]})]})},uS=({appointments:e})=>i.jsxs(Fi,{children:[i.jsx(Ui,{className:"pb-2",children:i.jsx(Wi,{className:"text-lg",children:""})}),i.jsx(zi,{children:i.jsx(dS,{appointments:e})})]}),hS=({todayAppointments:e,tomorrowAppointments:t,upcomingAppointments:s,nameSearchTerm:r,setNameSearchTerm:n,phoneSearchTerm:a,setPhoneSearchTerm:o,dateRange:l,setDateRange:c,getPatientName:d,getPatientPhone:u,filteredAppointments:h,isFiltered:m,onClearSearch:p,appointments:f})=>i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[i.jsx("div",{className:"lg:col-span-2",children:i.jsx(cS,{todayAppointments:e,tomorrowAppointments:t,upcomingAppointments:s,nameSearchTerm:r,setNameSearchTerm:n,phoneSearchTerm:a,setPhoneSearchTerm:o,dateRange:l,setDateRange:c,getPatientName:d,getPatientPhone:u,filteredAppointments:h,isFiltered:m,onClearSearch:p})}),i.jsx("div",{children:i.jsx(uS,{appointments:f})})]}),mS=()=>{const{appointments:e,fetchAppointments:t}=Qj(),{patients:s}=Ha(),{getPatientName:r,getPatientPhone:a}=(e=>({getPatientName:t=>{const s=e.find(e=>e.id===t);return s?s.name:""},getPatientPhone:t=>{const s=e.find(e=>e.id===t);return s?s.phone:""}}))(s),{todayAppointments:o,tomorrowAppointments:l,upcomingAppointments:c}=(e=>n.useMemo(()=>{const t=new Date,s=new Date(t);return s.setDate(s.getDate()+1),{todayAppointments:e.filter(e=>new Date(e.date).toDateString()===t.toDateString()),tomorrowAppointments:e.filter(e=>new Date(e.date).toDateString()===s.toDateString()),upcomingAppointments:e.filter(e=>new Date(e.date)>s)}},[e]))(e),{nameSearchTerm:d,setNameSearchTerm:u,phoneSearchTerm:h,setPhoneSearchTerm:m,dateRange:p,setDateRange:f,filteredAppointments:g,isFiltered:x,handleClearSearch:y}=((e,t)=>{const[s,r]=n.useState(""),[a,i]=n.useState(""),[o,l]=n.useState({from:void 0,to:void 0}),[c,d]=n.useState([]),u=!!s||!!a||!!o.from;return n.useEffect(()=>{if(!u)return void d([]);const r=e.filter(e=>{const r=t.find(t=>t.id===e.patient_id),n=new Date(e.date),i=!s||r&&r.name.toLowerCase().includes(s.toLowerCase())||r&&r.phone.includes(s)||r&&r.ID_card.includes(s),l=!a||r&&r.phone.includes(a);let c=!0;if(o.from&&(o.from.setHours(0,0,0,0),c=n>=o.from,c&&o.to)){const e=new Date(o.to);e.setHours(23,59,59,999),c=n<=e}return i&&l&&c});d(r)},[s,o,e,t,u]),{nameSearchTerm:s,setNameSearchTerm:r,phoneSearchTerm:a,setPhoneSearchTerm:i,dateRange:o,setDateRange:l,filteredAppointments:c,isFiltered:u,handleClearSearch:()=>{r(""),i(""),l({from:void 0,to:void 0})}}})(e,s);n.useEffect(()=>{(async()=>{await yu.createQueuesFromAppointments(),await yu.syncAppointmentQueueStatus()})()},[]);return i.jsxs("div",{className:"p-6",children:[i.jsx(yN,{onAppointmentsRefresh:async()=>{await t(),await yu.createQueuesFromAppointments(),await yu.syncAppointmentQueueStatus()}}),i.jsx(vN,{todayCount:o.length,tomorrowCount:l.length,totalCount:e.length,upcomingCount:c.length}),i.jsx(hS,{todayAppointments:o,tomorrowAppointments:l,upcomingAppointments:c,nameSearchTerm:d,setNameSearchTerm:u,phoneSearchTerm:h,setPhoneSearchTerm:m,dateRange:p,setDateRange:f,getPatientName:r,getPatientPhone:a,filteredAppointments:g,isFiltered:x,onClearSearch:y,appointments:e})]})},pS=Qa("generatePrintContent");async function fS(e){const{queueNumber:t,queueType:s,patientName:r="",patientPhone:n="",patientLineId:a="",purpose:i="",estimatedWaitTime:o=15,waitTiemQueueNext:l=0}=e,c=$u(s,t),d=`${jm}/patient-portal?queue=${t}${s?`&type=${s}`:""}`;pS.debug(`Generated QR URL: ${d}`);const u=(new Date).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}),h=(new Date).toLocaleTimeString("th-TH");pS.debug(`Formatted date and time: ${u} ${h}`);const{hospital_name:m,hospital_phone:p}=await async function(){try{const{data:e,error:t}=await qa.from("settings").select("key, value").eq("category","general").in("key",["hospital_name","hospital_phone"]);if(t)return{hospital_name:"",hospital_phone:""};const s={hospital_name:"",hospital_phone:""};return e&&e.length>0&&e.forEach(e=>{"hospital_name"!==e.key&&"hospital_phone"!==e.key||(s[e.key]=e.value)}),s}catch(e){return{hospital_name:"",hospital_phone:""}}}();return pS.debug(`Hospital settings: ${m}, ${p}`),`\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <title> ${c}</title>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"><\/script>\n        <style>\n          \n  body {\n    font-family: 'Sukhumvit Set', 'Prompt', system-ui, sans-serif;\n    padding: 20px;\n    text-align: center;\n  }\n  .patient-header {\n    margin-bottom: 10px;\n    font-size: 18px;\n    font-weight: bold;\n  }\n  .queue-info {\n    margin: 16px 0;\n    font-size: 18px;\n    font-weight: bold;\n  }\n  .queue-number {\n    font-size: 64px;\n    font-weight: bold;\n    color: #158a7b;\n    margin: 20px 0;\n  }\n  .patient-info {\n    margin: 8px 0;\n    font-size: 16px;\n  }\n  .purpose-info {\n    margin: 10px 0;\n    font-size: 16px;\n    color: #555;\n  }\n  .qr-container {\n    margin: 20px auto;\n    width: 200px;\n    height: 200px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n  .wait-time {\n    margin: 12px 0;\n    font-size: 16px;\n    padding: 4px 12px;\n    background-color: #f0f9ff;\n    border: 1px solid #bae6fd;\n    border-radius: 4px;\n    color: #0369a1;\n    display: inline-block;\n  }\n  .footer {\n    margin-top: 30px;\n    font-size: 14px;\n    color: #666;\n  }\n  .icon {\n    display: inline-block;\n    width: 16px;\n    height: 16px;\n    margin-right: 4px;\n    vertical-align: middle;\n  }\n  @media print {\n    body {\n      margin: 0;\n      padding: 15px;\n    }\n    .queue-number {\n      font-size: 60px;\n    }\n    .wait-time {\n      background-color: #f0f9ff !important;\n      border-color: #bae6fd !important;\n      color: #0369a1 !important;\n      -webkit-print-color-adjust: exact !important;\n      print-color-adjust: exact !important;\n    }\n    \n    /* Force print background colors and images */\n    * {\n      -webkit-print-color-adjust: exact !important;\n      color-adjust: exact !important;\n      print-color-adjust: exact !important;\n    }\n  }\n\n        </style>\n      </head>\n      <body>\n        <h2></h2>\n\n        <div class="queue-number">${c}</div>\n        \n        ${i?`<div class="purpose-info">${i}</div>`:""}\n        \n        <div class="queue-info">\n          : ${u}\n        </div>\n        <div class="queue-info">\n          : ${h}\n        </div>\n        \n        <div id="qrcode" class="qr-container"></div>\n        <p class="qr-text"></p>\n        <div class="footer">\n          <div class="hospital-name">${m}</div>\n          ${p?`<p>. ${p}</p>`:""}\n          <p></p>\n        </div>\n        \n        <script>\n          console.log('[PrintWindow] Print script initialized');\n          \n          // Generate QR Code when window loads\n          window.onload = function() {\n            console.log('[PrintWindow] Window loaded, generating QR code...');\n            \n            try {\n              // Create QR code\n              new QRCode(document.getElementById("qrcode"), {\n                text: "${d}",\n                width: 180,\n                height: 180,\n                colorDark: "#000000",\n                colorLight: "#ffffff",\n                correctLevel: QRCode.CorrectLevel.L\n              });\n              \n              console.log('[PrintWindow] QR code generated');\n              \n              // Small delay to ensure content and QR code are properly rendered before printing\n              setTimeout(() => {\n                console.log('[PrintWindow] Triggering browser print dialog');\n                try {\n                  window.print();\n                  console.log('[PrintWindow] Print triggered successfully');\n                } catch (e) {\n                  console.error('[PrintWindow] Error during print:', e);\n                }\n                \n                // Close after printing or after 10 seconds\n                setTimeout(() => {\n                  console.log('[PrintWindow] Closing print window');\n                  window.close();\n                }, 10000);\n              }, 800); // Increased delay to ensure QR code renders\n            } catch (err) {\n              console.error('[PrintWindow] Error generating QR code:', err);\n            }\n          }\n        <\/script>\n      </body>\n    </html>\n  `}const gS=Qa("printQueue");async function xS(e){const{queueNumber:t,queueType:s,waitTiemQueueNext:r=0}=e;$u(s,t),gS.debug("----------------------------------------"),gS.debug(" PRINT QUEUE TICKET FUNCTION CALLED "),gS.debug("----------------------------------------"),gS.debug("[printQueueTicket] Queue details:",e);try{gS.debug("[printQueueTicket] Opening new window for printing");const t=window.open("","_blank");if(!t)return gS.error("[printQueueTicket] Popup blocked. Please allow popups for printing"),void alert(" popup ");const s=await fS(e);gS.debug("[printQueueTicket] Writing content to print window"),t.document.open(),t.document.write(s),t.document.close(),gS.debug("[printQueueTicket] Print window opened and content written")}catch(n){gS.error("[printQueueTicket] Error during printing process:",n),alert("")}}const yS=()=>{u();const[e,t]=n.useState(new Date),[s,r]=n.useState(!0),{queueTypes:o}=ax(),[l,c]=n.useState(""),[d,h]=n.useState(""),[m,p]=n.useState(""),[f,g]=n.useState(!1),[x,y]=n.useState(!1),[v,b]=n.useState([]),[w,j]=n.useState(""),[N,_]=n.useState(""),[S,k]=n.useState(""),[C,T]=n.useState(""),[E,I]=n.useState(!1),[P,O]=n.useState(!1),[A,D]=n.useState(""),[M,q]=n.useState("GENERAL"),[R,$]=n.useState(""),[L,Q]=n.useState(!1),[F,U]=n.useState(!1),[W,V]=n.useState(null),[z,B]=n.useState(null),[H,G]=n.useState(""),[K,Y]=n.useState(""),[J,Z]=n.useState(""),[X,ee]=n.useState("");n.useEffect(()=>{const e=setInterval(()=>{t(new Date)},1e3);return()=>clearInterval(e)},[]),n.useEffect(()=>{if(o&&o.length>0){const e=o.filter(e=>e.enabled&&"INS"!==e.purpose).find(e=>"GENERAL"===e.code);e&&q(e.code)}},[o]);const te=e=>{const t=e.replace(/\D/g,"");return t.length<=13?t.replace(/(\d{1})(\d{4})(\d{5})(\d{2})(\d{1})/,"$1-$2-$3-$4-$5"):e},se=e=>{const t=e.replace(/\D/g,"");return t.length<=10?t.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3"):e},re=(e,t)=>{let s=t;if("searchInput"===e){const e=t.replace(/\D/g,"");e.length>0&&(s=e.length<=10?se(t):te(t)),c(s)}else"idCardNumber"===e?(s=te(t),p(s)):"phoneNumber"===e?(s=se(t),h(s)):"newPatientName"===e?D(t):"notes"===e&&$(t)},ne=()=>{c(""),h(""),p(""),b([]),j(""),O(!1),D(""),$(""),U(!1),V(null),B(null),G(""),Y(""),Z(""),ee(""),_(""),k(""),T("")},ae=(e,t)=>{var s;const r=o.find(t=>t.code===e);return r?r.prefix+t.toString().padStart((null==(s=r.format)?void 0:s.length)||3,"0"):t.toString()},ie=async()=>{if(W&&z)try{await xS({queueNumber:W,queueType:z,patientName:K,patientPhone:J,patientLineId:X,purpose:H}),a.success("",{id:"print-ticket"})}catch(e){a.error("",{id:"print-ticket-error"})}};return F&&W?i.jsxs("div",{className:"flex flex-col min-h-screen bg-pharmacy-50",children:[i.jsx(Qb,{currentTime:e,soundEnabled:s,setSoundEnabled:r,title:""}),i.jsx("main",{className:"flex-1 p-6 flex items-center justify-center",children:i.jsx(Fi,{className:"w-full max-w-md shadow-2xl border-0",children:i.jsxs(zi,{className:"p-8 text-center",children:[i.jsxs("div",{className:"mb-6",children:[i.jsx(go,{className:"w-20 h-20 text-green-500 mx-auto mb-4"}),i.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"!"}),i.jsx("p",{className:"text-gray-600",children:""})]}),i.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-2xl p-6 mb-6",children:[i.jsx("div",{className:"text-6xl font-bold mb-2",children:z&&W?ae(z,W):W}),i.jsx("div",{className:"text-lg opacity-90",children:""})]}),i.jsxs("div",{className:"space-y-3 mb-6 text-sm text-gray-600",children:[i.jsx("p",{children:""}),i.jsx("p",{children:""})]}),i.jsxs("div",{children:[i.jsxs(gu,{onClick:ie,className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-medium py-3 rounded-xl transition-all duration-200 flex items-center justify-center gap-2 mb-3",children:[i.jsx(rl,{className:"w-5 h-5"}),""]}),i.jsx(gu,{onClick:ne,variant:"outline",className:"w-full border-2 border-blue-200 text-blue-600 hover:bg-blue-50 font-medium py-3 rounded-xl transition-all duration-200",children:""})]})]})})}),i.jsx(Ub,{})]}):i.jsxs("div",{className:"flex flex-col min-h-screen bg-pharmacy-50",children:[i.jsx(Qb,{currentTime:e,soundEnabled:s,setSoundEnabled:r,title:""}),i.jsx(Fb,{algorithmName:""}),i.jsx("main",{className:"flex-1 p-6 flex items-center justify-center",children:i.jsxs(Fi,{className:"w-full max-w-md shadow-2xl border-0",children:[i.jsxs(Ui,{className:"text-center pb-6",children:[i.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx(kl,{className:"w-8 h-8 text-white"})}),i.jsx(Wi,{className:"text-2xl font-bold text-gray-800",children:""}),i.jsx("p",{className:"text-gray-600 mt-2",children:""})]}),i.jsx(zi,{className:"px-6 pb-6",children:i.jsxs("form",{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(Vx,{htmlFor:"searchInput",className:"text-sm font-medium text-gray-700",children:"  "}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(Ux,{id:"searchInput",type:"text",placeholder:"  ",value:l,onChange:e=>re("searchInput",e.target.value),className:"h-12 rounded-xl border-2 transition-all duration-200 border-gray-200 focus:border-blue-500",maxLength:50}),i.jsxs(gu,{type:"button",variant:"outline",onClick:async()=>{if(l){g(!0),b([]);try{const e=l.replace(/\D/g,""),t=e.length<=10&&e.length>0,s=13===e.length,r=0===e.length||!t&&!s;t?(h(l),p("")):s&&(p(l),h(""));let n=[];if(t){const{data:t,error:s}=await qa.from("patients").select("*").eq("phone",e);if(s)throw s;t&&t.length>0&&(n=[...n,...t])}if(s){const{data:t,error:s}=await qa.from("patients").select("*").eq("ID_card",e);if(s)throw s;t&&t.length>0&&(n=[...n,...t])}if(r||!t&&!s||0===n.length){const{data:e,error:t}=await qa.from("patients").select("*").ilike("name",`%${l}%`).order("name",{ascending:!0});if(t)throw t;e&&e.length>0&&(n=[...n,...e])}if(!r&&!t&&!s){const{data:t}=await qa.from("patients").select("*").eq("phone",e),{data:s}=await qa.from("patients").select("*").eq("ID_card",e);t&&(n=[...n,...t]),s&&(n=[...n,...s])}const i=n.filter((e,t,s)=>t===s.findIndex(t=>t.id===e.id));i.length>0?b(i):(O(!0),a.info(" ")),y(!0)}catch(e){a.error("")}finally{g(!1)}}else a.error("  ")},disabled:f,className:"px-3 h-12 rounded-xl",children:[f?i.jsx(Lo,{className:"h-4 w-4 animate-spin mr-2"}):i.jsx(cl,{className:"h-4 w-4 mr-2"}),""]})]}),i.jsx("p",{className:"text-xs text-gray-500",children:"  "})]}),v.length>0&&i.jsxs("div",{className:"space-y-2 border rounded-lg p-3 bg-gray-50",children:[i.jsx(Vx,{className:"text-sm font-medium text-gray-700",children:""}),i.jsx("div",{className:"space-y-2",children:v.map(e=>i.jsx("div",{className:"p-3 border rounded-md "+(w===e.id?"bg-blue-50 border-blue-300":"hover:bg-gray-100"),children:i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:e.name}),i.jsxs("div",{className:"text-sm text-gray-500",children:[": ",e.phone]}),e.ID_card&&i.jsxs("div",{className:"text-sm text-gray-500",children:[": ",e.ID_card]})]}),i.jsx(gu,{type:"button",onClick:()=>(e=>{j(e);const t=v.find(t=>t.id===e);t&&(Y(t.name),Z(t.phone||""),ee(t.line_id||""),_(t.name||""),k(t.phone||""),T(t.ID_card||""),re("idCardNumber",t.ID_card||""))})(e.id),className:"px-4 py-2 "+(w===e.id?"bg-blue-600 hover:bg-blue-700":"bg-gray-200 hover:bg-gray-300 text-gray-800"),size:"sm",children:w===e.id?"":""})]})},e.id))})]}),w&&i.jsx("div",{className:"space-y-4 rounded-lg ",children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"selectedPatientName",className:"text-sm font-medium text-gray-700",children:""}),i.jsx(Ux,{id:"selectedPatientName",value:N,onChange:e=>_(e.target.value),className:"mt-1 h-10"})]}),i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"selectedPatientPhone",className:"text-sm font-medium text-gray-700",children:""}),i.jsx(Ux,{id:"selectedPatientPhone",value:S,onChange:e=>k(se(e.target.value)),className:"mt-1 h-10",maxLength:12})]}),i.jsxs("div",{children:[i.jsx(Vx,{htmlFor:"selectedPatientIdCard",className:"text-sm font-medium text-gray-700",children:""}),i.jsx(Ux,{id:"selectedPatientIdCard",value:C,onChange:e=>T(te(e.target.value)),className:"mt-1 h-10",maxLength:17})]})]})}),P&&i.jsxs("div",{className:"space-y-2",children:[i.jsx(Vx,{htmlFor:"newPatientName",className:"text-sm font-medium text-gray-700",children:""}),i.jsx(Ux,{id:"newPatientName",type:"text",placeholder:"",value:A,onChange:e=>re("newPatientName",e.target.value),className:"h-12 rounded-xl border-2 transition-all duration-200 border-gray-200 focus:border-blue-500"}),i.jsx(gu,{type:"button",onClick:async()=>{if(!A)return void a.error("");const e=l.replace(/\D/g,"");if(e)try{const t=`P${Date.now()}`,s=e.length<=10,r=13===e.length,n={patient_id:t,name:A};s?n.phone=e:r?n.ID_card=e:n.phone=e;const{data:i,error:o}=await qa.from("patients").insert(n).select();if(o)throw o;i&&i.length>0&&(j(i[0].id),Y(i[0].name),Z(i[0].phone||""),a.success(""))}catch(t){a.error("")}else a.error("")},className:"w-full mt-2 bg-green-600 hover:bg-green-700 text-white",children:""})]}),(w||P&&A)&&i.jsxs("div",{className:"space-y-2",children:[i.jsx(Vx,{htmlFor:"queueType",className:"text-sm font-medium text-gray-700",children:""}),i.jsxs(Jh,{value:M,onValueChange:e=>q(e),children:[i.jsx(Xh,{id:"queueType",className:"h-12 rounded-xl border-2 transition-all duration-200 border-gray-200 focus:border-blue-500",children:i.jsx(Zh,{placeholder:""})}),i.jsxs(sm,{children:[o&&o.filter(e=>e.enabled&&"INS"!==e.purpose).map(e=>i.jsxs(rm,{value:e.code,children:[e.name," - ",e.purpose||""]},e.code)),(!o||0===o.filter(e=>e.enabled&&"INS"!==e.purpose).length)&&i.jsx(rm,{value:"GENERAL",disabled:!0,children:""})]})]})]}),(w||P&&A)&&i.jsxs("div",{className:"space-y-2",children:[i.jsx(Vx,{htmlFor:"notes",className:"text-sm font-medium text-gray-700",children:""}),i.jsx(Ux,{id:"notes",type:"text",placeholder:" ()",value:R,onChange:e=>re("notes",e.target.value),className:"h-12 rounded-xl border-2 transition-all duration-200 border-gray-200 focus:border-blue-500"})]}),i.jsx(Im,{className:"border-blue-200 bg-blue-50",children:i.jsxs(Pm,{className:"text-blue-800 text-sm",children:[i.jsx("strong",{children:":"})," ",""]})}),i.jsx(gu,{type:"button",onClick:async()=>{if(w||A){Q(!0);try{if(w&&N)try{const{data:e,error:t}=await qa.from("patients").select("patient_id").eq("id",w).single();if(t);else if(e){const t={id:w,patient_id:e.patient_id,name:N};S&&(t.phone=S.replace(/\D/g,"")),C&&(t.ID_card=C.replace(/\D/g,""));const{error:s}=await qa.from("patients").upsert(t)}}catch(e){}const t=Nu(),{data:s}=await qa.from("queues").select("number").eq("queue_date",t).order("number",{ascending:!1}).limit(1),r=s&&s.length>0?s[0].number+1:1,n=o.find(e=>e.code===M),i=n?n.purpose:"",{data:l,error:c}=await qa.from("queues").insert([{number:r,patient_id:w,type:M,status:"WAITING",notes:R,queue_date:t}]).select();if(c)throw c;l&&l.length>0&&(V(r),B(M),G(i),w&&N&&(Y(N),Z(S)),U(!0),y(!1),a.success(`!  ${r}`))}catch(t){a.error("")}finally{Q(!1)}}else a.error("")},disabled:L||!w&&!A,className:"w-full h-12 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-medium rounded-xl transition-all duration-200 disabled:opacity-50",children:L?i.jsxs(i.Fragment,{children:[i.jsx(Lo,{className:"w-5 h-5 animate-spin mr-2"}),"..."]}):""})]})})]})}),i.jsx(Ub,{})]})},vS=({patientName:e,patientPhone:t,patientLineId:s,formattedQueueNumber:r,showQRInstructions:n=!0,className:a})=>i.jsxs("div",{className:`text-center ${a}`,children:[i.jsxs("p",{className:"text-lg font-medium text-pharmacy-700",children:[": ",i.jsx("span",{className:"text-2xl",children:r})]}),e&&i.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2 text-sm text-gray-600",children:[i.jsx(Cl,{className:"h-3.5 w-3.5"}),i.jsx("span",{children:e})]}),t&&i.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1 text-sm text-gray-600",children:[i.jsx(el,{className:"h-3.5 w-3.5"}),i.jsx("span",{children:t})]}),s&&i.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1 text-sm text-gray-600",children:[i.jsx(zo,{className:"h-3.5 w-3.5"}),i.jsxs("span",{children:["LINE: ",s]})]}),n&&i.jsx("p",{className:"text-sm text-gray-500 mt-2",children:" QR Code  LINE"})]}),bS=()=>{const{id:e}=m(),{queues:t,sortQueues:s}=yh(),{patients:r}=Ha(),[a,l]=n.useState(15),[c,d]=n.useState(0),u=t.find(t=>t.id===e),h=u?r.find(e=>e.id===u.patient_id):null;if(n.useEffect(()=>{if(async function(){if(u&&"WAITING"===u.status){const r=t.filter(e=>"WAITING"===e.status),n=10*(s(r).findIndex(t=>t.id===e)+1);return d(n),n}}(),u&&"WAITING"===u.status){const r=t.filter(e=>"WAITING"===e.status),n=s(r).findIndex(t=>t.id===e)+1,a=5;let i=0;i=n>0?n*a:r.length*a,i=Math.round(1.2*i),l(Math.max(5,Math.min(60,i)))}},[u,t,e,s]),!u)return i.jsx("div",{className:"max-w-md mx-auto mt-12 px-4",children:i.jsx(Fi,{children:i.jsx(zi,{className:"pt-6",children:i.jsxs("div",{className:"text-center",children:[i.jsx("p",{className:"text-lg text-gray-700 mb-4",children:""}),i.jsx(o,{to:"/"})]})})})});const p=$u(u.type,u.number);return i.jsxs("div",{className:"max-w-md mx-auto mt-4 px-4 pb-12",children:[i.jsxs("div",{className:"mb-6",children:[i.jsx(o,{to:"/"}),i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:""}),i.jsx("p",{className:"text-gray-600",children:""})]}),i.jsx(Fi,{className:"overflow-hidden mb-6",children:i.jsxs(zi,{className:"p-6",children:[i.jsx(vS,{patientName:null==h?void 0:h.name,patientPhone:null==h?void 0:h.phone,patientLineId:null==h?void 0:h.line_id,formattedQueueNumber:p,className:"mb-4"}),"WAITING"===u.status&&i.jsx("div",{className:"flex justify-center mb-4",children:i.jsxs(Lh,{variant:"outline",className:"bg-pharmacy-50 text-pharmacy-700 border-pharmacy-200 px-3 py-1",children:[": ",a," "]})}),i.jsx(Nm,{queueNumber:u.number,queueType:u.type,className:"w-full max-w-[250px] mx-auto"}),i.jsxs("div",{className:"mt-6",children:[i.jsx("p",{className:"text-sm text-gray-500 text-center mb-4",children:"  QR Code "}),u.notes&&i.jsx("div",{className:"bg-gray-50 p-3 rounded-md mb-4",children:i.jsx("p",{className:"text-sm text-gray-600",children:u.notes})}),i.jsxs("div",{className:"flex gap-3 mt-4",children:[i.jsxs(gu,{variant:"outline",className:"flex-1",onClick:async()=>{await xS({queueNumber:u.number,queueType:u.type,patientName:null==h?void 0:h.name,patientPhone:null==h?void 0:h.phone,patientLineId:null==h?void 0:h.line_id,purpose:u.notes,estimatedWaitTime:"WAITING"===u.status?a:void 0,waitTiemQueueNext:c})},children:[i.jsx(rl,{className:"h-4 w-4 mr-2"}),""]}),i.jsxs(gu,{className:"flex-1 bg-pharmacy-600 hover:bg-pharmacy-700",onClick:()=>{navigator.share&&navigator.share({title:` ${p}`,text:` ${p}`,url:window.location.href}).catch(e=>{})},children:[i.jsx(hl,{className:"h-4 w-4 mr-2"}),""]})]})]})]})}),i.jsx("div",{className:"text-center text-sm text-gray-500",children:i.jsxs("p",{children:[" ",new Date(u.created_at).toLocaleString("th-TH")]})})]})},wS=({selectedServicePoint:e,servicePoints:t,onServicePointChange:s,onRefresh:r})=>{const n=u();return i.jsx(Fi,{children:i.jsx(zi,{className:"p-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("h1",{className:"text-2xl font-bold text-pharmacy-600",children:""}),i.jsxs(Jh,{value:(null==e?void 0:e.id)||"",onValueChange:s,children:[i.jsx(Xh,{className:"w-64",children:i.jsx(Zh,{placeholder:""})}),i.jsx(sm,{children:t.map(e=>i.jsx(rm,{value:e.id,children:e.name},e.id))})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[r&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:r,className:"flex items-center gap-2",children:[i.jsx(al,{className:"h-4 w-4"}),""]}),i.jsxs(gu,{variant:"outline",size:"sm",onClick:()=>{n("/settings")},className:"flex items-center gap-2",children:[i.jsx(ul,{className:"h-4 w-4"}),""]})]})]})})})},jS=()=>i.jsx(Fi,{className:"bg-white",children:i.jsx(zi,{className:"p-6",children:i.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[i.jsx("h2",{className:"text-xl font-medium mb-4",children:""}),i.jsx("p",{className:"text-gray-500",children:""})]})})}),NS=Qa("useQueueActions"),_S=Qa("usePharmacyQueueData"),SS=({servicePointId:e,refreshTrigger:t=0})=>{const{queues:s=[],updateQueueStatus:r,sortQueues:i,callQueue:o,recallQueue:l,fetchQueues:c,removeQueue:d,transferQueueToServicePoint:u,returnSkippedQueueToWaiting:h,loading:m}=yh(),{patients:p=[]}=Ha(),{servicePoints:f=[]}=Wa(),{mappings:g}=Uv(),x=n.useMemo(()=>{if(0===g.length)return[];const e={};return g.forEach(t=>{e[t.service_point_id]||(e[t.service_point_id]=[]),e[t.service_point_id].push(t.queue_type_id)}),Object.entries(e).map(([e,t])=>({servicePointId:e,queueTypeIds:t}))},[g]),y=Array.isArray(s)?s.filter(t=>{if(!e){const e=["WAITING","ACTIVE","COMPLETED","SKIPPED"].includes(t.status),s=new Date(new Date);s.setDate(s.getDate()-3);const r=new Date(t.queue_date+"T00:00:00");return e&&r>=s}const s=t.service_point_id===e||!t.service_point_id&&e,r=["WAITING","ACTIVE","COMPLETED","SKIPPED"].includes(t.status),n=new Date(new Date);n.setDate(n.getDate()-3);const a=new Date(t.queue_date+"T00:00:00");return s&&r&&a>=n}):[],v=e&&f.find(t=>t.id===e)||null,b=y.filter(e=>"WAITING"===e.status&&!e.paused_at),w=i?i(b,x):b;i&&_S.debug("Sorted all waiting queues (pharmacy):",{originalCount:b.length,sortedCount:w.length});const j={waiting:w,active:y.filter(e=>"ACTIVE"===e.status),completed:y.filter(e=>"COMPLETED"===e.status),skipped:y.filter(e=>"SKIPPED"===e.status),paused:y.filter(e=>"WAITING"===e.status&&e.paused_at)},{getPatientName:N,getPatientData:_}=(({patients:e})=>{const t=Array.isArray(e)?e:[];return{getPatientName:n.useMemo(()=>e=>{if(!e||!Array.isArray(t))return"";const s=t.find(t=>t&&t.id===e);return(null==s?void 0:s.name)||""},[t]),getPatientData:n.useMemo(()=>e=>e&&Array.isArray(t)&&t.find(t=>t&&t.id===e)||null,[t])}})({patients:Array.isArray(p)?p:[]}),S=n.useCallback(async(e,t)=>{if(v)try{await u(e,v.id,t)}catch(s){throw _S.error("Error in transfer queue wrapper:",s),s}},[u,v]),k=n.useCallback(async e=>{try{await h(e)}catch(t){throw _S.error("Error in return queue wrapper:",t),t}},[h]),C=n.useCallback(async e=>{try{await d(e)}catch(t){throw _S.error("Error in remove queue wrapper:",t),t}},[d]),{handleCallQueue:T,handleUpdateStatus:E,handleRecallQueue:I,handleHoldQueue:P,handleTransferQueue:O,handleReturnToWaiting:A,handleCancelQueue:D}=(({selectedServicePoint:e,servicePointQueues:t,servicePoints:s,callQueue:r,updateQueueStatus:i,recallQueue:o,transferQueueToServicePoint:l,returnSkippedQueueToWaiting:c,removeQueue:d})=>({handleCallQueue:n.useCallback(async s=>{if(!e)return null;const n=t.find(e=>e.id===s),i=n?$u(n.type,n.number):s;NS.debug(`Calling queue ${i} for service point ${e.code}`);try{const t=await r(s,e.id);return t&&a.success(` ${i} `),t}catch(o){throw a.error(` ${i} `),o}},[e,r,t]),handleUpdateStatus:n.useCallback(async(e,s)=>{const r=t.find(t=>t.id===e),n=r?$u(r.type,r.number):e;NS.debug(`Updating queue ${n} status to ${s}`);try{const t=await i(e,s);if(t){let e="";switch(s){case"COMPLETED":e=` ${n} `;break;case"SKIPPED":e=` ${n} `;break;case"WAITING":e=` ${n} `;break;case"PAUSED":e=` ${n} `;break;default:e=` ${n} `}a.success(e)}return t}catch(o){throw a.error(` ${n} `),o}},[i,t]),handleRecallQueue:n.useCallback(async s=>{const r=t.find(e=>e.id===s),n=r?$u(r.type,r.number):s;if(NS.debug(`Recalling queue ${n}`),e)try{const{error:e}=await qa.from("queues").update({called_at:(new Date).toISOString()}).eq("id",s);if(e)throw e;o(s),a.info(` ${n}`)}catch(i){a.error(` ${n}`)}},[o,t,e]),handleHoldQueue:n.useCallback(async e=>{const s=t.find(t=>t.id===e),r=s?$u(s.type,s.number):e;try{const{error:t}=await qa.from("queues").update({paused_at:(new Date).toISOString(),status:"WAITING"}).eq("id",e);if(t)throw t;a.success(` ${r} `)}catch(n){a.error(` ${r} `)}},[t]),handleTransferQueue:n.useCallback(async(e,r)=>{const n=t.find(t=>t.id===e),i=n?$u(n.type,n.number):e,o=s.find(e=>e.id===r);try{await l(e,r),a.success(` ${i}  ${(null==o?void 0:o.name)||""} `)}catch(c){a.error(` ${i} `)}},[l,t,s]),handleReturnToWaiting:n.useCallback(async e=>{const s=t.find(t=>t.id===e),r=s?$u(s.type,s.number):e;try{if(null==s?void 0:s.paused_at){const{error:t}=await qa.from("queues").update({paused_at:null,status:"WAITING"}).eq("id",e);if(t)throw t}else await c(e);a.success(` ${r} `)}catch(n){a.error(` ${r} `)}},[c,t]),handleCancelQueue:n.useCallback(async e=>{const s=t.find(t=>t.id===e),r=s?$u(s.type,s.number):e;try{await d(e),a.success(` ${r} `)}catch(n){a.error(` ${r} `)}},[d,t])}))({selectedServicePoint:v,servicePointQueues:Array.isArray(y)?y:[],servicePoints:Array.isArray(f)?f:[],callQueue:o,updateQueueStatus:r,recallQueue:l,transferQueueToServicePoint:S,returnSkippedQueueToWaiting:k,removeQueue:C}),M=n.useCallback(async()=>{_S.debug(`Manual refresh requested for service point ${(null==v?void 0:v.code)||"ALL"}`);try{await c(!0),a.success("")}catch(e){_S.error("Error refreshing data:",e),a.error("")}},[c,v]);return{selectedServicePoint:v,queuesByStatus:j,queues:s,patients:p,getPatientName:N,getPatientData:_,handleCallQueue:T,handleUpdateStatus:E,handleRecallQueue:I,handleHoldQueue:P,handleTransferQueue:O,handleReturnToWaiting:A,handleCancelQueue:D,handleManualRefresh:M,isLoading:m,servicePoints:Array.isArray(f)?f:[]}},kS=({value:e,queues:t,emptyMessage:s,getPatientName:r,onViewPatientInfo:n,onCallQueue:a,onUpdateStatus:o,onRecallQueue:l,onHoldQueue:c,onTransferClick:d,onReturnToWaiting:u,onCancelQueue:h,isCompleted:m=!1,getPatientById:p})=>{const f=m?t.slice(0,10):t;return i.jsx(Mh,{value:e,className:"space-y-2",children:0===t.length?i.jsx("div",{className:"text-center py-8 text-gray-500",children:s}):f.map(t=>i.jsx(Fh,{queue:t,patientName:r(t.patient_id),patientData:p(t.patient_id),onCall:a?()=>a(t.id):void 0,onSkip:o?()=>o(t.id,"SKIPPED"):void 0,onCancel:h?()=>h(t.id):void 0,onComplete:o?()=>o(t.id,"COMPLETED"):void 0,onRecall:l?()=>l(t.id):void 0,onHold:c?()=>c(t.id):void 0,onPaused:o?()=>o(t.id,"PAUSED"):void 0,onTransfer:d?()=>d(t.id):void 0,onReturnToWaiting:u?()=>u(t.id):void 0,onViewPatientInfo:()=>n(t,e),isPharmacyInterface:!0},t.id))})},CS=({servicePointId:e="",refreshTrigger:t})=>{const{queuesByStatus:s,getPatientName:r,handleCallQueue:n,handleUpdateStatus:a,handleRecallQueue:o,handleHoldQueue:l,handleTransferQueue:c,handleReturnToWaiting:u,handleCancelQueue:h,getPatientData:m,selectedServicePoint:p,servicePoints:f}=SS({servicePointId:e||"",refreshTrigger:t}),[g,x]=d.useState(!1),[y,v]=d.useState(null),[b,w]=d.useState(null),[j,N]=d.useState(""),[_,S]=d.useState(!1),[k,C]=d.useState(null),T=(e,t)=>{const s=m(e.patient_id);s&&(v(s),w(e.id),N(e.number?`${e.type}${e.number}`:""),x(!0))},E=e=>m(e);return i.jsxs("div",{className:"h-full",children:[i.jsxs(Oh,{defaultValue:"waiting",className:"h-full flex flex-col",children:[i.jsxs(Ah,{className:"grid w-full grid-cols-5 mb-4",children:[i.jsxs(Dh,{value:"waiting",className:"flex items-center gap-2",children:["",s.waiting.length>0&&i.jsx(Lh,{variant:"secondary",className:"ml-1",children:s.waiting.length})]}),i.jsxs(Dh,{value:"active",className:"flex items-center gap-2",children:["",s.active.length>0&&i.jsx(Lh,{variant:"secondary",className:"ml-1",children:s.active.length})]}),i.jsxs(Dh,{value:"paused",className:"flex items-center gap-2",children:["",s.paused.length>0&&i.jsx(Lh,{variant:"secondary",className:"ml-1",children:s.paused.length})]}),i.jsxs(Dh,{value:"skipped",className:"flex items-center gap-2",children:["",s.skipped.length>0&&i.jsx(Lh,{variant:"secondary",className:"ml-1",children:s.skipped.length})]}),i.jsxs(Dh,{value:"completed",className:"flex items-center gap-2",children:["",s.completed.length>0&&i.jsx(Lh,{variant:"secondary",className:"ml-1",children:s.completed.length})]})]}),i.jsxs("div",{className:"flex-1 overflow-auto",children:[i.jsx(kS,{value:"waiting",getPatientById:E,queues:s.waiting,emptyMessage:"",getPatientName:r,onViewPatientInfo:T,onCallQueue:n,onUpdateStatus:a}),i.jsx(kS,{value:"active",getPatientById:E,queues:s.active,emptyMessage:"",getPatientName:r,onViewPatientInfo:T,onUpdateStatus:a,onRecallQueue:o,onHoldQueue:l,onTransferClick:e=>{C(e),S(!0)}}),i.jsx(kS,{value:"paused",getPatientById:E,queues:s.paused,emptyMessage:"",getPatientName:r,onViewPatientInfo:T,onCallQueue:n,onReturnToWaiting:u,onUpdateStatus:a}),i.jsx(kS,{value:"skipped",getPatientById:E,queues:s.skipped,emptyMessage:"",getPatientName:r,onViewPatientInfo:T,onReturnToWaiting:u,onCancelQueue:h}),i.jsx(kS,{value:"completed",getPatientById:E,queues:s.completed,emptyMessage:"",getPatientName:r,onViewPatientInfo:T,isCompleted:!0})]})]}),i.jsx(Hy,{open:g,onOpenChange:x,patient:y,queueId:b||void 0,queueNumber:j,mode:"view",showCheckNotes:!1}),i.jsx(_b,{open:_,onOpenChange:S,onTransfer:async e=>{k&&(await c(k,e),S(!1),C(null))},servicePoints:f,currentServicePointId:(null==p?void 0:p.id)||""})]})},TS=({servicePointId:e,title:t="",refreshTrigger:s})=>i.jsxs(Fi,{className:"h-full flex flex-col",children:[i.jsx(Ui,{className:"flex-shrink-0",children:i.jsx(Wi,{children:t})}),i.jsx(zi,{className:"flex-1 overflow-hidden p-0",children:i.jsx(CS,{servicePointId:e,refreshTrigger:s})})]}),ES=({selectedServicePoint:e,refreshTrigger:t})=>i.jsx("div",{className:"h-full p-6",children:i.jsx(TS,{servicePointId:e.id,title:` - ${e.name}`,refreshTrigger:t})}),IS=()=>i.jsx("div",{className:"flex items-center justify-center h-full",children:i.jsx("p",{className:"text-gray-500",children:"..."})}),PS=()=>{const[e,t]=n.useState(0),{selectedServicePoint:s,setSelectedServicePoint:r,servicePoints:a,loading:o}=Ba(),l=n.useCallback(()=>{t(e=>e+1)},[]);return o?i.jsx(IS,{}):i.jsx(my,{children:i.jsxs("div",{className:"flex flex-col h-screen overflow-hidden",children:[i.jsx("div",{className:"p-6 border-b bg-white",children:i.jsx(wS,{selectedServicePoint:s,servicePoints:a,onServicePointChange:e=>{const t=a.find(t=>t.id===e);t&&r(t)},onRefresh:l})}),i.jsx("div",{className:"flex-1 overflow-hidden min-h-0",children:s?i.jsx(ES,{selectedServicePoint:s,refreshTrigger:e}):i.jsx(jS,{})})]})})},OS=({closeSidebar:e})=>i.jsxs("div",{className:"h-16 flex items-center px-6 border-b border-gray-200 flex-shrink-0",children:[i.jsx("h1",{className:"text-xl font-semibold tracking-tight",children:"SubdisTH-Que"}),i.jsx(gu,{variant:"ghost",size:"icon",onClick:e,className:"ml-auto lg:hidden",children:i.jsx(Pl,{className:"h-5 w-5"})})]});var AS="ScrollArea",[DS]=se(AS),[MS,qS]=DS(AS),RS=n.forwardRef((e,t)=>{const{__scopeScrollArea:s,type:r="hover",dir:a,scrollHideDelay:o=600,...l}=e,[c,d]=n.useState(null),[u,h]=n.useState(null),[m,p]=n.useState(null),[f,g]=n.useState(null),[x,y]=n.useState(null),[v,b]=n.useState(0),[w,j]=n.useState(0),[N,_]=n.useState(!1),[S,k]=n.useState(!1),C=ie(t,e=>d(e)),T=Pe(a);return i.jsx(MS,{scope:s,type:r,dir:T,scrollHideDelay:o,scrollArea:c,viewport:u,onViewportChange:h,content:m,onContentChange:p,scrollbarX:f,onScrollbarXChange:g,scrollbarXEnabled:N,onScrollbarXEnabledChange:_,scrollbarY:x,onScrollbarYChange:y,scrollbarYEnabled:S,onScrollbarYEnabledChange:k,onCornerWidthChange:b,onCornerHeightChange:j,children:i.jsx(ye.div,{dir:T,...l,ref:C,style:{position:"relative","--radix-scroll-area-corner-width":v+"px","--radix-scroll-area-corner-height":w+"px",...e.style}})})});RS.displayName=AS;var $S="ScrollAreaViewport",LS=n.forwardRef((e,t)=>{const{__scopeScrollArea:s,children:r,nonce:a,...o}=e,l=qS($S,s),c=n.useRef(null),d=ie(t,c,l.onViewportChange);return i.jsxs(i.Fragment,{children:[i.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),i.jsx(ye.div,{"data-radix-scroll-area-viewport":"",...o,ref:d,style:{overflowX:l.scrollbarXEnabled?"scroll":"hidden",overflowY:l.scrollbarYEnabled?"scroll":"hidden",...e.style},children:i.jsx("div",{ref:l.onContentChange,style:{minWidth:"100%",display:"table"},children:r})})]})});LS.displayName=$S;var QS="ScrollAreaScrollbar",FS=n.forwardRef((e,t)=>{const{forceMount:s,...r}=e,a=qS(QS,e.__scopeScrollArea),{onScrollbarXEnabledChange:o,onScrollbarYEnabledChange:l}=a,c="horizontal"===e.orientation;return n.useEffect(()=>(c?o(!0):l(!0),()=>{c?o(!1):l(!1)}),[c,o,l]),"hover"===a.type?i.jsx(US,{...r,ref:t,forceMount:s}):"scroll"===a.type?i.jsx(WS,{...r,ref:t,forceMount:s}):"auto"===a.type?i.jsx(VS,{...r,ref:t,forceMount:s}):"always"===a.type?i.jsx(zS,{...r,ref:t}):null});FS.displayName=QS;var US=n.forwardRef((e,t)=>{const{forceMount:s,...r}=e,a=qS(QS,e.__scopeScrollArea),[o,l]=n.useState(!1);return n.useEffect(()=>{const e=a.scrollArea;let t=0;if(e){const s=()=>{window.clearTimeout(t),l(!0)},r=()=>{t=window.setTimeout(()=>l(!1),a.scrollHideDelay)};return e.addEventListener("pointerenter",s),e.addEventListener("pointerleave",r),()=>{window.clearTimeout(t),e.removeEventListener("pointerenter",s),e.removeEventListener("pointerleave",r)}}},[a.scrollArea,a.scrollHideDelay]),i.jsx(re,{present:s||o,children:i.jsx(VS,{"data-state":o?"visible":"hidden",...r,ref:t})})}),WS=n.forwardRef((e,t)=>{const{forceMount:s,...r}=e,a=qS(QS,e.__scopeScrollArea),o="horizontal"===e.orientation,l=dk(()=>d("SCROLL_END"),100),[c,d]=(u="hidden",h={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},n.useReducer((e,t)=>h[e][t]??e,u));var u,h;return n.useEffect(()=>{if("idle"===c){const e=window.setTimeout(()=>d("HIDE"),a.scrollHideDelay);return()=>window.clearTimeout(e)}},[c,a.scrollHideDelay,d]),n.useEffect(()=>{const e=a.viewport,t=o?"scrollLeft":"scrollTop";if(e){let s=e[t];const r=()=>{const r=e[t];s!==r&&(d("SCROLL"),l()),s=r};return e.addEventListener("scroll",r),()=>e.removeEventListener("scroll",r)}},[a.viewport,o,d,l]),i.jsx(re,{present:s||"hidden"!==c,children:i.jsx(zS,{"data-state":"hidden"===c?"hidden":"visible",...r,ref:t,onPointerEnter:de(e.onPointerEnter,()=>d("POINTER_ENTER")),onPointerLeave:de(e.onPointerLeave,()=>d("POINTER_LEAVE"))})})}),VS=n.forwardRef((e,t)=>{const s=qS(QS,e.__scopeScrollArea),{forceMount:r,...a}=e,[o,l]=n.useState(!1),c="horizontal"===e.orientation,d=dk(()=>{if(s.viewport){const e=s.viewport.offsetWidth<s.viewport.scrollWidth,t=s.viewport.offsetHeight<s.viewport.scrollHeight;l(c?e:t)}},10);return uk(s.viewport,d),uk(s.content,d),i.jsx(re,{present:r||o,children:i.jsx(zS,{"data-state":o?"visible":"hidden",...a,ref:t})})}),zS=n.forwardRef((e,t)=>{const{orientation:s="vertical",...r}=e,a=qS(QS,e.__scopeScrollArea),o=n.useRef(null),l=n.useRef(0),[c,d]=n.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=nk(c.viewport,c.content),h={...r,sizes:c,onSizesChange:d,hasThumb:Boolean(u>0&&u<1),onThumbChange:e=>o.current=e,onThumbPointerUp:()=>l.current=0,onThumbPointerDown:e=>l.current=e};function m(e,t){return function(e,t,s,r="ltr"){const n=ak(s),a=n/2,i=t||a,o=n-i,l=s.scrollbar.paddingStart+i,c=s.scrollbar.size-s.scrollbar.paddingEnd-o,d=s.content-s.viewport,u="ltr"===r?[0,d]:[-1*d,0];return ok([l,c],u)(e)}(e,l.current,c,t)}return"horizontal"===s?i.jsx(BS,{...h,ref:t,onThumbPositionChange:()=>{if(a.viewport&&o.current){const e=ik(a.viewport.scrollLeft,c,a.dir);o.current.style.transform=`translate3d(${e}px, 0, 0)`}},onWheelScroll:e=>{a.viewport&&(a.viewport.scrollLeft=e)},onDragScroll:e=>{a.viewport&&(a.viewport.scrollLeft=m(e,a.dir))}}):"vertical"===s?i.jsx(HS,{...h,ref:t,onThumbPositionChange:()=>{if(a.viewport&&o.current){const e=ik(a.viewport.scrollTop,c);o.current.style.transform=`translate3d(0, ${e}px, 0)`}},onWheelScroll:e=>{a.viewport&&(a.viewport.scrollTop=e)},onDragScroll:e=>{a.viewport&&(a.viewport.scrollTop=m(e))}}):null}),BS=n.forwardRef((e,t)=>{const{sizes:s,onSizesChange:r,...a}=e,o=qS(QS,e.__scopeScrollArea),[l,c]=n.useState(),d=n.useRef(null),u=ie(t,d,o.onScrollbarXChange);return n.useEffect(()=>{d.current&&c(getComputedStyle(d.current))},[d]),i.jsx(YS,{"data-orientation":"horizontal",...a,ref:u,sizes:s,style:{bottom:0,left:"rtl"===o.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===o.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":ak(s)+"px",...e.style},onThumbPointerDown:t=>e.onThumbPointerDown(t.x),onDragScroll:t=>e.onDragScroll(t.x),onWheelScroll:(t,s)=>{if(o.viewport){const r=o.viewport.scrollLeft+t.deltaX;e.onWheelScroll(r),lk(r,s)&&t.preventDefault()}},onResize:()=>{d.current&&o.viewport&&l&&r({content:o.viewport.scrollWidth,viewport:o.viewport.offsetWidth,scrollbar:{size:d.current.clientWidth,paddingStart:rk(l.paddingLeft),paddingEnd:rk(l.paddingRight)}})}})}),HS=n.forwardRef((e,t)=>{const{sizes:s,onSizesChange:r,...a}=e,o=qS(QS,e.__scopeScrollArea),[l,c]=n.useState(),d=n.useRef(null),u=ie(t,d,o.onScrollbarYChange);return n.useEffect(()=>{d.current&&c(getComputedStyle(d.current))},[d]),i.jsx(YS,{"data-orientation":"vertical",...a,ref:u,sizes:s,style:{top:0,right:"ltr"===o.dir?0:void 0,left:"rtl"===o.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":ak(s)+"px",...e.style},onThumbPointerDown:t=>e.onThumbPointerDown(t.y),onDragScroll:t=>e.onDragScroll(t.y),onWheelScroll:(t,s)=>{if(o.viewport){const r=o.viewport.scrollTop+t.deltaY;e.onWheelScroll(r),lk(r,s)&&t.preventDefault()}},onResize:()=>{d.current&&o.viewport&&l&&r({content:o.viewport.scrollHeight,viewport:o.viewport.offsetHeight,scrollbar:{size:d.current.clientHeight,paddingStart:rk(l.paddingTop),paddingEnd:rk(l.paddingBottom)}})}})}),[GS,KS]=DS(QS),YS=n.forwardRef((e,t)=>{const{__scopeScrollArea:s,sizes:r,hasThumb:a,onThumbChange:o,onThumbPointerUp:l,onThumbPointerDown:c,onThumbPositionChange:d,onDragScroll:u,onWheelScroll:h,onResize:m,...p}=e,f=qS(QS,s),[g,x]=n.useState(null),y=ie(t,e=>x(e)),v=n.useRef(null),b=n.useRef(""),w=f.viewport,j=r.content-r.viewport,N=st(h),_=st(d),S=dk(m,10);function k(e){if(v.current){const t=e.clientX-v.current.left,s=e.clientY-v.current.top;u({x:t,y:s})}}return n.useEffect(()=>{const e=e=>{const t=e.target;(null==g?void 0:g.contains(t))&&N(e,j)};return document.addEventListener("wheel",e,{passive:!1}),()=>document.removeEventListener("wheel",e,{passive:!1})},[w,g,j,N]),n.useEffect(_,[r,_]),uk(g,S),uk(f.content,S),i.jsx(GS,{scope:s,scrollbar:g,hasThumb:a,onThumbChange:st(o),onThumbPointerUp:st(l),onThumbPositionChange:_,onThumbPointerDown:st(c),children:i.jsx(ye.div,{...p,ref:y,style:{position:"absolute",...p.style},onPointerDown:de(e.onPointerDown,e=>{if(0===e.button){e.target.setPointerCapture(e.pointerId),v.current=g.getBoundingClientRect(),b.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",f.viewport&&(f.viewport.style.scrollBehavior="auto"),k(e)}}),onPointerMove:de(e.onPointerMove,k),onPointerUp:de(e.onPointerUp,e=>{const t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),document.body.style.webkitUserSelect=b.current,f.viewport&&(f.viewport.style.scrollBehavior=""),v.current=null})})})}),JS="ScrollAreaThumb",ZS=n.forwardRef((e,t)=>{const{forceMount:s,...r}=e,n=KS(JS,e.__scopeScrollArea);return i.jsx(re,{present:s||n.hasThumb,children:i.jsx(XS,{ref:t,...r})})}),XS=n.forwardRef((e,t)=>{const{__scopeScrollArea:s,style:r,...a}=e,o=qS(JS,s),l=KS(JS,s),{onThumbPositionChange:c}=l,d=ie(t,e=>l.onThumbChange(e)),u=n.useRef(void 0),h=dk(()=>{u.current&&(u.current(),u.current=void 0)},100);return n.useEffect(()=>{const e=o.viewport;if(e){const t=()=>{if(h(),!u.current){const t=ck(e,c);u.current=t,c()}};return c(),e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}},[o.viewport,h,c]),i.jsx(ye.div,{"data-state":l.hasThumb?"visible":"hidden",...a,ref:d,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...r},onPointerDownCapture:de(e.onPointerDownCapture,e=>{const t=e.target.getBoundingClientRect(),s=e.clientX-t.left,r=e.clientY-t.top;l.onThumbPointerDown({x:s,y:r})}),onPointerUp:de(e.onPointerUp,l.onThumbPointerUp)})});ZS.displayName=JS;var ek="ScrollAreaCorner",tk=n.forwardRef((e,t)=>{const s=qS(ek,e.__scopeScrollArea),r=Boolean(s.scrollbarX&&s.scrollbarY);return"scroll"!==s.type&&r?i.jsx(sk,{...e,ref:t}):null});tk.displayName=ek;var sk=n.forwardRef((e,t)=>{const{__scopeScrollArea:s,...r}=e,a=qS(ek,s),[o,l]=n.useState(0),[c,d]=n.useState(0),u=Boolean(o&&c);return uk(a.scrollbarX,()=>{var e;const t=(null==(e=a.scrollbarX)?void 0:e.offsetHeight)||0;a.onCornerHeightChange(t),d(t)}),uk(a.scrollbarY,()=>{var e;const t=(null==(e=a.scrollbarY)?void 0:e.offsetWidth)||0;a.onCornerWidthChange(t),l(t)}),u?i.jsx(ye.div,{...r,ref:t,style:{width:o,height:c,position:"absolute",right:"ltr"===a.dir?0:void 0,left:"rtl"===a.dir?0:void 0,bottom:0,...e.style}}):null});function rk(e){return e?parseInt(e,10):0}function nk(e,t){const s=e/t;return isNaN(s)?0:s}function ak(e){const t=nk(e.viewport,e.content),s=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,r=(e.scrollbar.size-s)*t;return Math.max(r,18)}function ik(e,t,s="ltr"){const r=ak(t),n=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=t.scrollbar.size-n,i=t.content-t.viewport,o=a-r,l=nt(e,"ltr"===s?[0,i]:[-1*i,0]);return ok([0,i],[0,o])(l)}function ok(e,t){return s=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(s-e[0])}}function lk(e,t){return e>0&&e<t}var ck=(e,t=()=>{})=>{let s={left:e.scrollLeft,top:e.scrollTop},r=0;return function n(){const a={left:e.scrollLeft,top:e.scrollTop},i=s.left!==a.left,o=s.top!==a.top;(i||o)&&t(),s=a,r=window.requestAnimationFrame(n)}(),()=>window.cancelAnimationFrame(r)};function dk(e,t){const s=st(e),r=n.useRef(0);return n.useEffect(()=>()=>window.clearTimeout(r.current),[]),n.useCallback(()=>{window.clearTimeout(r.current),r.current=window.setTimeout(s,t)},[s,t])}function uk(e,t){const s=st(t);rt(()=>{let t=0;if(e){const r=new ResizeObserver(()=>{cancelAnimationFrame(t),t=window.requestAnimationFrame(s)});return r.observe(e),()=>{window.cancelAnimationFrame(t),r.unobserve(e)}}},[e,s])}var hk=RS,mk=LS,pk=tk;const fk=n.forwardRef(({className:e,children:t,...s},r)=>i.jsxs(hk,{ref:r,className:Qi("relative overflow-hidden",e),...s,children:[i.jsx(mk,{className:"h-full w-full rounded-[inherit]",children:t}),i.jsx(gk,{}),i.jsx(pk,{})]}));fk.displayName=hk.displayName;const gk=n.forwardRef(({className:e,orientation:t="vertical",...s},r)=>i.jsx(FS,{ref:r,orientation:t,className:Qi("flex touch-none select-none transition-colors","vertical"===t&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...s,children:i.jsx(ZS,{className:"relative flex-1 rounded-full bg-border"})}));gk.displayName=FS.displayName;const xk=({to:e,icon:t,children:s,isActive:r,onClick:n})=>i.jsxs(p,{to:e,onClick:n,className:({isActive:t})=>Qi("flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors",r(e)?"bg-gray-100 text-gray-900":"text-gray-700 hover:bg-gray-100 hover:text-gray-900"),children:[i.jsx(t,{className:"mr-3 h-5 w-5"}),s]}),yk=({title:e,children:t})=>i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"pt-4 pb-2",children:i.jsx("div",{className:"px-3",children:i.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:e})})}),t]}),vk=({isActiveRoute:e,closeSidebar:t})=>i.jsxs(yk,{title:"",children:[i.jsx(xk,{to:"/queue/create-ins",icon:vl,isActive:e,onClick:t,children:""}),i.jsx(xk,{to:"/ins-queue",icon:io,isActive:e,onClick:t,children:""}),i.jsxs(yk,{title:"",children:[i.jsx(xk,{to:"/queue",icon:ul,isActive:e,onClick:t,children:""}),i.jsx(xk,{to:"/queue/create",icon:vl,isActive:e,onClick:t,children:""}),i.jsx(xk,{to:"/pharmacy",icon:io,isActive:e,onClick:t,children:""})]}),i.jsxs(yk,{title:"",children:[i.jsx(xk,{to:"/queue-board",icon:Ho,isActive:e,onClick:t,children:""}),i.jsx(xk,{to:"/queue-board-ins",icon:Ho,isActive:e,onClick:t,children:""}),i.jsx(xk,{to:"/combined-queue-board",icon:Ho,isActive:e,onClick:t,children:""})]}),"localhost"===window.location.hostname&&i.jsx(xk,{to:"/test-dashboard",icon:yl,isActive:e,onClick:t,children:""})]}),bk=({isActiveRoute:e,closeSidebar:t})=>i.jsxs(yk,{title:"",children:[i.jsx(xk,{to:"/patients",icon:Tl,isActive:e,onClick:t,children:""}),i.jsx(xk,{to:"/appointments",icon:ao,isActive:e,onClick:t,children:""}),i.jsx(xk,{to:"/medications",icon:Ko,isActive:e,onClick:t,children:""}),i.jsx(xk,{to:"/queue-history",icon:jo,isActive:e,onClick:t,children:""}),i.jsx(xk,{to:"/ins-queue-history",icon:jo,isActive:e,onClick:t,children:""})]}),wk=({isActiveRoute:e,closeSidebar:t})=>i.jsxs(yk,{title:"",children:[i.jsx(xk,{to:"/analytics",icon:io,isActive:e,onClick:t,children:""}),i.jsx(xk,{to:"/settings",icon:ul,isActive:e,onClick:t,children:""})]}),jk=({isActiveRoute:e,closeSidebar:t})=>i.jsx("div",{className:"flex-1 min-h-0",children:i.jsx(fk,{className:"h-full px-3 py-4",children:i.jsxs("nav",{className:"space-y-1",children:[i.jsx(xk,{to:"/",icon:Po,isActive:e,onClick:t,children:""}),i.jsx(vk,{isActiveRoute:e,closeSidebar:t}),i.jsx(bk,{isActiveRoute:e,closeSidebar:t}),i.jsx(wk,{isActiveRoute:e,closeSidebar:t})]})})}),Nk=()=>i.jsxs("div",{className:"p-4 border-t border-gray-200 text-xs text-gray-500 text-center flex-shrink-0",children:[" ",(new Date).getFullYear()," SubdisTH-Que"]});function _k(){const[e,t]=n.useState(!1),s=f(),r=()=>{t(!1)};return i.jsxs(i.Fragment,{children:[e&&i.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 lg:hidden",onClick:r,"aria-hidden":"true"}),i.jsx("div",{className:"fixed top-4 left-4 z-50 lg:hidden",children:i.jsxs(gu,{variant:"outline",size:"icon",onClick:()=>{t(!e)},className:"bg-white border-gray-200",children:[e?i.jsx(Pl,{className:"h-5 w-5"}):i.jsx(Wo,{className:"h-5 w-5"}),i.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})}),i.jsx("div",{className:Qi("w-64 bg-white border-r border-gray-200 transition-all duration-200 ease-in-out","lg:relative lg:translate-x-0 lg:h-screen","fixed top-0 left-0 z-50 h-screen",e?"translate-x-0":"-translate-x-full lg:translate-x-0"),children:i.jsxs("div",{className:"flex flex-col h-full",children:[i.jsx(OS,{closeSidebar:r}),i.jsx(jk,{isActiveRoute:e=>s.pathname===e,closeSidebar:r}),i.jsx(Nk,{})]})})]})}const Sk=async e=>{const{useEdgeFunction:t=!0,useExternalService:s=!1}=e||{},r=sessionStorage.getItem("clientIP")||window.__CLIENT_IP__;if(r)return r;if(t){const e=await(async()=>{try{const{data:e,error:t}=await qa.functions.invoke("get-client-ip");return t?null:e&&e.ip?(sessionStorage.setItem("clientIP",e.ip),window.__CLIENT_IP__=e.ip,e.ip):null}catch(e){return null}})();if(e)return e}if(s){const e=await(async()=>{try{const e=await fetch("https://api.ipify.org?format=json"),t=await e.json();return t&&t.ip?(sessionStorage.setItem("clientIP",t.ip),window.__CLIENT_IP__=t.ip,t.ip):null}catch(e){return null}})();if(e)return e}return null},kk=(e,t)=>{const[s,r]=t.split("/"),n=~(2**(32-parseInt(r))-1),a=e=>e.split(".").reduce((e,t)=>(e<<8)+parseInt(t),0)>>>0;return(a(e)&n)===(a(s)&n)},Ck=async()=>{const e=await(async e=>{const{forceRefresh:t=!1,...s}=e||{};if(!t){const e=sessionStorage.getItem("clientIP")||window.__CLIENT_IP__;if(e)return e}return await Sk(s)})({useEdgeFunction:!1,useExternalService:!0});return e?(e=>"::1"===e||"::ffff:127.0.0.1"===e?"127.0.0.1":e)(e):null},Tk=async e=>{if(!e)return!1;const t=await(async()=>{try{const{data:e,error:t}=await qa.from("settings").select("value_text").eq("category","IP");if(t)return[];if(!e||0===e.length)return[];const s=[];return e.forEach(e=>{if(e.value_text){const t=e.value_text.split(/[,;\n]/).map(e=>e.trim()).filter(e=>e.length>0);s.push(...t)}}),s}catch(e){return[]}})();if(0===t.length)return!0;const s=t.some(t=>((e,t)=>{if(e===t)return!0;if(t.includes("*")){const s=t.replace(/\./g,"\\.").replace(/\*/g,"\\d+");return new RegExp(`^${s}$`).test(e)}return!!t.includes("/")&&kk(e,t)})(e,t));return s},Ek=e=>{const{autoCheck:t=!0,redirectOnDenied:s=!0,redirectPath:r="/"}=e||{},[i,o]=n.useState(!1),[l,c]=n.useState(null),[d,h]=n.useState(null),m=u(),p=async()=>{o(!0);try{const e=await Ck();h(e);const{allowed:t,message:n}=await(async()=>{const e=await Ck();return e?await Tk(e)?{allowed:!0}:{allowed:!1,message:`: IP address (${e})  Admin`}:{allowed:!1,message:" IP address  "}})();return c(t),t||(a.error(n||""),s&&setTimeout(()=>{m(r,{replace:!0})},2e3)),t}catch(e){return c(!1),a.error(""),!1}finally{o(!1)}};return n.useEffect(()=>{t&&p()},[t]),{isChecking:i,isAllowed:l,clientIP:d,checkAccess:p}},Ik=({children:e,fullWidth:t=!1,className:s,requireIPProtection:r=!0})=>{u();const{isChecking:n,isAllowed:a}=Ek({autoCheck:r,redirectOnDenied:!1,redirectPath:"/"});return r?n||null===a?i.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:i.jsxs("div",{className:"text-center",children:[i.jsx(Lo,{className:"h-12 w-12 animate-spin mx-auto mb-4 text-primary"}),i.jsx("p",{className:"text-lg text-muted-foreground",children:"..."}),i.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:""})]})}):a?i.jsxs("div",{className:`min-h-screen bg-background flex ${s||""}`,children:[i.jsx(_k,{}),i.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[i.jsx("header",{className:"border-b bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/60 flex-shrink-0",children:i.jsx("div",{className:"container flex h-16 items-center justify-between px-4",children:i.jsx("div",{className:"flex items-center space-x-4",children:i.jsx("h1",{className:"text-lg font-semibold",children:""})})})}),i.jsx("main",{className:"flex-1 overflow-auto "+(t?"w-full px-4 py-6":"container mx-auto px-4 py-6"),children:e})]})]}):i.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:i.jsxs("div",{className:"text-center max-w-md p-8 bg-white rounded-lg shadow-lg",children:[i.jsx(ml,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),i.jsx("h1",{className:"text-2xl font-bold mb-2 text-gray-900",children:""}),i.jsx("p",{className:"text-gray-600 mb-4",children:"IP address "})]})}):i.jsxs("div",{className:`min-h-screen bg-background flex ${s||""}`,children:[i.jsx(_k,{}),i.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[i.jsx("header",{className:"border-b bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/60 flex-shrink-0",children:i.jsx("div",{className:"container flex h-16 items-center justify-between px-4",children:i.jsx("div",{className:"flex items-center space-x-4",children:i.jsx("h1",{className:"text-lg font-semibold",children:""})})})}),i.jsx("main",{className:"flex-1 overflow-auto "+(t?"w-full px-4 py-6":"container mx-auto px-4 py-6"),children:e})]})]})},Pk=()=>{const{servicePointId:e}=m(),{servicePoints:t}=Wa(),{queues:s,updateQueueStatus:r,recallQueue:n}=yh(),{patients:a}=Ha(),o=t.find(t=>t.id===e),l=s.filter(t=>t.service_point_id===e),c=l.filter(e=>"WAITING"===e.status),d=l.filter(e=>"ACTIVE"===e.status),u=l.filter(e=>"COMPLETED"===e.status),h=e=>{const t=a.find(t=>t.id===e);return t?t.name:"Unknown"},p=e=>a.find(t=>t.id===e);return o?i.jsx(Ik,{className:"overflow-hidden",children:i.jsxs("div",{className:"flex flex-col h-[calc(100vh-2rem)]",children:[i.jsx("div",{className:"mb-4",children:i.jsxs(Fi,{children:[i.jsx(Ui,{children:i.jsxs(Wi,{className:"flex items-center gap-2",children:[i.jsx("span",{children:o.name}),i.jsxs("span",{className:"text-sm text-gray-500",children:["(",o.code,")"]})]})}),i.jsx(zi,{children:i.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-orange-600",children:c.length}),i.jsx("p",{className:"text-sm text-gray-500",children:""})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-green-600",children:d.length}),i.jsx("p",{className:"text-sm text-gray-500",children:""})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-2xl font-bold text-gray-600",children:u.length}),i.jsx("p",{className:"text-sm text-gray-500",children:""})]})]})})]})}),i.jsx("div",{className:"flex-1 overflow-hidden",children:i.jsxs(Oh,{defaultValue:"waiting",className:"h-full flex flex-col",children:[i.jsx("div",{className:"border-b px-2",children:i.jsxs(Ah,{className:"h-12",children:[i.jsxs(Dh,{value:"waiting",className:"relative",children:["",c.length>0&&i.jsx("span",{className:"ml-2 rounded-full bg-primary text-primary-foreground text-xs px-2 py-0.5",children:c.length})]}),i.jsxs(Dh,{value:"active",className:"relative",children:["",d.length>0&&i.jsx("span",{className:"ml-2 rounded-full bg-green-500 text-white text-xs px-2 py-0.5",children:d.length})]}),i.jsxs(Dh,{value:"completed",children:["",u.length>0&&i.jsx("span",{className:"ml-2 rounded-full bg-gray-500 text-white text-xs px-2 py-0.5",children:u.length})]})]})}),i.jsxs("div",{className:"flex-1 overflow-auto p-2",children:[i.jsx(Mh,{value:"waiting",className:"mt-0 h-full",children:i.jsx(Fi,{className:"h-full overflow-auto border-0 shadow-none",children:i.jsx(am,{queues:c,getPatientById:p,getPatientName:h,onUpdateStatus:r,status:"WAITING",selectedServicePoint:o})})}),i.jsx(Mh,{value:"active",className:"mt-0 h-full",children:i.jsx(Fi,{className:"h-full overflow-auto border-0 shadow-none",children:i.jsx(am,{queues:d,getPatientById:p,getPatientName:h,onUpdateStatus:r,onRecallQueue:n,status:"ACTIVE",selectedServicePoint:o})})}),i.jsx(Mh,{value:"completed",className:"mt-0 h-full",children:i.jsx(Fi,{className:"h-full overflow-auto border-0 shadow-none",children:i.jsx(am,{getPatientById:p,queues:u,getPatientName:h,status:"COMPLETED",selectedServicePoint:o})})})]})]})})]})}):i.jsx(Ik,{children:i.jsx("div",{className:"flex items-center justify-center h-full",children:i.jsx("p",{className:"text-gray-500",children:""})})})},Ok=()=>{const[e,t]=n.useState([]),[s,r]=n.useState([]),[o,l]=n.useState(!0),[c,d]=n.useState({totalServed:0,averageWaitTime:0,totalPatients:0}),[u,h]=n.useState(!1),[m,p]=n.useState(null),[f,g]=n.useState(""),[x,y]=n.useState([]),[v,b]=n.useState(!1),[w,j]=n.useState(""),[N,_]=n.useState({from:zl(new Date),to:ec(new Date)}),[S,k]=n.useState("all"),[C,T]=n.useState([]),[E,I]=n.useState([]);n.useEffect(()=>{(async()=>{try{const{data:e,error:t}=await qa.from("queue_types").select("*");if(t)throw t;if(e){const t=e.map(e=>({id:e.id,code:e.code,name:e.name,prefix:e.prefix,purpose:e.purpose||"",format:ox(e.format),enabled:e.enabled,algorithm:lx(e.algorithm),priority:e.priority}));T(t)}}catch(e){a.error("");const s=localStorage.getItem("queue_types");if(s)try{const e=JSON.parse(s).map(e=>({...e,format:ox(e.format),algorithm:lx(e.algorithm),purpose:e.purpose||""}));T(e)}catch(t){}}})()},[]),n.useEffect(()=>{(async()=>{l(!0);try{let e=qa.from("queues").select("*, patient:patient_id(id, name, phone)");if(null==N?void 0:N.from){const t=zc(N.from,"yyyy-MM-dd");e=e.gte("queue_date",t)}if(null==N?void 0:N.to){const t=zc(N.to,"yyyy-MM-dd");e=e.lte("queue_date",t)}e=e.in("status",["COMPLETED","SKIPPED"]);const{data:s,error:n}=await e;if(n)throw n;if(s){t(s);const e=s.length;let r=0,n=0;s.forEach(e=>{if(e.called_at&&e.created_at){const t=(new Date(e.called_at).getTime()-new Date(e.created_at).getTime())/6e4;t>0&&(r+=t,n++)}});const a=n>0?Math.round(r/n):0,i=new Set(s.map(e=>e.patient_id)).size;d({totalServed:e,averageWaitTime:a,totalPatients:i})}const a=[...new Set((null==s?void 0:s.map(e=>e.patient_id))||[])];if(a.length>0){const{data:e,error:t}=await qa.from("patients").select("*").in("id",a);if(t)throw t;e&&r(e)}}catch(e){a.error("")}finally{l(!1)}})()},[N]),n.useEffect(()=>{(async()=>{try{const{data:e,error:t}=await qa.from("service_points").select("*").eq("enabled",!0);if(t)throw t;e&&I(e)}catch(e){a.error("")}})()},[]);const P=e=>{const t=E.find(t=>t.id===e);return t?t.name:""},O=[...e.filter(e=>{var t;const s=(null==(t=e.patient)?void 0:t.name)||"",r=""===w||e.number.toString().includes(w)||s.toLowerCase().includes(w.toLowerCase()),n="all"===S||e.type===S;return r&&n})].sort((e,t)=>new Date(t.completed_at||t.created_at).getTime()-new Date(e.completed_at||e.created_at).getTime()),A=e=>{const t=s.find(t=>t.id===e);return t?t.name:""},D=e=>{const t=C.find(t=>t.code===e);return t?t.name:""},M=(e,t)=>{const s=C.find(t=>t.code===e);return s?s.prefix+t.toString().padStart(s.format.length,"0"):""},q=e=>{const t=C.find(t=>t.code===e);if(!t)return"text-gray-600 bg-gray-50";const s=t.priority||0;return s>=8?"text-red-600 bg-red-50":s>=6?"text-amber-600 bg-amber-50":s>=4?"text-blue-600 bg-blue-50":"text-purple-600 bg-purple-50"},R=e=>{if(!e.called_at||!e.completed_at)return"?";const t=new Date(e.called_at).getTime(),s=new Date(e.completed_at).getTime();return`${Math.round((s-t)/6e4)} `},$=e=>{if(!e.created_at||!e.called_at)return"?";const t=new Date(e.created_at).getTime(),s=new Date(e.called_at).getTime();return`${Math.round((s-t)/6e4)} `},L=e=>{const t=e.patient_id,r=e.queue_date,n=s.find(e=>e.id===t);p(n),g(r),h(!0),(async(e,t)=>{if(e){b(!0);try{const{data:s,error:r}=await qa.from("patient_medications").select("\n          *,\n          medication:medications(*)\n        ").eq("patient_id",e).eq("start_date",t);if(r)return void a.error("");y(s||[])}catch(s){a.error("")}finally{b(!1)}}})(t,r)};return i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:""}),i.jsx("p",{className:"text-gray-500",children:""})]}),i.jsx("div",{className:"flex items-center gap-2",children:i.jsxs(gu,{variant:"outline",className:"flex items-center gap-2",onClick:async()=>{var e;a.loading("...");let t=",,,,,,,\n";for(const a of O){const s=zc(new Date(a.completed_at||a.created_at),"dd/MM/yyyy",{locale:cu}),r=zc(new Date(a.completed_at||a.created_at),"HH:mm .",{locale:cu}),n=M(a.type,a.number),o=D(a.type),l=(null==(e=a.patient)?void 0:e.name)||A(a.patient_id),c=$(a),d=R(a);let u="";try{const{data:e,error:t}=await qa.from("patient_medications").select("\n            *,\n            medication:medications(*)\n          ").eq("patient_id",a.patient_id).eq("start_date",a.queue_date);!t&&e&&e.length>0&&(u=e.map(e=>{var t,s,r;return`${(null==(t=e.medication)?void 0:t.name)||e.medication_id} ${e.dosage}${null==(s=e.medication)?void 0:s.unit} ${e.instructions} ( ${e.dispensed||0}${null==(r=e.medication)?void 0:r.unit})`}).join("; "))}catch(i){}u=`"${u.replace(/"/g,'""')}"`,t+=`${s},${r},${n},${o},${l},${c},${d},${u}\n`}const s=new Blob(["\ufeff"+t],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(s),n=document.createElement("a");n.setAttribute("href",r),n.setAttribute("download",`_${zc(new Date,"dd-MM-yyyy")}.csv`),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),a.dismiss(),a.success("")},children:[i.jsx(ko,{className:"w-4 h-4"}),""]})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[i.jsx(Fi,{className:"dashboard-card",children:i.jsxs(zi,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:""}),i.jsx("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:c.totalServed})]}),i.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:i.jsx($o,{className:"w-6 h-6 text-blue-600"})})]}),i.jsx("div",{className:"mt-4",children:i.jsxs("div",{className:"text-xs text-gray-500",children:[""," ",i.jsx("span",{className:"font-medium",children:zc(new Date,"dd MMM HH:mm .",{locale:cu})})]})})]})}),i.jsx(Fi,{className:"dashboard-card",children:i.jsxs(zi,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:""}),i.jsxs("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:[c.averageWaitTime," "]})]}),i.jsx("div",{className:"bg-amber-100 p-3 rounded-full",children:i.jsx(jo,{className:"w-6 h-6 text-amber-600"})})]}),i.jsx("div",{className:"mt-4",children:i.jsx("div",{className:"text-xs text-gray-500",children:""})})]})}),i.jsx(Fi,{className:"dashboard-card",children:i.jsxs(zi,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:""}),i.jsx("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:c.totalPatients})]}),i.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:i.jsx(Tl,{className:"w-6 h-6 text-green-600"})})]}),i.jsx("div",{className:"mt-4",children:i.jsxs("div",{className:"text-xs text-gray-500",children:[""," ",i.jsx("span",{className:"font-medium",children:c.totalPatients>0?Math.round(c.totalServed/c.totalPatients*10)/10:0})," ","/"]})})]})})]}),i.jsxs(Fi,{className:"mb-6",children:[i.jsx(Ui,{children:i.jsx(Wi,{children:""})}),i.jsx(zi,{children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm mb-1.5",children:""}),i.jsxs(Qy,{children:[i.jsx(Fy,{asChild:!0,children:i.jsxs(gu,{variant:"outline",className:"w-full justify-start text-left",children:[i.jsx(ao,{className:"mr-2 h-4 w-4"}),(null==N?void 0:N.from)?N.to?i.jsxs(i.Fragment,{children:[zc(N.from,"dd/MM/yyyy")," -"," ",zc(N.to,"dd/MM/yyyy")]}):zc(N.from,"dd/MM/yyyy"):i.jsx("span",{children:""})]})}),i.jsx(Uy,{className:"w-auto p-0",align:"start",children:i.jsx(z_,{initialFocus:!0,mode:"range",defaultMonth:null==N?void 0:N.from,selected:N,onSelect:e=>{_(e)},numberOfMonths:2,className:"p-3 pointer-events-auto"})})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm mb-1.5",children:""}),i.jsxs(Jh,{value:S,onValueChange:k,children:[i.jsx(Xh,{children:i.jsx(Zh,{placeholder:""})}),i.jsxs(sm,{children:[i.jsx(rm,{value:"all",children:""}),C.map(e=>i.jsx(rm,{value:e.code,children:e.name},e.code))]})]})]}),i.jsxs("div",{className:"md:col-span-2",children:[i.jsx("p",{className:"text-sm mb-1.5",children:""}),i.jsxs("div",{className:"relative",children:[i.jsx(cl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),i.jsx(Ux,{placeholder:"",className:"pl-10",value:w,onChange:e=>j(e.target.value)})]})]})]})})]}),i.jsx(Fi,{children:i.jsx(zi,{className:"p-0",children:i.jsxs(Zx,{children:[i.jsx(Xx,{children:i.jsxs(ty,{children:[i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""})]})}),i.jsx(ey,{children:o?i.jsx(ty,{children:i.jsx(ry,{colSpan:7,className:"text-center py-4",children:"..."})}):0===O.length?i.jsx(ty,{children:i.jsx(ry,{colSpan:7,className:"text-center py-4",children:""})}):O.map(e=>{var t;return i.jsxs(ty,{onClick:()=>L(e),children:[i.jsx(ry,{children:zc(new Date(e.completed_at||e.created_at),"dd MMM yyyy",{locale:cu})}),i.jsx(ry,{children:zc(new Date(e.completed_at||e.created_at),"HH:mm .",{locale:cu})}),i.jsx(ry,{className:"font-medium",children:M(e.type,e.number)}),i.jsx(ry,{children:i.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${q(e.type)}`,children:D(e.type)})}),i.jsx(ry,{children:i.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-blue-50 text-blue-600",children:P(e.service_point_id)})}),i.jsx(ry,{children:i.jsx("button",{onClick:()=>L(e),className:"text-left hover:text-blue-600 hover:underline focus:outline-none",children:(null==(t=e.patient)?void 0:t.name)||A(e.patient_id)})}),i.jsx(ry,{children:$(e)}),i.jsx(ry,{children:R(e)})]},e.id)})})]})})}),i.jsx(Uh,{open:u,onOpenChange:h,children:i.jsxs(Bh,{className:"sm:max-w-[600px]",children:[i.jsxs(Hh,{children:[i.jsxs(Kh,{className:"flex items-center gap-2",children:[i.jsx(tl,{className:"h-5 w-5"}),""]}),i.jsx(Yh,{children:m?i.jsxs("div",{className:"mt-2",children:[i.jsx("p",{className:"font-medium text-base",children:m.name}),i.jsxs("p",{className:"text-sm text-gray-500",children:[":"," ",f?zc(new Date(f),"dd MMMM yyyy",{locale:cu}):"-"]})]}):"..."})]}),i.jsx("div",{className:"py-4",children:v?i.jsx("div",{className:"flex justify-center py-8",children:i.jsx("p",{children:"..."})}):0===x.length?i.jsx("div",{className:"text-center py-8 text-gray-500",children:i.jsx("p",{children:""})}):i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"rounded-md border",children:i.jsxs(Zx,{children:[i.jsx(Xx,{children:i.jsxs(ty,{children:[i.jsx(sy,{className:"w-[180px]",children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{className:"text-right",children:""})]})}),i.jsx(ey,{children:x.map(e=>{var t,s,r;const n=(null==(t=e.medication)?void 0:t.name)||e.medication_id;return i.jsxs(ty,{children:[i.jsx(ry,{className:"font-medium",children:n}),i.jsxs(ry,{children:[e.dosage,null==(s=e.medication)?void 0:s.unit]}),i.jsx(ry,{children:e.instructions}),i.jsxs(ry,{className:"text-right",children:[e.dispensed,null==(r=e.medication)?void 0:r.unit]})]},e.id)})})]})}),i.jsx("div",{className:"text-sm text-gray-500 mt-2",children:i.jsx("p",{children:": "})})]})}),i.jsx(Gh,{children:i.jsx(gu,{onClick:()=>h(!1),children:""})})]})})]})},Ak=()=>{const[e,t]=n.useState([]),[s,r]=n.useState(!0),[o,l]=n.useState({totalServed:0,averageWaitTime:0,totalPatients:0}),[c,d]=n.useState(!1),[u,h]=n.useState(null),[m,p]=n.useState(null),[f,g]=n.useState([]),[x,y]=n.useState(!1),[v,b]=n.useState(""),[w,j]=n.useState({from:zl(new Date),to:ec(new Date)}),[N,_]=n.useState("all"),[S,k]=n.useState([]),[C,T]=n.useState([]);n.useEffect(()=>{(async()=>{try{const{data:e,error:t}=await qa.from("queue_ins_types").select("*").eq("enabled",!0);if(t)throw t;if(e){const t=e.map(e=>({id:e.id,code:e.code,name:e.name,prefix:e.prefix,purpose:"ins",format:ox(e.format),enabled:e.enabled,algorithm:"FIFO",priority:0}));T(t)}}catch(e){a.error("")}})()},[]),n.useEffect(()=>{(async()=>{try{const{data:e,error:t}=await qa.from("service_points_ins").select("*").eq("enabled",!0);if(t)throw t;e&&k(e)}catch(e){a.error("")}})()},[]),n.useEffect(()=>{(async()=>{r(!0);try{let e=qa.from("queues_ins").select("*");if(null==w?void 0:w.from){const t=zc(w.from,"yyyy-MM-dd");e=e.gte("queue_date",t)}if(null==w?void 0:w.to){const t=zc(w.to,"yyyy-MM-dd");e=e.lte("queue_date",t)}e=e.in("status",["COMPLETED","SKIPPED"]);const{data:s,error:r}=await e;if(r)throw r;if(s){t(s);const e=s.length;let r=0,n=0;s.forEach(e=>{if(e.called_at&&e.created_at){const t=(new Date(e.called_at).getTime()-new Date(e.created_at).getTime())/6e4;t>0&&(r+=t,n++)}});const a=n>0?Math.round(r/n):0,i=new Set(s.map(e=>e.ID_card||e.phone_number).filter(e=>e)).size;l({totalServed:e,averageWaitTime:a,totalPatients:i})}}catch(e){a.error("")}finally{r(!1)}})()},[w]);const E=[...e.filter(e=>{const t=e.full_name||"",s=""===v||e.number.toString().includes(v)||t.toLowerCase().includes(v.toLowerCase())||e.phone_number&&e.phone_number.includes(v)||e.ID_card&&e.ID_card.includes(v),r="all"===N||e.service_point_id===N;return s&&r})].sort((e,t)=>new Date(t.completed_at||t.created_at||0).getTime()-new Date(e.completed_at||e.created_at||0).getTime()),I=e=>{const t=S.find(t=>t.id===e);return t?t.name:""},P=(e,t)=>{const s=C.find(t=>t.code===e);return s?s.prefix+t.toString().padStart(s.format.length,"0"):""},O=e=>{const t=C.find(t=>t.code===e);return t?t.name:""},A=e=>{if(!e.called_at||!e.completed_at)return"?";const t=new Date(e.called_at).getTime(),s=new Date(e.completed_at).getTime();return`${Math.round((s-t)/6e4)} `},D=e=>{if(!e.created_at||!e.called_at)return"?";const t=new Date(e.created_at).getTime(),s=new Date(e.called_at).getTime();return`${Math.round((s-t)/6e4)} `},M=e=>{h(e),d(!0),(async e=>{if((e.ID_card||e.phone_number)&&e.queue_date){y(!0);try{let t=null;if(e.ID_card){const{data:s}=await qa.from("patients").select("id").eq("ID_card",e.ID_card).single();s&&(t=s.id)}if(!t&&e.phone_number){const{data:s}=await qa.from("patients").select("id").eq("phone",e.phone_number).single();s&&(t=s.id)}if(!t)return p(null),void g([]);const{data:s}=await qa.from("patient_check").select("*").eq("patient_id",t).gte("created_at",e.queue_date+"T00:00:00").lte("created_at",e.queue_date+"T23:59:59").order("created_at",{ascending:!1}).limit(1).single();if(s){p(s);const{data:e}=await qa.from("patient_medications").select("\n            *,\n            medication:medications(*)\n          ").eq("patient_check_id",s.id).order("created_at",{ascending:!1});e&&g(e)}else p(null),g([])}catch(t){}finally{y(!1)}}})(e)};return i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:""}),i.jsx("p",{className:"text-gray-500",children:""})]}),i.jsx("div",{className:"flex items-center gap-2",children:i.jsxs(gu,{variant:"outline",className:"flex items-center gap-2",onClick:async()=>{a.loading("...");let e=",,,,,,,,,,,\n";for(const a of E){const t=zc(new Date(a.completed_at||a.created_at||0),"dd/MM/yyyy",{locale:cu}),s=zc(new Date(a.completed_at||a.created_at||0),"HH:mm .",{locale:cu}),r=P(a.type,a.number),i=I(a.service_point_id),o=a.full_name||"-";a.phone_number;const l=a.ID_card||"-",c=D(a),d=A(a);a.status;let u="-",h="-";try{if((a.ID_card||a.phone_number)&&a.queue_date){let e=null;if(a.ID_card){const{data:t}=await qa.from("patients").select("id").eq("ID_card",a.ID_card).single();t&&(e=t.id)}if(!e&&a.phone_number){const{data:t}=await qa.from("patients").select("id").eq("phone",a.phone_number).single();t&&(e=t.id)}if(e){const{data:t}=await qa.from("patient_check").select("*").eq("patient_id",e).gte("created_at",a.queue_date+"T00:00:00").lte("created_at",a.queue_date+"T23:59:59").order("created_at",{ascending:!1}).limit(1).single();if(t){u=t.check_note?t.check_note.replace(/[\n\r]/g," ").replace(/"/g,'""'):"-";const{data:e}=await qa.from("patient_medications").select("\n                  *,\n                  medication:medications(*)\n                ").eq("patient_check_id",t.id).order("created_at",{ascending:!1});if(e&&e.length>0){h=e.map((e,t)=>{var s,r;const n=(null==(s=e.medication)?void 0:s.name)||e.medication_id,a=e.dosage,i=e.dispensed||0,o=(null==(r=e.medication)?void 0:r.unit)||"";return`${t+1}. ${n} ${a}${o}  ${i} ${o}`}).join("; ").replace(/"/g,'""')}}}}}catch(n){}const m=e=>e.includes(",")||e.includes('"')||e.includes("\n")?`"${e}"`:e;e+=`${t},${s},${r},${i},${o},${l},${c},${d},${m(u)},${m(h)}\n`}const t=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(t),r=document.createElement("a");r.setAttribute("href",s),r.setAttribute("download",`_${zc(new Date,"dd-MM-yyyy")}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),a.dismiss(),a.success("")},children:[i.jsx(ko,{className:"w-4 h-4"}),""]})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[i.jsx(Fi,{className:"dashboard-card",children:i.jsxs(zi,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:""}),i.jsx("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:o.totalServed})]}),i.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:i.jsx($o,{className:"w-6 h-6 text-blue-600"})})]}),i.jsx("div",{className:"mt-4",children:i.jsxs("div",{className:"text-xs text-gray-500",children:[""," ",i.jsx("span",{className:"font-medium",children:zc(new Date,"dd MMM HH:mm .",{locale:cu})})]})})]})}),i.jsx(Fi,{className:"dashboard-card",children:i.jsxs(zi,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:""}),i.jsxs("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:[o.averageWaitTime," "]})]}),i.jsx("div",{className:"bg-amber-100 p-3 rounded-full",children:i.jsx(jo,{className:"w-6 h-6 text-amber-600"})})]}),i.jsx("div",{className:"mt-4",children:i.jsx("div",{className:"text-xs text-gray-500",children:""})})]})}),i.jsx(Fi,{className:"dashboard-card",children:i.jsxs(zi,{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:""}),i.jsx("h3",{className:"text-3xl font-bold text-gray-900 mt-1",children:o.totalPatients})]}),i.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:i.jsx(Tl,{className:"w-6 h-6 text-green-600"})})]}),i.jsx("div",{className:"mt-4",children:i.jsxs("div",{className:"text-xs text-gray-500",children:[""," ",i.jsx("span",{className:"font-medium",children:o.totalPatients>0?Math.round(o.totalServed/o.totalPatients*10)/10:0})," ","/"]})})]})})]}),i.jsxs(Fi,{className:"mb-6",children:[i.jsx(Ui,{children:i.jsx(Wi,{children:""})}),i.jsx(zi,{children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm mb-1.5",children:""}),i.jsxs(Qy,{children:[i.jsx(Fy,{asChild:!0,children:i.jsxs(gu,{variant:"outline",className:"w-full justify-start text-left",children:[i.jsx(ao,{className:"mr-2 h-4 w-4"}),(null==w?void 0:w.from)?w.to?i.jsxs(i.Fragment,{children:[zc(w.from,"dd/MM/yyyy")," -"," ",zc(w.to,"dd/MM/yyyy")]}):zc(w.from,"dd/MM/yyyy"):i.jsx("span",{children:""})]})}),i.jsx(Uy,{className:"w-auto p-0",align:"start",children:i.jsx(z_,{initialFocus:!0,mode:"range",defaultMonth:null==w?void 0:w.from,selected:w,onSelect:e=>{j(e)},numberOfMonths:2,className:"p-3 pointer-events-auto"})})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm mb-1.5",children:""}),i.jsxs(Jh,{value:N,onValueChange:_,children:[i.jsx(Xh,{children:i.jsx(Zh,{placeholder:""})}),i.jsxs(sm,{children:[i.jsx(rm,{value:"all",children:""}),S.map(e=>i.jsx(rm,{value:e.id,children:e.name},e.id))]})]})]}),i.jsxs("div",{className:"md:col-span-2",children:[i.jsx("p",{className:"text-sm mb-1.5",children:""}),i.jsxs("div",{className:"relative",children:[i.jsx(cl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),i.jsx(Ux,{placeholder:", ,  ",className:"pl-10",value:v,onChange:e=>b(e.target.value)})]})]})]})})]}),i.jsx(Fi,{children:i.jsx(zi,{className:"p-0",children:i.jsxs(Zx,{children:[i.jsx(Xx,{children:i.jsxs(ty,{children:[i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""})]})}),i.jsx(ey,{children:s?i.jsx(ty,{children:i.jsx(ry,{colSpan:10,className:"text-center py-4",children:"..."})}):0===E.length?i.jsx(ty,{children:i.jsx(ry,{colSpan:10,className:"text-center py-4",children:""})}):E.map(e=>i.jsxs(ty,{onClick:()=>M(e),className:"cursor-pointer hover:bg-gray-50",children:[i.jsx(ry,{children:zc(new Date(e.completed_at||e.created_at||0),"dd MMM yyyy",{locale:cu})}),i.jsx(ry,{children:zc(new Date(e.completed_at||e.created_at||0),"HH:mm .",{locale:cu})}),i.jsx(ry,{className:"font-medium",children:P(e.type,e.number)}),i.jsx(ry,{children:i.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-purple-50 text-purple-600",children:O(e.type)})}),i.jsx(ry,{children:i.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-blue-50 text-blue-600",children:I(e.service_point_id)})}),i.jsx(ry,{children:i.jsx("button",{onClick:()=>M(e),className:"text-left hover:text-blue-600 hover:underline focus:outline-none",children:e.full_name||"-"})}),i.jsx(ry,{children:D(e)}),i.jsx(ry,{children:A(e)})]},e.id))})]})})}),i.jsx(Uh,{open:c,onOpenChange:d,children:i.jsxs(Bh,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[i.jsxs(Hh,{children:[i.jsxs(Kh,{className:"flex items-center gap-2",children:[i.jsx(Cl,{className:"h-5 w-5"}),""]}),i.jsx(Yh,{children:",  "})]}),i.jsx("div",{className:"py-4",children:u?i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"font-semibold text-lg border-b pb-2",children:""}),x?i.jsx("div",{className:"text-center py-4 text-gray-500",children:i.jsx("p",{children:"..."})}):m?i.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[i.jsxs("p",{className:"text-sm text-gray-500 mb-2",children:[":"," ",zc(new Date(m.created_at),"dd MMMM yyyy HH:mm .",{locale:cu})]}),i.jsx("p",{className:"whitespace-pre-wrap",children:m.check_note||""})]}):i.jsx("div",{className:"text-center py-4 text-gray-500",children:i.jsx("p",{children:""})})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"font-semibold text-lg border-b pb-2",children:""}),x?i.jsx("div",{className:"text-center py-4 text-gray-500",children:i.jsx("p",{children:"..."})}):f.length>0?i.jsx("div",{className:"rounded-md border",children:i.jsxs(Zx,{children:[i.jsx(Xx,{children:i.jsxs(ty,{children:[i.jsx(sy,{className:"w-[50px]",children:"#"}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{children:""}),i.jsx(sy,{className:"text-right",children:""})]})}),i.jsx(ey,{children:f.map((e,t)=>{var s,r,n;return i.jsxs(ty,{children:[i.jsx(ry,{className:"text-center",children:t+1}),i.jsx(ry,{className:"font-medium",children:(null==(s=e.medication)?void 0:s.name)||e.medication_id}),i.jsxs(ry,{children:[e.dosage,null==(r=e.medication)?void 0:r.unit]}),i.jsx(ry,{children:e.instructions||"-"}),i.jsxs(ry,{className:"text-right",children:[e.dispensed||0," ",null==(n=e.medication)?void 0:n.unit]})]},e.id)})})]})}):i.jsx("div",{className:"text-center py-4 text-gray-500",children:i.jsx("p",{children:""})})]})]}):i.jsx("div",{className:"text-center py-8 text-gray-500",children:i.jsx("p",{children:"..."})})}),i.jsx(Gh,{children:i.jsx(gu,{onClick:()=>d(!1),children:""})})]})})]})},Dk=({onSimulate:e,onRecalculate:t,onClearQueues:s,onForceRefresh:r})=>i.jsx("div",{className:"bg-white border-b px-6 py-4 flex-shrink-0",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:""}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsxs(gu,{onClick:e,className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700",children:[i.jsx(xo,{className:"w-4 h-4"})," (15 )"]}),i.jsxs(gu,{onClick:t,variant:"outline",className:"flex items-center gap-2 text-green-600 border-green-200 hover:bg-green-50",children:[i.jsx(al,{className:"w-4 h-4"}),""]}),i.jsxs(gu,{variant:"outline",onClick:s,className:"flex items-center gap-2 text-red-600 border-red-200 hover:bg-red-50",children:[i.jsx(bl,{className:"w-4 h-4"}),""]}),i.jsxs(gu,{variant:"outline",onClick:r,size:"sm",className:"flex items-center gap-2",children:[i.jsx(al,{className:"w-3 h-3"}),""]})]})]})}),Mk=({refreshKey:e})=>i.jsxs("div",{className:"w-1/2 flex flex-col border-r bg-white",children:[i.jsx("div",{className:"h-1/2 border-b overflow-hidden",children:i.jsx("div",{className:"h-full overflow-auto",children:i.jsx(Eb,{},`mgmt-${e}`)})}),i.jsx("div",{className:"h-1/2 overflow-hidden",children:i.jsx("div",{className:"h-full overflow-auto",children:i.jsx(Lb,{},`board-${e}`)})})]}),qk=({selectedServicePoints:e,enabledServicePoints:t,onServicePointChange:s})=>i.jsxs("div",{className:"bg-gray-100 p-4 border-b flex-shrink-0",children:[i.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:""}),i.jsx("div",{className:"grid grid-cols-3 gap-3",children:[0,1,2].map(r=>i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[" ",r+1]}),i.jsxs(Jh,{value:e[r]||"",onValueChange:e=>s(r,e),children:[i.jsx(Xh,{className:"h-8 text-xs",children:i.jsx(Zh,{placeholder:` SP${r+1}`})}),i.jsx(sm,{children:t.map(e=>i.jsxs(rm,{value:e.id,className:"text-xs",children:[e.code," - ",e.name]},e.id))})]})]},r))})]}),Rk=({selectedServicePoints:e,enabledServicePoints:t,refreshKey:s,onServicePointChange:r,loading:n=!1})=>n?i.jsxs("div",{className:"w-1/2 flex flex-col",children:[i.jsxs("div",{className:"bg-gray-100 p-4 border-b flex-shrink-0",children:[i.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:""}),i.jsxs("div",{className:"flex items-center justify-center py-8",children:[i.jsx(Lo,{className:"w-6 h-6 animate-spin text-gray-500"}),i.jsx("span",{className:"ml-2 text-gray-500",children:"..."})]})]}),i.jsx("div",{className:"flex-1 bg-gray-50"})]}):i.jsxs("div",{className:"w-1/2 flex flex-col h-full",children:[i.jsx(qk,{selectedServicePoints:e,enabledServicePoints:t,onServicePointChange:r}),i.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:[0,1,2].map(t=>i.jsx("div",{className:"flex-1 border-b last:border-b-0 overflow-hidden min-h-0",style:{height:"calc(100% / 3)"},children:e[t]?i.jsx(TS,{servicePointId:e[t],title:` ${t+1}`,refreshTrigger:s},`panel-${t}-${e[t]}-${s}`):i.jsx("div",{className:"h-full flex items-center justify-center bg-gray-50",children:i.jsxs("div",{className:"text-center text-gray-500",children:[i.jsx(ul,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),i.jsx("p",{className:"text-sm",children:""})]})})},`panel-${t}`))})]}),$k=({refreshKey:e,selectedServicePoints:t,enabledServicePoints:s,onServicePointChange:r,servicePointLoading:n})=>i.jsxs("div",{className:"flex-1 flex overflow-hidden min-h-0",children:[i.jsx(Mk,{refreshKey:e}),i.jsx(Rk,{selectedServicePoints:t,enabledServicePoints:s,refreshKey:e,onServicePointChange:r,loading:n})]}),Lk=Qa("useQueueValidation"),Qk=Qa("useQueueNumbers"),Fk=Qa("useServicePointAssignment"),Uk=Qa("useQueueCreation"),Wk=Qa("useQueueClearance"),Vk=Qa("useQueueSimulation"),zk=()=>{const{fetchQueues:e}=yh(),{patients:t}=Ha(),{queueTypes:s}=dx(),{servicePoints:r}=Wa(),{mappings:i}=Vv(),{validateQueueData:o}={validateQueueData:(e,t,s)=>{if(!e||0===e.length)return a.error(""),Lk.error("No patients available for queue creation"),{isValid:!1,enabledQueueTypes:[],enabledServicePoints:[]};if(!t||0===t.length)return a.error(""),Lk.error("No queue types available for queue creation"),{isValid:!1,enabledQueueTypes:[],enabledServicePoints:[]};const r=t.filter(e=>e.enabled);if(0===r.length)return a.error(""),Lk.error("No enabled queue types available"),{isValid:!1,enabledQueueTypes:[],enabledServicePoints:[]};const n=s.filter(e=>e.enabled);return 0===n.length?(a.error(""),Lk.error("No enabled service points available"),{isValid:!1,enabledQueueTypes:[],enabledServicePoints:[]}):(Lk.info(`Using ${r.length} enabled queue types:`,r.map(e=>e.code)),Lk.info(`Using ${n.length} enabled service points:`,n.map(e=>e.code)),{isValid:!0,enabledQueueTypes:r,enabledServicePoints:n})}},{getNextQueueNumbers:l}={getNextQueueNumbers:async e=>{const t={};for(const r of e)try{const{data:e}=await qa.from("queues").select("number").eq("type",r.code).eq("queue_date",(new Date).toISOString().split("T")[0]).order("number",{ascending:!1}).limit(1).maybeSingle();t[r.code]=((null==e?void 0:e.number)||0)+1,Qk.debug(`Next queue number for ${r.code}: ${t[r.code]}`)}catch(s){Qk.warn(`Error getting last queue number for ${r.code}:`,s),t[r.code]=1}return t}},{findServicePointForQueueType:c}={findServicePointForQueueType:(e,t,s)=>{var r,n;const a=t.filter(t=>t.queue_type_id===e.id).map(e=>s.find(t=>t.id===e.service_point_id)).filter(Boolean);if(a.length>0){const t=Math.floor(Math.random()*a.length);return Fk.debug(`Found ${a.length} compatible service points for ${e.code}, selecting:`,null==(r=a[t])?void 0:r.code),a[t]}return Fk.warn(`No compatible service points found for queue type ${e.code}, using fallback:`,null==(n=s[0])?void 0:n.code),s[0]}},{createTestQueues:d,insertQueues:u}={createTestQueues:(e,t,s,r,n)=>{const a=[],i={...r};for(let o=0;o<e;o++){const e=t[o%t.length],r=s[Math.floor(Math.random()*s.length)],l=n(e),c={patient_id:r.id,type:e.code,number:i[e.code]++,status:"WAITING",queue_date:(new Date).toISOString().split("T")[0],service_point_id:(null==l?void 0:l.id)||null,notes:` #${o+1} - ${l?` (${l.name})`:""}`};a.push(c),Uk.debug("Created queue data with service point:",c)}return a},insertQueues:async e=>{const{data:t,error:s}=await qa.from("queues").insert(e).select();if(s)throw Uk.error("Database error inserting queues:",s),new Error(`Database error: ${s.message}`);if(!t||0===t.length)return Uk.warn("No queues were created"),a.warning(""),null;const r=t.filter(e=>e.service_point_id).length,n=t.length-r;return Uk.info(`Successfully created ${t.length} simulation queues (${r} assigned, ${n} unassigned)`),a.success(` ${t.length}  ( ${r} )`),n>0&&a.info(` ${n}  - `),t}},{clearTestQueues:h}={clearTestQueues:async()=>{try{Wk.info("Clearing test queues..."),a.info("...");const e=(new Date).toISOString().split("T")[0],{data:t,error:s}=await qa.from("queues").select("id").like("notes","%%").eq("queue_date",e);if(s)throw Wk.error("Error checking for simulation queues:",s),new Error(`Database error: ${s.message}`);if(!t||0===t.length)return Wk.info("No simulation queues found to delete"),a.info(""),0;Wk.info(`Found ${t.length} simulation queues to delete`);const{error:r}=await qa.from("queues").delete().like("notes","%%").eq("queue_date",e);if(r)throw Wk.error("Error deleting simulation queues:",r),new Error(`Database error: ${r.message}`);return Wk.info(`Successfully deleted ${t.length} simulation queues`),a.success(` (${t.length} )`),t.length}catch(e){Wk.error("Error clearing test queues:",e);const t=e instanceof Error?e.message:"";throw a.error(`: ${t}`),e}},clearAllTodayQueues:async()=>{try{Wk.info("Clearing all today queues..."),a.info("...");const e=(new Date).toISOString().split("T")[0],{data:t,error:s}=await qa.from("queues").select("id").eq("queue_date",e);if(s)throw Wk.error("Error checking for today queues:",s),new Error(`Database error: ${s.message}`);if(!t||0===t.length)return Wk.info("No queues found for today"),a.info(""),0;Wk.info(`Found ${t.length} queues for today to delete`);const{error:r}=await qa.from("queues").delete().eq("queue_date",e);if(r)throw Wk.error("Error deleting today queues:",r),new Error(`Database error: ${r.message}`);return Wk.info(`Successfully deleted ${t.length} queues for today`),a.success(` (${t.length} )`),t.length}catch(e){Wk.error("Error clearing all today queues:",e);const t=e instanceof Error?e.message:"";throw a.error(`: ${t}`),e}}};return{simulateQueues:n.useCallback(async(n=15)=>{try{Vk.info("Starting queue simulation..."),a.info(` ${n} ...`);const{isValid:h,enabledQueueTypes:m,enabledServicePoints:p}=o(t,s,r);if(!h)return;Vk.info(`Using ${i.length} service point mappings`);const f=await l(m),g=d(n,m,t,f,e=>c(e,i,p));await u(g)&&await e()}catch(h){Vk.error("Error simulating queues:",h);const e=h instanceof Error?h.message:"";a.error(`: ${e}`)}},[t,s,r,i,e,o,l,c,d,u]),clearTestQueues:n.useCallback(async()=>{await h(),await e()},[h,e])}},Bk=Qa("useTestDashboardActions"),Hk=Qa("useGlobalRealtime"),Gk=class e{constructor(){t(this,"channel",null),t(this,"listeners",[]),t(this,"debounceTimeout",null),t(this,"reconnectAttempts",0),t(this,"maxReconnectAttempts",3),t(this,"isConnecting",!1),t(this,"isDestroyed",!1),t(this,"isSubscribed",!1),t(this,"debouncedNotify",()=>{this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout(()=>{this.isDestroyed||(Hk.debug(`Notifying ${this.listeners.length} listeners of queue changes`),this.listeners.forEach(e=>{try{e.callback()}catch(t){Hk.error(`Error in listener ${e.id}:`,t)}}))},1e3)})}static getInstance(){return e.instance||(e.instance=new e),e.instance}setupChannel(){if(!(this.channel||this.isConnecting||this.isDestroyed||this.isSubscribed)){this.isConnecting=!0,Hk.debug("Setting up global realtime channel");try{this.channel=qa.channel("global-queue-changes").on("postgres_changes",{event:"*",schema:"public",table:"queues"},e=>{this.isDestroyed||(Hk.debug("Global queue change detected:",e),this.debouncedNotify())}).subscribe(e=>{this.isDestroyed||(Hk.debug("Global channel subscription status:",e),"SUBSCRIBED"===e?(this.reconnectAttempts=0,this.isConnecting=!1,this.isSubscribed=!0):"CHANNEL_ERROR"===e?(Hk.error("Global channel error detected"),this.isSubscribed=!1,this.handleConnectionError()):"CLOSED"===e&&(Hk.warn("Global channel closed"),this.isConnecting=!1,this.isSubscribed=!1,this.isDestroyed||this.scheduleReconnect()))})}catch(e){Hk.error("Failed to setup channel:",e),this.isConnecting=!1,this.isDestroyed||this.scheduleReconnect()}}}handleConnectionError(){this.isConnecting=!1,this.isSubscribed=!1,this.cleanupChannel(),this.reconnectAttempts<this.maxReconnectAttempts&&!this.isDestroyed?this.scheduleReconnect():Hk.error("Max reconnection attempts reached. Real-time updates disabled.")}scheduleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts||this.isDestroyed)return;const e=Math.min(5e3*Math.pow(2,this.reconnectAttempts),3e4);this.reconnectAttempts++,Hk.debug(`Scheduling reconnection attempt ${this.reconnectAttempts} in ${e}ms`),setTimeout(()=>{this.listeners.length>0&&!this.isDestroyed&&!this.isSubscribed&&this.setupChannel()},e)}cleanupChannel(){if(this.channel){Hk.debug("Cleaning up global realtime channel");try{qa.removeChannel(this.channel)}catch(e){Hk.error("Error removing channel:",e)}this.channel=null,this.isSubscribed=!1}this.debounceTimeout&&(clearTimeout(this.debounceTimeout),this.debounceTimeout=null)}addListener(e){if(this.isDestroyed)return;const t=this.listeners.findIndex(t=>t.id===e.id);if(-1!==t)return Hk.debug(`Listener ${e.id} already exists, updating callback`),void(this.listeners[t]=e);Hk.debug(`Adding listener: ${e.id}`),this.listeners.push(e),1!==this.listeners.length||this.isConnecting||this.isSubscribed||this.setupChannel()}removeListener(e){Hk.debug(`Removing listener: ${e}`),this.listeners=this.listeners.filter(t=>t.id!==e),0===this.listeners.length&&(this.cleanupChannel(),this.reconnectAttempts=0)}destroy(){this.isDestroyed=!0,this.cleanupChannel(),this.listeners=[]}};t(Gk,"instance");let Kk=Gk;const Yk=Qa("useTestDashboardState"),Jk=()=>{const{fetchQueues:e}=yh(),[t,s]=n.useState(0),[r,a]=n.useState(Date.now()),i=n.useCallback(()=>{const t=Date.now();t-r<300?Yk.debug("Skipping refresh due to debouncing"):(Yk.debug("Forcing refresh of all components"),a(t),s(e=>{const t=e+1;return Yk.debug("New refresh key:",t),t}),setTimeout(()=>{e(!0)},100))},[e,r]);return((e,t,s,r=!0)=>{const a=n.useRef(t),i=Kk.getInstance();n.useEffect(()=>{a.current=t},[t]);const o=n.useCallback(()=>{a.current()},[]);n.useEffect(()=>{if(!r)return;const t={id:e,callback:o,servicePointId:s};return i.addListener(t),()=>{i.removeListener(e)}},[e,o,s,r])})("test-dashboard-realtime",n.useCallback(()=>{Yk.debug("Queue change detected via global realtime, refreshing dashboard"),i()},[i]),void 0,!0),{refreshKey:t,forceRefresh:i}},Zk=Qa("useServicePointState"),Xk=()=>{const{refreshKey:e,forceRefresh:t}=Jk(),{handleSimulate:s,handleRecalculate:r,handleClearQueues:o}=(e=>{const{simulateQueues:t,clearTestQueues:s}=zk(),{recalculateAllQueues:r}=Bv();return{handleSimulate:n.useCallback(async()=>{try{Bk.info("Starting queue simulation"),a.loading("...",{id:"simulate"}),await t(15),a.success("",{id:"simulate"}),setTimeout(()=>e(),500),Bk.info("Queue simulation completed")}catch(s){Bk.error("Error during simulation:",s),a.error("",{id:"simulate"})}},[t,e]),handleRecalculate:n.useCallback(async()=>{try{Bk.info("Starting queue recalculation"),a.loading("...",{id:"recalculate"}),await r(),a.success("",{id:"recalculate"}),setTimeout(()=>e(),500),Bk.info("Queue recalculation completed")}catch(t){Bk.error("Error during recalculation:",t),a.error("",{id:"recalculate"})}},[r,e]),handleClearQueues:n.useCallback(async()=>{try{Bk.info("Starting queue clearing"),a.loading("...",{id:"clear"}),await s(),a.success("",{id:"clear"}),setTimeout(()=>e(),500),Bk.info("Test queues cleared")}catch(t){Bk.error("Error clearing test queues:",t),a.error("",{id:"clear"})}},[s,e])}})(t),{selectedServicePoints:l,enabledServicePoints:c,handleServicePointChange:d,loading:u}=(e=>{const{servicePoints:t,loading:s}=Wa(),[r,a]=n.useState(["","",""]),[i,o]=n.useState(!1),l=n.useMemo(()=>{const e=t.filter(e=>e.enabled);return Zk.debug("Enabled service points:",e.length),e},[t]);n.useEffect(()=>{if(s)Zk.debug("Service points still loading, waiting...");else{if(0===l.length)return Zk.warn("No enabled service points found"),void o(!0);if(!i){Zk.debug("Initializing service point selections...");const t=localStorage.getItem("test-dashboard-service-points");let s=["","",""];if(t)try{const e=JSON.parse(t);Array.isArray(e)&&3===e.length&&(s=e.map(e=>l.some(t=>t.id===e)?e:""),Zk.debug("Loaded and validated saved service point selections:",s))}catch(e){Zk.warn("Failed to parse saved service points:",e)}for(let e=0;e<3;e++)if(!s[e]&&l.length>0){const t=l.find(e=>!s.includes(e.id));t&&(s[e]=t.id)}Zk.info("Final service point selections:",s),a(s),localStorage.setItem("test-dashboard-service-points",JSON.stringify(s)),o(!0)}}},[l,i,s]);const c=n.useCallback((t,s)=>{Zk.debug(`Changing service point ${t} to:`,s),a(e=>{const r=[...e];return r[t]=s,localStorage.setItem("test-dashboard-service-points",JSON.stringify(r)),Zk.debug("Updated service point selections:",r),r}),setTimeout(()=>{Zk.debug("Triggering refresh after service point change"),e()},200)},[e]);return{selectedServicePoints:r,enabledServicePoints:l,handleServicePointChange:c,isInitialized:i&&!s,loading:s||!i}})(t),h=n.useMemo(()=>({onSimulate:s,onRecalculate:r,onClearQueues:o,onForceRefresh:t}),[s,r,o,t]);return i.jsxs("div",{className:"h-screen flex flex-col overflow-hidden bg-gray-50",children:[i.jsx(Dk,{...h}),i.jsx($k,{refreshKey:e,selectedServicePoints:l,enabledServicePoints:c,onServicePointChange:d,servicePointLoading:u})]})},eC=()=>{const[e,t]=n.useState(!1),[s,r]=n.useState(!0),[i,o]=n.useState(null),[l,c]=n.useState([]),[d,u]=n.useState(null),[h,m]=n.useState(null),[p,f]=n.useState([]),[g,x]=n.useState([]),[y,v]=n.useState(null),[b,w]=n.useState(!1),j=async e=>{try{const t=e.map(e=>e.id),s=e.map(e=>e.ID_card).filter(Boolean),r=Nu(),{data:n,error:a}=await qa.from("queues").select("*").in("patient_id",t).in("status",["WAITING","ACTIVE"]).eq("queue_date",r).order("created_at",{ascending:!1}),{data:i,error:l}=await qa.from("queues_ins").select("*").in("ID_card",s).in("status",["WAITING","ACTIVE"]).eq("queue_date",r).order("created_at",{ascending:!1});if(a)throw a;if(l)throw l;if(n&&n.length>0){const t=n.map(e=>({...e,type:e.type,status:e.status}));if(f(t),1===t.length){const s=t[0];u(s);const r=e.find(e=>e.id===s.patient_id);o(r||e[0])}}if(i&&i.length>0){const t=i.map(e=>({...e,status:e.status}));if(x(t),1===t.length){const s=t[0];m(s);const r=e.find(e=>e.ID_card===s.ID_card);o(r||e[0])}}n&&0!==n.length||i&&0!==i.length||o(e[0])}catch(t){}};return n.useEffect(()=>{(async()=>{try{r(!0);const e=localStorage.getItem("lineToken"),s=localStorage.getItem("userPhone");if(e&&s){t(!0),v(s);const{data:e,error:r}=await qa.from("patients").select("*").eq("ID_card",s);if(r)throw r;e&&e.length>0?(c(e),await j(e)):a.info("")}else t(!1)}catch(e){a.error("")}finally{r(!1)}})()},[]),{isAuthenticated:e,loading:s,selectedPatient:i,patients:l,activeQueue:d,activeQueueIns:h,availableQueues:p,availableQueuesIns:g,phoneNumber:y,isStaffMode:b,setIsAuthenticated:t,setSelectedPatient:o,setPatients:c,setActiveQueue:u,setActiveQueueIns:m,setAvailableQueues:f,setAvailableQueuesIns:x,setPhoneNumber:v,setIsStaffMode:w,checkForActiveQueues:j}},tC=()=>i.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-50 p-4",children:i.jsxs(Fi,{className:"w-full max-w-md",children:[i.jsx(Ui,{children:i.jsx(Wi,{className:"text-center",children:""})}),i.jsxs(zi,{className:"space-y-4",children:[i.jsx(ny,{className:"h-12 w-full"}),i.jsx(ny,{className:"h-32 w-full"}),i.jsx(ny,{className:"h-12 w-full"})]})]})});function sC(e,t){return function(){return e.apply(t,arguments)}}const{toString:rC}=Object.prototype,{getPrototypeOf:nC}=Object,{iterator:aC,toStringTag:iC}=Symbol,oC=(e=>t=>{const s=rC.call(t);return e[s]||(e[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),lC=e=>(e=e.toLowerCase(),t=>oC(t)===e),cC=e=>t=>typeof t===e,{isArray:dC}=Array,uC=cC("undefined");function hC(e){return null!==e&&!uC(e)&&null!==e.constructor&&!uC(e.constructor)&&fC(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const mC=lC("ArrayBuffer");const pC=cC("string"),fC=cC("function"),gC=cC("number"),xC=e=>null!==e&&"object"==typeof e,yC=e=>{if("object"!==oC(e))return!1;const t=nC(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||iC in e||aC in e)},vC=lC("Date"),bC=lC("File"),wC=lC("Blob"),jC=lC("FileList"),NC=lC("URLSearchParams"),[_C,SC,kC,CC]=["ReadableStream","Request","Response","Headers"].map(lC);function TC(e,t,{allOwnKeys:s=!1}={}){if(null==e)return;let r,n;if("object"!=typeof e&&(e=[e]),dC(e))for(r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else{if(hC(e))return;const n=s?Object.getOwnPropertyNames(e):Object.keys(e),a=n.length;let i;for(r=0;r<a;r++)i=n[r],t.call(null,e[i],i,e)}}function EC(e,t){if(hC(e))return null;t=t.toLowerCase();const s=Object.keys(e);let r,n=s.length;for(;n-- >0;)if(r=s[n],t===r.toLowerCase())return r;return null}const IC="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,PC=e=>!uC(e)&&e!==IC;const OC=(e=>t=>e&&t instanceof e)("undefined"!=typeof Uint8Array&&nC(Uint8Array)),AC=lC("HTMLFormElement"),DC=(({hasOwnProperty:e})=>(t,s)=>e.call(t,s))(Object.prototype),MC=lC("RegExp"),qC=(e,t)=>{const s=Object.getOwnPropertyDescriptors(e),r={};TC(s,(s,n)=>{let a;!1!==(a=t(s,n,e))&&(r[n]=a||s)}),Object.defineProperties(e,r)};const RC=lC("AsyncFunction"),$C=(LC="function"==typeof setImmediate,QC=fC(IC.postMessage),LC?setImmediate:QC?(FC=`axios@${Math.random()}`,UC=[],IC.addEventListener("message",({source:e,data:t})=>{e===IC&&t===FC&&UC.length&&UC.shift()()},!1),e=>{UC.push(e),IC.postMessage(FC,"*")}):e=>setTimeout(e));var LC,QC,FC,UC;const WC="undefined"!=typeof queueMicrotask?queueMicrotask.bind(IC):"undefined"!=typeof process&&process.nextTick||$C,VC={isArray:dC,isArrayBuffer:mC,isBuffer:hC,isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||fC(e.append)&&("formdata"===(t=oC(e))||"object"===t&&fC(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&mC(e.buffer),t},isString:pC,isNumber:gC,isBoolean:e=>!0===e||!1===e,isObject:xC,isPlainObject:yC,isEmptyObject:e=>{if(!xC(e)||hC(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(t){return!1}},isReadableStream:_C,isRequest:SC,isResponse:kC,isHeaders:CC,isUndefined:uC,isDate:vC,isFile:bC,isBlob:wC,isRegExp:MC,isFunction:fC,isStream:e=>xC(e)&&fC(e.pipe),isURLSearchParams:NC,isTypedArray:OC,isFileList:jC,forEach:TC,merge:function e(){const{caseless:t,skipUndefined:s}=PC(this)&&this||{},r={},n=(n,a)=>{const i=t&&EC(r,a)||a;yC(r[i])&&yC(n)?r[i]=e(r[i],n):yC(n)?r[i]=e({},n):dC(n)?r[i]=n.slice():s&&uC(n)||(r[i]=n)};for(let a=0,i=arguments.length;a<i;a++)arguments[a]&&TC(arguments[a],n);return r},extend:(e,t,s,{allOwnKeys:r}={})=>(TC(t,(t,r)=>{s&&fC(t)?e[r]=sC(t,s):e[r]=t},{allOwnKeys:r}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,s,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),s&&Object.assign(e.prototype,s)},toFlatObject:(e,t,s,r)=>{let n,a,i;const o={};if(t=t||{},null==e)return t;do{for(n=Object.getOwnPropertyNames(e),a=n.length;a-- >0;)i=n[a],r&&!r(i,e,t)||o[i]||(t[i]=e[i],o[i]=!0);e=!1!==s&&nC(e)}while(e&&(!s||s(e,t))&&e!==Object.prototype);return t},kindOf:oC,kindOfTest:lC,endsWith:(e,t,s)=>{e=String(e),(void 0===s||s>e.length)&&(s=e.length),s-=t.length;const r=e.indexOf(t,s);return-1!==r&&r===s},toArray:e=>{if(!e)return null;if(dC(e))return e;let t=e.length;if(!gC(t))return null;const s=new Array(t);for(;t-- >0;)s[t]=e[t];return s},forEachEntry:(e,t)=>{const s=(e&&e[aC]).call(e);let r;for(;(r=s.next())&&!r.done;){const s=r.value;t.call(e,s[0],s[1])}},matchAll:(e,t)=>{let s;const r=[];for(;null!==(s=e.exec(t));)r.push(s);return r},isHTMLForm:AC,hasOwnProperty:DC,hasOwnProp:DC,reduceDescriptors:qC,freezeMethods:e=>{qC(e,(t,s)=>{if(fC(e)&&-1!==["arguments","caller","callee"].indexOf(s))return!1;const r=e[s];fC(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(e,t)=>{const s={},r=e=>{e.forEach(e=>{s[e]=!0})};return dC(e)?r(e):r(String(e).split(t)),s},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,s){return t.toUpperCase()+s}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:EC,global:IC,isContextDefined:PC,isSpecCompliantForm:function(e){return!!(e&&fC(e.append)&&"FormData"===e[iC]&&e[aC])},toJSONObject:e=>{const t=new Array(10),s=(e,r)=>{if(xC(e)){if(t.indexOf(e)>=0)return;if(hC(e))return e;if(!("toJSON"in e)){t[r]=e;const n=dC(e)?[]:{};return TC(e,(e,t)=>{const a=s(e,r+1);!uC(a)&&(n[t]=a)}),t[r]=void 0,n}}return e};return s(e,0)},isAsyncFn:RC,isThenable:e=>e&&(xC(e)||fC(e))&&fC(e.then)&&fC(e.catch),setImmediate:$C,asap:WC,isIterable:e=>null!=e&&fC(e[aC])};function zC(e,t,s,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),s&&(this.config=s),r&&(this.request=r),n&&(this.response=n,this.status=n.status?n.status:null)}VC.inherits(zC,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:VC.toJSONObject(this.config),code:this.code,status:this.status}}});const BC=zC.prototype,HC={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{HC[e]={value:e}}),Object.defineProperties(zC,HC),Object.defineProperty(BC,"isAxiosError",{value:!0}),zC.from=(e,t,s,r,n,a)=>{const i=Object.create(BC);VC.toFlatObject(e,i,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e);const o=e&&e.message?e.message:"Error",l=null==t&&e?e.code:t;return zC.call(i,o,l,s,r,n),e&&null==i.cause&&Object.defineProperty(i,"cause",{value:e,configurable:!0}),i.name=e&&e.name||"Error",a&&Object.assign(i,a),i};function GC(e){return VC.isPlainObject(e)||VC.isArray(e)}function KC(e){return VC.endsWith(e,"[]")?e.slice(0,-2):e}function YC(e,t,s){return e?e.concat(t).map(function(e,t){return e=KC(e),!s&&t?"["+e+"]":e}).join(s?".":""):t}const JC=VC.toFlatObject(VC,{},null,function(e){return/^is[A-Z]/.test(e)});function ZC(e,t,s){if(!VC.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(s=VC.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!VC.isUndefined(t[e])})).metaTokens,n=s.visitor||c,a=s.dots,i=s.indexes,o=(s.Blob||"undefined"!=typeof Blob&&Blob)&&VC.isSpecCompliantForm(t);if(!VC.isFunction(n))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(VC.isDate(e))return e.toISOString();if(VC.isBoolean(e))return e.toString();if(!o&&VC.isBlob(e))throw new zC("Blob is not supported. Use a Buffer instead.");return VC.isArrayBuffer(e)||VC.isTypedArray(e)?o&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,s,n){let o=e;if(e&&!n&&"object"==typeof e)if(VC.endsWith(s,"{}"))s=r?s:s.slice(0,-2),e=JSON.stringify(e);else if(VC.isArray(e)&&function(e){return VC.isArray(e)&&!e.some(GC)}(e)||(VC.isFileList(e)||VC.endsWith(s,"[]"))&&(o=VC.toArray(e)))return s=KC(s),o.forEach(function(e,r){!VC.isUndefined(e)&&null!==e&&t.append(!0===i?YC([s],r,a):null===i?s:s+"[]",l(e))}),!1;return!!GC(e)||(t.append(YC(n,s,a),l(e)),!1)}const d=[],u=Object.assign(JC,{defaultVisitor:c,convertValue:l,isVisitable:GC});if(!VC.isObject(e))throw new TypeError("data must be an object");return function e(s,r){if(!VC.isUndefined(s)){if(-1!==d.indexOf(s))throw Error("Circular reference detected in "+r.join("."));d.push(s),VC.forEach(s,function(s,a){!0===(!(VC.isUndefined(s)||null===s)&&n.call(t,s,VC.isString(a)?a.trim():a,r,u))&&e(s,r?r.concat(a):[a])}),d.pop()}}(e),t}function XC(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function eT(e,t){this._pairs=[],e&&ZC(e,this,t)}const tT=eT.prototype;function sT(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function rT(e,t,s){if(!t)return e;const r=s&&s.encode||sT;VC.isFunction(s)&&(s={serialize:s});const n=s&&s.serialize;let a;if(a=n?n(t,s):VC.isURLSearchParams(t)?t.toString():new eT(t,s).toString(r),a){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}tT.append=function(e,t){this._pairs.push([e,t])},tT.toString=function(e){const t=e?function(t){return e.call(this,t,XC)}:XC;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};class nT{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){VC.forEach(this.handlers,function(t){null!==t&&e(t)})}}const aT={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},iT={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:eT,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},oT="undefined"!=typeof window&&"undefined"!=typeof document,lT="object"==typeof navigator&&navigator||void 0,cT=oT&&(!lT||["ReactNative","NativeScript","NS"].indexOf(lT.product)<0),dT="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,uT=oT&&window.location.href||"http://localhost",hT={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:oT,hasStandardBrowserEnv:cT,hasStandardBrowserWebWorkerEnv:dT,navigator:lT,origin:uT},Symbol.toStringTag,{value:"Module"})),...iT};function mT(e){function t(e,s,r,n){let a=e[n++];if("__proto__"===a)return!0;const i=Number.isFinite(+a),o=n>=e.length;if(a=!a&&VC.isArray(r)?r.length:a,o)return VC.hasOwnProp(r,a)?r[a]=[r[a],s]:r[a]=s,!i;r[a]&&VC.isObject(r[a])||(r[a]=[]);return t(e,s,r[a],n)&&VC.isArray(r[a])&&(r[a]=function(e){const t={},s=Object.keys(e);let r;const n=s.length;let a;for(r=0;r<n;r++)a=s[r],t[a]=e[a];return t}(r[a])),!i}if(VC.isFormData(e)&&VC.isFunction(e.entries)){const s={};return VC.forEachEntry(e,(e,r)=>{t(function(e){return VC.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),r,s,0)}),s}return null}const pT={transitional:aT,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",r=s.indexOf("application/json")>-1,n=VC.isObject(e);n&&VC.isHTMLForm(e)&&(e=new FormData(e));if(VC.isFormData(e))return r?JSON.stringify(mT(e)):e;if(VC.isArrayBuffer(e)||VC.isBuffer(e)||VC.isStream(e)||VC.isFile(e)||VC.isBlob(e)||VC.isReadableStream(e))return e;if(VC.isArrayBufferView(e))return e.buffer;if(VC.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(n){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return ZC(e,new hT.classes.URLSearchParams,{visitor:function(e,t,s,r){return hT.isNode&&VC.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)},...t})}(e,this.formSerializer).toString();if((a=VC.isFileList(e))||s.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return ZC(a?{"files[]":e}:e,t&&new t,this.formSerializer)}}return n||r?(t.setContentType("application/json",!1),function(e,t,s){if(VC.isString(e))try{return(t||JSON.parse)(e),VC.trim(e)}catch(r){if("SyntaxError"!==r.name)throw r}return(s||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||pT.transitional,s=t&&t.forcedJSONParsing,r="json"===this.responseType;if(VC.isResponse(e)||VC.isReadableStream(e))return e;if(e&&VC.isString(e)&&(s&&!this.responseType||r)){const s=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(n){if(s){if("SyntaxError"===n.name)throw zC.from(n,zC.ERR_BAD_RESPONSE,this,null,this.response);throw n}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:hT.classes.FormData,Blob:hT.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};VC.forEach(["delete","get","head","post","put","patch"],e=>{pT.headers[e]={}});const fT=VC.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),gT=Symbol("internals");function xT(e){return e&&String(e).trim().toLowerCase()}function yT(e){return!1===e||null==e?e:VC.isArray(e)?e.map(yT):String(e)}function vT(e,t,s,r,n){return VC.isFunction(r)?r.call(this,t,s):(n&&(t=s),VC.isString(t)?VC.isString(r)?-1!==t.indexOf(r):VC.isRegExp(r)?r.test(t):void 0:void 0)}let bT=class{constructor(e){e&&this.set(e)}set(e,t,s){const r=this;function n(e,t,s){const n=xT(t);if(!n)throw new Error("header name must be a non-empty string");const a=VC.findKey(r,n);(!a||void 0===r[a]||!0===s||void 0===s&&!1!==r[a])&&(r[a||t]=yT(e))}const a=(e,t)=>VC.forEach(e,(e,s)=>n(e,s,t));if(VC.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(VC.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))a((e=>{const t={};let s,r,n;return e&&e.split("\n").forEach(function(e){n=e.indexOf(":"),s=e.substring(0,n).trim().toLowerCase(),r=e.substring(n+1).trim(),!s||t[s]&&fT[s]||("set-cookie"===s?t[s]?t[s].push(r):t[s]=[r]:t[s]=t[s]?t[s]+", "+r:r)}),t})(e),t);else if(VC.isObject(e)&&VC.isIterable(e)){let s,r,n={};for(const t of e){if(!VC.isArray(t))throw TypeError("Object iterator must return a key-value pair");n[r=t[0]]=(s=n[r])?VC.isArray(s)?[...s,t[1]]:[s,t[1]]:t[1]}a(n,t)}else null!=e&&n(t,e,s);return this}get(e,t){if(e=xT(e)){const s=VC.findKey(this,e);if(s){const e=this[s];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=s.exec(e);)t[r[1]]=r[2];return t}(e);if(VC.isFunction(t))return t.call(this,e,s);if(VC.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=xT(e)){const s=VC.findKey(this,e);return!(!s||void 0===this[s]||t&&!vT(0,this[s],s,t))}return!1}delete(e,t){const s=this;let r=!1;function n(e){if(e=xT(e)){const n=VC.findKey(s,e);!n||t&&!vT(0,s[n],n,t)||(delete s[n],r=!0)}}return VC.isArray(e)?e.forEach(n):n(e),r}clear(e){const t=Object.keys(this);let s=t.length,r=!1;for(;s--;){const n=t[s];e&&!vT(0,this[n],n,e,!0)||(delete this[n],r=!0)}return r}normalize(e){const t=this,s={};return VC.forEach(this,(r,n)=>{const a=VC.findKey(s,n);if(a)return t[a]=yT(r),void delete t[n];const i=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}(n):String(n).trim();i!==n&&delete t[n],t[i]=yT(r),s[i]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return VC.forEach(this,(s,r)=>{null!=s&&!1!==s&&(t[r]=e&&VC.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(e=>s.set(e)),s}static accessor(e){const t=(this[gT]=this[gT]={accessors:{}}).accessors,s=this.prototype;function r(e){const r=xT(e);t[r]||(!function(e,t){const s=VC.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+s,{value:function(e,s,n){return this[r].call(this,t,e,s,n)},configurable:!0})})}(s,e),t[r]=!0)}return VC.isArray(e)?e.forEach(r):r(e),this}};function wT(e,t){const s=this||pT,r=t||s,n=bT.from(r.headers);let a=r.data;return VC.forEach(e,function(e){a=e.call(s,a,n.normalize(),t?t.status:void 0)}),n.normalize(),a}function jT(e){return!(!e||!e.__CANCEL__)}function NT(e,t,s){zC.call(this,null==e?"canceled":e,zC.ERR_CANCELED,t,s),this.name="CanceledError"}function _T(e,t,s){const r=s.config.validateStatus;s.status&&r&&!r(s.status)?t(new zC("Request failed with status code "+s.status,[zC.ERR_BAD_REQUEST,zC.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):e(s)}bT.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),VC.reduceDescriptors(bT.prototype,({value:e},t)=>{let s=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[s]=e}}}),VC.freezeMethods(bT),VC.inherits(NT,zC,{__CANCEL__:!0});const ST=(e,t,s=3)=>{let r=0;const n=function(e,t){e=e||10;const s=new Array(e),r=new Array(e);let n,a=0,i=0;return t=void 0!==t?t:1e3,function(o){const l=Date.now(),c=r[i];n||(n=l),s[a]=o,r[a]=l;let d=i,u=0;for(;d!==a;)u+=s[d++],d%=e;if(a=(a+1)%e,a===i&&(i=(i+1)%e),l-n<t)return;const h=c&&l-c;return h?Math.round(1e3*u/h):void 0}}(50,250);return function(e,t){let s,r,n=0,a=1e3/t;const i=(t,a=Date.now())=>{n=a,s=null,r&&(clearTimeout(r),r=null),e(...t)};return[(...e)=>{const t=Date.now(),o=t-n;o>=a?i(e,t):(s=e,r||(r=setTimeout(()=>{r=null,i(s)},a-o)))},()=>s&&i(s)]}(s=>{const a=s.loaded,i=s.lengthComputable?s.total:void 0,o=a-r,l=n(o);r=a;e({loaded:a,total:i,progress:i?a/i:void 0,bytes:o,rate:l||void 0,estimated:l&&i&&a<=i?(i-a)/l:void 0,event:s,lengthComputable:null!=i,[t?"download":"upload"]:!0})},s)},kT=(e,t)=>{const s=null!=e;return[r=>t[0]({lengthComputable:s,total:e,loaded:r}),t[1]]},CT=e=>(...t)=>VC.asap(()=>e(...t)),TT=hT.hasStandardBrowserEnv?((e,t)=>s=>(s=new URL(s,hT.origin),e.protocol===s.protocol&&e.host===s.host&&(t||e.port===s.port)))(new URL(hT.origin),hT.navigator&&/(msie|trident)/i.test(hT.navigator.userAgent)):()=>!0,ET=hT.hasStandardBrowserEnv?{write(e,t,s,r,n,a){const i=[e+"="+encodeURIComponent(t)];VC.isNumber(s)&&i.push("expires="+new Date(s).toGMTString()),VC.isString(r)&&i.push("path="+r),VC.isString(n)&&i.push("domain="+n),!0===a&&i.push("secure"),document.cookie=i.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function IT(e,t,s){let r=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(r||0==s)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const PT=e=>e instanceof bT?{...e}:e;function OT(e,t){t=t||{};const s={};function r(e,t,s,r){return VC.isPlainObject(e)&&VC.isPlainObject(t)?VC.merge.call({caseless:r},e,t):VC.isPlainObject(t)?VC.merge({},t):VC.isArray(t)?t.slice():t}function n(e,t,s,n){return VC.isUndefined(t)?VC.isUndefined(e)?void 0:r(void 0,e,0,n):r(e,t,0,n)}function a(e,t){if(!VC.isUndefined(t))return r(void 0,t)}function i(e,t){return VC.isUndefined(t)?VC.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function o(s,n,a){return a in t?r(s,n):a in e?r(void 0,s):void 0}const l={url:a,method:a,data:a,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:o,headers:(e,t,s)=>n(PT(e),PT(t),0,!0)};return VC.forEach(Object.keys({...e,...t}),function(r){const a=l[r]||n,i=a(e[r],t[r],r);VC.isUndefined(i)&&a!==o||(s[r]=i)}),s}const AT=e=>{const t=OT({},e);let{data:s,withXSRFToken:r,xsrfHeaderName:n,xsrfCookieName:a,headers:i,auth:o}=t;if(t.headers=i=bT.from(i),t.url=rT(IT(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),o&&i.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),VC.isFormData(s))if(hT.hasStandardBrowserEnv||hT.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if(VC.isFunction(s.getHeaders)){const e=s.getHeaders(),t=["content-type","content-length"];Object.entries(e).forEach(([e,s])=>{t.includes(e.toLowerCase())&&i.set(e,s)})}if(hT.hasStandardBrowserEnv&&(r&&VC.isFunction(r)&&(r=r(t)),r||!1!==r&&TT(t.url))){const e=n&&a&&ET.read(a);e&&i.set(n,e)}return t},DT="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,s){const r=AT(e);let n=r.data;const a=bT.from(r.headers).normalize();let i,o,l,c,d,{responseType:u,onUploadProgress:h,onDownloadProgress:m}=r;function p(){c&&c(),d&&d(),r.cancelToken&&r.cancelToken.unsubscribe(i),r.signal&&r.signal.removeEventListener("abort",i)}let f=new XMLHttpRequest;function g(){if(!f)return;const r=bT.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());_T(function(e){t(e),p()},function(e){s(e),p()},{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:r,config:e,request:f}),f=null}f.open(r.method.toUpperCase(),r.url,!0),f.timeout=r.timeout,"onloadend"in f?f.onloadend=g:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(g)},f.onabort=function(){f&&(s(new zC("Request aborted",zC.ECONNABORTED,e,f)),f=null)},f.onerror=function(t){const r=new zC(t&&t.message?t.message:"Network Error",zC.ERR_NETWORK,e,f);r.event=t||null,s(r),f=null},f.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const n=r.transitional||aT;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),s(new zC(t,n.clarifyTimeoutError?zC.ETIMEDOUT:zC.ECONNABORTED,e,f)),f=null},void 0===n&&a.setContentType(null),"setRequestHeader"in f&&VC.forEach(a.toJSON(),function(e,t){f.setRequestHeader(t,e)}),VC.isUndefined(r.withCredentials)||(f.withCredentials=!!r.withCredentials),u&&"json"!==u&&(f.responseType=r.responseType),m&&([l,d]=ST(m,!0),f.addEventListener("progress",l)),h&&f.upload&&([o,c]=ST(h),f.upload.addEventListener("progress",o),f.upload.addEventListener("loadend",c)),(r.cancelToken||r.signal)&&(i=t=>{f&&(s(!t||t.type?new NT(null,e,f):t),f.abort(),f=null)},r.cancelToken&&r.cancelToken.subscribe(i),r.signal&&(r.signal.aborted?i():r.signal.addEventListener("abort",i)));const x=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);x&&-1===hT.protocols.indexOf(x)?s(new zC("Unsupported protocol "+x+":",zC.ERR_BAD_REQUEST,e)):f.send(n||null)})},MT=(e,t)=>{const{length:s}=e=e?e.filter(Boolean):[];if(t||s){let s,r=new AbortController;const n=function(e){if(!s){s=!0,i();const t=e instanceof Error?e:this.reason;r.abort(t instanceof zC?t:new NT(t instanceof Error?t.message:t))}};let a=t&&setTimeout(()=>{a=null,n(new zC(`timeout ${t} of ms exceeded`,zC.ETIMEDOUT))},t);const i=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(n):e.removeEventListener("abort",n)}),e=null)};e.forEach(e=>e.addEventListener("abort",n));const{signal:o}=r;return o.unsubscribe=()=>VC.asap(i),o}},qT=function*(e,t){let s=e.byteLength;if(s<t)return void(yield e);let r,n=0;for(;n<s;)r=n+t,yield e.slice(n,r),n=r},RT=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},$T=(e,t,s,r)=>{const n=async function*(e,t){for await(const s of RT(e))yield*qT(s,t)}(e,t);let a,i=0,o=e=>{a||(a=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await n.next();if(t)return o(),void e.close();let a=r.byteLength;if(s){let e=i+=a;s(e)}e.enqueue(new Uint8Array(r))}catch(t){throw o(t),t}},cancel:e=>(o(e),n.return())},{highWaterMark:2})},{isFunction:LT}=VC,QT=(({Request:e,Response:t})=>({Request:e,Response:t}))(VC.global),{ReadableStream:FT,TextEncoder:UT}=VC.global,WT=(e,...t)=>{try{return!!e(...t)}catch(s){return!1}},VT=e=>{e=VC.merge.call({skipUndefined:!0},QT,e);const{fetch:t,Request:s,Response:r}=e,n=t?LT(t):"function"==typeof fetch,a=LT(s),i=LT(r);if(!n)return!1;const o=n&&LT(FT),l=n&&("function"==typeof UT?(e=>t=>e.encode(t))(new UT):async e=>new Uint8Array(await new s(e).arrayBuffer())),c=a&&o&&WT(()=>{let e=!1;const t=new s(hT.origin,{body:new FT,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),d=i&&o&&WT(()=>VC.isReadableStream(new r("").body)),u={stream:d&&(e=>e.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!u[e]&&(u[e]=(t,s)=>{let r=t&&t[e];if(r)return r.call(t);throw new zC(`Response type '${e}' is not supported`,zC.ERR_NOT_SUPPORT,s)})});const h=async(e,t)=>{const r=VC.toFiniteNumber(e.getContentLength());return null==r?(async e=>{if(null==e)return 0;if(VC.isBlob(e))return e.size;if(VC.isSpecCompliantForm(e)){const t=new s(hT.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return VC.isArrayBufferView(e)||VC.isArrayBuffer(e)?e.byteLength:(VC.isURLSearchParams(e)&&(e+=""),VC.isString(e)?(await l(e)).byteLength:void 0)})(t):r};return async e=>{let{url:n,method:i,data:o,signal:l,cancelToken:m,timeout:p,onDownloadProgress:f,onUploadProgress:g,responseType:x,headers:y,withCredentials:v="same-origin",fetchOptions:b}=AT(e),w=t||fetch;x=x?(x+"").toLowerCase():"text";let j=MT([l,m&&m.toAbortSignal()],p),N=null;const _=j&&j.unsubscribe&&(()=>{j.unsubscribe()});let S;try{if(g&&c&&"get"!==i&&"head"!==i&&0!==(S=await h(y,o))){let e,t=new s(n,{method:"POST",body:o,duplex:"half"});if(VC.isFormData(o)&&(e=t.headers.get("content-type"))&&y.setContentType(e),t.body){const[e,s]=kT(S,ST(CT(g)));o=$T(t.body,65536,e,s)}}VC.isString(v)||(v=v?"include":"omit");const t=a&&"credentials"in s.prototype,l={...b,signal:j,method:i.toUpperCase(),headers:y.normalize().toJSON(),body:o,duplex:"half",credentials:t?v:void 0};N=a&&new s(n,l);let m=await(a?w(N,b):w(n,l));const p=d&&("stream"===x||"response"===x);if(d&&(f||p&&_)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=m[t]});const t=VC.toFiniteNumber(m.headers.get("content-length")),[s,n]=f&&kT(t,ST(CT(f),!0))||[];m=new r($T(m.body,65536,s,()=>{n&&n(),_&&_()}),e)}x=x||"text";let k=await u[VC.findKey(u,x)||"text"](m,e);return!p&&_&&_(),await new Promise((t,s)=>{_T(t,s,{data:k,headers:bT.from(m.headers),status:m.status,statusText:m.statusText,config:e,request:N})})}catch(k){if(_&&_(),k&&"TypeError"===k.name&&/Load failed|fetch/i.test(k.message))throw Object.assign(new zC("Network Error",zC.ERR_NETWORK,e,N),{cause:k.cause||k});throw zC.from(k,k&&k.code,e,N)}}},zT=new Map,BT=e=>{let t=e?e.env:{};const{fetch:s,Request:r,Response:n}=t,a=[r,n,s];let i,o,l=a.length,c=zT;for(;l--;)i=a[l],o=c.get(i),void 0===o&&c.set(i,o=l?new Map:VT(t)),c=o;return o};BT();const HT={http:null,xhr:DT,fetch:{get:BT}};VC.forEach(HT,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(s){}Object.defineProperty(e,"adapterName",{value:t})}});const GT=e=>`- ${e}`,KT=e=>VC.isFunction(e)||null===e||!1===e,YT=(e,t)=>{e=VC.isArray(e)?e:[e];const{length:s}=e;let r,n;const a={};for(let i=0;i<s;i++){let s;if(r=e[i],n=r,!KT(r)&&(n=HT[(s=String(r)).toLowerCase()],void 0===n))throw new zC(`Unknown adapter '${s}'`);if(n&&(VC.isFunction(n)||(n=n.get(t))))break;a[s||"#"+i]=n}if(!n){const e=Object.entries(a).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new zC("There is no suitable adapter to dispatch the request "+(s?e.length>1?"since :\n"+e.map(GT).join("\n"):" "+GT(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n};function JT(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new NT(null,e)}function ZT(e){JT(e),e.headers=bT.from(e.headers),e.data=wT.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return YT(e.adapter||pT.adapter,e)(e).then(function(t){return JT(e),t.data=wT.call(e,e.transformResponse,t),t.headers=bT.from(t.headers),t},function(t){return jT(t)||(JT(e),t&&t.response&&(t.response.data=wT.call(e,e.transformResponse,t.response),t.response.headers=bT.from(t.response.headers))),Promise.reject(t)})}const XT="1.12.2",eE={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{eE[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});const tE={};eE.transitional=function(e,t,s){return(r,n,a)=>{if(!1===e)throw new zC(function(e,t){return"[Axios v"+XT+"] Transitional option '"+e+"'"+t+(s?". "+s:"")}(n," has been removed"+(t?" in "+t:"")),zC.ERR_DEPRECATED);return t&&!tE[n]&&(tE[n]=!0),!e||e(r,n,a)}},eE.spelling=function(e){return(e,t)=>!0};const sE={assertOptions:function(e,t,s){if("object"!=typeof e)throw new zC("options must be an object",zC.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let n=r.length;for(;n-- >0;){const a=r[n],i=t[a];if(i){const t=e[a],s=void 0===t||i(t,a,e);if(!0!==s)throw new zC("option "+a+" must be "+s,zC.ERR_BAD_OPTION_VALUE);continue}if(!0!==s)throw new zC("Unknown option "+a,zC.ERR_BAD_OPTION)}},validators:eE},rE=sE.validators;let nE=class{constructor(e){this.defaults=e||{},this.interceptors={request:new nT,response:new nT}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{s.stack?t&&!String(s.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(s.stack+="\n"+t):s.stack=t}catch(r){}}throw s}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=OT(this.defaults,t);const{transitional:s,paramsSerializer:r,headers:n}=t;void 0!==s&&sE.assertOptions(s,{silentJSONParsing:rE.transitional(rE.boolean),forcedJSONParsing:rE.transitional(rE.boolean),clarifyTimeoutError:rE.transitional(rE.boolean)},!1),null!=r&&(VC.isFunction(r)?t.paramsSerializer={serialize:r}:sE.assertOptions(r,{encode:rE.function,serialize:rE.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),sE.assertOptions(t,{baseUrl:rE.spelling("baseURL"),withXsrfToken:rE.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=n&&VC.merge(n.common,n[t.method]);n&&VC.forEach(["delete","get","head","post","put","patch","common"],e=>{delete n[e]}),t.headers=bT.concat(a,n);const i=[];let o=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,i.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let d,u=0;if(!o){const e=[ZT.bind(this),void 0];for(e.unshift(...i),e.push(...l),d=e.length,c=Promise.resolve(t);u<d;)c=c.then(e[u++],e[u++]);return c}d=i.length;let h=t;for(;u<d;){const e=i[u++],t=i[u++];try{h=e(h)}catch(m){t.call(this,m);break}}try{c=ZT.call(this,h)}catch(m){return Promise.reject(m)}for(u=0,d=l.length;u<d;)c=c.then(l[u++],l[u++]);return c}getUri(e){return rT(IT((e=OT(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};VC.forEach(["delete","get","head","options"],function(e){nE.prototype[e]=function(t,s){return this.request(OT(s||{},{method:e,url:t,data:(s||{}).data}))}}),VC.forEach(["post","put","patch"],function(e){function t(t){return function(s,r,n){return this.request(OT(n||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:s,data:r}))}}nE.prototype[e]=t(),nE.prototype[e+"Form"]=t(!0)});const aE={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(aE).forEach(([e,t])=>{aE[t]=e});const iE=function e(t){const s=new nE(t),r=sC(nE.prototype.request,s);return VC.extend(r,nE.prototype,s,{allOwnKeys:!0}),VC.extend(r,s,null,{allOwnKeys:!0}),r.create=function(s){return e(OT(t,s))},r}(pT);iE.Axios=nE,iE.CanceledError=NT,iE.CancelToken=class e{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const s=this;this.promise.then(e=>{if(!s._listeners)return;let t=s._listeners.length;for(;t-- >0;)s._listeners[t](e);s._listeners=null}),this.promise.then=e=>{let t;const r=new Promise(e=>{s.subscribe(e),t=e}).then(e);return r.cancel=function(){s.unsubscribe(t)},r},e(function(e,r,n){s.reason||(s.reason=new NT(e,r,n),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;return{token:new e(function(e){t=e}),cancel:t}}},iE.isCancel=jT,iE.VERSION=XT,iE.toFormData=ZC,iE.AxiosError=zC,iE.Cancel=iE.CanceledError,iE.all=function(e){return Promise.all(e)},iE.spread=function(e){return function(t){return e.apply(null,t)}},iE.isAxiosError=function(e){return VC.isObject(e)&&!0===e.isAxiosError},iE.mergeConfig=OT,iE.AxiosHeaders=bT,iE.formToJSON=e=>mT(VC.isHTMLForm(e)?new FormData(e):e),iE.getAdapter=YT,iE.HttpStatusCode=aE,iE.default=iE;const{Axios:oE,AxiosError:lE,CanceledError:cE,isCancel:dE,CancelToken:uE,VERSION:hE,all:mE,Cancel:pE,isAxiosError:fE,spread:gE,toFormData:xE,AxiosHeaders:yE,HttpStatusCode:vE,formToJSON:bE,getAdapter:wE,mergeConfig:jE}=iE;const NE=new class{constructor(){t(this,"lineSettings",null),this.loadSettings()}async loadSettings(){try{const{data:e,error:t}=await qa.from("line_settings").select("login_channel_id, login_channel_secret, callback_url, liff_id, channel_id, channel_secret, access_token").single();if(t)return;this.lineSettings=e}catch(e){}}async ensureSettings(){if(this.lineSettings||await this.loadSettings(),!this.lineSettings)throw new Error("LINE settings not configured. Please configure LINE settings in the admin panel.");return this.lineSettings}async generateLoginUrl(e){const t=await this.ensureSettings();sessionStorage.setItem("lineLoginState",e);return`https://access.line.me/oauth2/v2.1/authorize?${new URLSearchParams({response_type:"code",client_id:t.login_channel_id,redirect_uri:t.callback_url,state:e,scope:"profile openid email",bot_prompt:"aggressive"}).toString()}`}async exchangeToken(e){try{const t=await this.ensureSettings();return(await iE.post("/.netlify/functions/line-token-exchange",{code:e,redirectUri:t.callback_url,clientId:t.login_channel_id,clientSecret:t.login_channel_secret})).data}catch(t){throw new Error("Failed to exchange LINE token")}}async handleCallback(e){try{const t=await this.exchangeToken(e);if(t.profile)return{userId:t.profile.userId,displayName:t.profile.displayName,pictureUrl:t.profile.pictureUrl};return await this.getProfile(t.access_token)}catch(t){throw new Error("Failed to handle LINE callback")}}async getProfile(e){try{return(await iE.get("/api/line-profile",{headers:{Authorization:`Bearer ${e}`}})).data}catch(t){throw new Error("Failed to get LINE profile")}}getUserId(){return localStorage.getItem("lineUserId")}storeUserId(e){localStorage.setItem("lineUserId",e)}clearAuth(){localStorage.removeItem("lineToken"),localStorage.removeItem("lineUserId"),localStorage.removeItem("lineProfile"),localStorage.removeItem("lineLoginState"),sessionStorage.removeItem("lineLoginState")}async sendNotification(e,t){try{await iE.post("/api/line-send-notification",{userId:e,message:t})}catch(s){throw new Error("Failed to send LINE notification")}}async getLINEProfile(e){try{return(await iE.post("/api/line-profile",{userId:e})).data}catch(t){throw new Error("Failed to get LINE profile")}}},_E=({onLoginSuccess:e})=>{const[t,s]=n.useState(!1),[r,o]=n.useState(""),[l,c]=n.useState(!1),d=n.useCallback(async()=>{try{const e=Math.random().toString(36).substring(2,15);localStorage.setItem("lineLoginState",e),localStorage.setItem("lineLoginCallback","patient-portal");const t=await NE.generateLoginUrl(e);window.location.href=t}catch(e){a.error(" LINE  ")}},[]),u=async t=>{if(t.preventDefault(),r.trim())try{c(!0),await new Promise(e=>setTimeout(e,1500));const t=`line-${Math.random().toString(36).substring(2,15)}`,s=null==r?void 0:r.replace(/[\s-]/g,"");e(t,s),a.success("")}catch(s){a.error("")}finally{c(!1)}else a.error("")};return t?i.jsxs("form",{onSubmit:u,className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{htmlFor:"phone",className:"text-sm font-medium text-gray-700",children:""}),i.jsx(Ux,{id:"phone",type:"text",placeholder:"X-XXXX-XXXXX-XX-X",value:r,onChange:e=>{o((e=>{const t=e.replace(/\D/g,"");return t.length<=13?t.replace(/(\d{1})(\d{4})(\d{5})(\d{2})(\d{1})/,"$1-$2-$3-$4-$5"):e})(e.target.value))},maxLength:17,required:!0})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(gu,{type:"button",variant:"outline",className:"flex-1",onClick:()=>s(!1),children:""}),i.jsx(gu,{type:"submit",className:"flex-1 bg-[#06C755] hover:bg-[#06B048] text-white",disabled:l,children:l?"...":""})]})]}):i.jsxs("div",{className:"space-y-3",children:[i.jsx(gu,{onClick:d,className:"w-full bg-[#06C755] hover:bg-[#06B048] text-white",children:" LINE"}),i.jsx("div",{className:"text-center",children:i.jsx("button",{type:"button",onClick:()=>{s(!0)},className:"text-sm text-gray-500 hover:underline",children:""})})]})};var SE=Object.defineProperty,kE=Object.defineProperties,CE=Object.getOwnPropertyDescriptors,TE=Object.getOwnPropertySymbols,EE=Object.prototype.hasOwnProperty,IE=Object.prototype.propertyIsEnumerable,PE=(e,t,s)=>t in e?SE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var OE=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");var AE=n.createContext({}),DE=n.forwardRef((e,t)=>{var s,r,a,i,o,l=e,{value:c,onChange:d,maxLength:u,textAlign:h="left",pattern:m,placeholder:p,inputMode:f="numeric",onComplete:g,pushPasswordManagerStrategy:x="increase-width",pasteTransformer:y,containerClassName:v,noScriptCSSFallback:b=qE,render:w,children:j}=l,N=((e,t)=>{var s={};for(var r in e)EE.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&TE)for(var r of TE(e))t.indexOf(r)<0&&IE.call(e,r)&&(s[r]=e[r]);return s})(l,["value","onChange","maxLength","textAlign","pattern","placeholder","inputMode","onComplete","pushPasswordManagerStrategy","pasteTransformer","containerClassName","noScriptCSSFallback","render","children"]);let[_,S]=n.useState("string"==typeof N.defaultValue?N.defaultValue:""),k=null!=c?c:_,C=function(e){let t=n.useRef();return n.useEffect(()=>{t.current=e}),t.current}(k),T=n.useCallback(e=>{null==d||d(e),S(e)},[d]),E=n.useMemo(()=>m?"string"==typeof m?new RegExp(m):m:null,[m]),I=n.useRef(null),P=n.useRef(null),O=n.useRef({value:k,onChange:T,isIOS:"undefined"!=typeof window&&(null==(r=null==(s=null==window?void 0:window.CSS)?void 0:s.supports)?void 0:r.call(s,"-webkit-touch-callout","none"))}),A=n.useRef({prev:[null==(a=I.current)?void 0:a.selectionStart,null==(i=I.current)?void 0:i.selectionEnd,null==(o=I.current)?void 0:o.selectionDirection]});n.useImperativeHandle(t,()=>I.current,[]),n.useEffect(()=>{let e=I.current,t=P.current;if(!e||!t)return;function s(){if(document.activeElement!==e)return L(null),void F(null);let t,s=e.selectionStart,r=e.selectionEnd,n=e.selectionDirection,a=e.maxLength,i=e.value,o=A.current.prev,l=-1,c=-1;if(0!==i.length&&null!==s&&null!==r){let e=s===r,n=s===i.length&&i.length<a;if(e&&!n){let e=s;if(0===e)l=0,c=1,t="forward";else if(e===a)l=e-1,c=e,t="backward";else if(a>1&&i.length>1){let s=0;if(null!==o[0]&&null!==o[1]){t=e<o[1]?"backward":"forward";let r=o[0]===o[1]&&o[0]<a;"backward"===t&&!r&&(s=-1)}l=s+e,c=s+e+1}}-1!==l&&-1!==c&&l!==c&&I.current.setSelectionRange(l,c,t)}let d=-1!==l?l:s,u=-1!==c?c:r,h=null!=t?t:n;L(d),F(u),A.current.prev=[d,u,h]}if(O.current.value!==e.value&&O.current.onChange(e.value),A.current.prev=[e.selectionStart,e.selectionEnd,e.selectionDirection],document.addEventListener("selectionchange",s,{capture:!0}),s(),document.activeElement===e&&R(!0),!document.getElementById("input-otp-style")){let e=document.createElement("style");if(e.id="input-otp-style",document.head.appendChild(e),e.sheet){let t="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";ME(e.sheet,"[data-input-otp]::selection { background: transparent !important; color: transparent !important; }"),ME(e.sheet,`[data-input-otp]:autofill { ${t} }`),ME(e.sheet,`[data-input-otp]:-webkit-autofill { ${t} }`),ME(e.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),ME(e.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let r=()=>{t&&t.style.setProperty("--root-height",`${e.clientHeight}px`)};r();let n=new ResizeObserver(r);return n.observe(e),()=>{document.removeEventListener("selectionchange",s,{capture:!0}),n.disconnect()}},[]);let[D,M]=n.useState(!1),[q,R]=n.useState(!1),[$,L]=n.useState(null),[Q,F]=n.useState(null);n.useEffect(()=>{!function(e){setTimeout(e,0),setTimeout(e,10),setTimeout(e,50)}(()=>{var e,t,s,r;null==(e=I.current)||e.dispatchEvent(new Event("input"));let n=null==(t=I.current)?void 0:t.selectionStart,a=null==(s=I.current)?void 0:s.selectionEnd,i=null==(r=I.current)?void 0:r.selectionDirection;null!==n&&null!==a&&(L(n),F(a),A.current.prev=[n,a,i])})},[k,q]),n.useEffect(()=>{void 0!==C&&k!==C&&C.length<u&&k.length===u&&(null==g||g(k))},[u,g,C,k]);let U=function({containerRef:e,inputRef:t,pushPasswordManagerStrategy:s,isFocused:r}){let[a,i]=n.useState(!1),[o,l]=n.useState(!1),[c,d]=n.useState(!1),u=n.useMemo(()=>"none"!==s&&("increase-width"===s||"experimental-no-flickering"===s)&&a&&o,[a,o,s]),h=n.useCallback(()=>{let r=e.current,n=t.current;if(!r||!n||c||"none"===s)return;let a=r,o=a.getBoundingClientRect().left+a.offsetWidth-18,l=a.getBoundingClientRect().top+a.offsetHeight/2;0===document.querySelectorAll(OE).length&&document.elementFromPoint(o,l)===r||(i(!0),d(!0))},[e,t,c,s]);return n.useEffect(()=>{let t=e.current;if(!t||"none"===s)return;function r(){let e=window.innerWidth-t.getBoundingClientRect().right;l(e>=40)}r();let n=setInterval(r,1e3);return()=>{clearInterval(n)}},[e,s]),n.useEffect(()=>{let e=r||document.activeElement===t.current;if("none"===s||!e)return;let n=setTimeout(h,0),a=setTimeout(h,2e3),i=setTimeout(h,5e3),o=setTimeout(()=>{d(!0)},6e3);return()=>{clearTimeout(n),clearTimeout(a),clearTimeout(i),clearTimeout(o)}},[t,r,s,h]),{hasPWMBadge:a,willPushPWMBadge:u,PWM_BADGE_SPACE_WIDTH:"40px"}}({containerRef:P,inputRef:I,pushPasswordManagerStrategy:x,isFocused:q}),W=n.useCallback(e=>{let t=e.currentTarget.value.slice(0,u);t.length>0&&E&&!E.test(t)?e.preventDefault():("string"==typeof C&&t.length<C.length&&document.dispatchEvent(new Event("selectionchange")),T(t))},[u,T,C,E]),V=n.useCallback(()=>{var e;if(I.current){let t=Math.min(I.current.value.length,u-1),s=I.current.value.length;null==(e=I.current)||e.setSelectionRange(t,s),L(t),F(s)}R(!0)},[u]),z=n.useCallback(e=>{var t,s;let r=I.current;if(!(y||O.current.isIOS&&e.clipboardData&&r))return;let n=e.clipboardData.getData("text/plain"),a=y?y(n):n;e.preventDefault();let i=null==(t=I.current)?void 0:t.selectionStart,o=null==(s=I.current)?void 0:s.selectionEnd,l=(i!==o?k.slice(0,i)+a+k.slice(o):k.slice(0,i)+a+k.slice(i)).slice(0,u);if(l.length>0&&E&&!E.test(l))return;r.value=l,T(l);let c=Math.min(l.length,u-1),d=l.length;r.setSelectionRange(c,d),L(c),F(d)},[u,T,E,k]),B=n.useMemo(()=>({position:"relative",cursor:N.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[N.disabled]),H=n.useMemo(()=>({position:"absolute",inset:0,width:U.willPushPWMBadge?`calc(100% + ${U.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:U.willPushPWMBadge?`inset(0 ${U.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:h,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[U.PWM_BADGE_SPACE_WIDTH,U.willPushPWMBadge,h]),G=n.useMemo(()=>n.createElement("input",((e,t)=>kE(e,CE(t)))(((e,t)=>{for(var s in t||(t={}))EE.call(t,s)&&PE(e,s,t[s]);if(TE)for(var s of TE(t))IE.call(t,s)&&PE(e,s,t[s]);return e})({autoComplete:N.autoComplete||"one-time-code"},N),{"data-input-otp":!0,"data-input-otp-placeholder-shown":0===k.length||void 0,"data-input-otp-mss":$,"data-input-otp-mse":Q,inputMode:f,pattern:null==E?void 0:E.source,"aria-placeholder":p,style:H,maxLength:u,value:k,ref:I,onPaste:e=>{var t;z(e),null==(t=N.onPaste)||t.call(N,e)},onChange:W,onMouseOver:e=>{var t;M(!0),null==(t=N.onMouseOver)||t.call(N,e)},onMouseLeave:e=>{var t;M(!1),null==(t=N.onMouseLeave)||t.call(N,e)},onFocus:e=>{var t;V(),null==(t=N.onFocus)||t.call(N,e)},onBlur:e=>{var t;R(!1),null==(t=N.onBlur)||t.call(N,e)}})),[W,V,z,f,H,u,Q,$,N,null==E?void 0:E.source,k]),K=n.useMemo(()=>({slots:Array.from({length:u}).map((e,t)=>{var s;let r=q&&null!==$&&null!==Q&&($===Q&&t===$||t>=$&&t<Q),n=void 0!==k[t]?k[t]:null;return{char:n,placeholderChar:void 0!==k[0]?null:null!=(s=null==p?void 0:p[t])?s:null,isActive:r,hasFakeCaret:r&&null===n}}),isFocused:q,isHovering:!N.disabled&&D}),[q,D,u,Q,$,N.disabled,k]),Y=n.useMemo(()=>w?w(K):n.createElement(AE.Provider,{value:K},j),[j,K,w]);return n.createElement(n.Fragment,null,null!==b&&n.createElement("noscript",null,n.createElement("style",null,b)),n.createElement("div",{ref:P,"data-input-otp-container":!0,style:B,className:v},Y,n.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},G)))});function ME(e,t){try{e.insertRule(t)}catch(s){}}DE.displayName="Input";var qE="\n[data-input-otp] {\n  --nojs-bg: white !important;\n  --nojs-fg: black !important;\n\n  background-color: var(--nojs-bg) !important;\n  color: var(--nojs-fg) !important;\n  caret-color: var(--nojs-fg) !important;\n  letter-spacing: .25em !important;\n  text-align: center !important;\n  border: 1px solid var(--nojs-fg) !important;\n  border-radius: 4px !important;\n  width: 100% !important;\n}\n@media (prefers-color-scheme: dark) {\n  [data-input-otp] {\n    --nojs-bg: black !important;\n    --nojs-fg: white !important;\n  }\n}";const RE=n.forwardRef(({className:e,containerClassName:t,...s},r)=>i.jsx(DE,{ref:r,containerClassName:Qi("flex items-center gap-2 has-[:disabled]:opacity-50",t),className:Qi("disabled:cursor-not-allowed",e),...s}));RE.displayName="InputOTP";const $E=n.forwardRef(({className:e,...t},s)=>i.jsx("div",{ref:s,className:Qi("flex items-center",e),...t}));$E.displayName="InputOTPGroup";const LE=n.forwardRef(({index:e,className:t,...s},r)=>{const a=n.useContext(AE),{char:o,hasFakeCaret:l,isActive:c}=a.slots[e];return i.jsxs("div",{ref:r,className:Qi("relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",c&&"z-10 ring-2 ring-ring ring-offset-background",t),...s,children:[o,l&&i.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:i.jsx("div",{className:"h-4 w-px animate-caret-blink bg-foreground duration-1000"})})]})});LE.displayName="InputOTPSlot";n.forwardRef(({...e},t)=>i.jsx("div",{ref:t,role:"separator",...e,children:i.jsx(So,{})})).displayName="InputOTPSeparator";const QE=({onPatientFound:e})=>{const[t,s]=n.useState(""),[r,o]=n.useState(!1),{findPatientByPhone:l,searchLoading:c}=Ha(),d=()=>{o(!r)};return i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"text-center mb-4",children:[i.jsx("h2",{className:"text-xl font-semibold",children:""}),i.jsx("p",{className:"text-gray-600 text-sm",children:""})]}),r?i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"flex justify-center",children:i.jsx(RE,{maxLength:10,value:t,onChange:s,children:i.jsxs($E,{children:[i.jsx(LE,{index:0}),i.jsx(LE,{index:1}),i.jsx(LE,{index:2}),i.jsx(LE,{index:3}),i.jsx(LE,{index:4}),i.jsx(LE,{index:5}),i.jsx(LE,{index:6}),i.jsx(LE,{index:7}),i.jsx(LE,{index:8}),i.jsx(LE,{index:9})]})})}),i.jsx(gu,{type:"button",variant:"link",onClick:d,className:"text-sm mx-auto block",children:""})]}):i.jsxs("div",{className:"space-y-4",children:[i.jsx(Ux,{type:"tel",placeholder:" ( 0812345678)",value:t,onChange:e=>s(e.target.value),className:"text-center",maxLength:10}),i.jsx(gu,{type:"button",variant:"link",onClick:d,className:"text-sm mx-auto block",children:""})]}),i.jsx("div",{className:"flex justify-center",children:i.jsx(gu,{onClick:async()=>{if(t.trim())try{const s=await l(t);s?(a.success(`: ${s.name}`),e(s)):a.error("")}catch(s){a.error("")}else a.error("")},className:"w-full bg-pharmacy-600 hover:bg-pharmacy-700",disabled:t.length<10||c,children:c?"...":""})})]})},FE=({onLoginSuccess:e,onPatientSelect:t})=>{const[s,r]=n.useState("patient");u();return i.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-50 p-4",children:i.jsxs(Fi,{className:"w-full max-w-md",children:[i.jsx(Ui,{children:i.jsx(Wi,{className:"text-center",children:""})}),i.jsx(zi,{className:"space-y-4",children:i.jsxs(Oh,{defaultValue:"patient",value:s,onValueChange:r,children:[i.jsx(Mh,{value:"patient",children:i.jsx(_E,{onLoginSuccess:e})}),i.jsxs(Mh,{value:"staff",children:[i.jsx("div",{className:"text-center mb-4",children:i.jsx(Zo,{className:"mx-auto h-16 w-16 text-pharmacy-600 mb-2"})}),i.jsx(QE,{onPatientFound:e=>{t(e)}})]})]})})]})})},UE=({patient:e,queue:t,patients:s,availableQueues:r,onLogout:a,onSwitchPatient:o,onSwitchQueue:l,onClearQueueHistory:c})=>{const d=u(),[h,m]=n.useState(0),[p,f]=n.useState(0);return n.useEffect(()=>{(async()=>{try{const e=Nu();let s=qa.from("queues").select("*",{count:"exact"}).eq("queue_date",e).eq("status","WAITING").is("paused_at",null).lt("number",t.number);s=t.service_point_id?s.or(`service_point_id.eq.${t.service_point_id},service_point_id.is.null`):s.is("service_point_id",null);const{count:r,error:n}=await s;if(n)throw n;m(r||0)}catch(e){}})(),(async()=>{try{const{data:e,error:t}=await qa.from("settings").select("value").eq("category","queue").eq("key","avg_wait_time").single();if(t)throw t;const s=e?parseInt(String(e.value),10):10;f(h*s)}catch(e){}})()},[t,qa,h]),i.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:i.jsxs("div",{className:"max-w-2xl mx-auto space-y-4",children:[i.jsx(Fi,{children:i.jsx(zi,{className:"p-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:e.name}),i.jsx("p",{className:"text-gray-600",children:e.phone})]}),i.jsxs(Lh,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[" ",t.number]})]})})}),i.jsxs(Fi,{children:[i.jsx(Ui,{children:i.jsxs(Wi,{className:"flex items-center gap-2",children:[i.jsx(jo,{className:"w-5 h-5 text-blue-600"}),""]})}),i.jsxs(zi,{className:"space-y-4",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:h}),i.jsx("p",{className:"text-gray-600",children:""})]}),i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"text-xl font-semibold text-green-600",children:[p," "]}),i.jsx("p",{className:"text-gray-600",children:""})]})]})]}),t.paused_at&&i.jsx(Fi,{children:i.jsx(zi,{className:"p-4",children:i.jsxs("div",{className:"text-center",children:[i.jsx("p",{className:"text-orange-600 font-medium",children:""}),i.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[":"," ",new Date(t.paused_at).toLocaleTimeString("th-TH")]})]})})}),i.jsxs(Fi,{children:[i.jsx(Ui,{children:i.jsx(Wi,{className:"text-lg",children:""})}),i.jsx(zi,{className:"space-y-3",children:i.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[i.jsxs(gu,{onClick:()=>d("/patient-portal/appointments"),className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:[i.jsx(ao,{className:"w-4 h-4 mr-2"}),""]}),i.jsxs(gu,{onClick:()=>d("/patient-portal/profile"),variant:"outline",className:"w-full border-green-600 text-green-600 hover:bg-green-50",children:[i.jsx(Sl,{className:"w-4 h-4 mr-2"}),""]})]})})]}),i.jsx(Fi,{children:i.jsxs(zi,{className:"p-4 space-y-3",children:[s.length>1&&i.jsxs(gu,{onClick:o,variant:"outline",className:"w-full",children:[i.jsx(Tl,{className:"w-4 h-4 mr-2"}),""]}),l&&r.length>1&&i.jsxs(gu,{onClick:l,variant:"outline",className:"w-full",children:[i.jsx(il,{className:"w-4 h-4 mr-2"}),""]}),i.jsxs(gu,{onClick:a,variant:"outline",className:"w-full",children:[i.jsx(Qo,{className:"w-4 h-4 mr-2"}),""]})]})})]})})},WE=({patient:e,queueIns:t,patients:s,onLogout:r,onSwitchPatient:a,onClearQueueHistory:o})=>{const l=u(),[c,d]=n.useState(0),[h,m]=n.useState(0),[p,f]=n.useState(!1);return n.useEffect(()=>{(async()=>{try{f(!0);const e=Nu();let s=qa.from("queues_ins").select("*",{count:"exact"}).eq("queue_date",e).eq("status","WAITING").is("paused_at",null).lt("number",t.number);s=t.service_point_id?s.or(`service_point_id.eq.${t.service_point_id},service_point_id.is.null`):s.is("service_point_id",null);const{count:r,error:n}=await s;if(n)throw n;d(r||0);const{data:a}=await qa.from("settings").select("value").eq("category","queue").eq("key","ins_avg_wait_time").single(),i=a?parseInt(String(a.value),10):15;m(r*i)}catch(e){}finally{f(!1)}})()},[t]),i.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:i.jsxs("div",{className:"max-w-2xl mx-auto space-y-4",children:[i.jsx(Fi,{children:i.jsx(zi,{className:"p-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:e.name}),i.jsx("p",{className:"text-gray-600",children:e.phone})]}),i.jsxs(Lh,{variant:"outline",className:"bg-purple-50 text-purple-700 border-purple-200",children:[" ",t.number]})]})})}),i.jsxs(Fi,{children:[i.jsx(Ui,{children:i.jsxs(Wi,{className:"flex items-center gap-2",children:[i.jsx(xl,{className:"w-5 h-5 text-purple-600"}),""]})}),i.jsxs(zi,{className:"space-y-4",children:["WAITING"===t.status&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:c}),i.jsx("p",{className:"text-gray-600",children:""})]}),i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"text-xl font-semibold text-purple-600",children:[h," "]}),i.jsx("p",{className:"text-gray-600",children:""})]})]}),t.paused_at&&i.jsxs("div",{className:"text-center p-2 bg-yellow-50 rounded-md",children:[i.jsx("p",{className:"text-orange-600 font-medium",children:""}),i.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[":"," ",new Date(t.paused_at).toLocaleTimeString("th-TH")]})]}),"ACTIVE"===t.status&&i.jsxs("div",{className:"text-center p-2 bg-green-50 rounded-md",children:[i.jsx("p",{className:"text-green-600 font-medium",children:""}),i.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[":"," ",new Date(t.called_at||"").toLocaleTimeString("th-TH")]})]}),"COMPLETED"===t.status&&i.jsxs("div",{className:"text-center p-2 bg-blue-50 rounded-md",children:[i.jsx("p",{className:"text-blue-600 font-medium",children:""}),i.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[":"," ",new Date(t.completed_at||"").toLocaleTimeString("th-TH")]})]})]})]}),i.jsxs(Fi,{children:[i.jsx(Ui,{children:i.jsx(Wi,{className:"text-lg",children:""})}),i.jsx(zi,{className:"space-y-3",children:i.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[i.jsxs(gu,{onClick:()=>l("/patient-portal/appointments"),className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:[i.jsx(ao,{className:"w-4 h-4 mr-2"}),""]}),i.jsxs(gu,{onClick:()=>l("/patient-portal/profile"),variant:"outline",className:"w-full border-green-600 text-green-600 hover:bg-green-50",children:[i.jsx(Sl,{className:"w-4 h-4 mr-2"}),""]})]})})]}),i.jsx(Fi,{children:i.jsxs(zi,{className:"p-4 space-y-3",children:[s.length>1&&i.jsxs(gu,{onClick:a,variant:"outline",className:"w-full",children:[i.jsx(Tl,{className:"w-4 h-4 mr-2"}),""]}),i.jsxs(gu,{onClick:r,variant:"outline",className:"w-full",children:[i.jsx(Qo,{className:"w-4 h-4 mr-2"}),""]})]})})]})})},VE=({patient:e,isSelected:t,onSelect:s,onAppointmentsClick:r,onMedicationsClick:a,onProfileClick:o,onQueueClick:l})=>{const[c,d]=n.useState(null),[u,h]=n.useState(!0);n.useEffect(()=>{(async()=>{try{const t=Nu(),{data:s,error:r}=await qa.from("queues").select("*").eq("patient_id",e.id).in("status",["WAITING","ACTIVE"]).eq("queue_date",t).order("created_at",{ascending:!1}).limit(1);if(r)return;s&&s.length>0&&d(s[0])}catch(t){}finally{h(!1)}})()},[e.id]);return i.jsxs(Fi,{className:"cursor-pointer transition-all duration-200 hover:shadow-md "+(t?"ring-2 ring-blue-500 border-blue-500":""),onClick:()=>s(e),children:[i.jsx(Ui,{className:"pb-3",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs(Wi,{className:"text-lg flex items-center gap-2",children:[i.jsx(Cl,{className:"w-5 h-5"}),e.name]}),(()=>{if(u)return i.jsx(Lh,{variant:"secondary",children:"..."});if(!c)return i.jsx(Lh,{variant:"outline",children:""});switch(c.status){case"WAITING":return i.jsx(Lh,{variant:"default",className:"bg-yellow-500",children:""});case"ACTIVE":return i.jsx(Lh,{variant:"default",className:"bg-green-500",children:""});default:return i.jsx(Lh,{variant:"outline",children:""})}})()]})}),i.jsx(zi,{className:"pt-0",children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[i.jsx(_o,{className:"w-4 h-4"}),i.jsx("span",{children:e.ID_card})]}),i.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[i.jsx(Po,{className:"w-4 h-4"}),i.jsx("span",{children:e.address})]}),c&&i.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[i.jsxs("div",{className:"flex items-center gap-2 text-blue-800 font-medium mb-2",children:[i.jsx(jo,{className:"w-4 h-4"}),i.jsx("span",{children:""})]}),i.jsxs("div",{className:"space-y-1 text-sm",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:":"}),i.jsxs("span",{className:"font-medium",children:[c.type,"-",String(c.number).padStart(3,"0")]})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:":"}),i.jsx("span",{className:"font-medium",children:(m=c.type,{GENERAL:"",APPOINTMENT:"",EMERGENCY:"",PHARMACY:""}[m]||m)})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:":"}),i.jsx("span",{className:"font-medium",children:new Date(c.created_at).toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit"})})]})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-4",children:[i.jsxs(gu,{size:"sm",variant:"outline",className:"text-blue-600 border-blue-200 hover:bg-blue-50",onClick:t=>{t.stopPropagation(),r&&r(e)},children:[i.jsx(ao,{className:"w-4 h-4 mr-1"}),""]}),i.jsxs(gu,{size:"sm",variant:"outline",className:"text-green-600 border-green-200 hover:bg-green-50",onClick:t=>{t.stopPropagation(),a&&a(e)},children:[i.jsx(xl,{className:"w-4 h-4 mr-1"}),""]}),i.jsxs(gu,{size:"sm",variant:"outline",className:"text-purple-600 border-purple-200 hover:bg-purple-50",onClick:t=>{t.stopPropagation(),o&&o(e)},children:[i.jsx(gl,{className:"w-4 h-4 mr-1"}),""]}),c&&i.jsxs(gu,{size:"sm",variant:"outline",className:"text-orange-600 border-orange-200 hover:bg-orange-50",onClick:t=>{s(e)},children:[i.jsx(jo,{className:"w-4 h-4 mr-1"}),""]})]})]})})]});var m},zE=({patients:e,selectedPatient:t,onSelectPatient:s,onLogout:r,onClearQueueHistory:n})=>{const a=u(),o=e=>{try{sessionStorage.setItem("appointmentPatientContext",JSON.stringify(e)),a("/patient-portal/appointments")}catch(t){}},l=e=>{try{sessionStorage.setItem("medicationPatientContext",JSON.stringify(e)),a("/patient-portal/medications")}catch(t){}},c=e=>{try{sessionStorage.setItem("profilePatientContext",JSON.stringify(e)),a("/patient-portal/profile")}catch(t){}},d=(e,t)=>{try{sessionStorage.setItem("queuePatientContext",JSON.stringify(e)),sessionStorage.setItem("activeQueueContext",JSON.stringify(t)),a("/patient-portal/")}catch(s){}};return i.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:i.jsxs("div",{className:"max-w-2xl mx-auto",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:""}),i.jsxs(gu,{variant:"outline",onClick:r,className:"text-red-600 border-red-300 hover:bg-red-50",children:[i.jsx(Qo,{className:"w-4 h-4 mr-2"}),""]})]}),e.length>1&&i.jsx(Fi,{className:"mb-6 border-blue-200 bg-blue-50",children:i.jsx(zi,{className:"p-4",children:i.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[i.jsx(fo,{className:"w-5 h-5"}),i.jsxs("span",{className:"font-medium",children:[" ",e.length,"  "]})]})})}),i.jsx("div",{className:"space-y-4 mb-6",children:e.map(e=>i.jsx(VE,{patient:e,isSelected:(null==t?void 0:t.id)===e.id,onSelect:s,onAppointmentsClick:o,onMedicationsClick:l,onProfileClick:c,onQueueClick:d},e.id))})]})})};function BE(){const[e,t]=n.useState(void 0);return n.useEffect(()=>{const e=window.matchMedia("(max-width: 767px)"),s=()=>{t(window.innerWidth<768)};return e.addEventListener("change",s),t(window.innerWidth<768),()=>e.removeEventListener("change",s)},[]),!!e}const HE=({queues:e,patients:t,onSelectQueue:s,onLogout:r})=>{const n=BE(),a=e=>{switch(e){case"PRIORITY":return"";case"GENERAL":return"";case"APPOINTMENT":return"";default:return e}},o=[...e].sort((e,t)=>"URGENT"===e.type&&"URGENT"!==t.type?-1:"URGENT"!==e.type&&"URGENT"===t.type?1:new Date(e.created_at).getTime()-new Date(t.created_at).getTime());return i.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-50 p-2 sm:p-4",children:[i.jsxs("div",{className:"flex justify-between items-center mb-3 sm:mb-4",children:[i.jsx("h1",{className:(n?"text-xl":"text-2xl")+" font-bold text-pharmacy-700",children:""}),i.jsx(gu,{variant:"outline",size:n?"sm":"default",onClick:r,children:""})]}),i.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3 mb-4",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx(fo,{className:"h-4 w-4 text-blue-600"}),i.jsx("span",{className:"font-medium text-blue-800",children:""})]}),i.jsx("p",{className:"text-sm text-blue-700",children:'  "" '})]}),i.jsx("div",{className:"space-y-3",children:o.map((e,r)=>{const n=(e=>{const s=t.find(t=>t.id===e);return(null==s?void 0:s.name)||""})(e.patient_id),o=(e=>5*(e+1))(r),l="URGENT"===e.type;return i.jsxs(Fi,{className:"cursor-pointer transition-all hover:shadow-md "+(l?"border-red-200 bg-red-50":"border-gray-200 bg-white"),onClick:()=>s(e),children:[i.jsx(Ui,{className:"pb-2",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"text-2xl font-bold "+(l?"text-red-600":"text-pharmacy-600"),children:$u(e.type,e.number)}),i.jsx(Lh,{variant:l?"destructive":"secondary",className:"text-xs",children:a(e.type)})]}),i.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[i.jsx(jo,{className:"h-4 w-4"}),i.jsxs("span",{children:["~",o," "]})]})]})}),i.jsxs(zi,{className:"pt-0",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"font-medium text-gray-800",children:n}),i.jsx(Lh,{variant:"outline",className:"text-xs",children:": "})]}),i.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(ao,{className:"h-3 w-3"}),i.jsxs("span",{children:[" ",(c=e.created_at,new Date(c).toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit"}))]})]}),e.notes&&i.jsx("div",{className:"flex-1 truncate",children:i.jsxs("span",{children:[": ",e.notes]})})]})]}),i.jsx(gu,{className:"w-full mt-3",size:"sm",variant:l?"destructive":"default",children:""})]})]},e.id);var c})}),0===e.length&&i.jsx(Fi,{className:"bg-white border border-gray-200",children:i.jsx(zi,{className:"p-8 flex flex-col items-center justify-center",children:i.jsx("p",{className:"text-gray-500 text-center",children:""})})})]})},GE=()=>{const{isAuthenticated:e,loading:t,selectedPatient:s,patients:r,activeQueue:n,activeQueueIns:o,availableQueues:l,phoneNumber:c,isStaffMode:d,setIsAuthenticated:u,setSelectedPatient:h,setPatients:m,setActiveQueue:p,setAvailableQueues:f,setPhoneNumber:g,setIsStaffMode:x,checkForActiveQueues:y}=eC(),{handlePatientSelect:v,handleLineLoginSuccess:b,handlePatientFound:w,handleLogout:j,handleSwitchPatient:N,handleSwitchQueue:_,handleSelectQueue:S,handleClearQueueHistory:k}=(({patients:e,setSelectedPatient:t,setActiveQueue:s,setAvailableQueues:r,setIsAuthenticated:n,setIsStaffMode:i,setPhoneNumber:o,setPatients:l,checkForActiveQueues:c})=>({handlePatientSelect:async e=>{t(e);try{const t=Nu(),{data:n,error:a}=await qa.from("queues").select("*").eq("patient_id",e.id).in("status",["WAITING","ACTIVE"]).eq("queue_date",t).order("created_at",{ascending:!1});if(a)throw a;if(n&&n.length>0){const e=n.map(e=>({...e,type:e.type,status:e.status}));r(e),1===e.length&&s(e[0])}else r([]),s(null)}catch(n){a.error("")}},handleLineLoginSuccess:async(e,t)=>{localStorage.setItem("lineToken",e),localStorage.setItem("userPhone",t),n(!0),o(t),i(!1),window.location.reload()},handlePatientFound:async e=>{n(!0),i(!0),t(e),l([e]);try{const t=new Date;t.setDate(t.getDate()-1);const{data:n,error:a}=await qa.from("queues").select("*").eq("patient_id",e.id).in("status",["WAITING","ACTIVE"]).gte("created_at",t.toISOString()).order("created_at",{ascending:!1});if(a)throw a;if(n&&n.length>0){const e=n.map(e=>({...e,type:e.type,status:e.status}));r(e),1===e.length&&s(e[0])}}catch(a){}},handleLogout:()=>{localStorage.removeItem("lineToken"),localStorage.removeItem("userPhone"),localStorage.removeItem("stepOutData"),sessionStorage.removeItem("appointmentPatientContext"),sessionStorage.removeItem("profilePatientContext"),n(!1),t(null),l([]),s(null),r([]),o(null),i(!1)},handleSwitchPatient:()=>{s(null),r([])},handleSwitchQueue:()=>{s(null)},handleSelectQueue:r=>{s(r);const n=e.find(e=>e.id===r.patient_id);n&&t(n)},handleClearQueueHistory:async e=>{try{if(!e)return;const{error:t}=await qa.from("queues").update({status:"COMPLETED",completed_at:(new Date).toISOString()}).in("status",["WAITING","ACTIVE"]).eq("patient_id",e.id);if(t)throw t;a.success(""),s(null),r([])}catch(t){a.error("")}}}))({patients:r,setSelectedPatient:h,setActiveQueue:p,setAvailableQueues:f,setIsAuthenticated:u,setIsStaffMode:x,setPhoneNumber:g,setPatients:m,checkForActiveQueues:y});return t?i.jsx(tC,{}):e?l.length>1&&!n&&s?i.jsx(HE,{queues:l,patients:r,onSelectQueue:S,onLogout:j}):o&&s?i.jsx(WE,{patient:s,queueIns:o,patients:r,onLogout:j,onSwitchPatient:N,onClearQueueHistory:()=>k(s)}):n&&s?i.jsx(UE,{patient:s,queue:n,patients:r,availableQueues:l,onLogout:j,onSwitchPatient:N,onSwitchQueue:l.length>1?_:void 0,onClearQueueHistory:()=>k(s)}):i.jsx(zE,{patients:r,selectedPatient:s,onSelectPatient:v,onLogout:j,onClearQueueHistory:()=>s&&k(s)}):i.jsx(FE,{onLoginSuccess:b,onPatientSelect:w})},KE=()=>i.jsx(GE,{}),YE=()=>{const e=f();return n.useEffect(()=>{},[e.pathname]),i.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:i.jsxs("div",{className:"text-center",children:[i.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),i.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),i.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},JE=n.forwardRef(({className:e,...t},s)=>i.jsx(at,{ref:s,className:Qi("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));JE.displayName=at.displayName;const ZE=n.forwardRef(({className:e,...t},s)=>i.jsx(it,{ref:s,className:Qi("aspect-square h-full w-full",e),...t}));ZE.displayName=it.displayName;const XE=n.forwardRef(({className:e,...t},s)=>i.jsx(ot,{ref:s,className:Qi("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));XE.displayName=ot.displayName;const eI=()=>{var e;const[t,s]=n.useState(""),[r,o]=n.useState(!1),l=u(),c=f().state;n.useEffect(()=>{(null==c?void 0:c.lineLoginSuccess)||l("/patient-portal")},[c,l]);return(null==c?void 0:c.lineLoginSuccess)?i.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-50 p-4",children:i.jsxs(Fi,{className:"w-full max-w-md",children:[i.jsx(Ui,{children:i.jsx(Wi,{className:"text-center",children:" LINE Account"})}),i.jsxs(zi,{className:"space-y-4",children:[i.jsxs("div",{className:"flex flex-col items-center space-y-2 p-4 bg-green-50 rounded-lg",children:[i.jsxs(JE,{className:"w-16 h-16",children:[i.jsx(ZE,{src:c.pictureUrl,alt:c.displayName}),i.jsx(XE,{children:(null==(e=c.displayName)?void 0:e.charAt(0))||"L"})]}),i.jsx("h3",{className:"font-medium",children:c.displayName}),c.statusMessage&&i.jsx("p",{className:"text-sm text-gray-600 text-center",children:c.statusMessage})]}),i.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),t.trim())if(null==c?void 0:c.lineUserId)try{o(!0);const{data:e,error:s}=await qa.from("patients").select("*").eq("ID_card",null==t?void 0:t.replace(/[\s-]/g,"")).single();if(s&&"PGRST116"!==s.code)throw s;if(e){const{error:s}=await qa.from("patients").update({line_user_id:c.lineUserId,line_id:c.displayName,line_picture_url:c.pictureUrl,line_status_message:c.statusMessage}).eq("id",e.id);if(s)throw s;localStorage.setItem("userPhone",null==t?void 0:t.replace(/[\s-]/g,"")),a.success(" LINE Account "),l("/patient-portal")}else a.error("")}catch(s){a.error("")}finally{o(!1)}else a.error(" LINE Account");else a.error("")},className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{htmlFor:"phone",className:"text-sm font-medium text-gray-700",children:""}),i.jsx(Ux,{id:"phone",type:"text",placeholder:"",value:t,onChange:e=>{s((e=>{const t=e.replace(/\D/g,"");return t.length<=13?t.replace(/(\d{1})(\d{4})(\d{5})(\d{2})(\d{1})/,"$1-$2-$3-$4-$5"):e})(e.target.value))},maxLength:17,required:!0}),i.jsx("p",{className:"text-xs text-gray-500",children:" LINE "})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(gu,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{l("/patient-portal")},children:""}),i.jsx(gu,{type:"submit",className:"flex-1 bg-[#06C755] hover:bg-[#06B048] text-white",disabled:r,children:r?"...":""})]})]})]})]})}):null},tI=()=>{const[e,t]=n.useState(!0),[s,r]=n.useState(null),o=u(),l=f();return n.useEffect(()=>{(async()=>{try{const e=new URLSearchParams(l.search),t=e.get("code"),s=e.get("state"),r=e.get("error"),n=e.get("error_description");if(r)throw new Error(n||"LINE login failed");const i=localStorage.getItem("lineLoginState"),c=sessionStorage.getItem("lineLoginState");if(!s||s!==i&&s!==c)throw new Error("Invalid state parameter");if(!t)throw new Error("No authorization code received");const d=await NE.exchangeToken(t);let u;localStorage.setItem("lineToken",d.access_token),u=d.profile?d.profile:await NE.getProfile(d.access_token),localStorage.setItem("lineProfile",JSON.stringify(u)),localStorage.setItem("lineUserId",u.userId);const{data:h,error:m}=await qa.from("patients").select("*").eq("line_user_id",u.userId).single();m&&m.code,h?(localStorage.setItem("userPhone",h.ID_card),localStorage.setItem("lineToken",d.access_token),a.success(""),o("/patient-portal")):o("/patient-portal/connect-phone",{state:{lineLoginSuccess:!0,lineUserId:u.userId,displayName:u.displayName,pictureUrl:u.pictureUrl,statusMessage:u.statusMessage}}),localStorage.removeItem("lineLoginState"),sessionStorage.removeItem("lineLoginState")}catch(e){r(e instanceof Error?e.message:"Unknown error occurred"),a.error("")}finally{t(!1)}})()},[l,o]),e?i.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500 mb-4"}),i.jsx("p",{className:"text-lg",children:"..."})]}):s?i.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:[i.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:i.jsxs("p",{children:[": ",s]})}),i.jsx("button",{onClick:()=>o("/patient-portal"),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:""})]}):null},sI=({children:e})=>{const[t,s]=n.useState(!0),[r,o]=n.useState(!1),[l,c]=n.useState([]),[d,h]=n.useState(null),m=u(),p=f();n.useEffect(()=>{(async()=>{try{const e=localStorage.getItem("lineToken"),t=localStorage.getItem("userPhone");if(!e||!t)return void m("/patient-portal");const{data:s,error:r}=await qa.from("patients").select("*").eq("ID_card",t);if(r)return a.error(" "),localStorage.removeItem("lineToken"),localStorage.removeItem("userPhone"),void m("/patient-portal");if(!s||0===s.length)return a.error(" "),localStorage.removeItem("lineToken"),localStorage.removeItem("userPhone"),void m("/patient-portal");c(s);const n=localStorage.getItem("selectedPatientId");if(n){const e=s.find(e=>e.id===n);e&&h(e)}o(!0)}catch(e){a.error(""),localStorage.removeItem("lineToken"),localStorage.removeItem("userPhone"),m("/patient-portal")}finally{s(!1)}})()},[m,p.pathname]);return t?i.jsx(tC,{}):r&&0!==l.length?i.jsx(i.Fragment,{children:e(l,d,e=>{h(e),localStorage.setItem("selectedPatientId",e.id)})}):null},rI=Gg({date:Wg().min(1,""),time:Wg().min(1,""),purpose:Wg().min(1,""),notes:Wg().optional()}),nI=({open:e,onOpenChange:t,patient:s,appointment:r,onSuccess:n})=>{const o=sf({resolver:hf(rI),defaultValues:{date:r?zc(new Date(r.date),"yyyy-MM-dd"):"",time:r?zc(new Date(r.date),"HH:mm"):"",purpose:(null==r?void 0:r.purpose)||"",notes:(null==r?void 0:r.notes)||""}});d.useEffect(()=>{if(r){const e=new Date(r.date);o.reset({date:zc(e,"yyyy-MM-dd"),time:zc(e,"HH:mm"),purpose:r.purpose,notes:r.notes||""})}else o.reset({date:"",time:"",purpose:"",notes:""})},[r,o]);const l=new Date;l.setDate(l.getDate()+1);const c=zc(l,"yyyy-MM-dd");return i.jsx(Uh,{open:e,onOpenChange:t,children:i.jsxs(Bh,{className:"sm:max-w-md",children:[i.jsx(Hh,{children:i.jsx(Kh,{children:r?"":""})}),i.jsx(hv,{...o,children:i.jsxs("form",{onSubmit:o.handleSubmit(async e=>{try{const t=new Date(`${e.date}T${e.time}`),i=new Date;if(i.setHours(0,0,0,0),t.toDateString()===i.toDateString())return void a.error(" ");if(t<=i)return void a.error("");const o={patient_id:s.id,date:t.toISOString(),purpose:e.purpose,notes:e.notes||null,status:"SCHEDULED"};if(r){const{error:e}=await qa.from("appointments").update(o).eq("id",r.id);if(e)throw e;a.success("")}else{const{error:e}=await qa.from("appointments").insert(o);if(e)throw e;a.success("")}n()}catch(t){a.error("")}}),className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(pv,{control:o.control,name:"date",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{type:"date",min:c,...e})}),i.jsx(wv,{})]})}),i.jsx(pv,{control:o.control,name:"time",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{type:"time",...e})}),i.jsx(wv,{})]})})]}),i.jsx(pv,{control:o.control,name:"purpose",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{...e,placeholder:" , , "})}),i.jsx(wv,{})]})}),i.jsx(pv,{control:o.control,name:"notes",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:" ()"}),i.jsx(vv,{children:i.jsx(zx,{...e,placeholder:"...",rows:3})}),i.jsx(wv,{})]})}),i.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[i.jsx(gu,{type:"button",variant:"outline",onClick:()=>t(!1),children:""}),i.jsx(gu,{type:"submit",className:"bg-green-600 hover:bg-green-700",children:r?"":""})]})]})})]})})},aI=({patient:e})=>{const t=u(),[s,r]=n.useState([]),[o,l]=n.useState(!0),[c,d]=n.useState(!1),[h,m]=n.useState(null),[p,f]=n.useState(null),g=async()=>{try{const{data:t,error:s}=await qa.from("appointments").select("*").eq("patient_id",e.id).order("date",{ascending:!0});if(s)throw s;r(t||[])}catch(t){a.error("")}finally{l(!1)}};n.useEffect(()=>{g()},[e.id]);const x=e=>{switch(e){case"SCHEDULED":return"bg-blue-100 text-blue-800";case"COMPLETED":return"bg-green-100 text-green-800";case"CANCELLED":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},y=e=>{switch(e){case"SCHEDULED":return"";case"COMPLETED":return"";case"CANCELLED":return"";default:return e}};return o?i.jsx("div",{className:"flex items-center justify-center min-h-screen",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"})}):i.jsxs("div",{className:"min-h-screen bg-gray-50 p-4",children:[i.jsxs("div",{className:"max-w-2xl mx-auto",children:[i.jsx("div",{className:"flex items-center justify-between mb-6",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(gu,{variant:"ghost",size:"sm",onClick:()=>t("/patient-portal"),children:i.jsx(Zi,{className:"w-4 h-4"})}),i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:""})]})}),i.jsxs(Fi,{className:"mb-4",children:[i.jsx(Ui,{className:"pb-3",children:i.jsx(Wi,{className:"text-lg",children:""})}),i.jsxs(zi,{children:[i.jsxs("div",{className:"flex items-center gap-1 text-gray-700 mb-1",children:[i.jsx(Cl,{className:"w-4 h-4"}),i.jsx("span",{children:e.name})]}),i.jsxs("div",{className:"flex items-center gap-1 text-gray-700 mb-1",children:[i.jsx(_o,{className:"w-4 h-4"}),i.jsx("span",{children:e.ID_card})]}),i.jsxs("div",{className:"flex items-center gap-1 text-gray-700 mb-1",children:[i.jsx(Po,{className:"w-4 h-4"}),i.jsx("span",{children:e.address})]})]})]}),i.jsx("div",{className:"space-y-4",children:0===s.length?i.jsx(Fi,{children:i.jsxs(zi,{className:"py-8 text-center",children:[i.jsx(ao,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),i.jsx("p",{className:"text-gray-500",children:""})]})}):s.map(e=>i.jsx(Fi,{children:i.jsx(zi,{className:"p-4",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx(ao,{className:"w-4 h-4 text-gray-500"}),i.jsx("span",{className:"font-medium",children:zc(new Date(e.date),"dd MMMM yyyy, HH:mm .",{locale:cu})}),i.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${x(e.status)}`,children:y(e.status)})]}),i.jsx("p",{className:"text-gray-900 font-medium mb-1",children:e.purpose}),e.notes&&i.jsx("p",{className:"text-gray-600 text-sm",children:e.notes})]}),i.jsx("div",{className:"flex gap-2 ml-4"})]})})},e.id))})]}),i.jsx(nI,{open:c,onOpenChange:d,patient:e,appointment:h,onSuccess:()=>{d(!1),m(null),g()}}),i.jsx(iS,{open:!!p,onOpenChange:e=>!e&&f(null),onConfirm:async()=>{if(p)try{const{error:e}=await qa.from("appointments").delete().eq("id",p);if(e)throw e;a.success(""),f(null),g()}catch(e){a.error("")}}})]})},iI=Gg({name:Wg().min(1,""),phone:Wg().min(0,""),ID_card:Wg().min(1,""),line_id:Wg().optional(),address:Wg().optional(),gender:Wg().optional(),birth_date:Wg().optional(),distance_from_hospital:Wg().optional()}),oI=({patient:e})=>{var t;const s=u(),[r,o]=n.useState(!1),l=sf({resolver:hf(iI),defaultValues:{name:e.name||"",phone:e.phone||"",ID_card:e.ID_card||"",line_id:e.line_id||"",address:e.address||"",gender:e.gender||"",birth_date:e.birth_date||"",distance_from_hospital:(null==(t=e.distance_from_hospital)?void 0:t.toString())||""}});return i.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:i.jsxs("div",{className:"max-w-2xl mx-auto",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[i.jsx(gu,{variant:"ghost",size:"sm",onClick:()=>s("/patient-portal"),children:i.jsx(Zi,{className:"w-4 h-4"})}),i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:""})]}),i.jsxs(Fi,{children:[i.jsx(Ui,{children:i.jsxs(Wi,{className:"flex items-center gap-2",children:[i.jsx(Cl,{className:"w-5 h-5"}),""]})}),i.jsx(zi,{children:i.jsx(hv,{...l,children:i.jsxs("form",{onSubmit:l.handleSubmit(async t=>{o(!0);try{const s={name:t.name,phone:t.phone,ID_card:t.ID_card,line_id:t.line_id||null,address:t.address||null,gender:t.gender||null,birth_date:t.birth_date||null,distance_from_hospital:t.distance_from_hospital?parseFloat(t.distance_from_hospital):null},{error:r}=await qa.from("patients").update(s).eq("id",e.id);if(r)throw r;t.ID_card!==e.ID_card&&localStorage.setItem("userPhone",t.ID_card),a.success("")}catch(s){a.error("")}finally{o(!1)}}),className:"space-y-4",children:[i.jsx(pv,{control:l.control,name:"name",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:"-"}),i.jsx(vv,{children:i.jsx(Ux,{...e,placeholder:"-"})}),i.jsx(wv,{})]})}),i.jsx(pv,{control:l.control,name:"ID_card",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{...e,placeholder:""})}),i.jsx(wv,{})]})}),i.jsx(pv,{control:l.control,name:"phone",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{...e,placeholder:""})}),i.jsx(wv,{})]})}),i.jsx(pv,{control:l.control,name:"line_id",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:"LINE ID ()"}),i.jsx(vv,{children:i.jsx(Ux,{...e,placeholder:"LINE ID"})}),i.jsx(wv,{})]})}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx(pv,{control:l.control,name:"gender",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsxs(Jh,{onValueChange:e.onChange,value:e.value||"",children:[i.jsx(vv,{children:i.jsx(Xh,{children:i.jsx(Zh,{placeholder:""})})}),i.jsxs(sm,{children:[i.jsx(rm,{value:"",children:""}),i.jsx(rm,{value:"",children:""}),i.jsx(rm,{value:"",children:""})]})]}),i.jsx(wv,{})]})}),i.jsx(pv,{control:l.control,name:"birth_date",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(Ux,{type:"date",...e})}),i.jsx(wv,{})]})})]}),i.jsx(pv,{control:l.control,name:"address",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:""}),i.jsx(vv,{children:i.jsx(zx,{...e,placeholder:"",rows:3})}),i.jsx(wv,{})]})}),i.jsx(pv,{control:l.control,name:"distance_from_hospital",render:({field:e})=>i.jsxs(xv,{children:[i.jsx(yv,{children:" ()"}),i.jsx(vv,{children:i.jsx(Ux,{type:"number",step:"0.1",min:"0",...e,placeholder:" 5.2"})}),i.jsx(wv,{})]})}),i.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[i.jsx(gu,{type:"button",variant:"outline",onClick:()=>s("/patient-portal"),children:""}),i.jsx(gu,{type:"submit",disabled:r,className:"bg-green-600 hover:bg-green-700",children:r?"...":""})]})]})})})]})]})})},lI=({patient:e,onClearQueueHistory:t})=>(BE(),i.jsxs(Fi,{className:"flex-1",children:[i.jsx(Ui,{className:"pb-2",children:i.jsx(Wi,{children:""})}),i.jsxs(zi,{children:[i.jsxs("div",{className:"flex items-center gap-1 text-gray-700 mb-1",children:[i.jsx(Cl,{className:"w-4 h-4"}),i.jsx("span",{children:e.name})]}),i.jsxs("div",{className:"flex items-center gap-1 text-gray-700 mb-1",children:[i.jsx(_o,{className:"w-4 h-4"}),i.jsx("span",{children:e.ID_card})]}),i.jsxs("div",{className:"flex items-center gap-1 text-gray-700 mb-1",children:[i.jsx(Po,{className:"w-4 h-4"}),i.jsx("span",{children:e.address})]})]})]})),cI=({patient:e})=>{const{medications:t,loading:s}=ly(e.id),[r,a]=n.useState(null),o=BE(),[l,c]=n.useState(null);return i.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsxs(gu,{variant:"ghost",size:o?"sm":"default",onClick:()=>{window.location.href="/patient-portal"},className:"flex items-center gap-2",children:[i.jsx(Zi,{className:"w-4 h-4"}),!o&&""]}),i.jsx("h1",{className:(o?"text-xl":"text-2xl")+" font-bold text-pharmacy-700",children:""})]}),i.jsxs("div",{className:"grid gap-4",children:[i.jsx(lI,{patient:e}),s?i.jsxs(Fi,{children:[i.jsx(Ui,{children:i.jsxs(Wi,{className:"flex items-center gap-2",children:[i.jsx(tl,{className:"h-5 w-5 text-pharmacy-600"}),""]})}),i.jsxs(zi,{className:"space-y-4",children:[i.jsx(ny,{className:"h-20 w-full"}),i.jsx(ny,{className:"h-20 w-full"}),i.jsx(ny,{className:"h-20 w-full"})]})]}):t&&0!==t.length?i.jsxs(Fi,{children:[i.jsx(Ui,{children:i.jsxs(Wi,{className:"flex items-center gap-2",children:[i.jsx(tl,{className:"h-5 w-5 text-pharmacy-600"}),""]})}),i.jsxs(zi,{children:[i.jsx("div",{className:"space-y-4",children:t.map(e=>{var t,s,n,o;return i.jsxs("div",{className:"p-4 rounded-md border border-gray-200 hover:border-pharmacy-200 hover:bg-pharmacy-50 transition-colors",children:[i.jsxs("div",{className:"flex items-start justify-between gap-3",children:[(null==(t=e.medication)?void 0:t.image)&&i.jsx("img",{src:e.medication.image,alt:(null==(s=e.medication)?void 0:s.name)||"Medication",className:"h-16 w-16 object-cover rounded-md border flex-shrink-0 cursor-zoom-in",loading:"lazy",onClick:()=>c(e.medication.image)}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-medium text-pharmacy-700",children:null==(n=e.medication)?void 0:n.name}),i.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.dosage})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-pharmacy-100 text-pharmacy-700"}),i.jsx(gu,{variant:"outline",size:"sm",onClick:()=>(async e=>{var t,s,r;try{a(e.id);let n="";(null==(t=e.medication)?void 0:t.description)&&(n+=e.medication.description+" "),(null==(s=e.medication)?void 0:s.name)&&(n+=e.medication.name+" "),e.dosage&&(n+=e.dosage+" "),(null==(r=e.medication)?void 0:r.unit)&&(n+=e.medication.unit),e.instructions&&(n+=e.instructions+" "),n=n.trim(),await Fu(n)}catch(n){}finally{a(null)}})(e),disabled:r===e.id,className:"h-8 w-8 p-0",children:i.jsx(El,{className:"h-4 w-4 "+(r===e.id?"animate-pulse":"")})})]})]}),(null==(o=e.medication)?void 0:o.description)&&i.jsx("p",{className:"text-sm text-gray-500 mt-2",children:e.medication.description}),e.instructions&&i.jsx("p",{className:"text-sm text-gray-600 mt-2",children:e.instructions}),i.jsxs("div",{className:"flex items-center justify-between mt-3 text-xs text-gray-500",children:[i.jsxs("span",{children:[":"," ",zc(new Date(e.start_date),"PP",{locale:cu})]}),e.end_date&&i.jsxs("span",{children:[":"," ",zc(new Date(e.end_date),"PP",{locale:cu})]})]})]},e.id)})}),i.jsx(Uh,{open:!!l,onOpenChange:e=>!e&&c(null),children:i.jsx(Bh,{className:"sm:max-w-2xl",children:l&&i.jsx("img",{src:l,alt:"Medication preview",className:"w-full h-auto max-h-[80vh] object-contain rounded-md"})})})]})]}):i.jsxs(Fi,{children:[i.jsx(Ui,{children:i.jsxs(Wi,{className:"flex items-center gap-2",children:[i.jsx(tl,{className:"h-5 w-5 text-pharmacy-600"}),""]})}),i.jsx(zi,{children:i.jsxs("div",{className:"text-center py-6",children:[i.jsx(Do,{className:"mx-auto h-12 w-12 text-gray-400 mb-2"}),i.jsx("p",{className:"text-gray-600",children:""})]})})]})]})]})})};function dI(){return i.jsx(g,{position:"bottom-right",toastOptions:{className:"rounded-md border border-border bg-background text-foreground",style:{background:"hsl(var(--background))",color:"hsl(var(--foreground))",border:"1px solid hsl(var(--border))"}}})}const uI=Qa("generatePrintContentINS");async function hI(e){const{queueNumber:t,phoneNumber:s="",purpose:r="",estimatedWaitTime:n=15,waitTiemQueueNext:a=0,queueType:i}=e,o=Zu(i,t),l=`${jm}/patient-portal`;uI.debug(`Generated QR URL: ${l}`);const c=(new Date).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}),d=(new Date).toLocaleTimeString("th-TH");uI.debug(`Formatted date and time: ${c} ${d}`);const{hospital_name:u,hospital_phone:h}=await async function(){try{const{data:e,error:t}=await qa.from("settings").select("key, value").eq("category","general").in("key",["hospital_name","hospital_phone"]);if(t)return{hospital_name:"",hospital_phone:""};const s={hospital_name:"",hospital_phone:""};return e&&e.length>0&&e.forEach(e=>{"hospital_name"!==e.key&&"hospital_phone"!==e.key||(s[e.key]=e.value)}),s}catch(e){return{hospital_name:"",hospital_phone:""}}}();return uI.debug(`Hospital settings: ${u}, ${h}`),`\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <title> ${o}</title>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"><\/script>\n        <style>\n          \n  body {\n    font-family: 'Sukhumvit Set', 'Prompt', system-ui, sans-serif;\n    padding: 20px;\n    text-align: center;\n  }\n  .header {\n    margin-bottom: 15px;\n    font-size: 20px;\n    font-weight: bold;\n    color: #333;\n  }\n  .queue-info {\n    margin: 16px 0;\n    font-size: 18px;\n    font-weight: bold;\n  }\n  .queue-number {\n    font-size: 72px;\n    font-weight: bold;\n    color: #0f766e;\n    margin: 20px 0;\n    padding: 10px;\n    display: inline-block;\n  }\n  .patient-info {\n    margin: 8px 0;\n    font-size: 16px;\n  }\n  .purpose-info {\n    margin: 12px 0;\n    font-size: 18px;\n    color: #444;\n    font-weight: 500;\n  }\n  .qr-container {\n    margin: 20px auto;\n    width: 200px;\n    height: 200px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n  .wait-time {\n    margin: 12px 0;\n    font-size: 16px;\n    padding: 6px 14px;\n    background-color: #f0f9ff;\n    border: 1px solid #bae6fd;\n    border-radius: 6px;\n    color: #0369a1;\n    display: inline-block;\n  }\n  .footer {\n    margin-top: 20px;\n    font-size: 14px;\n    color: #666;\n  }\n  .hospital-name {\n    font-size: 16px;\n    font-weight: bold;\n    margin-bottom: 5px;\n  }\n  @media print {\n    body {\n      margin: 0;\n      padding: 15px;\n    }\n    .queue-number {\n      font-size: 68px;\n    }\n    .wait-time {\n      background-color: #f0f9ff !important;\n      border-color: #bae6fd !important;\n      color: #0369a1 !important;\n      -webkit-print-color-adjust: exact !important;\n      print-color-adjust: exact !important;\n    }\n    \n    /* Force print background colors and images */\n    * {\n      -webkit-print-color-adjust: exact !important;\n      color-adjust: exact !important;\n      print-color-adjust: exact !important;\n    }\n  }\n\n        </style>\n      </head>\n      <body>\n        <div class="header"></div>\n        \n        <div class="queue-number">${o}</div>\n        \n        <div class="purpose-info"> ${r}</div>\n        \n        <div class="queue-info">\n          : ${c}\n        </div>\n        <div class="queue-info">\n          : ${d}\n        </div>\n        \n        \x3c!-- QR Code for patient portal --\x3e\n        <div class="qr-container">\n          <div id="qrcode"></div>\n          </div>\n          <p class="qr-text"></p>\n\n        <div class="footer">\n          <div class="hospital-name">${u}</div>\n          ${h?`<p>. ${h}</p>`:""}\n          <p></p>\n        </div>\n        \n        <script>\n          // Generate QR code when the page loads\n          window.onload = function() {\n            new QRCode(document.getElementById("qrcode"), {\n              text: "${l}",\n              width: 180,\n              height: 180,\n              colorDark: "#000000",\n              colorLight: "#ffffff",\n              correctLevel: QRCode.CorrectLevel.H\n            });\n          }\n        <\/script>\n      </body>\n    </html>\n  `}const mI=Qa("printInCurrentWindow");const pI=Qa("PrintQueueTicketINS");async function fI(e){const{queueNumber:t,phoneNumber:s,purpose:r="",estimatedWaitTime:n=15,waitTiemQueueNext:i=0,queueType:o}=e;pI.debug("----------------------------------------"),pI.debug(" PRINT INS QUEUE TICKET FUNCTION CALLED "),pI.debug("----------------------------------------"),pI.debug("[printQueueTicketINS] Queue details:",e);try{pI.debug("[printQueueTicketINS] Generating print content");const t=await hI(e);pI.debug("[printQueueTicketINS] Printing in current window"),function(e){var t;try{mI.debug("[printInCurrentWindow] Creating hidden iframe for printing");const s=document.getElementById("print-frame");s&&s.remove();const r=document.createElement("iframe");r.id="print-frame",r.style.position="fixed",r.style.right="-999999px",r.style.bottom="-999999px",r.style.width="0",r.style.height="0",r.style.border="0",document.body.appendChild(r);const n=r.contentDocument||(null==(t=r.contentWindow)?void 0:t.document);if(!n)throw new Error("Could not access iframe document");n.open(),n.write(e),n.close(),r.onload=()=>{try{mI.debug("[printInCurrentWindow] Iframe loaded, triggering print"),r.contentWindow&&r.contentWindow.focus(),setTimeout(()=>{r.contentWindow&&(r.contentWindow.print(),mI.debug("[printInCurrentWindow] Print triggered successfully"),setTimeout(()=>{r.remove(),mI.debug("[printInCurrentWindow] Print frame removed")},5e3))},500)}catch(e){mI.error("[printInCurrentWindow] Error during print:",e),a.error("",{id:"print-ticket-error"}),r.remove()}},a.success("",{id:"print-ticket"})}catch(s){mI.error("[printInCurrentWindow] Error setting up print:",s),a.error("",{id:"print-ticket-error"})}}(t),a.success("",{id:"print-ticket"})}catch(l){pI.error("[printQueueTicketINS] Error during printing process:",l),a.error("",{id:"print-ticket-error"})}}const gI=()=>{const[e,t]=n.useState({phoneNumber:"",idCard:"",houseNumber:"",moo:"",full_name:""}),[s,r]=n.useState(!1),[o,l]=n.useState(!1),[c,d]=n.useState(null),[u,h]=n.useState({}),[m,p]=n.useState(new Date),[f,g]=n.useState(!0),[x,y]=n.useState(0),[v,b]=n.useState(!1);n.useEffect(()=>{const e=setInterval(()=>{p(new Date)},1e3);return()=>clearInterval(e)},[]),n.useEffect(()=>{const e=localStorage.getItem("queue_voice_enabled");null!==e&&g("true"===e)},[]),n.useEffect(()=>{if(e.idCard)return;const t=setInterval(()=>{v||e.idCard||N()},5e3);return()=>clearInterval(t)},[e.idCard,v]);const w=e=>{const t=e.replace(/\D/g,"");return t.length<=13?t.replace(/(\d{1})(\d{4})(\d{5})(\d{2})(\d{1})/,"$1-$2-$3-$4-$5"):e},j=(e,s)=>{let r=s;"idCard"===e?r=w(s):"phoneNumber"===e&&(r=(e=>{const t=e.replace(/\D/g,"");return t.length<=10?t.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3"):e})(s)),t(t=>({...t,[e]:r})),u[e]&&h(t=>({...t,[e]:""}))},N=async()=>{var s,r;b(!0);try{const s=`thaiIDCallback_${Date.now()}`,r=await new Promise((e,t)=>{const r=()=>{delete window[s];const e=document.getElementById(s);e&&e.remove()},n=setTimeout(()=>{r(),t(new Error(" "))},1e4);window[s]=t=>{clearTimeout(n),r(),e(t)};const a=document.createElement("script");a.id=s,a.src=`https://localhost:8182/thaiid/read.jsonp?callback=${s}&section1=true&section2a=true&section2c=true`,a.onerror=()=>{clearTimeout(n),r(),t(new Error(" "))},document.body.appendChild(a)});if(!r)throw new Error((null==r?void 0:r.message)||"");const n=r;let i=[];n.HomeNo&&i.push(n.HomeNo),n.Soi&&i.push(` ${n.Soi}`),n.Trok&&i.push(` ${n.Trok}`),n.Road&&i.push(` ${n.Road}`);const o=i.join(" ");t({idCard:w(n.CitizenNo||""),full_name:`${n.FirstNameTh||""} ${n.LastNameTh||""}`.trim(),houseNumber:o,moo:n.Moo.replace(" ","")||"",phoneNumber:e.phoneNumber}),h({}),a.success("")}catch(n){iE.isAxiosError(n)?"ECONNABORTED"===n.code?a.error(" "):"ERR_NETWORK"!==n.code&&n.response?a.error((null==(r=null==(s=n.response)?void 0:s.data)?void 0:r.message)||""):a.error(" "):a.error(n.message||"")}finally{b(!1)}};const _=()=>{l(!1),d(null),t({phoneNumber:"",idCard:"",houseNumber:"",moo:"",full_name:""}),h({})},S=async()=>{if(c)try{const t=await async function(){try{const e=Nu(),{data:t,error:s}=await qa.from("queues_ins").select("*").eq("queue_date",e).eq("status","WAITING").order("created_at",{ascending:!0});if(s)return 0;const r=10,n=t.length*r;return y(n),n}catch(e){return 0}}();await fI({queueNumber:c,phoneNumber:e.phoneNumber.replace(/\D/g,"")||"",purpose:"",estimatedWaitTime:15,queueType:"CHECK",waitTiemQueueNext:t})}catch(t){a.error("",{id:"print-ticket"})}};return o&&c?i.jsxs("div",{className:"flex flex-col min-h-screen bg-pharmacy-50",children:[i.jsx(Qb,{currentTime:m,soundEnabled:f,setSoundEnabled:g,title:""}),i.jsx("main",{className:"flex-1 p-6 flex items-center justify-center",children:i.jsx(Fi,{className:"w-full max-w-md shadow-2xl border-0",children:i.jsxs(zi,{className:"p-8 text-center",children:[i.jsxs("div",{className:"mb-6",children:[i.jsx(go,{className:"w-20 h-20 text-green-500 mx-auto mb-4"}),i.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"!"}),i.jsx("p",{className:"text-gray-600",children:""})]}),i.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-2xl p-6 mb-6",children:[i.jsx("div",{className:"text-6xl font-bold mb-2",children:Zu("CHECK",c)}),i.jsx("div",{className:"text-lg opacity-90",children:""})]}),i.jsxs("div",{className:"space-y-3 mb-6 text-sm text-gray-600",children:[i.jsx("p",{children:""}),i.jsx("p",{children:""})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs(gu,{onClick:S,className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-medium py-3 rounded-xl transition-all duration-200 flex items-center justify-center gap-2",children:[i.jsx(rl,{className:"w-5 h-5"}),""]}),i.jsx(gu,{onClick:_,variant:"outline",className:"w-full border-2 border-blue-200 text-blue-600 hover:bg-blue-50 font-medium py-3 rounded-xl transition-all duration-200",children:""})]})]})})}),i.jsx(Ub,{})]}):i.jsxs("div",{className:"flex flex-col min-h-screen bg-pharmacy-50",children:[i.jsx(Qb,{currentTime:m,soundEnabled:f,setSoundEnabled:g,title:""}),i.jsx(Fb,{algorithmName:""}),i.jsx("main",{className:"flex-1 p-6 flex items-center justify-center",children:i.jsxs(Fi,{className:"w-full max-w-md shadow-2xl border-0",children:[i.jsxs(Ui,{className:"text-center pb-6",children:[i.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx(kl,{className:"w-8 h-8 text-white"})}),i.jsx(Wi,{className:"text-2xl font-bold text-gray-800",children:""}),i.jsx("p",{className:"text-gray-600 mt-2",children:""})]}),i.jsx(zi,{className:"px-6 pb-6",children:i.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),(()=>{const t={};if(e.idCard.trim()){const s=e.idCard.replace(/[\s-]/g,"");/^\d{13}$/.test(s)||(t.idCard=" 13 ")}else t.idCard="";if(e.full_name.trim()||(t.full_name="-"),e.phoneNumber.trim()){const s=e.phoneNumber.replace(/[\s-]/g,"");/^0\d{9}$/.test(s)||(t.phoneNumber=" 10   0")}return h(t),0===Object.keys(t).length})()){r(!0);try{const t=await(async()=>{try{const e=Nu(),{data:t}=await qa.from("queues_ins").select("number").eq("queue_date",e).order("number",{ascending:!1}).limit(1);return t&&t.length>0?t[0].number+1:1}catch(p){return 1}})(),s=Nu(),r=e.idCard.replace(/\D/g,""),n=e.phoneNumber.replace(/\D/g,"")||null,{data:i,error:o}=await qa.from("service_points_ins").select("id").eq("enabled",!0).order("created_at",{ascending:!0}).limit(1);if(o)throw o;if(!i||0===i.length)throw new Error("No service points found");i[0].id;const{data:c,error:u}=await qa.from("patients").select("id").eq("ID_card",r).limit(1);if(u)throw u;let h;if(c&&0!==c.length){h=c[0].id;const{error:t}=await qa.from("patients").update({name:e.full_name,phone:n||"",address:e.houseNumber?`${e.houseNumber}${e.moo?`  ${e.moo}`:""}`:null}).eq("id",h)}else{const t="PT",s=Date.now().toString().slice(-6),a=`${t}${s}${Math.floor(1e3*Math.random()).toString().padStart(3,"0")}`,i={name:e.full_name,patient_id:a,phone:n||"",address:e.houseNumber?`${e.houseNumber?` ${e.houseNumber}`:""}${e.moo?`  ${e.moo}`:""}`:null,ID_card:r},{data:o,error:l}=await qa.from("patients").insert([i]).select("id");if(l)throw l;if(!o||0===o.length)throw new Error("Failed to create patient record");h=o[0].id}const m={number:t,type:"CHECK",status:"WAITING",queue_date:s,phone_number:n,ID_card:r,full_name:e.full_name,house_number:e.houseNumber||null,moo:e.moo||null,service_point_id:null},{error:p}=await qa.from("queues_ins").insert([m]);if(p)throw p;d(t),l(!0),a.success(`!  ${t}`)}catch(s){a.error(" ")}finally{r(!1)}}},className:"space-y-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs(Vx,{htmlFor:"idCard",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(_o,{className:"w-4 h-4"})," ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx(Ux,{id:"idCard",type:"text",placeholder:"X-XXXX-XXXXX-XX-X",value:e.idCard,onChange:e=>j("idCard",e.target.value),className:"h-12 rounded-xl border-2 transition-all duration-200 "+(u.idCard?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500"),maxLength:17,required:!0}),u.idCard&&i.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.idCard})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs(Vx,{htmlFor:"full_name",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(kl,{className:"w-4 h-4"}),"- ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx(Ux,{id:"full_name",type:"text",placeholder:"-",value:e.full_name,onChange:e=>j("full_name",e.target.value),className:"h-12 rounded-xl border-2 transition-all duration-200 "+(u.full_name?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500"),required:!0}),u.full_name&&i.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.full_name})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(Vx,{htmlFor:"houseNumber",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:""}),i.jsx(Ux,{id:"houseNumber",type:"text",placeholder:"",value:e.houseNumber,onChange:e=>j("houseNumber",e.target.value),className:"h-12 rounded-xl border-2 transition-all duration-200 "+(u.houseNumber?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500")}),u.houseNumber&&i.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.houseNumber})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(Vx,{htmlFor:"moo",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:""}),i.jsx(Ux,{id:"moo",type:"text",placeholder:"",value:e.moo,onChange:e=>j("moo",e.target.value),className:"h-12 rounded-xl border-2 transition-all duration-200 "+(u.moo?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500")}),u.moo&&i.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.moo})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs(Vx,{htmlFor:"phoneNumber",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[i.jsx(el,{className:"w-4 h-4"})," ()"]}),i.jsx(Ux,{id:"phoneNumber",type:"text",placeholder:"0XX-XXX-XXXX",value:e.phoneNumber,onChange:e=>j("phoneNumber",e.target.value),className:"h-12 rounded-xl border-2 transition-all duration-200 "+(u.phoneNumber?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500"),maxLength:12}),u.phoneNumber&&i.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.phoneNumber})]}),i.jsx(Im,{className:"border-blue-200 bg-blue-50",children:i.jsxs(Pm,{className:"text-blue-800 text-sm",children:[i.jsx("strong",{children:":"})," ",""]})}),i.jsx(gu,{type:"submit",disabled:s,className:"w-full h-12 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-medium rounded-xl transition-all duration-200 disabled:opacity-50",children:s?i.jsxs(i.Fragment,{children:[i.jsx(Lo,{className:"w-5 h-5 animate-spin mr-2"}),"..."]}):""})]})})]})}),i.jsx(Ub,{})]})},xI=n.createContext(void 0),yI=({children:e})=>{const[t,s]=n.useState([]),[r,a]=n.useState(null),[o,l]=n.useState(!1),c={insQueue:t,setInsQueue:s,selectedQueueItem:r,setSelectedQueueItem:a,isLoading:o,setIsLoading:l};return i.jsx(xI.Provider,{value:c,children:e})},vI=({selectedServicePoint:e,servicePoints:t,onServicePointChange:s,onRefresh:r})=>{const n=u();return i.jsx(Fi,{children:i.jsx(zi,{className:"p-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("h1",{className:"text-2xl font-bold text-pharmacy-600",children:""}),i.jsxs(Jh,{value:(null==e?void 0:e.id)||"",onValueChange:s,children:[i.jsx(Xh,{className:"w-64",children:i.jsx(Zh,{placeholder:""})}),i.jsx(sm,{children:t.map(e=>i.jsx(rm,{value:e.id,children:e.name},e.id))})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs(gu,{variant:"outline",size:"sm",onClick:r,className:"flex items-center gap-2",children:[i.jsx(al,{className:"h-4 w-4"}),""]}),i.jsxs(gu,{variant:"outline",size:"sm",onClick:()=>{n("/settings")},className:"flex items-center gap-2",children:[i.jsx(ul,{className:"h-4 w-4"}),""]})]})]})})})},bI=()=>i.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-6",children:[i.jsx("div",{className:"bg-gray-100 p-4 rounded-full mb-4",children:i.jsx(Io,{className:"h-10 w-10 text-gray-400"})}),i.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:""}),i.jsx("p",{className:"text-gray-500 max-w-sm",children:""})]}),wI=({value:e,queues:t,emptyMessage:s,getIdCard:r,onViewPatientInfo:n,onCallQueue:a,onUpdateStatus:o,onTabChange:l,onRecallQueue:c,onHoldQueue:d,onTransferClick:u,onReturnToWaiting:h,onCancelQueue:m,onCompleteQueue:p,isCompleted:f=!1,isCancelled:g=!1,servicePoints:x,selectedServicePoint:y})=>Array.isArray(t)&&0!==t.length?i.jsx(Mh,{value:e||"",className:"h-full",children:i.jsx("div",{className:"space-y-4 p-4",children:t.map(t=>i.jsxs(Fi,{className:"overflow-hidden",children:[i.jsx(zi,{className:"p-4",children:i.jsx("div",{className:"flex justify-between items-start",children:i.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>n&&n(t,e||""),children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("span",{className:"text-2xl font-bold text-gray-900",children:Zu(t.type,t.number)}),i.jsx(Lh,{variant:"default",children:t.type})]}),i.jsxs("div",{className:"flex items-center gap-1 text-gray-700 mb-1",children:[i.jsx(Cl,{className:"w-4 h-4"}),i.jsx("span",{className:"font-medium",children:t.full_name||""})]}),i.jsxs("div",{className:"flex items-center gap-1 text-gray-700 mb-1",children:[i.jsx(_o,{className:"w-4 h-4"}),i.jsx("span",{className:"font-medium",children:r?r(t):t.ID_card})]}),i.jsxs("div",{className:"flex items-center gap-1 text-gray-700 mb-1",children:[i.jsx(Po,{className:"w-4 h-4"}),i.jsxs("span",{className:"font-medium",children:[t.house_number||"-","  ",t.moo||"-"]})]}),i.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[i.jsx(jo,{className:"h-3 w-3 mr-1"}),t.created_at&&i.jsx("span",{children:Hc(new Date(t.created_at),{addSuffix:!0,locale:cu})})]})]})})}),("waiting"===e||"active"===e||"paused"===e||"skipped"===e)&&i.jsxs(Bi,{className:"px-4 py-3 flex justify-end gap-2 flex-wrap bg-gray-50",children:[n&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:()=>n(t,e||""),children:[i.jsx(Cl,{className:"h-4 w-4 mr-1"}),""]}),"waiting"===e&&m&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:()=>m(t.id),className:"border-red-200 text-red-700 hover:bg-red-50",children:[i.jsx(Pl,{className:"h-4 w-4 mr-1"}),""]}),("skipped"===e||"paused"===e)&&h&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:()=>h(t.id),children:[i.jsx(ol,{className:"h-4 w-4 mr-1"}),"paused"===e?"":""]}),"active"===e&&d&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:()=>{d(t.id)},children:[i.jsx(Yo,{className:"h-4 w-4 mr-1"}),""]}),"active"===e&&u&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:()=>u(t.id),children:[i.jsx(Xi,{className:"h-4 w-4 mr-1"}),""]}),("waiting"===e||"paused"===e)&&a&&i.jsxs(gu,{variant:"default",size:"sm",onClick:()=>{a(t.id),Uu(t.number,{code:null==y?void 0:y.code,name:null==y?void 0:y.name},t.type)},children:[i.jsx(Zo,{className:"h-4 w-4 mr-1"}),""]}),"active"===e&&o&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:()=>o(t.id,"SKIPPED"),children:[i.jsx(pl,{className:"h-4 w-4 mr-1"}),""]}),"active"===e&&c&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:()=>{c(t.id);const e=null==x?void 0:x.find(e=>e.id===t.service_point_id);Uu(t.number,{code:null==e?void 0:e.code,name:null==e?void 0:e.name},t.type)},className:"border-blue-200 text-blue-700 hover:bg-blue-50",children:[i.jsx(Xo,{className:"h-4 w-4 mr-1"}),""]}),"active"===e&&o&&i.jsxs(gu,{variant:"outline",size:"sm",onClick:()=>o(t.id,"COMPLETED"),className:"border-green-200 text-green-700 hover:bg-green-50",children:[i.jsx(lo,{className:"h-4 w-4 mr-1"}),""]})]}),"completed"===e&&i.jsx(Bi,{className:"px-4 py-3 flex justify-end items-center bg-gray-50",children:i.jsxs("div",{className:"flex items-center text-green-600",children:[i.jsx(lo,{className:"h-4 w-4 mr-1"}),i.jsx("span",{className:"text-sm",children:""})]})}),"cancelled"===e&&i.jsx(Bi,{className:"px-4 py-3 flex justify-end items-center bg-gray-50",children:i.jsxs("div",{className:"flex items-center text-red-600",children:[i.jsx(Pl,{className:"h-4 w-4 mr-1"}),i.jsx("span",{className:"text-sm",children:""})]})})]},t.id))})}):i.jsx(Mh,{value:e||"",className:"h-full",children:i.jsx("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center",children:i.jsx("p",{className:"text-gray-500",children:s})})}),jI=({open:e,onOpenChange:t,onTransfer:s,servicePoints:r,currentServicePointId:a})=>{const[o,l]=n.useState(""),c=r.filter(e=>e.id!==a);return i.jsx(Uh,{open:e,onOpenChange:t,children:i.jsxs(Bh,{className:"sm:max-w-[425px]",children:[i.jsxs(Hh,{children:[i.jsx(Kh,{children:""}),i.jsx(Yh,{children:""})]}),i.jsx("div",{className:"grid gap-4 py-4",children:i.jsxs(Jh,{value:o,onValueChange:l,children:[i.jsx(Xh,{children:i.jsx(Zh,{placeholder:""})}),i.jsx(sm,{children:c.map(e=>i.jsx(rm,{value:e.id,children:e.name},e.id))})]})}),i.jsxs(Gh,{children:[i.jsx(gu,{variant:"outline",onClick:()=>{l(""),t(!1)},children:""}),i.jsx(gu,{onClick:()=>{o&&(s(o),l(""))},disabled:!o,children:""})]})]})})},NI=({servicePointId:e="",refreshTrigger:t})=>{const[s,r]=d.useState("waiting"),{queuesByStatus:o,getIdCard:l,handleCallQueue:c,handleUpdateStatus:u,handleRecallQueue:h,handleHoldQueue:m,handleTransferQueue:p,handleReturnToWaiting:f,handleCancelQueue:g,selectedServicePoint:x,servicePoints:y}=(({servicePointId:e,refreshTrigger:t=0})=>{const[s,r]=n.useState([]),[i,o]=n.useState(!1),{servicePoints:l}=ew(),{sendSmsToNextQueueIns:c}=ih(),d=n.useCallback(async(e=!1)=>{if(e){o(!0);try{const{data:e,error:t}=await qa.from("queues_ins").select("*").eq("queue_date",Nu()).order("created_at",{ascending:!0});if(t)return;r(e||[])}catch(t){}finally{o(!1)}}},[t]);n.useEffect(()=>{d(!0)},[d,t]);const u=n.useMemo(()=>s.filter(t=>{if(t.transferred_at&&t.transferred_to_service_point_id&&t.transferred_to_service_point_id!==e)return!1;const s=["WAITING","ACTIVE","COMPLETED","SKIPPED","CANCELLED"].includes(t.status||""),r=new Date(new Date);r.setDate(r.getDate()-3);const n=t.queue_date?new Date(t.queue_date+"T00:00:00"):new Date(t.created_at||"");return s&&n>=r}),[s,e]),h=e&&l.find(t=>t.id===e)||null,m=n.useMemo(()=>({waiting:u.filter(e=>"WAITING"===e.status&&!e.paused_at),active:u.filter(t=>"ACTIVE"===t.status&&t.service_point_id===e),completed:u.filter(t=>"COMPLETED"===t.status&&t.service_point_id===e),skipped:u.filter(e=>"SKIPPED"===e.status),paused:u.filter(e=>"WAITING"===e.status&&e.paused_at)}),[u,e]),p=n.useCallback(async()=>{try{await d(!0),a.success("")}catch(e){a.error("")}},[d]);return{selectedServicePoint:h,queuesByStatus:m,queues:s,getIdCard:e=>e.ID_card||"",getIdCardData:e=>e||"",handleCallQueue:async t=>{try{const{error:r}=await qa.from("queues_ins").update({status:"ACTIVE",called_at:(new Date).toISOString(),service_point_id:e}).eq("id",t);if(r)return void a.error("");try{await c()}catch(s){Fa.error("SMS notification error (non-blocking):",s)}a.success(""),d(!0)}catch(r){a.error("")}},handleUpdateStatus:async(e,t)=>{try{const s={status:t};"COMPLETED"===t?s.completed_at=(new Date).toISOString():"CANCELLED"===t?s.cancelled_at=(new Date).toISOString():"SKIPPED"===t&&(s.skipped_at=(new Date).toISOString());const{error:r}=await qa.from("queues_ins").update(s).eq("id",e);if(r)return void a.error("");a.success(""),d(!0)}catch(s){a.error("")}},handleRecallQueue:async e=>{try{const{error:t}=await qa.from("queues_ins").update({called_at:(new Date).toISOString()}).eq("id",e);if(t)return void a.error("");a.success(""),d(!0)}catch(t){a.error("")}},handleHoldQueue:async e=>{try{const{error:t}=await qa.from("queues_ins").update({paused_at:(new Date).toISOString(),status:"WAITING"}).eq("id",e);if(t)return void a.error("");a.success(""),d(!0)}catch(t){a.error("")}},handleTransferQueue:async(e,t)=>{try{const{error:s}=await qa.from("queues_ins").update({service_point_id:t,transferred_to_service_point_id:t,transferred_at:(new Date).toISOString(),status:"WAITING"}).eq("id",e);if(s)return void a.error("");a.success(""),d(!0)}catch(s){a.error("")}},handleReturnToWaiting:async e=>{try{const{error:t}=await qa.from("queues_ins").update({status:"WAITING",paused_at:null,skipped_at:null}).eq("id",e);if(t)return void a.error("");a.success(""),d(!0)}catch(t){a.error("")}},handleCancelQueue:async e=>{try{const{error:t}=await qa.from("queues_ins").update({status:"CANCELLED",cancelled_at:(new Date).toISOString()}).eq("id",e);if(t)return void a.error("");a.success(""),d(!0)}catch(t){a.error("")}},handleManualRefresh:p,isLoading:i,servicePoints:Array.isArray(l)?l:[]}})({servicePointId:e||"",refreshTrigger:t}),[v,b]=d.useState(!1),[w,j]=d.useState(null),[N,_]=d.useState(""),[S,k]=d.useState(null),[C,T]=d.useState(!1),[E,I]=d.useState(null),P=async(e,t)=>{let s=null;if(e.ID_card)try{const{data:t,error:r}=await qa.from("patients").select("*").eq("ID_card",e.ID_card).single();!r&&t&&(s=t)}catch(r){}s||(s={id:e.id,patient_id:e.ID_card||e.id,name:e.full_name||"",phone:e.phone_number||"",address:e.house_number||e.moo?`${e.house_number?` ${e.house_number}`:""}${e.house_number&&e.moo?" ":""}${e.moo?` ${e.moo}`:""}`:"",ID_card:e.ID_card,created_at:e.created_at||(new Date).toISOString(),updated_at:e.created_at||(new Date).toISOString()}),j(s),_(`${e.type}${e.number}`),k(e.id),b(!0)};return i.jsxs("div",{className:"h-full",children:[i.jsxs(Oh,{defaultValue:"waiting",className:"h-full flex flex-col",value:s,onValueChange:r,children:[i.jsxs(Ah,{className:"grid w-full grid-cols-5 mb-4",children:[i.jsxs(Dh,{value:"waiting",className:"flex items-center gap-2",children:["",o.waiting.length>0&&i.jsx(Lh,{variant:"secondary",className:"ml-1",children:o.waiting.length})]}),i.jsxs(Dh,{value:"active",className:"flex items-center gap-2",children:["",o.active.length>0&&i.jsx(Lh,{variant:"secondary",className:"ml-1",children:o.active.length})]}),i.jsxs(Dh,{value:"paused",className:"flex items-center gap-2",children:["",o.paused.length>0&&i.jsx(Lh,{variant:"secondary",className:"ml-1",children:o.paused.length})]}),i.jsxs(Dh,{value:"skipped",className:"flex items-center gap-2",children:["",o.skipped.length>0&&i.jsx(Lh,{variant:"secondary",className:"ml-1",children:o.skipped.length})]}),i.jsxs(Dh,{value:"completed",className:"flex items-center gap-2",children:["",o.completed.length>0&&i.jsx(Lh,{variant:"secondary",className:"ml-1",children:o.completed.length})]})]}),i.jsxs("div",{className:"flex-1 overflow-auto",children:[i.jsx(wI,{value:"waiting",queues:o.waiting,emptyMessage:"",getIdCard:l,onViewPatientInfo:P,onCallQueue:c,onUpdateStatus:u,onTabChange:r,servicePoints:y,selectedServicePoint:x}),i.jsx(wI,{value:"active",queues:o.active,emptyMessage:"",getIdCard:l,onViewPatientInfo:P,onUpdateStatus:u,onRecallQueue:h,onHoldQueue:m,onTransferClick:e=>{I(e),T(!0)},onTabChange:r,servicePoints:y,selectedServicePoint:x}),i.jsx(wI,{value:"paused",queues:o.paused,emptyMessage:"",getIdCard:l,onViewPatientInfo:P,onCallQueue:c,onReturnToWaiting:f,onUpdateStatus:u,onTabChange:r,servicePoints:y,selectedServicePoint:x}),i.jsx(wI,{value:"skipped",queues:o.skipped,emptyMessage:"",getIdCard:l,onViewPatientInfo:P,onReturnToWaiting:f,onCancelQueue:g,onTabChange:r,servicePoints:y,selectedServicePoint:x}),i.jsx(wI,{value:"completed",queues:o.completed,emptyMessage:"",getIdCard:l,onViewPatientInfo:P,isCompleted:!0,onTabChange:r,servicePoints:y,selectedServicePoint:x})]})]}),i.jsx(Hy,{open:v,onOpenChange:b,patient:w,queueNumber:N,queueId:S||void 0,showCheckNotes:!0}),i.jsx(jI,{open:C,onOpenChange:T,onTransfer:async e=>{E&&(await p(E,e),T(!1),I(null))},servicePoints:y,currentServicePointId:(null==x?void 0:x.id)||""})]})},_I=({servicePointId:e,title:t="",refreshTrigger:s})=>i.jsxs(Fi,{className:"h-full flex flex-col",children:[i.jsx(Ui,{className:"flex-shrink-0",children:i.jsx(Wi,{children:t})}),i.jsx(zi,{className:"flex-1 overflow-hidden p-0",children:i.jsx(NI,{servicePointId:e,refreshTrigger:s})})]}),SI=({selectedServicePoint:e,refreshTrigger:t})=>i.jsx("div",{className:"h-full p-6",children:i.jsx(_I,{servicePointId:e.id,title:` - ${e.name}`,refreshTrigger:t})}),kI=()=>i.jsxs("div",{className:"flex flex-col items-center justify-center h-screen",children:[i.jsx(Lo,{className:"h-8 w-8 animate-spin text-primary mb-4"}),i.jsx("p",{className:"text-gray-500",children:"..."})]}),CI=()=>{const[e,t]=n.useState(0),{selectedServicePoint:s,setSelectedServicePoint:r,servicePoints:a,loading:o}=ew(),l=n.useCallback(()=>{t(e=>e+1)},[]);return o?i.jsx(kI,{}):i.jsx(yI,{children:i.jsxs("div",{className:"flex flex-col h-screen overflow-hidden",children:[i.jsx("div",{className:"p-6 border-b bg-white",children:i.jsx(vI,{selectedServicePoint:s,servicePoints:a,onServicePointChange:e=>{const t=a.find(t=>t.id===e);t&&r(t)},onRefresh:l})}),i.jsx("div",{className:"flex-1 overflow-hidden min-h-0",children:s?i.jsx(SI,{selectedServicePoint:s,refreshTrigger:e}):i.jsx(bI,{})})]})})},TI=new x({defaultOptions:{queries:{staleTime:3e5,retry:1}}});function EI(){return n.useEffect(()=>{Sk({useEdgeFunction:!1,useExternalService:!0}).catch(console.error)},[]),i.jsx(y,{client:TI,children:i.jsxs(za,{children:[i.jsx(v,{children:i.jsx("div",{className:"min-h-screen bg-background",children:i.jsxs(b,{children:[i.jsx(w,{path:"/",element:i.jsx(Ik,{fullWidth:!0,children:i.jsx(Ph,{})})}),i.jsx(w,{path:"/dashboard",element:i.jsx(Ik,{children:i.jsx(Lx,{})})}),i.jsx(w,{path:"/patients",element:i.jsx(Ik,{fullWidth:!0,children:i.jsx(Ky,{})})}),i.jsx(w,{path:"/medications",element:i.jsx(Ik,{fullWidth:!0,children:i.jsx(Dv,{})})}),i.jsx(w,{path:"/queue",element:i.jsx(Ik,{fullWidth:!0,children:i.jsx(Ib,{})})}),i.jsx(w,{path:"/appointments",element:i.jsx(Ik,{fullWidth:!0,children:i.jsx(mS,{})})}),i.jsx(w,{path:"/pharmacy",element:i.jsx(Ik,{fullWidth:!0,children:i.jsx(PS,{})})}),i.jsx(w,{path:"/ins-queue",element:i.jsx(Ik,{fullWidth:!0,children:i.jsx(CI,{})})}),i.jsx(w,{path:"/service-point-queue",element:i.jsx(Ik,{children:i.jsx(Pk,{})})}),i.jsx(w,{path:"/queue-history",element:i.jsx(Ik,{fullWidth:!0,children:i.jsx(Ok,{})})}),i.jsx(w,{path:"/ins-queue-history",element:i.jsx(Ik,{fullWidth:!0,children:i.jsx(Ak,{})})}),i.jsx(w,{path:"/analytics",element:i.jsx(Ik,{fullWidth:!0,children:i.jsx($j,{})})}),i.jsx(w,{path:"/settings",element:i.jsx(Ik,{fullWidth:!0,children:i.jsx(Oj,{})})}),i.jsx(w,{path:"/test-dashboard",element:i.jsx(Xk,{})}),i.jsx(w,{path:"/patient-portal",element:i.jsx(KE,{})}),i.jsx(w,{path:"/patient-portal/connect-phone",element:i.jsx(eI,{})}),i.jsx(w,{path:"/auth/line/callback",element:i.jsx(tI,{})}),i.jsx(w,{path:"/queue/create",element:i.jsx(yS,{})}),i.jsx(w,{path:"/queue/create-ins",element:i.jsx(gI,{})}),i.jsx(w,{path:"/queue-ticket",element:i.jsx(bS,{})}),i.jsx(w,{path:"/queue-board",element:i.jsx(Wb,{})}),i.jsx(w,{path:"/queue-board-ins",element:i.jsx(dw,{})}),i.jsx(w,{path:"/combined-queue-board",element:i.jsx(uw,{})}),i.jsx(w,{path:"/patient-portal/appointments",element:i.jsx(sI,{children:(e,t)=>{const s=sessionStorage.getItem("appointmentPatientContext"),r=s?JSON.parse(s):t||e[0];return r?i.jsx(aI,{patient:r}):(window.location.href="/patient-portal",null)}})}),i.jsx(w,{path:"/patient-portal/medications",element:i.jsx(sI,{children:(e,t)=>{const s=sessionStorage.getItem("medicationPatientContext"),r=s?JSON.parse(s):t||e[0];return r?i.jsx(cI,{patient:r}):(window.location.href="/patient-portal",null)}})}),i.jsx(w,{path:"/patient-portal/profile",element:i.jsx(sI,{children:(e,t)=>{const s=sessionStorage.getItem("profilePatientContext"),r=s?JSON.parse(s):t||e[0];return r?i.jsx(oI,{patient:r}):(window.location.href="/patient-portal",null)}})}),i.jsx(w,{path:"*",element:i.jsx(YE,{})})]})})}),i.jsx(dI,{})]})})}const II=Qa("main");"undefined"!=typeof window&&(window.React=d);const PI=()=>{try{const e=document.getElementById("root");if(!e)return II.error("Root element not found, waiting for DOM"),void setTimeout(PI,100);II.info("Mounting React application"),e.style.cssText="width: 100%; height: 100%; min-height: 100vh; background-color: hsl(var(--background, 180 25% 98%));";vt.createRoot(e).render(i.jsx(d.StrictMode,{children:i.jsx(EI,{})})),setTimeout(()=>{"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{II.info("Attempting to register service worker...");{const e=await navigator.serviceWorker.register("/serviceWorker.js",{updateViaCache:"none"});II.info("Service Worker registered with scope:",e.scope)}}catch(e){II.error("Service Worker registration failed:",e)}})},1e3)}catch(e){II.error("Error mounting React application:",e),document.body.innerHTML='<div style="color:red;padding:20px;">Failed to load application. Please refresh the page.</div>'}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",PI):PI();
//# sourceMappingURL=index-DGDJ3OvZ.js.map
